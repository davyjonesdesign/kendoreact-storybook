"use strict";(self.webpackChunkkendoreact_storybook=self.webpackChunkkendoreact_storybook||[]).push([[4859],{"./node_modules/@progress/kendo-date-math/dist/es/add-days.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>addDays});var _adjust_dst__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/adjust-dst.js"),_clone_date__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/clone-date.js"),addDays=function(date,offset){var newDate=(0,_clone_date__WEBPACK_IMPORTED_MODULE_0__.a)(date);return newDate.setDate(newDate.getDate()+offset),(0,_adjust_dst__WEBPACK_IMPORTED_MODULE_1__.t)(newDate,date.getHours())}},"./node_modules/@progress/kendo-date-math/dist/es/adjust-dst.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>adjustDST});var _clone_date__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/clone-date.js"),adjustDST=function(date,hour){var newDate=(0,_clone_date__WEBPACK_IMPORTED_MODULE_0__.a)(date);return 0===hour&&23===newDate.getHours()&&newDate.setHours(newDate.getHours()+2),newDate}},"./node_modules/@progress/kendo-date-math/dist/es/clone-date.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>cloneDate});var cloneDate=function(date){return date?new Date(date.getTime()):null}},"./node_modules/@progress/kendo-date-math/dist/es/create-date.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>createDate});var _adjust_dst__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/adjust-dst.js"),createDate=function(year,month,day,hours,minutes,seconds,milliseconds){void 0===hours&&(hours=0),void 0===minutes&&(minutes=0),void 0===seconds&&(seconds=0),void 0===milliseconds&&(milliseconds=0);var date=new Date(year,month,day,hours,minutes,seconds,milliseconds);return year>-1&&year<100&&date.setFullYear(date.getFullYear()-1900),(0,_adjust_dst__WEBPACK_IMPORTED_MODULE_0__.t)(date,hours)}},"./node_modules/@progress/kendo-date-math/dist/es/day-of-week.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>dayOfWeek});var _direction_enum__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/direction.enum.js"),_adjust_dst__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/adjust-dst.js"),_clone_date__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/clone-date.js"),dayOfWeek=function(date,weekDay,direction){void 0===direction&&(direction=_direction_enum__WEBPACK_IMPORTED_MODULE_0__.O.Forward);var newDate=(0,_clone_date__WEBPACK_IMPORTED_MODULE_1__.a)(date),newDay=(weekDay-newDate.getDay()+7*direction)%7;return newDate.setDate(newDate.getDate()+newDay),(0,_adjust_dst__WEBPACK_IMPORTED_MODULE_2__.t)(newDate,date.getHours())}},"./node_modules/@progress/kendo-date-math/dist/es/direction.enum.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var Direction;__webpack_require__.d(__webpack_exports__,{O:()=>Direction}),function(Direction){Direction[Direction.Forward=1]="Forward",Direction[Direction.Backward=-1]="Backward"}(Direction||(Direction={}))},"./node_modules/@progress/kendo-date-math/dist/es/first-day-of-month.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>firstDayOfMonth});var _create_date__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/create-date.js"),firstDayOfMonth=function(date){return(0,_create_date__WEBPACK_IMPORTED_MODULE_0__.J)(date.getFullYear(),date.getMonth(),1,date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds())}},"./node_modules/@progress/kendo-date-math/dist/es/get-date.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>getDate});var _create_date__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/create-date.js"),getDate=function(date){return(0,_create_date__WEBPACK_IMPORTED_MODULE_0__.J)(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}},"./node_modules/@progress/kendo-drawing/dist/es/util.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DEG_TO_RAD:()=>constants.Td,LRUCache:()=>lru_cache.A,MAX_NUM:()=>constants.eN,MIN_NUM:()=>constants.uo,TextMetrics:()=>text_metrics.A,append:()=>append.A,arabicToRoman:()=>arabic_to_roman.A,bindEvents:()=>bind_events.A,createPromise:()=>create_promise.A,defined:()=>defined.A,definitionId:()=>definition_id.A,deg:()=>deg.A,elementOffset:()=>element_offset.A,elementPadding:()=>element_padding.A,elementScale:()=>element_scale.A,elementSize:()=>element_size.A,elementStyles:()=>element_styles.A,encodeBase64:()=>encode_base64.A,eventCoordinates:()=>event_coordinates.A,eventElement:()=>event_element.A,hashKey:()=>util.EN,isTransparent:()=>is_transparent.A,last:()=>last.A,limitValue:()=>limit_value.A,measureText:()=>measure_text.A,mergeSort:()=>merge_sort.A,normalizeText:()=>util.fQ,now:()=>now.A,objectKey:()=>util.T5,promiseAll:()=>promise_all.A,rad:()=>rad.A,round:()=>round.A,unbindEvents:()=>unbind_events.A,valueOrDefault:()=>value_or_default.A});var append=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/append.js"),arabic_to_roman=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/arabic-to-roman.js"),create_promise=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/create-promise.js"),defined=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/defined.js"),definition_id=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/definition-id.js"),deg=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/deg.js"),encode_base64=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/encode-base64.js"),event_coordinates=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/event-coordinates.js"),event_element=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/event-element.js"),is_transparent=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/is-transparent.js"),last=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/last.js"),limit_value=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/limit-value.js"),merge_sort=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/merge-sort.js"),now=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/now.js"),promise_all=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/promise-all.js"),rad=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/rad.js"),round=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/round.js"),value_or_default=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/value-or-default.js"),bind_events=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/bind-events.js"),element_offset=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-offset.js"),element_size=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-size.js"),element_styles=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-styles.js"),unbind_events=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/unbind-events.js"),element_padding=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-padding.js"),element_scale=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-scale.js"),constants=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/constants.js"),lru_cache=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/text-metrics/lru-cache.js"),text_metrics=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/text-metrics/text-metrics.js"),measure_text=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/text-metrics/measure-text.js"),util=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/text-metrics/util.js")},"./node_modules/@progress/kendo-drawing/dist/es/util/bind-events.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function bindEvents(element,events){for(var eventName in events)for(var eventNames=eventName.trim().split(" "),idx=0;idx<eventNames.length;idx++)element.addEventListener(eventNames[idx],events[eventName],!1)}__webpack_require__.d(__webpack_exports__,{A:()=>bindEvents})},"./node_modules/@progress/kendo-drawing/dist/es/util/element-offset.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function elementOffset(element){var box=element.getBoundingClientRect(),documentElement=document.documentElement;return{top:box.top+(window.pageYOffset||documentElement.scrollTop)-(documentElement.clientTop||0),left:box.left+(window.pageXOffset||documentElement.scrollLeft)-(documentElement.clientLeft||0)}}__webpack_require__.d(__webpack_exports__,{A:()=>elementOffset})},"./node_modules/@progress/kendo-drawing/dist/es/util/element-padding.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>elementPadding});var _element_styles__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-styles.js");function elementPadding(element){var ref=(0,_element_styles__WEBPACK_IMPORTED_MODULE_0__.A)(element,["paddingLeft","paddingTop"]),paddingLeft=ref.paddingLeft,paddingTop=ref.paddingTop;return{top:parseFloat(paddingTop),left:parseFloat(paddingLeft)}}},"./node_modules/@progress/kendo-drawing/dist/es/util/element-scale.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>elementScale});var _geometry_matrix__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/geometry/matrix.js"),matrixRegexp=/matrix\((.*)\)/;function transformMatrix(element){var transform=getComputedStyle(element).transform;return"none"===transform?_geometry_matrix__WEBPACK_IMPORTED_MODULE_0__.A.unit():function parseMatrix(matrixString){var match=matrixString.match(matrixRegexp);if(null===match||2!==match.length)return _geometry_matrix__WEBPACK_IMPORTED_MODULE_0__.A.unit();var members=match[1].split(",").map((function(x){return parseFloat(x)}));return new(Function.prototype.bind.apply(_geometry_matrix__WEBPACK_IMPORTED_MODULE_0__.A,[null].concat(members)))}(transform)}function elementScale(element){if(!element)return _geometry_matrix__WEBPACK_IMPORTED_MODULE_0__.A.unit();for(var matrix=transformMatrix(element),parent=element.parentElement;parent;){var parentMatrix=transformMatrix(parent);matrix=matrix.multiplyCopy(parentMatrix),parent=parent.parentElement}return matrix.b=matrix.c=matrix.e=matrix.f=0,matrix}},"./node_modules/@progress/kendo-drawing/dist/es/util/element-size.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>elementSize});var _element_styles__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/element-styles.js"),_defined__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/defined.js");function getPixels(value){return isNaN(value)?value:value+"px"}function elementSize(element,size){if(!size){var size$1=(0,_element_styles__WEBPACK_IMPORTED_MODULE_1__.A)(element,["width","height"]);return{width:parseInt(size$1.width,10),height:parseInt(size$1.height,10)}}var width=size.width,height=size.height;(0,_defined__WEBPACK_IMPORTED_MODULE_0__.A)(width)&&(element.style.width=getPixels(width)),(0,_defined__WEBPACK_IMPORTED_MODULE_0__.A)(height)&&(element.style.height=getPixels(height))}},"./node_modules/@progress/kendo-drawing/dist/es/util/element-styles.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function elementStyles(element,styles){for(var result={},style=window.getComputedStyle(element)||{},stylesArray=Array.isArray(styles)?styles:[styles],idx=0;idx<stylesArray.length;idx++){var field=stylesArray[idx];result[field]=style[field]}return result}__webpack_require__.d(__webpack_exports__,{A:()=>elementStyles})},"./node_modules/@progress/kendo-drawing/dist/es/util/event-coordinates.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>eventCoordinates});var _defined__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util/defined.js");function eventCoordinates(e){return(0,_defined__WEBPACK_IMPORTED_MODULE_0__.A)((e.x||{}).location)?{x:e.x.location,y:e.y.location}:{x:e.pageX||e.clientX||0,y:e.pageY||e.clientY||0}}},"./node_modules/@progress/kendo-drawing/dist/es/util/event-element.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function eventElement(e){return void 0===e&&(e={}),e.touch?e.touch.initialTouch:e.target}__webpack_require__.d(__webpack_exports__,{A:()=>eventElement})},"./node_modules/@progress/kendo-drawing/dist/es/util/now.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=Date.now||function(){return(new Date).getTime()}},"./node_modules/@progress/kendo-drawing/dist/es/util/promise-all.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function promiseAll(promises){return Promise.all(promises)}__webpack_require__.d(__webpack_exports__,{A:()=>promiseAll})},"./node_modules/@progress/kendo-drawing/dist/es/util/unbind-events.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function unbindEvents(element,events){for(var name in void 0===events&&(events={}),events)for(var eventNames=name.trim().split(" "),idx=0;idx<eventNames.length;idx++)element.removeEventListener(eventNames[idx],events[name],!1)}__webpack_require__.d(__webpack_exports__,{A:()=>unbindEvents})},"./node_modules/@progress/kendo-react-buttons/dist/es/ListButton/DropDownButton.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>DropDownButton});var extendStatics,react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),Button=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/Button.js"),guid=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/guid.js"),keys=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/keys.js"),getActiveElement=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/getActiveElement.js"),classNames=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/classNames.js"),theme=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/theme.js"),utils=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/icons/utils.js"),dispatchEvent=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/events/dispatchEvent.js"),navigation=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/ListButton/utils/navigation.js"),__extends=(extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),DropDownButtonItem=function(_super){function DropDownButtonItem(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(DropDownButtonItem,_super),DropDownButtonItem.prototype.render=function(){return null},DropDownButtonItem.propTypes={text:prop_types.string,icon:prop_types.string,iconClass:prop_types.string,imageUrl:prop_types.string,selected:prop_types.bool,disabled:prop_types.bool,render:prop_types.any},DropDownButtonItem}(react.Component),ButtonItem=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/ListButton/ButtonItem.js"),Popup=__webpack_require__("./node_modules/@progress/kendo-react-popup/dist/es/Popup.js"),popup=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/ListButton/utils/popup.js"),validate_package=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/validate-package.js"),package_metadata=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/package-metadata.js"),DropDownButton_extends=function(){var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},DropDownButton=function(_super){function DropDownButton(props){var _this=_super.call(this,props)||this;return _this.state={opened:!1,focused:!1,focusedIndex:-1},_this.wrapper=null,_this.mainButton=null,_this.list=null,_this.skipFocus=!1,_this.guid=(0,guid.O)(),_this.buttonsData=[],_this.onKeyDown=function(event){var focusedIndex=_this.state.focusedIndex;if(event.altKey)_this.opened||event.keyCode!==keys.D.down?_this.opened&&event.keyCode===keys.D.up&&(_this.setState({focusedIndex:-1}),_this.setOpen(!1)):(_this.setOpen(!0),_this.dispatchPopupEvent(event,!0),_this.setState({focusedIndex:0}));else{var newState=__assign({},_this.state);if(event.keyCode===keys.D.enter||event.keyCode===keys.D.space){focusedIndex>=0&&_this.dispatchClickEvent(event,focusedIndex),event.preventDefault();var notOpened=!_this.opened;return _this.setOpen(notOpened),void(notOpened&&(_this.dispatchPopupEvent(event,!0),_this.setState({focusedIndex:_this.opened?-1:0})))}if(_this.opened&&event.keyCode===keys.D.esc)return _this.setState({focusedIndex:-1}),void _this.setOpen(!1);if(_this.opened){var newFocused=(0,navigation.o)(focusedIndex,event.keyCode,event.altKey,_this.buttonsData.length);newState.focusedIndex=newFocused;var arrowKey=event.keyCode===keys.D.up||event.keyCode===keys.D.down||event.keyCode===keys.D.left||event.keyCode===keys.D.right;event.altKey||!arrowKey&&event.keyCode!==keys.D.home&&event.keyCode!==keys.D.end||event.preventDefault()}_this.setState(newState)}},_this.switchFocus=function(focusFn){_this.skipFocus=!0,focusFn(),window.setTimeout((function(){return _this.skipFocus=!1}),0)},_this.handleFocus=function(event){_this.skipFocus||(_this.setState({focused:!0,focusedIndex:_this.opened?0:-1}),(0,dispatchEvent.P)(_this.props.onFocus,event,_this,void 0))},_this.handleBlur=function(event){_this.skipFocus||(_this.setState({focused:!1,focusedIndex:-1}),_this.setOpen(!1),(0,dispatchEvent.P)(_this.props.onBlur,event,_this,void 0))},_this.setOpen=function(value){_this.openedDuringOnChange=value,_this.setState({opened:value})},_this.onItemClick=function(event,clickedItemIndex){_this.setState({focusedIndex:-1}),_this.setOpen(!1),_this.dispatchClickEvent(event,clickedItemIndex)},_this.onItemDown=function(event){(0,getActiveElement.b)(document)===_this.list&&event.preventDefault()},_this.mouseDown=function(event){event.preventDefault();var activeElement=(0,getActiveElement.b)(document);_this.element&&activeElement!==_this.element&&activeElement!==_this.list&&_this.element.focus()},_this.onPopupClose=function(){_this.state.focused&&_this.switchFocus((function(){_this.element&&(_this.element.removeAttribute("tabindex"),_this.element.focus({preventScroll:!0}))})),_this.dispatchPopupEvent({},!1)},_this.listRef=function(list){_this.list=list,list&&_this.state.focused&&_this.switchFocus((function(){list.focus({preventScroll:!0}),_this.element&&(_this.element.tabIndex=-1)}))},_this.onClickMainButton=function(event){if(_this.buttonsData.length){var toOpen=!_this.opened;_this.setState({focused:!0,focusedIndex:toOpen?0:-1}),_this.setOpen(toOpen),toOpen&&_this.dispatchPopupEvent(event,toOpen)}},_this.dispatchPopupEvent=function(dispatchedEvent,open){(0,dispatchEvent.P)(open?_this.props.onOpen:_this.props.onClose,dispatchedEvent,_this,void 0),_this.openedDuringOnChange=void 0},(0,validate_package.$)(package_metadata.Q),_this}return DropDownButton_extends(DropDownButton,_super),Object.defineProperty(DropDownButton.prototype,"opened",{get:function(){return void 0!==this.openedDuringOnChange?this.openedDuringOnChange:void 0===this.props.opened?this.state.opened:this.props.opened},enumerable:!1,configurable:!0}),DropDownButton.prototype.render=function(){var _this=this,rtl=this.isRtl(),dir=rtl?"rtl":void 0,_a=this.props,id=_a.id,style=_a.style,tabIndex=_a.tabIndex,disabled=_a.disabled;return this.buttonsData=this.props.items||react.Children.toArray(this.props.children).filter((function(child){return child&&child.type===DropDownButtonItem})).map((function(child){return child.props})),react.createElement("div",{id,style,className:(0,classNames.x)("k-dropdown-button",{"k-focus":this.state.focused},this.props.className),onKeyDown:this.onKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,dir,ref:function(el){return _this.wrapper=el}},react.createElement(Button.$,{size:this.props.size,rounded:this.props.rounded,fillMode:this.props.fillMode,themeColor:this.props.themeColor,onClick:this.onClickMainButton,onMouseDown:this.mouseDown,disabled:disabled||void 0,tabIndex,accessKey:this.props.accessKey,icon:this.props.icon,svgIcon:this.props.svgIcon,iconClass:this.props.iconClass,className:this.props.buttonClass,imageUrl:this.props.imageUrl,dir,ref:function(btn){return _this.mainButton=btn&&btn.element},type:"button","aria-haspopup":!0,"aria-expanded":this.opened||void 0,"aria-label":this.props.ariaLabel,"aria-controls":this.opened?this.guid:void 0,id:"button-"+this.guid,title:this.props.title},this.props.text),this.renderPopup(rtl))},DropDownButton.prototype.componentDidMount=function(){(void 0===this.props.dir&&this.isRtl()||this.opened)&&this.forceUpdate()},Object.defineProperty(DropDownButton.prototype,"element",{get:function(){return this.mainButton},enumerable:!1,configurable:!0}),DropDownButton.prototype.dispatchClickEvent=function(dispatchedEvent,index){this.isItemDisabled(index)||(0,dispatchEvent.P)(this.props.onItemClick,dispatchedEvent,this,{item:this.buttonsData[index],itemIndex:index})},DropDownButton.prototype.renderPopup=function(rtl){var _a,_b=this.props.popupSettings,popupSettings=void 0===_b?{}:_b,focusedIndex=this.state.focusedIndex;return react.createElement(Popup.z,{anchor:this.wrapper,show:this.opened,animate:popupSettings.animate,popupClass:(0,classNames.x)("k-menu-popup",popupSettings.popupClass),anchorAlign:popupSettings.anchorAlign||(0,popup.H)(rtl),popupAlign:popupSettings.popupAlign||(0,popup.i)(rtl),style:rtl?{direction:"rtl"}:void 0,onClose:this.onPopupClose},react.createElement("ul",{role:"menu",id:this.guid,"aria-labelledby":"button-"+this.guid,tabIndex:-1,"aria-activedescendant":focusedIndex>=0?"".concat(this.guid,"-").concat(focusedIndex):void 0,ref:this.listRef,className:(0,classNames.x)("k-group k-menu-group k-reset",(_a={},_a["k-menu-group-".concat(theme.O.sizeMap[this.props.size]||this.props.size)]=this.props.size,_a))},this.renderChildItems()))},DropDownButton.prototype.renderChildItems=function(){var _this=this,_a=this.props,item=_a.item,itemRender=_a.itemRender,textField=_a.textField;return this.buttonsData.length>0?this.buttonsData.map((function(dataItem,index){return react.createElement(ButtonItem.C,{className:"k-menu-item",dataItem,textField,focused:_this.state.focusedIndex===index,onClick:_this.onItemClick,onDown:_this.onItemDown,render:itemRender,item,index,key:index,id:"".concat(_this.guid,"-").concat(index)})})):null},DropDownButton.prototype.isItemDisabled=function(index){return this.buttonsData[index]?this.buttonsData[index].disabled:this.props.disabled},DropDownButton.prototype.isRtl=function(){return void 0!==this.props.dir?"rtl"===this.props.dir:!!this.wrapper&&"rtl"===getComputedStyle(this.wrapper).direction},DropDownButton.propTypes={accessKey:prop_types.string,ariaLabel:prop_types.string,title:prop_types.string,onFocus:prop_types.func,onBlur:prop_types.func,onItemClick:prop_types.func,onOpen:prop_types.func,onClose:prop_types.func,items:prop_types.arrayOf(prop_types.any),textField:prop_types.string,tabIndex:prop_types.number,disabled:prop_types.bool,icon:prop_types.string,svgIcon:utils.jf,iconClass:prop_types.string,imageUrl:prop_types.string,popupSettings:prop_types.object,itemRender:prop_types.func,item:prop_types.func,className:prop_types.string,buttonClass:prop_types.string,dir:prop_types.string},DropDownButton.defaultProps={size:"medium",rounded:"medium",fillMode:"solid",themeColor:"base"},DropDownButton}(react.Component)},"./node_modules/@progress/kendo-react-common/dist/es/hasRelativeStackingContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>hasRelativeStackingContext});var _canUseDOM__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/canUseDOM.js"),hasRelativeStackingContext=function(elementSource){if(!_canUseDOM__WEBPACK_IMPORTED_MODULE_0__.S)return!1;var currentDocument=elementSource?elementSource.ownerDocument:document;if(!currentDocument||!currentDocument.body)return!1;var parent=currentDocument.createElement("div");parent.style.transform="matrix(10, 0, 0, 10, 0, 0)";var child=currentDocument.createElement("div");child.appendChild(currentDocument.createTextNode("child")),child.style.position="fixed",child.style.top="10px",parent.appendChild(child),currentDocument.body.appendChild(parent);var isDifferent=10!==child.getBoundingClientRect().top;return currentDocument.body.removeChild(parent),isDifferent}},"./node_modules/@progress/kendo-react-spreadsheet/dist/es/Spreadsheet.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Spreadsheet});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),ToolbarSeparator=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/toolbar/tools/ToolbarSeparator.js"),Toolbar=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/toolbar/Toolbar.js"),ButtonGroup=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/ButtonGroup.js"),Button=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/Button.js"),TabStrip=__webpack_require__("./node_modules/@progress/kendo-react-layout/dist/es/tabstrip/TabStrip.js"),TabStripTab=__webpack_require__("./node_modules/@progress/kendo-react-layout/dist/es/tabstrip/TabStripTab.js"),Dialog=__webpack_require__("./node_modules/@progress/kendo-react-dialogs/dist/es/Dialog.js"),DialogActionsBar=__webpack_require__("./node_modules/@progress/kendo-react-dialogs/dist/es/DialogActionsBar.js"),Popup=__webpack_require__("./node_modules/@progress/kendo-react-popup/dist/es/Popup.js"),IconWrap=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/icons/IconWrap.js"),index_es=__webpack_require__("./node_modules/@progress/kendo-svg-icons/dist/index.es.js");const List=react.forwardRef(((props,ref)=>{const target=react.useRef(null),ulRef=react.useRef(null);return react.useImperativeHandle(target,(()=>({element:ulRef.current,props}))),react.useImperativeHandle(ref,(()=>target.current)),react.createElement("div",{className:"k-list k-list-md"},react.createElement("div",{className:"k-list-content"},react.createElement("ul",{ref:ulRef,className:"k-spreadsheet-formula-list k-list-ul",onMouseDown:e=>e.preventDefault(),style:{maxHeight:280}},props.data.map((item=>react.createElement("li",{key:item.text,className:"k-list-item",onClick:()=>props.onItemClick(item.value)},react.createElement(IconWrap.Q,{name:"formula-fx",icon:index_es.formulaFxIcon}),react.createElement("span",{className:"k-list-item-text"},item.text)))))))}));List.displayName="List",List.propTypes={};var classNames=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/classNames.js");const FormulaInput=react.forwardRef(((props,ref)=>{const[showPopup,setShowPopup]=react.useState(!1),[popupContentKey,setPopupContentKey]=react.useState(0),[data,setData]=react.useState([]),memo=react.useMemo((()=>({})),[]);memo.showPopup=showPopup,memo.popupContentKey=popupContentKey,memo.data=data;const target=react.useRef(null),elementRef=react.useRef(null),listRef=react.useRef(null),focusedItem=react.useCallback((()=>{if(listRef.current&&listRef.current.element)return listRef.current.element.querySelector(".k-focus")}),[]),unfocus=react.useCallback((()=>{const focused=focusedItem();focused&&focused.classList.remove("k-focus")}),[]),focusNext=react.useCallback((dir=>{const items=Array.from(listRef.current&&listRef.current.element.children||[]),focused=focusedItem();let next;if(focused){const index=items.indexOf(focused);focused.classList.remove("k-focus"),next=items[index+dir]?items[index+dir]:1===dir?items[0]:items[items.length-1]}else next=1===dir?items[0]:items[items.length-1];next&&next.classList.add("k-focus")}),[]);react.useImperativeHandle(target,(()=>({element:elementRef.current,props,popup:{open:()=>{setShowPopup(!0)},close:()=>{setShowPopup(!1)},position:()=>{setPopupContentKey(memo.popupContentKey+1)},visible:()=>memo.showPopup},list:{get element(){return listRef.current&&listRef.current.element},data:d=>{if(!d)return memo.data;setData(d)},value:()=>({}),focus:()=>Array.from(listRef.current&&listRef.current.element&&listRef.current.element.children||[]).indexOf(focusedItem()),focusNext:()=>{focusNext(1)},focusPrev:()=>{focusNext(-1)},focusFirst:()=>{const list=listRef.current&&listRef.current.element;list&&list.children.item(0)&&(unfocus(),list.children.item(0).classList.add("k-focus"))},focusLast:()=>{const list=listRef.current&&listRef.current.element;list&&list.children.length&&(unfocus(),list.children.item(list.children.length-1).classList.add("k-focus"))},itemClick:handler=>{memo.itemClick=handler}}})),[]),react.useImperativeHandle(ref,(()=>target.current),[]);const onItemClick=react.useCallback((value=>{memo.itemClick&&memo.itemClick(value)}),[]);return react.createElement(react.Fragment,null,react.createElement("div",{className:(0,classNames.x)("k-spreadsheet-formula-input",props.className),contentEditable:"true",spellCheck:"false",style:{whiteSpace:"pre"},ref:elementRef}),react.createElement(Popup.z,{show:showPopup,anchor:elementRef.current,animate:{openDuration:100,closeDuration:100},contentKey:popupContentKey,popupClass:"k-list-container"},react.createElement(List,{data,ref:listRef,onItemClick})))}));FormulaInput.displayName="FormulaInput",FormulaInput.propTypes={};var ComboBox=__webpack_require__("./node_modules/@progress/kendo-react-dropdowns/dist/es/ComboBox/ComboBox.js"),useLocalization=__webpack_require__("./node_modules/@progress/kendo-react-intl/dist/es/hooks/useLocalization.js");const bold="spreadsheet.bold",italic="spreadsheet.italic",underline="spreadsheet.underline",messages_open="spreadsheet.openFile",textColor="spreadsheet.textColor",background="spreadsheet.background",addRowAbove="spreadsheet.addRowAbove",addRowBelow="spreadsheet.addRowBelow",addColumnLeft="spreadsheet.addColumnLeft",addColumnRight="spreadsheet.addColumnRight",deleteRow="spreadsheet.deleteRow",deleteColumn="spreadsheet.deleteColumn",undo="spreadsheet.undo",redo="spreadsheet.redo",fontSize="spreadsheet.fontSize",fontSizeIncrease="spreadsheet.fontSizeIncrease",fontSizeDecrease="spreadsheet.fontSizeDecrease",fontName="spreadsheet.fontName",cleanFormatting="spreadsheet.cleanFormatting",format="spreadsheet.format",alignHorizontally="spreadsheet.alignHorizontally",alignVertically="spreadsheet.alignVertically",align="spreadsheet.align",alignLeft="spreadsheet.alignLeft",alignRight="spreadsheet.alignRight",alignCenter="spreadsheet.alignCenter",center="spreadsheet.center",alignJustify="spreadsheet.alignJustify",justify="spreadsheet.justify",alignTop="spreadsheet.alignTop",alignMiddle="spreadsheet.alignMiddle",alignBottom="spreadsheet.alignBottom",increaseDecimal="spreadsheet.increaseDecimal",decreaseDecimal="spreadsheet.decreaseDecimal",textWrap="spreadsheet.textWrap",gridLines="spreadsheet.gridLines",exportToExcel="spreadsheet.exportToExcel",nameBox="spreadsheet.nameBox",defaultSheetName="spreadsheet.defaultSheetName",home="spreadsheet.home",file="spreadsheet.file",insert="spreadsheet.insert",formatTab="spreadsheet.formatTab",addNewSheet="spreadsheet.addNewSheet",error="spreadsheet.error",ok="spreadsheet.ok",modifyMerged="spreadsheet.modifyMerged",cannotModifyDisabled="spreadsheet.cannotModifyDisabled",openUnsupported="spreadsheet.openUnsupported",duplicateSheetName="spreadsheet.duplicateSheetName",messages={[bold]:"Bold",[italic]:"Italic",[underline]:"Underline",[undo]:"Undo",[redo]:"Redo",[fontSize]:"Font size",[fontSizeIncrease]:"Increase Font size",[fontSizeDecrease]:"Decrease Font size",[fontName]:"Font",[cleanFormatting]:"Clean formatting",[format]:"Custom format...",[alignHorizontally]:"Align horizontally",[alignVertically]:"Align vertically",[align]:"Align",[alignLeft]:"Align left",[alignRight]:"Align right",[alignCenter]:"Align center",[alignJustify]:"Align justify",[center]:"Center",[justify]:"Justify",[alignTop]:"Align top",[alignMiddle]:"Align middle",[alignBottom]:"Align bottom",[increaseDecimal]:"Increase decimal",[decreaseDecimal]:"Decrease decimal",[textColor]:"Text Color",[background]:"Background color",[addRowAbove]:"Add row above",[addRowBelow]:"Add row below",[addColumnLeft]:"Add column left",[addColumnRight]:"Add column right",[deleteRow]:"Delete row",[deleteColumn]:"Delete column",[messages_open]:"Open...",[exportToExcel]:"Export to Excel",[textWrap]:"Text Wrap",[gridLines]:"Toggle gridlines",[nameBox]:"Name Box",[defaultSheetName]:"Sheet",[home]:"Home",[file]:"File",[insert]:"Insert",[addNewSheet]:"Add new sheet",[formatTab]:"Format",[modifyMerged]:"Cannot change part of a merged cell.",[cannotModifyDisabled]:"Cannot modify disabled cells.",[openUnsupported]:"Unsupported format. Please select an .xlsx file.",[duplicateSheetName]:"There is an existing sheet with this name. Please enter another name.",[error]:"Error",[ok]:"OK"},keys={bold,italic:"spreadsheet.italic",underline:"spreadsheet.underline",undo,redo,fontSize:"spreadsheet.fontSize",fontSizeIncrease:"spreadsheet.fontSizeIncrease",fontSizeDecrease:"spreadsheet.fontSizeDecrease",fontName:"spreadsheet.fontName",cleanFormatting:"spreadsheet.cleanFormatting",format:"spreadsheet.format",alignHorizontally:"spreadsheet.alignHorizontally",alignVertically:"spreadsheet.alignVertically",align,alignLeft:"spreadsheet.alignLeft",alignRight:"spreadsheet.alignRight",alignCenter:"spreadsheet.alignCenter",center:"spreadsheet.center",alignJustify:"spreadsheet.alignJustify",justify:"spreadsheet.justify",alignTop:"spreadsheet.alignTop",alignMiddle:"spreadsheet.alignMiddle",alignBottom:"spreadsheet.alignBottom",increaseDecimal:"spreadsheet.increaseDecimal",decreaseDecimal:"spreadsheet.decreaseDecimal",textColor:"spreadsheet.textColor",background:"spreadsheet.background",addRowAbove:"spreadsheet.addRowAbove",addRowBelow:"spreadsheet.addRowBelow",addColumnLeft:"spreadsheet.addColumnLeft",addColumnRight:"spreadsheet.addColumnRight",deleteRow:"spreadsheet.deleteRow",deleteColumn:"spreadsheet.deleteColumn",open:"spreadsheet.openFile",exportToExcel:"spreadsheet.exportToExcel",textWrap:"spreadsheet.textWrap",gridLines:"spreadsheet.gridLines",nameBox:"spreadsheet.nameBox",defaultSheetName:"spreadsheet.defaultSheetName",file,home,insert:"spreadsheet.insert",addNewSheet:"spreadsheet.addNewSheet",error,ok,modifyMerged:"spreadsheet.modifyMerged",cannotModifyDisabled:"spreadsheet.cannotModifyDisabled",openUnsupported:"spreadsheet.openUnsupported",duplicateSheetName:"spreadsheet.duplicateSheetName",formatTab:"spreadsheet.formatTab"},NameBox=react.forwardRef(((props,ref)=>{const target=react.useRef(null),comboboxRef=react.useRef(null),[data,setData]=react.useState([]),[open,setOpen]=react.useState(!1),[value,setValue]=react.useState(""),memo=react.useMemo((()=>({})),[]);memo.data=data,react.useImperativeHandle(target,(()=>({value:val=>{if(void 0===val){const item=comboboxRef.current&&comboboxRef.current.value;return item&&item.name||item}setValue(val||"")}})),[]),react.useImperativeHandle(ref,(()=>target.current),[]);const onDelete=react.useCallback((name=>{const editor=props.nameEditor();editor&&editor.trigger("delete",{name})}),[]),itemRender=react.useCallback(((li,itemProps)=>{const itemChildren=react.createElement(react.Fragment,null,li.props.children,react.createElement("span",{role:"button",className:"k-button-delete",onClick:()=>onDelete(itemProps.dataItem[itemProps.textField]),onMouseDown:e=>e.preventDefault(),onPointerDown:e=>e.preventDefault(),"data-role":"delete"},react.createElement(IconWrap.Q,{name:"x",icon:index_es.xIcon})));return react.cloneElement(li,li.props,itemChildren)}),[]),listNoDataRender=react.useCallback((el=>react.cloneElement(el,Object.assign({},el.props),react.createElement("div",null))),[]),onOpen=react.useCallback((event=>{if(event.syntheticEvent&&"change"===event.syntheticEvent.type)return;const editor=props.nameEditor();editor&&(setData(editor.readData()),setOpen(!0))}),[]),onClose=react.useCallback((()=>{setOpen(!1)}),[]),onChange=react.useCallback((event=>{if(event.syntheticEvent.target.closest("[data-role]"))return;const editor=props.nameEditor();if(editor&&event.value){const name=event.value.name;name!==value&&(editor.trigger("select",{name}),setValue(name))}}),[value]),onKeyDown=react.useCallback((event=>{const editor=props.nameEditor();if(editor)if("Enter"===event.key){const name=event.target.value;editor.trigger("enter",{value:name}),setValue(name)}else"Escape"===event.key&&(editor.trigger("cancel"),setValue(memo.prevValue))}),[]),onFocus=react.useCallback((event=>{memo.prevValue=event.value.name}),[]);return react.createElement("div",{className:"k-spreadsheet-name-editor",onKeyDown},react.createElement(ComboBox.a3,{ref:comboboxRef,title:(0,useLocalization.B)().toLanguageString(keys.nameBox,messages[keys.nameBox]),popupSettings:{className:"k-spreadsheet-names-popup"},fillMode:"flat",clearButton:!1,dataItemKey:"name",textField:"name",itemRender,data,value:value?data.find((d=>d.name===name))||{name:value}:null,onChange,opened:open,onOpen,onClose,onFocus,listNoDataRender,allowCustom:!0}))}));NameBox.displayName="NameBox",NameBox.propTypes={};var extendStatics,_a,Sortable_a,guid=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/guid.js"),react_dom=__webpack_require__("./node_modules/react-dom/index.js"),getActiveElement=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/getActiveElement.js"),es_keys=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/keys.js"),getTabIndex=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/getTabIndex.js"),Draggable=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/Draggable.js"),PreventableEvent=function(){function PreventableEvent(){this.prevented=!1}return PreventableEvent.prototype.preventDefault=function(){this.prevented=!0},PreventableEvent.prototype.isDefaultPrevented=function(){return this.prevented},PreventableEvent}(),__extends=(extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),SortableOnDragStartEvent=function(_super){function SortableOnDragStartEvent(target,prevIndex,element){var _this=_super.call(this)||this;return _this.target=target,_this.prevIndex=prevIndex,_this.element=element,_this}return __extends(SortableOnDragStartEvent,_super),SortableOnDragStartEvent}(PreventableEvent),SortableOnDragOverEvent=function SortableOnDragOverEvent(target,prevIndex,nextIndex,newState){this.target=target,this.prevIndex=prevIndex,this.nextIndex=nextIndex,this.newState=newState},SortableOnDragEndEvent=function SortableOnDragEndEvent(target,prevIndex,nextIndex,newState){this.target=target,this.prevIndex=prevIndex,this.nextIndex=nextIndex,this.newState=newState},SortableOnNavigateEvent=function SortableOnNavigateEvent(target,prevIndex,nextIndex,newState){this.target=target,this.prevIndex=prevIndex,this.nextIndex=nextIndex,this.newState=newState},intlUtils=__webpack_require__("./node_modules/@progress/kendo-react-intl/dist/es/intlUtils.js"),noData="sortable.noData",messages_messages=((_a={})[noData]="No Data",_a),hasRelativeStackingContext=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/hasRelativeStackingContext.js"),findIndex=function(data,comparer){for(var i=0;i<data.length;i++)if(comparer(data[i]))return i;return-1},toClassList=function(classNames){return String(classNames).trim().split(" ")},FOCUSABLE_REGEX=/^(?:a|input|select|option|textarea|button|object)$/i,HAS_RELATIVE_STACKING_CONTEXT=(0,hasRelativeStackingContext.k)(),validate_package=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/validate-package.js"),packageMetadata={name:"@progress/kendo-react-sortable",productName:"KendoReact",productCodes:["KENDOUIREACT","KENDOUICOMPLETE"],publishDate:1695802797,version:"",licensingDocsUrl:"https://www.telerik.com/kendo-react-ui/my-license/?utm_medium=product&utm_source=kendoreact&utm_campaign=kendo-ui-react-purchase-license-keys-warning"},getter=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/getter.js"),Sortable_extends=function(){var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},__spreadArray=function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},SORTABLE_ATTRIBUTE_PROP=((Sortable_a={})["data-sortable-component"]=!0,Sortable_a),Sortable=function(_super){function Sortable(props){var _this=_super.call(this,props)||this;return _this.state={clientX:0,clientY:0,isDragging:!1,activeId:"",dragCueWidth:0,dragCueHeight:0},_this.isRtl=!1,_this.itemRefsMap={},_this.oldSizesMap={},_this.animatingItemMap={},_this.draggableRef=null,_this.isUnmounted=!1,_this.focusActiveId=!1,_this.isKeyboardNavigated=!1,_this.isDragPrevented=!1,_this.swapItems=function(newState,source,destination){var b=newState[source];return newState[source]=newState[destination],newState[destination]=b,source=destination},_this.generateNewState=function(prevIndex,nextIndex){var data=_this.props.data,newState=__spreadArray([],data,!0);if(prevIndex>nextIndex)for(var i=prevIndex-1;i>=nextIndex;i--){var nextItem=data[i];_this.isItemDisabled(nextItem)||(prevIndex=_this.swapItems(newState,prevIndex,i))}else for(i=prevIndex+1;i<=nextIndex;i++){nextItem=data[i];_this.isItemDisabled(nextItem)||(prevIndex=_this.swapItems(newState,prevIndex,i))}return newState},_this.closestSortableItem=function(target){for(var currentTarget=target;currentTarget;){var id=currentTarget.getAttribute("data-sortable-id");if(id&&_this.itemRefsMap[id]===currentTarget)return{id,element:currentTarget};currentTarget=currentTarget.parentElement}return{id:"",element:null}},_this.isSortable=function(target){return Boolean(target.hasAttribute("data-sortable-component"))},_this.closestSortable=function(target){for(var currentTarget=target;currentTarget;){if(_this.isSortable(currentTarget))return currentTarget;currentTarget=currentTarget.parentElement}return null},_this.isSameSortable=function(element){return _this.closestSortable(element)===_this.container},_this.idComparer=function(id1,id2){return id1+""==id2+""},_this.findItem=function(id){var _a=_this.props,data=_a.data,idField=_a.idField;if(id+""){var idGetter=(0,getter.o)(idField);return function(data,comparer){for(var i=0;i<data.length;i++)if(comparer(data[i]))return data[i]}(data,(function(item){return _this.idComparer(idGetter(item),id)}))}},_this.findIndex=function(id){var _a=_this.props,data=_a.data,idField=_a.idField;return id+""?findIndex(data,(function(item){return _this.idComparer(item[idField],id)})):-1},_this.isItemDisabled=function(item){return item&&!0===item[_this.props.disabledField||""]},_this.shouldResetActive=function(){var activeElement=(0,getActiveElement.b)(document);if(activeElement instanceof HTMLElement){var closestItemElement=_this.closestSortableItem(activeElement).element;return!Boolean(closestItemElement)}return!1},_this.widgetTarget=function(target){var element=function(node,predicate){for(;node&&!predicate(node);)node=node.parentNode;return node}(target,(function(node){return function(element,classNames){var namesList=toClassList(classNames);return Boolean(toClassList(element.className).find((function(className){return namesList.indexOf(className)>=0})))}(node,"k-widget")||_this.isSortable(node)}));return element&&!_this.isSortable(element)},_this.allowDrag=function(target){return target.hasAttribute("data-sortable-id")||!(function(element){if(element.tagName){var tagName=element.tagName.toLowerCase(),tabIndex=element.getAttribute("tabIndex"),skipTab="-1"===tabIndex,focusable=null!==tabIndex&&!skipTab;return FOCUSABLE_REGEX.test(tagName)&&(focusable=!element.disabled&&!skipTab),focusable}return!1}(target)||_this.widgetTarget(target))},_this.onDragStart=function(eventData){var event=eventData.event,onDragStart=_this.props.onDragStart,targetElement=document.elementFromPoint(event.clientX,event.clientY),_a=_this.closestSortableItem(targetElement),activeId=_a.id,activeElement=_a.element,activeItem=_this.findItem(activeId);if(!activeId||activeItem&&_this.isItemDisabled(activeItem)||!_this.allowDrag(targetElement)||!_this.isSameSortable(targetElement))_this.isDragPrevented=!0;else{event.isTouch&&event.originalEvent.preventDefault();var dragStartEvent=new SortableOnDragStartEvent(_this,_this.findIndex(activeId),targetElement);onDragStart&&onDragStart.call(void 0,dragStartEvent),_this.isDragPrevented=dragStartEvent.isDefaultPrevented(),_this.isDragPrevented?event.originalEvent.preventDefault():(_this.offsetParent=function(element){if(!element||!HAS_RELATIVE_STACKING_CONTEXT)return null;for(var node=element.parentElement;node;){if("none"!==window.getComputedStyle(node).transform)return node;node=node.parentElement}}(_this.container),_this.setState({activeId,dragCueWidth:activeElement&&activeElement.clientWidth||0,dragCueHeight:activeElement&&activeElement.clientHeight||0}))}},_this.onDragOver=function(eventData){var event=eventData.event,_a=_this.props,onDragOver=_a.onDragOver,data=_a.data;if(!_this.isDragPrevented){event.originalEvent.preventDefault();var prevIndex=_this.findIndex(_this.state.activeId);if(-1!==prevIndex){var targetElement=document.elementFromPoint(event.clientX,event.clientY),closestSortable=_this.closestSortableItem(targetElement),nextIndex=_this.findIndex(closestSortable.id),nextItem=data[nextIndex];if(onDragOver&&nextIndex>-1&&prevIndex!==nextIndex&&!_this.isItemDisabled(nextItem)&&!_this.animatingItemMap[closestSortable.id]&&_this.shouldReorder(closestSortable.element,event.clientX,event.clientY)){var dragOverEvent=new SortableOnDragOverEvent(_this,prevIndex,nextIndex,_this.generateNewState(prevIndex,nextIndex));onDragOver.call(void 0,dragOverEvent)}var offset=_this.parentOffset();_this.setState({clientX:event.clientX-offset.left,clientY:event.clientY-offset.top,isDragging:!0})}else _this.resetState()}},_this.onDragEnd=function(eventData){var event=eventData.event,resetActive=_this.shouldResetActive();if(!_this.isDragPrevented){var _a=_this.props,onDragEnd=_a.onDragEnd,data=_a.data,targetElement=document.elementFromPoint(event.clientX,event.clientY),closestSortableItem=_this.closestSortableItem(targetElement),nextIndex=_this.findIndex(closestSortableItem.id),prevIndex=_this.findIndex(_this.state.activeId),isNextDisabled=_this.isItemDisabled(data[nextIndex]);if((-1===nextIndex||isNextDisabled)&&(nextIndex=prevIndex),onDragEnd){var nextState=_this.generateNewState(prevIndex,nextIndex);if(!isNextDisabled){var rect=_this.thresholdRect(closestSortableItem.element);if(rect&&(event.clientX<rect.left||event.clientX>rect.right||event.clientY<rect.top||event.clientY>rect.bottom)){var prev=prevIndex;prevIndex=nextIndex,nextIndex=prev,nextState=_this.props.data.slice()}}var dragEndEvent=new SortableOnDragEndEvent(_this,prevIndex,nextIndex,nextState);onDragEnd.call(void 0,dragEndEvent)}_this.resetState(resetActive)}},_this.shouldReorder=function(draggerOverElement,clientX,clientY){var rect=_this.thresholdRect(draggerOverElement);return rect&&clientX>rect.left&&clientX<rect.right&&clientY>rect.top&&clientY<rect.bottom},_this.thresholdRect=function(draggerOverElement){var activeId=_this.state.activeId,root=_this.container,activeElement=(root?Array.from(root.childNodes):[]).find((function(e){return e instanceof HTMLElement&&e.getAttribute("data-sortable-id")===activeId}));if(!draggerOverElement||!activeElement)return null;var _a=activeElement.getBoundingClientRect(),width=_a.width,height=_a.height,rect=draggerOverElement.getBoundingClientRect(),top=rect.top+rect.height/2-height/2,left=rect.left+rect.width/2-width/2;return{top,left,bottom:top+height,right:left+width}},_this.onItemBlur=function(){window.setTimeout((function(){_this.isUnmounted||_this.shouldResetActive()&&!_this.state.isDragging&&_this.setState({activeId:""})}))},_this.onItemFocus=function(event){var _a=_this.closestSortableItem(event.currentTarget),activeId=_a.id,element=_a.element;!_this.idComparer(activeId,_this.state.activeId)&&_this.isSameSortable(event.target)&&element===event.target&&_this.setState({activeId})},_this.onKeyDown=function(event){var _a=_this.props,data=_a.data,idField=_a.idField,onNavigate=_a.onNavigate,navigation=_a.navigation,activeId=_this.state.activeId;if(navigation&&activeId&&_this.isSameSortable(event.target)){var isRtl=_this.isRtl,enabledItems=data.filter((function(item){return!_this.isItemDisabled(item)})),prevIndex=findIndex(enabledItems,(function(item){return _this.idComparer(item[idField],activeId)})),maxNavIndex=enabledItems.length-1,nextIndex=prevIndex;switch(event.keyCode===es_keys.D.left&&(event.keyCode=isRtl?es_keys.D.down:es_keys.D.up),event.keyCode===es_keys.D.right&&(event.keyCode=isRtl?es_keys.D.up:es_keys.D.down),event.keyCode){case es_keys.D.up:prevIndex>0&&(nextIndex=prevIndex-1);break;case es_keys.D.down:prevIndex<maxNavIndex&&(nextIndex=prevIndex+1)}if(nextIndex!==prevIndex){event.stopPropagation(),event.preventDefault();var nextItem=enabledItems[nextIndex],nextItemId=nextItem?nextItem[idField]:"",prevItem=enabledItems[prevIndex],prevItemId=prevItem?prevItem[idField]:"";if(event.ctrlKey){if(onNavigate){var actualPrevIndex=_this.findIndex(prevItemId),actualNextIndex=_this.findIndex(nextItemId),navigateEvent=new SortableOnNavigateEvent(_this,actualPrevIndex,actualNextIndex,_this.generateNewState(actualPrevIndex,actualNextIndex));_this.isKeyboardNavigated=!0,onNavigate.call(void 0,navigateEvent)}}else _this.focusActiveId=!0,_this.setState({activeId:nextItemId+""})}}},_this.resetState=function(resetActive){_this.isDragPrevented=!1,_this.setState({clientX:0,clientY:0,isDragging:!1,dragCueWidth:0,dragCueHeight:0,activeId:resetActive?"":_this.state.activeId})},_this.renderData=function(){var _a=_this.props,data=_a.data,UIComponent=_a.itemUI,idField=_a.idField,tabIndex=_a.tabIndex;return data.map((function(item){var _a,id=(0,getter.o)(idField)(item),isDisabled=_this.isItemDisabled(item),isActive=_this.idComparer(_this.state.activeId,id);return react.createElement(UIComponent,{key:id,forwardRef:function(ele){return _this.refAssign(ele,id)},dataItem:item,isDisabled,isActive,isDragged:isActive&&_this.state.isDragging,isDragCue:!1,attributes:(_a={},_a["data-sortable-id"]=id,_a["aria-disabled"]=isDisabled,_a["aria-grabbed"]=isActive&&_this.state.isDragging&&!_this.isDragPrevented,_a["aria-dropeffect"]=isDisabled?"none":"move",_a.tabIndex=(0,getTabIndex.y)(tabIndex,isDisabled),_a.onFocus=_this.onItemFocus,_a.onBlur=_this.onItemBlur,_a),style:{cursor:isDisabled?"auto":"move",MozUserSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",userSelect:"none"}})}))},_this.renderNoData=function(){var UIComponent=_this.props.emptyItemUI,noDataMessage=(0,intlUtils.GB)(_this).toLanguageString(noData,messages_messages[noData]);if(UIComponent)return react.createElement(UIComponent,{message:noDataMessage})},_this.renderDragCue=function(){var UIComponent=_this.props.itemUI,_a=_this.state,isDragging=_a.isDragging,activeId=_a.activeId,clientX=_a.clientX,clientY=_a.clientY,dataItem=_this.findItem(activeId);if(isDragging&&dataItem)return react.createElement(UIComponent,{dataItem,isDisabled:!1,isActive:!0,isDragged:!0,isDragCue:!0,style:{position:"fixed",top:clientY+10,left:clientX+10,width:_this.state.dragCueWidth,height:_this.state.dragCueHeight},attributes:{}})},_this.refAssign=function(element,id){element?_this.itemRefsMap[id]=element:delete _this.itemRefsMap[id]},_this.draggableRefAssign=function(ref){_this.draggableRef=ref},(0,validate_package.$)(packageMetadata),_this}return Sortable_extends(Sortable,_super),Object.defineProperty(Sortable.prototype,"container",{get:function(){return this.draggableRef&&this.draggableRef.element},enumerable:!1,configurable:!0}),Sortable.prototype.getSnapshotBeforeUpdate=function(){var _this=this,_a=this.props,idField=_a.idField,animation=_a.animation;return this.oldSizesMap={},animation?(this.props.data.forEach((function(item){var id=item[idField],ref=_this.itemRefsMap[id],domNode=react_dom.findDOMNode(ref);domNode&&(_this.oldSizesMap[id]=domNode.getBoundingClientRect())})),null):null},Sortable.prototype.componentDidUpdate=function(previousProps){var _this=this,_a=this.props,idField=_a.idField,animation=_a.animation;this.focusActiveId&&(this.focusActiveId=!1,this.itemRefsMap[this.state.activeId].focus()),animation&&(this.state.isDragging||this.isKeyboardNavigated)&&(this.isKeyboardNavigated=!1,previousProps.data.forEach((function(item){var id=item[idField],domNode=_this.itemRefsMap[id];if(domNode){var newBox=domNode.getBoundingClientRect(),oldBox=_this.oldSizesMap[id],deltaX=oldBox.left-newBox.left,deltaY=oldBox.top-newBox.top;0===deltaX&&0===deltaY||requestAnimationFrame((function(){_this.animatingItemMap[id]=!0,domNode.style.transform="translate(".concat(deltaX,"px, ").concat(deltaY,"px)"),domNode.style.transition="transform 0s",requestAnimationFrame((function(){domNode.style.transform="",domNode.style.transition="transform ".concat(200,"ms cubic-bezier(0.2, 0, 0, 1) 0s"),window.setTimeout((function(){return _this.animatingItemMap[id]=!1}),200)}))}))}})))},Sortable.prototype.componentDidMount=function(){this.isRtl=this.container&&"rtl"===getComputedStyle(this.container).direction||!1},Sortable.prototype.componentWillUnmount=function(){this.isUnmounted=!0},Sortable.prototype.parentOffset=function(){var offsetParent=this.offsetParent;if(offsetParent&&offsetParent.ownerDocument&&offsetParent!==offsetParent.ownerDocument.body){var rect=offsetParent.getBoundingClientRect();return{left:rect.left-offsetParent.scrollLeft,top:rect.top-offsetParent.scrollTop}}return{left:0,top:0}},Sortable.prototype.render=function(){var _a=this.props,data=_a.data,style=_a.style,className=_a.className,Wrapper=_a.itemsWrapUI||"div";return react.createElement(Draggable.s,{onDragStart:this.onDragStart,onDrag:this.onDragOver,onDragEnd:this.onDragEnd,ref:this.draggableRefAssign},react.createElement(Wrapper,__assign({},SORTABLE_ATTRIBUTE_PROP,{className,style:__assign({touchAction:"none"},style),onKeyDown:this.onKeyDown}),data&&data.length?this.renderData():this.renderNoData(),this.renderDragCue()))},Sortable.defaultProps={navigation:!0,animation:!0,emptyItemUI:function(props){return react.createElement("div",null,props.message)}},Sortable.propTypes={idField:prop_types.string.isRequired,disabledField:prop_types.string,data:prop_types.array.isRequired,tabIndex:prop_types.number,navigation:prop_types.bool,animation:prop_types.bool,itemsWrapUI:prop_types.any,itemUI:prop_types.func.isRequired,emptyItemUI:prop_types.func,style:prop_types.object,className:prop_types.string,onDragStart:prop_types.func,onDragOver:prop_types.func,onDragEnd:prop_types.func,onNavigate:prop_types.func},Sortable}(react.Component);(0,intlUtils.AK)(Sortable);var __rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const ItemsContext=react.createContext({onSelect:()=>{},onDelete:()=>{},onEnterEdit:()=>{},onCancelEdit:()=>{},onExitEdit:()=>{},onEdit:()=>{}}),TabItem=props=>{const dataItem=props.dataItem,{onSelect,onDelete,onEnterEdit,onExitEdit,onCancelEdit,onEdit}=react.useContext(ItemsContext),onClick=react.useCallback((e=>{e.target instanceof HTMLElement&&"INPUT"===e.target.nodeName||onSelect.call(void 0,dataItem,e)}),[dataItem,onSelect]),onClickDelete=react.useCallback((e=>{onDelete.call(void 0,dataItem,e)}),[dataItem,onDelete]),onDoubleClick=react.useCallback((e=>{e.target instanceof HTMLElement&&"INPUT"===e.target.nodeName||onEnterEdit.call(void 0,dataItem,e)}),[dataItem,onEnterEdit]),onInputBlur=react.useCallback((e=>{onExitEdit.call(void 0,dataItem,e)}),[dataItem,onExitEdit]),onInputKeyDown=react.useCallback((e=>{"Enter"===e.key?onExitEdit.call(void 0,dataItem,e):"Escape"===e.key&&onCancelEdit.call(void 0,dataItem,e)}),[dataItem,onExitEdit,onCancelEdit]),onInputChange=react.useCallback((e=>{onEdit.call(void 0,Object.assign(Object.assign({},dataItem),{text:e.target.value}),e)}),[dataItem,onEdit]);return react.createElement("li",Object.assign({style:props.style},props.attributes,{ref:props.forwardRef,role:"tab",className:(0,classNames.x)("k-item k-tabstrip-item",{"k-disabled":props.isDisabled,"k-active k-state-tab-on-top k-spreadsheet-sheets-bar-active":dataItem.active,"k-spreadsheet-sheets-bar-inactive":!dataItem.active,"k-first":dataItem.first,"k-last":dataItem.last}),onClick,onDoubleClick}),dataItem.inEdit?react.createElement("input",{type:"text",className:"k-textbox k-spreadsheet-sheets-editor",value:dataItem.text,onChange:onInputChange,maxLength:50,autoFocus:!0,onBlur:onInputBlur,onKeyDown:onInputKeyDown}):react.createElement(react.Fragment,null,react.createElement("span",{className:"k-link"},dataItem.text),dataItem.first&&dataItem.last?null:react.createElement("span",{className:"k-link k-spreadsheet-sheets-remove",onClick:onClickDelete},react.createElement(IconWrap.Q,{name:"x",icon:index_es.xIcon}))))},TabsList=react.forwardRef(((props,ref)=>{const{children,className}=props,restProps=__rest(props,["children","className"]);return react.createElement("ul",Object.assign({className:(0,classNames.x)("k-tabstrip-items k-reset",className),role:"tablist"},restProps,{ref}),children)}));TabsList.displayName="TabsList";const Tabs=props=>{const{sheets,setSheets,onSheetSelect,onSheetDelete,onSheetEdit,onSheetReorderEnd}=props,[inEditItem,setInEditItem]=react.useState(null),dragging=react.useRef(!1),prevIndex=react.useRef(-1),updateData=react.useCallback((d=>{setSheets(d.map(((item,index,array)=>Object.assign(Object.assign({},item),{first:0===index,last:index===array.length-1}))))}),[]),onDragOver=react.useCallback((event=>{updateData(event.newState)}),[updateData,onSheetReorderEnd]),onNavigate=react.useCallback((event=>{onSheetReorderEnd.call(void 0,event)}),[onSheetReorderEnd]),onDragStart=react.useCallback((e=>{dragging.current=!0,prevIndex.current=e.prevIndex}),[]),onDragEnd=react.useCallback((event=>{setTimeout((()=>{dragging.current=!1}),50),onSheetReorderEnd.call(void 0,Object.assign(Object.assign({},event),{prevIndex:prevIndex.current}))}),[]),onSelect=react.useCallback(((dataItem,e)=>{dragging.current||onSheetSelect.call(void 0,dataItem,e)}),[onSheetSelect]),onDelete=react.useCallback(((dataItem,e)=>{e.stopPropagation(),onSheetDelete.call(void 0,dataItem)}),[sheets,onSheetDelete]),onEnterEdit=react.useCallback(((dataItem,e)=>{e.stopPropagation(),e.preventDefault();const newData=sheets.map((item=>Object.assign(Object.assign({},item),{active:item.id===dataItem.id,inEdit:item.id===dataItem.id})));setSheets(newData),setInEditItem(Object.assign({},dataItem))}),[sheets]),onCancelEdit=react.useCallback(((_dataItem,e)=>{e.stopPropagation(),e.preventDefault();const newData=sheets.map((item=>Object.assign(Object.assign({},item),{inEdit:!1,text:item.inEdit&&inEditItem?inEditItem.text:item.text})));setSheets(newData),setInEditItem(null)}),[sheets,inEditItem]),onExitEdit=react.useCallback(((dataItem,e)=>{e.stopPropagation(),e.preventDefault();const newData=sheets.map((item=>Object.assign(Object.assign({},item),{inEdit:!1}))),index=sheets.findIndex((i=>i.id===dataItem.id));setSheets(newData),setInEditItem(null),onSheetEdit.call(void 0,dataItem,index)}),[sheets,onSheetEdit]),onEdit=react.useCallback(((dataItem,e)=>{e.stopPropagation(),e.preventDefault();const newData=sheets.map((item=>Object.assign(Object.assign({},item),{text:dataItem.id===item.id?dataItem.text:item.text})));setSheets(newData)}),[sheets]);return react.createElement("div",{className:"k-spreadsheet-sheets-items k-tabstrip k-floatwrap k-tabstrip-bottom"},react.createElement("div",{className:"k-tabstrip-items-wrapper k-hstack"},react.createElement(ItemsContext.Provider,{value:{onSelect,onDelete,onEnterEdit,onCancelEdit,onExitEdit,onEdit}},react.createElement(Sortable,{idField:"id",data:sheets,itemUI:TabItem,itemsWrapUI:TabsList,onDragOver,onNavigate,onDragStart,onDragEnd}))))},SheetsBar=props=>{const{spreadsheetRef}=props,[sheets,setSheets]=react.useState([]),activeSheet=react.useRef((sheets.find((s=>s.active))||{}).text),selectActiveSheet=react.useCallback((()=>{spreadsheetRef.current&&(spreadsheetRef.current.view.sheetsbar.onSheetSelect(activeSheet.current),setSheets(((sheets,active)=>sheets.map(((sheet,i,arr)=>({text:sheet.name(),id:(0,guid.O)(),first:0===i,last:i===arr.length-1,active:sheet.name()===active}))))(spreadsheetRef.current.sheets(),activeSheet.current)))}),[]),onUpdate=react.useCallback((()=>{if(spreadsheetRef.current){const sh=spreadsheetRef.current.sheets();sh.find((s=>s.name()===activeSheet.current))||(activeSheet.current=sh[sh.length-1].name()),selectActiveSheet()}}),[]);react.useEffect((()=>(spreadsheetRef.current&&(activeSheet.current=spreadsheetRef.current.sheets()[0].name(),selectActiveSheet(),spreadsheetRef.current.view.bind("update",onUpdate)),()=>{spreadsheetRef.current&&spreadsheetRef.current.view.unbind("update",onUpdate)})),[spreadsheetRef.current]);const onSelect=react.useCallback((dataItem=>{activeSheet.current!==dataItem.text&&(activeSheet.current=dataItem.text,selectActiveSheet())}),[]),onAddSheet=react.useCallback((()=>{if(spreadsheetRef.current){spreadsheetRef.current.view.sheetsbar.onAddSelect();const spSheets=spreadsheetRef.current.sheets();activeSheet.current=spSheets[spSheets.length-1].name(),selectActiveSheet()}}),[]),onSheetDelete=react.useCallback((dataItem=>{if(spreadsheetRef.current){if(activeSheet.current===dataItem.text){const curSheets=spreadsheetRef.current.sheets(),index=curSheets.findIndex((s=>s.name()===dataItem.text)),active=curSheets[index+1]||curSheets[index-1];activeSheet.current=active?active.name():""}spreadsheetRef.current.view.sheetsbar.onSheetRemove(dataItem.text),selectActiveSheet()}}),[]),onSheetRename=react.useCallback(((dataItem,index)=>{if(spreadsheetRef.current){let text=dataItem.text;const curSheets=spreadsheetRef.current.sheets(),active=curSheets[index];if(!text)return activeSheet.current=active.name(),void selectActiveSheet();if(active&&active.name()===text)return;curSheets.find((s=>s.name()===text))&&(text=active.name()),spreadsheetRef.current.view.sheetsbar.onSheetRename(text,index),activeSheet.current=text,selectActiveSheet()}}),[]),onSheetReorderEnd=react.useCallback((event=>{if(spreadsheetRef.current){const{prevIndex,nextIndex}=event;activeSheet.current=spreadsheetRef.current.sheets()[prevIndex].name(),spreadsheetRef.current.view.sheetsbar.onSheetReorderEnd({oldIndex:prevIndex,newIndex:nextIndex}),selectActiveSheet()}}),[]);return react.createElement("div",{className:"k-spreadsheet-sheets-bar k-header"},react.createElement(Button.$,{fillMode:"flat",icon:"plus",className:"k-spreadsheet-sheets-bar-add",title:(0,useLocalization.B)().toLanguageString(keys.addNewSheet,messages[keys.addNewSheet]),svgIcon:index_es.plusIcon,onClick:onAddSheet}),react.createElement(Tabs,{sheets,setSheets,onSheetSelect:onSelect,onSheetDelete,onSheetEdit:onSheetRename,onSheetReorderEnd}))};var util=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/util.js"),parse_color=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/common/color/parse-color.js"),shapes_group=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/shapes/group.js"),path=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/shapes/path.js"),geometry_rect=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/geometry/rect.js"),geometry_matrix=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/geometry/matrix.js"),shapes_rect=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/shapes/rect.js"),core=__webpack_require__("./node_modules/@progress/kendo-drawing/dist/es/html/core.js"),get_date=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/get-date.js"),day_of_week=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/day-of-week.js"),add_days=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/add-days.js"),first_day_of_month=__webpack_require__("./node_modules/@progress/kendo-date-math/dist/es/first-day-of-month.js"),main=__webpack_require__("./node_modules/@progress/kendo-common/dist/es/main.js"),pako_esm5=__webpack_require__("./node_modules/@progress/pako-esm/dist/pako-esm5.js"),external={Promise},support={base64:!0,array:!0,string:!0,nodebuffer:!1,nodestream:!1,get arraybuffer(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array},get uint8array(){return"undefined"!=typeof Uint8Array},get blob(){return blob()}},blob=function(){var supported;if("undefined"==typeof ArrayBuffer)supported=!1;else{var buffer=new ArrayBuffer(0);try{supported=0===new Blob([buffer],{type:"application/zip"}).size}catch(e){supported=!1}}return blob=function(){return supported},supported},_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function identity(input){return input}function stringToArrayLike(str,array){for(var i=0;i<str.length;++i)array[i]=255&str.charCodeAt(i);return array}function stringifyByChunk(array,type,chunk){var result=[],k=0,len=array.length;if(len<=chunk)return String.fromCharCode.apply(null,array);for(;k<len;)"array"===type?result.push(String.fromCharCode.apply(null,array.slice(k,Math.min(k+chunk,len)))):result.push(String.fromCharCode.apply(null,array.subarray(k,Math.min(k+chunk,len)))),k+=chunk;return result.join("")}var fromCharCodeSupportsTypedArrays=function(){var supported;try{supported=support.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){supported=!1}return fromCharCodeSupportsTypedArrays=function(){return supported},supported};function arrayLikeToString(array){var chunk=65536,type=getTypeOf(array),canUseApply=!0;if("uint8array"===type&&(canUseApply=fromCharCodeSupportsTypedArrays()),canUseApply)for(;chunk>1;)try{return stringifyByChunk(array,type,chunk)}catch(e){chunk=Math.floor(chunk/2)}return function stringifyByChar(array){for(var resultStr="",i=0;i<array.length;i++)resultStr+=String.fromCharCode(array[i]);return resultStr}(array)}var applyFromCharCode=arrayLikeToString;function arrayLikeToArrayLike(arrayFrom,arrayTo){for(var i=0;i<arrayFrom.length;i++)arrayTo[i]=arrayFrom[i];return arrayTo}var transform={string:{string:identity,array:function(input){return stringToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return transform.string.uint8array(input).buffer},uint8array:function(input){return stringToArrayLike(input,new Uint8Array(input.length))}},array:{string:arrayLikeToString,array:identity,arraybuffer:function(input){return new Uint8Array(input).buffer},uint8array:function(input){return new Uint8Array(input)}},arraybuffer:{string:function(input){return arrayLikeToString(new Uint8Array(input))},array:function(input){return arrayLikeToArrayLike(new Uint8Array(input),new Array(input.byteLength))},arraybuffer:identity,uint8array:function(input){return new Uint8Array(input)}},uint8array:{string:arrayLikeToString,array:function(input){return arrayLikeToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return input.buffer},uint8array:identity}},transformTo=function(outputType,input){if(input||(input=""),!outputType)return input;checkSupport(outputType);var inputType=getTypeOf(input);return transform[inputType][outputType](input)},resolve=function(path){for(var parts=path.split("/"),result=[],index=0;index<parts.length;index++){var part=parts[index];"."===part||""===part&&0!==index&&index!==parts.length-1||(".."===part?result.pop():result.push(part))}return result.join("/")},getTypeOf=function(input){return"string"==typeof input?"string":"[object Array]"===Object.prototype.toString.call(input)?"array":support.uint8array&&input instanceof Uint8Array?"uint8array":support.arraybuffer&&input instanceof ArrayBuffer?"arraybuffer":void 0},checkSupport=function(type){if(!support[type.toLowerCase()])throw new Error(type+" is not supported by this platform")},pretty=function(str){var code,i,res="";for(i=0;i<(str||"").length;i++)res+="\\x"+((code=str.charCodeAt(i))<16?"0":"")+code.toString(16).toUpperCase();return res},delay=function(callback,args,self){setTimeout((function(){callback.apply(self||null,args||[])}),0)},extend=function(){var i,attr,arguments$1=arguments,result={};for(i=0;i<arguments.length;i++)for(attr in arguments[i])Object.hasOwnProperty.call(arguments$1[i],attr)&&void 0===result[attr]&&(result[attr]=arguments$1[i][attr]);return result},prepareContent=function(name,inputData,isBinary,isOptimizedBinaryString,isBase64){var promise=external.Promise.resolve(inputData).then((function(data){return support.blob&&(data instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(data)))&&"undefined"!=typeof FileReader?new external.Promise((function(resolve,reject){var reader=new FileReader;reader.onload=function(e){resolve(e.target.result)},reader.onerror=function(e){reject(e.target.error)},reader.readAsArrayBuffer(data)})):data}));return promise.then((function(data){var dataType=getTypeOf(data);return dataType?("arraybuffer"===dataType?data=transformTo("uint8array",data):"string"===dataType&&(isBase64?data=function(input){var chr1,chr2,chr3,enc2,enc3,enc4,i=0,resultIndex=0;if("data:"===input.substr(0,5))throw new Error("Invalid base64 input, it looks like a data url.");var output,totalLength=3*(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(input.charAt(input.length-1)===_keyStr.charAt(64)&&totalLength--,input.charAt(input.length-2)===_keyStr.charAt(64)&&totalLength--,totalLength%1!=0)throw new Error("Invalid base64 input, bad content length.");for(output=support.uint8array?new Uint8Array(0|totalLength):new Array(0|totalLength);i<input.length;)chr1=_keyStr.indexOf(input.charAt(i++))<<2|(enc2=_keyStr.indexOf(input.charAt(i++)))>>4,chr2=(15&enc2)<<4|(enc3=_keyStr.indexOf(input.charAt(i++)))>>2,chr3=(3&enc3)<<6|(enc4=_keyStr.indexOf(input.charAt(i++))),output[resultIndex++]=chr1,64!==enc3&&(output[resultIndex++]=chr2),64!==enc4&&(output[resultIndex++]=chr3);return output}(data):isBinary&&!0!==isOptimizedBinaryString&&(data=function string2binary(str){return stringToArrayLike(str,support.uint8array?new Uint8Array(str.length):new Array(str.length))}(data))),data):external.Promise.reject(new Error("Can't read the data of '"+name+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))},GenericWorker=function GenericWorker(name){this.name=name||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null};GenericWorker.prototype.push=function push(chunk){this.emit("data",chunk)},GenericWorker.prototype.end=function end(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},GenericWorker.prototype.error=function error(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},GenericWorker.prototype.on=function on(name,listener){return this._listeners[name].push(listener),this},GenericWorker.prototype.cleanUp=function cleanUp(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},GenericWorker.prototype.emit=function emit(name,arg){if(this._listeners[name])for(var i=0;i<this._listeners[name].length;i++)this._listeners[name][i].call(this,arg)},GenericWorker.prototype.pipe=function pipe(next){return next.registerPrevious(this)},GenericWorker.prototype.registerPrevious=function registerPrevious(previous){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=previous.streamInfo,this.mergeStreamInfo(),this.previous=previous;var self=this;return previous.on("data",(function(chunk){self.processChunk(chunk)})),previous.on("end",(function(){self.end()})),previous.on("error",(function(e){self.error(e)})),this},GenericWorker.prototype.pause=function pause(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},GenericWorker.prototype.resume=function resume(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var withError=!1;return this.generatedError&&(this.error(this.generatedError),withError=!0),this.previous&&this.previous.resume(),!withError},GenericWorker.prototype.flush=function flush(){},GenericWorker.prototype.processChunk=function processChunk(chunk){this.push(chunk)},GenericWorker.prototype.withStreamInfo=function withStreamInfo(key,value){return this.extraStreamInfo[key]=value,this.mergeStreamInfo(),this},GenericWorker.prototype.mergeStreamInfo=function mergeStreamInfo(){for(var key in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(key)&&(this.streamInfo[key]=this.extraStreamInfo[key])},GenericWorker.prototype.lock=function lock(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},GenericWorker.prototype.toString=function toString(){var me="Worker "+this.name;return this.previous?this.previous+" -> "+me:me};var utf8len=function(c){for(var _utf8len=new Array(256),i=0;i<256;i++)_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;return _utf8len[254]=_utf8len[254]=1,utf8len=function(c){return _utf8len[c]},_utf8len[c]},utf8encode=function utf8encode(str){return function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),buf_len+=c<128?1:c<2048?2:c<65536?3:4;for(buf=support.uint8array?new Uint8Array(buf_len):new Array(buf_len),i=0,m_pos=0;i<buf_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),c<128?buf[i++]=c:c<2048?(buf[i++]=192|c>>>6,buf[i++]=128|63&c):c<65536?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c);return buf}(str)},utf8decode=function utf8decode(buf){return function(buf){var i,out,c,c_len,len=buf.length,utf16buf=new Array(2*len);for(out=0,i=0;i<len;)if((c=buf[i++])<128)utf16buf[out++]=c;else if((c_len=utf8len(c))>4)utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;c_len>1&&i<len;)c=c<<6|63&buf[i++],c_len--;c_len>1?utf16buf[out++]=65533:c<65536?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return utf16buf.length!==out&&(utf16buf.subarray?utf16buf=utf16buf.subarray(0,out):utf16buf.length=out),applyFromCharCode(utf16buf)}(buf=transformTo(support.uint8array?"uint8array":"array",buf))},Utf8DecodeWorker=function(GenericWorker){function Utf8DecodeWorker(){GenericWorker.call(this,"utf-8 decode"),this.leftOver=null}return Utf8DecodeWorker.__proto__=GenericWorker,Utf8DecodeWorker.prototype=Object.create(GenericWorker.prototype),Utf8DecodeWorker.prototype.constructor=Utf8DecodeWorker,Utf8DecodeWorker.prototype.processChunk=function processChunk(chunk){var data=transformTo(support.uint8array?"uint8array":"array",chunk.data);if(this.leftOver&&this.leftOver.length){if(support.uint8array){var previousData=data;(data=new Uint8Array(previousData.length+this.leftOver.length)).set(this.leftOver,0),data.set(previousData,this.leftOver.length)}else data=this.leftOver.concat(data);this.leftOver=null}var nextBoundary=function(buf,max){var pos;for((max=max||buf.length)>buf.length&&(max=buf.length),pos=max-1;pos>=0&&128==(192&buf[pos]);)pos--;return pos<0||0===pos?max:pos+utf8len(buf[pos])>max?pos:max}(data),usableData=data;nextBoundary!==data.length&&(support.uint8array?(usableData=data.subarray(0,nextBoundary),this.leftOver=data.subarray(nextBoundary,data.length)):(usableData=data.slice(0,nextBoundary),this.leftOver=data.slice(nextBoundary,data.length))),this.push({data:utf8decode(usableData),meta:chunk.meta})},Utf8DecodeWorker.prototype.flush=function flush(){this.leftOver&&this.leftOver.length&&(this.push({data:utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},Utf8DecodeWorker}(GenericWorker),Utf8EncodeWorker=function(GenericWorker){function Utf8EncodeWorker(){GenericWorker.call(this,"utf-8 encode")}return Utf8EncodeWorker.__proto__=GenericWorker,Utf8EncodeWorker.prototype=Object.create(GenericWorker.prototype),Utf8EncodeWorker.prototype.constructor=Utf8EncodeWorker,Utf8EncodeWorker.prototype.processChunk=function processChunk(chunk){this.push({data:utf8encode(chunk.data),meta:chunk.meta})},Utf8EncodeWorker}(GenericWorker),ConvertWorker=function(GenericWorker){function ConvertWorker(destType){GenericWorker.call(this,"ConvertWorker to "+destType),this.destType=destType}return ConvertWorker.__proto__=GenericWorker,ConvertWorker.prototype=Object.create(GenericWorker.prototype),ConvertWorker.prototype.constructor=ConvertWorker,ConvertWorker.prototype.processChunk=function processChunk(chunk){this.push({data:transformTo(this.destType,chunk.data),meta:chunk.meta})},ConvertWorker}(GenericWorker);function transformZipOutput(type,content,mimeType){switch(type){case"blob":return function(part,type){return checkSupport("blob"),new Blob([part],{type})}(transformTo("arraybuffer",content),mimeType);case"base64":return function(input){for(var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output=[],i=0,len=input.length,remainingBytes=len,isArray="string"!=typeof input;i<input.length;)remainingBytes=len-i,isArray?(chr1=input[i++],chr2=i<len?input[i++]:0,chr3=i<len?input[i++]:0):(chr1=input.charCodeAt(i++),chr2=i<len?input.charCodeAt(i++):0,chr3=i<len?input.charCodeAt(i++):0),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=remainingBytes>1?(15&chr2)<<2|chr3>>6:64,enc4=remainingBytes>2?63&chr3:64,output.push(_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4));return output.join("")}(content);default:return transformTo(type,content)}}function accumulate(helper,updateCallback){return new external.Promise((function(resolve,reject){var dataArray=[],chunkType=helper._internalType,resultType=helper._outputType,mimeType=helper._mimeType;helper.on("data",(function(data,meta){dataArray.push(data),updateCallback&&updateCallback(meta)})).on("error",(function(err){dataArray=[],reject(err)})).on("end",(function(){try{var result=transformZipOutput(resultType,function concat(type,dataArray){var i,index=0,res=null,totalLength=0;for(i=0;i<dataArray.length;i++)totalLength+=dataArray[i].length;switch(type){case"string":return dataArray.join("");case"array":return Array.prototype.concat.apply([],dataArray);case"uint8array":for(res=new Uint8Array(totalLength),i=0;i<dataArray.length;i++)res.set(dataArray[i],index),index+=dataArray[i].length;return res;default:throw new Error("concat : unsupported type '"+type+"'")}}(chunkType,dataArray),mimeType);resolve(result)}catch(e){reject(e)}dataArray=[]})).resume()}))}var StreamHelper=function StreamHelper(worker,outputType,mimeType){var internalType=outputType;switch(outputType){case"blob":case"arraybuffer":internalType="uint8array";break;case"base64":internalType="string"}try{this._internalType=internalType,this._outputType=outputType,this._mimeType=mimeType,checkSupport(internalType),this._worker=worker.pipe(new ConvertWorker(internalType)),worker.lock()}catch(e){this._worker=new GenericWorker("error"),this._worker.error(e)}};StreamHelper.prototype.accumulate=function accumulate$1(updateCb){return accumulate(this,updateCb)},StreamHelper.prototype.on=function on(evt,fn){var self=this;return"data"===evt?this._worker.on(evt,(function(chunk){fn.call(self,chunk.data,chunk.meta)})):this._worker.on(evt,(function(){delay(fn,arguments,self)})),this},StreamHelper.prototype.resume=function resume(){return delay(this._worker.resume,[],this._worker),this},StreamHelper.prototype.pause=function pause(){return this._worker.pause(),this};var defaults=Object.freeze({__proto__:null,base64:!1,binary:!1,comment:null,compression:null,compressionOptions:null,createFolders:true,date:null,dir:!1,dosPermissions:null,unixPermissions:null}),DataWorker=function(GenericWorker){function DataWorker(dataP){GenericWorker.call(this,"DataWorker");var self=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,dataP.then((function(data){self.dataIsReady=!0,self.data=data,self.max=data&&data.length||0,self.type=getTypeOf(data),self.isPaused||self._tickAndRepeat()}),(function(e){self.error(e)}))}return DataWorker.__proto__=GenericWorker,DataWorker.prototype=Object.create(GenericWorker.prototype),DataWorker.prototype.constructor=DataWorker,DataWorker.prototype.cleanUp=function cleanUp(){GenericWorker.prototype.cleanUp.call(this),this.data=null},DataWorker.prototype.resume=function resume(){return!!GenericWorker.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,delay(this._tickAndRepeat,[],this)),!0)},DataWorker.prototype._tickAndRepeat=function _tickAndRepeat(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},DataWorker.prototype._tick=function _tick(){if(this.isPaused||this.isFinished)return!1;var data=null,nextIndex=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":data=this.data.substring(this.index,nextIndex);break;case"uint8array":data=this.data.subarray(this.index,nextIndex);break;case"array":data=this.data.slice(this.index,nextIndex)}return this.index=nextIndex,this.push({data,meta:{percent:this.max?this.index/this.max*100:0}})},DataWorker}(GenericWorker),DataLengthProbe=function(GenericWorker){function DataLengthProbe(propName){GenericWorker.call(this,"DataLengthProbe for "+propName),this.propName=propName,this.withStreamInfo(propName,0)}return DataLengthProbe.__proto__=GenericWorker,DataLengthProbe.prototype=Object.create(GenericWorker.prototype),DataLengthProbe.prototype.constructor=DataLengthProbe,DataLengthProbe.prototype.processChunk=function processChunk(chunk){if(chunk){var length=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=length+chunk.data.length}GenericWorker.prototype.processChunk.call(this,chunk)},DataLengthProbe}(GenericWorker),makeTable=function(){for(var table=[],n=0;n<256;n++){for(var c=n,k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return makeTable=function(){return table},table};function crc32wrapper(input,crc){return void 0!==input&&input.length?"string"!==getTypeOf(input)?function crc32(crc,buf,len,pos){var t=makeTable(),end=pos+len;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc}(0|crc,input,input.length,0):function crc32str(crc,str,len,pos){var t=makeTable(),end=pos+len;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[255&(crc^str.charCodeAt(i))];return-1^crc}(0|crc,input,input.length,0):0}var Crc32Probe=function(GenericWorker){function Crc32Probe(){GenericWorker.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}return Crc32Probe.__proto__=GenericWorker,Crc32Probe.prototype=Object.create(GenericWorker.prototype),Crc32Probe.prototype.constructor=Crc32Probe,Crc32Probe.prototype.processChunk=function processChunk(chunk){this.streamInfo.crc32=crc32wrapper(chunk.data,this.streamInfo.crc32||0),this.push(chunk)},Crc32Probe}(GenericWorker),CompressedObject=function CompressedObject(compressedSize,uncompressedSize,crc32,compression,data){this.compressedSize=compressedSize,this.uncompressedSize=uncompressedSize,this.crc32=crc32,this.compression=compression,this.compressedContent=data};CompressedObject.prototype.getContentWorker=function getContentWorker(){var worker=new DataWorker(external.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new DataLengthProbe("data_length")),that=this;return worker.on("end",(function(){if(this.streamInfo.data_length!==that.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),worker},CompressedObject.prototype.getCompressedWorker=function getCompressedWorker(){return new DataWorker(external.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)},CompressedObject.createWorkerFrom=function createWorkerFrom(uncompressedWorker,compression,compressionOptions){return uncompressedWorker.pipe(new Crc32Probe).pipe(new DataLengthProbe("uncompressedSize")).pipe(compression.compressWorker(compressionOptions)).pipe(new DataLengthProbe("compressedSize")).withStreamInfo("compression",compression)};var ZipObject=function ZipObject(name,data,options){this.name=name,this.dir=options.dir,this.date=options.date,this.comment=options.comment,this.unixPermissions=options.unixPermissions,this.dosPermissions=options.dosPermissions,this._data=data,this._dataBinary=options.binary,this.options={compression:options.compression,compressionOptions:options.compressionOptions}};ZipObject.prototype.internalStream=function internalStream(type){var result=null,outputType="string";try{if(!type)throw new Error("No output type specified.");var askUnicodeString="string"===(outputType=type.toLowerCase())||"text"===outputType;"binarystring"!==outputType&&"text"!==outputType||(outputType="string"),result=this._decompressWorker();var isUnicodeString=!this._dataBinary;isUnicodeString&&!askUnicodeString&&(result=result.pipe(new Utf8EncodeWorker)),!isUnicodeString&&askUnicodeString&&(result=result.pipe(new Utf8DecodeWorker))}catch(e){(result=new GenericWorker("error")).error(e)}return new StreamHelper(result,outputType,"")},ZipObject.prototype.async=function async(type,onUpdate){return this.internalStream(type).accumulate(onUpdate)},ZipObject.prototype._compressWorker=function _compressWorker(compression,compressionOptions){if(this._data instanceof CompressedObject&&this._data.compression.magic===compression.magic)return this._data.getCompressedWorker();var result=this._decompressWorker();return this._dataBinary||(result=result.pipe(new Utf8EncodeWorker)),CompressedObject.createWorkerFrom(result,compression,compressionOptions)},ZipObject.prototype._decompressWorker=function _decompressWorker(){return this._data instanceof CompressedObject?this._data.getContentWorker():this._data instanceof GenericWorker?this._data:new DataWorker(this._data)};var arrayType=function(){var resolved="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array?"uint8array":"array";arrayType=function(){return resolved}},FlateWorker=function(GenericWorker){function FlateWorker(action,options){GenericWorker.call(this,"FlateWorker/"+action),this._pako=null,this._pakoAction=action,this._pakoOptions=options,this.meta={}}return FlateWorker.__proto__=GenericWorker,FlateWorker.prototype=Object.create(GenericWorker.prototype),FlateWorker.prototype.constructor=FlateWorker,FlateWorker.prototype.processChunk=function processChunk(chunk){this.meta=chunk.meta,null===this._pako&&this._createPako(),this._pako.push(transformTo(arrayType(),chunk.data),!1)},FlateWorker.prototype.flush=function flush(){GenericWorker.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},FlateWorker.prototype.cleanUp=function cleanUp(){GenericWorker.prototype.cleanUp.call(this),this._pako=null},FlateWorker.prototype._createPako=function _createPako(){var this$1$1=this,params={raw:!0,level:this._pakoOptions.level||-1};this._pako="Deflate"===this._pakoAction?new pako_esm5.Gy(params):new pako_esm5.EL(params),this._pako.onData=function(data){this$1$1.push({data,meta:this$1$1.meta})}},FlateWorker}(GenericWorker),DEFLATE={magic:"\b\0",compressWorker:function(compressionOptions){return new FlateWorker("Deflate",compressionOptions)},uncompressWorker:function(){return new FlateWorker("Inflate",{})}},compressions={STORE:{magic:"\0\0",compressWorker:function(){return new GenericWorker("STORE compression")},uncompressWorker:function(){return new GenericWorker("STORE decompression")}},DEFLATE},decToHex=function(dec,bytes){var i,hex="";for(i=0;i<bytes;i++)hex+=String.fromCharCode(255&dec),dec>>>=8;return hex},generateZipParts=function(streamInfo,streamedContent,streamingEnded,offset,platform,encodeFileName){var dosTime,dosDate,file=streamInfo.file,compression=streamInfo.compression,useCustomEncoding=encodeFileName!==utf8encode,encodedFileName=transformTo("string",encodeFileName(file.name)),utfEncodedFileName=transformTo("string",utf8encode(file.name)),comment=file.comment,encodedComment=transformTo("string",encodeFileName(comment)),utfEncodedComment=transformTo("string",utf8encode(comment)),useUTF8ForFileName=utfEncodedFileName.length!==file.name.length,useUTF8ForComment=utfEncodedComment.length!==comment.length,extraFields="",unicodePathExtraField="",unicodeCommentExtraField="",dir=file.dir,date=file.date,dataInfo={crc32:0,compressedSize:0,uncompressedSize:0};streamedContent&&!streamingEnded||(dataInfo.crc32=streamInfo.crc32,dataInfo.compressedSize=streamInfo.compressedSize,dataInfo.uncompressedSize=streamInfo.uncompressedSize);var bitflag=0;streamedContent&&(bitflag|=8),useCustomEncoding||!useUTF8ForFileName&&!useUTF8ForComment||(bitflag|=2048);var extFileAttr=0,versionMadeBy=0;dir&&(extFileAttr|=16),"UNIX"===platform?(versionMadeBy=798,extFileAttr|=function(unixPermissions,isDir){var result=unixPermissions;return unixPermissions||(result=isDir?16893:33204),(65535&result)<<16}(file.unixPermissions,dir)):(versionMadeBy=20,extFileAttr|=function(dosPermissions){return 63&(dosPermissions||0)}(file.dosPermissions)),dosTime=date.getUTCHours(),dosTime<<=6,dosTime|=date.getUTCMinutes(),dosTime<<=5,dosTime|=date.getUTCSeconds()/2,dosDate=date.getUTCFullYear()-1980,dosDate<<=4,dosDate|=date.getUTCMonth()+1,dosDate<<=5,dosDate|=date.getUTCDate(),useUTF8ForFileName&&(unicodePathExtraField=decToHex(1,1)+decToHex(crc32wrapper(encodedFileName),4)+utfEncodedFileName,extraFields+="up"+decToHex(unicodePathExtraField.length,2)+unicodePathExtraField),useUTF8ForComment&&(unicodeCommentExtraField=decToHex(1,1)+decToHex(crc32wrapper(encodedComment),4)+utfEncodedComment,extraFields+="uc"+decToHex(unicodeCommentExtraField.length,2)+unicodeCommentExtraField);var header="";return header+="\n\0",header+=decToHex(bitflag,2),header+=compression.magic,header+=decToHex(dosTime,2),header+=decToHex(dosDate,2),header+=decToHex(dataInfo.crc32,4),header+=decToHex(dataInfo.compressedSize,4),header+=decToHex(dataInfo.uncompressedSize,4),header+=decToHex(encodedFileName.length,2),{fileRecord:"PK"+(header+=decToHex(extraFields.length,2))+encodedFileName+extraFields,dirRecord:"PK"+decToHex(versionMadeBy,2)+header+decToHex(encodedComment.length,2)+"\0\0\0\0"+decToHex(extFileAttr,4)+decToHex(offset,4)+encodedFileName+extraFields+encodedComment}},generateDataDescriptors=function(streamInfo){return"PK\b"+decToHex(streamInfo.crc32,4)+decToHex(streamInfo.compressedSize,4)+decToHex(streamInfo.uncompressedSize,4)},ZipFileWorker=function(GenericWorker){function ZipFileWorker(streamFiles,comment,platform,encodeFileName){GenericWorker.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=comment,this.zipPlatform=platform,this.encodeFileName=encodeFileName,this.streamFiles=streamFiles,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}return ZipFileWorker.__proto__=GenericWorker,ZipFileWorker.prototype=Object.create(GenericWorker.prototype),ZipFileWorker.prototype.constructor=ZipFileWorker,ZipFileWorker.prototype.push=function push(chunk){var currentFilePercent=chunk.meta.percent||0,entriesCount=this.entriesCount,remainingFiles=this._sources.length;this.accumulate?this.contentBuffer.push(chunk):(this.bytesWritten+=chunk.data.length,GenericWorker.prototype.push.call(this,{data:chunk.data,meta:{currentFile:this.currentFile,percent:entriesCount?(currentFilePercent+100*(entriesCount-remainingFiles-1))/entriesCount:100}}))},ZipFileWorker.prototype.openedSource=function openedSource(streamInfo){this.currentSourceOffset=this.bytesWritten,this.currentFile=streamInfo.file.name;var streamedContent=this.streamFiles&&!streamInfo.file.dir;if(streamedContent){var record=generateZipParts(streamInfo,streamedContent,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:record.fileRecord,meta:{percent:0}})}else this.accumulate=!0},ZipFileWorker.prototype.closedSource=function closedSource(streamInfo){this.accumulate=!1;var streamedContent=this.streamFiles&&!streamInfo.file.dir,record=generateZipParts(streamInfo,streamedContent,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(record.dirRecord),streamedContent)this.push({data:generateDataDescriptors(streamInfo),meta:{percent:100}});else for(this.push({data:record.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},ZipFileWorker.prototype.flush=function flush(){for(var localDirLength=this.bytesWritten,i=0;i<this.dirRecords.length;i++)this.push({data:this.dirRecords[i],meta:{percent:100}});var centralDirLength=this.bytesWritten-localDirLength,dirEnd=function(entriesCount,centralDirLength,localDirLength,comment,encodeFileName){var encodedComment=transformTo("string",encodeFileName(comment));return"PK\0\0\0\0"+decToHex(entriesCount,2)+decToHex(entriesCount,2)+decToHex(centralDirLength,4)+decToHex(localDirLength,4)+decToHex(encodedComment.length,2)+encodedComment}(this.dirRecords.length,centralDirLength,localDirLength,this.zipComment,this.encodeFileName);this.push({data:dirEnd,meta:{percent:100}})},ZipFileWorker.prototype.prepareNextSource=function prepareNextSource(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},ZipFileWorker.prototype.registerPrevious=function registerPrevious(previous){this._sources.push(previous);var self=this;return previous.on("data",(function(chunk){self.processChunk(chunk)})),previous.on("end",(function(){self.closedSource(self.previous.streamInfo),self._sources.length?self.prepareNextSource():self.end()})),previous.on("error",(function(e){self.error(e)})),this},ZipFileWorker.prototype.resume=function resume(){return!!GenericWorker.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},ZipFileWorker.prototype.error=function error(e){var sources=this._sources;if(!GenericWorker.prototype.error.call(this,e))return!1;for(var i=0;i<sources.length;i++)try{sources[i].error(e)}catch(e$1){}return!0},ZipFileWorker.prototype.lock=function lock(){GenericWorker.prototype.lock.call(this);for(var sources=this._sources,i=0;i<sources.length;i++)sources[i].lock()},ZipFileWorker}(GenericWorker),generateWorker=function(zip,options,comment){var zipFileWorker=new ZipFileWorker(options.streamFiles,comment,options.platform,options.encodeFileName),entriesCount=0;try{zip.forEach((function(relativePath,file){entriesCount++;var compression=function(fileCompression,zipCompression){var compressionName=fileCompression||zipCompression,compression=compressions[compressionName];if(!compression)throw new Error(compressionName+" is not a valid compression method !");return compression}(file.options.compression,options.compression),compressionOptions=file.options.compressionOptions||options.compressionOptions||{},dir=file.dir,date=file.date;file._compressWorker(compression,compressionOptions).withStreamInfo("file",{name:relativePath,dir,date,comment:file.comment||"",unixPermissions:file.unixPermissions,dosPermissions:file.dosPermissions}).pipe(zipFileWorker)})),zipFileWorker.entriesCount=entriesCount}catch(e){zipFileWorker.error(e)}return zipFileWorker},DataReader=function DataReader(data){this.data=data,this.length=data.length,this.index=0,this.zero=0};DataReader.prototype.checkOffset=function checkOffset(offset){this.checkIndex(this.index+offset)},DataReader.prototype.checkIndex=function checkIndex(newIndex){if(this.length<this.zero+newIndex||newIndex<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+newIndex+"). Corrupted zip ?")},DataReader.prototype.setIndex=function setIndex(newIndex){this.checkIndex(newIndex),this.index=newIndex},DataReader.prototype.skip=function skip(n){this.setIndex(this.index+n)},DataReader.prototype.byteAt=function byteAt(i){},DataReader.prototype.readInt=function readInt(size){var i,result=0;for(this.checkOffset(size),i=this.index+size-1;i>=this.index;i--)result=(result<<8)+this.byteAt(i);return this.index+=size,result},DataReader.prototype.readString=function readString(size){return transformTo("string",this.readData(size))},DataReader.prototype.readData=function readData(size){},DataReader.prototype.lastIndexOfSignature=function lastIndexOfSignature(sig){},DataReader.prototype.readAndCheckSignature=function readAndCheckSignature(sig){},DataReader.prototype.readDate=function readDate(){var dostime=this.readInt(4);return new Date(Date.UTC(1980+(dostime>>25&127),(dostime>>21&15)-1,dostime>>16&31,dostime>>11&31,dostime>>5&63,(31&dostime)<<1))};var ArrayReader=function(DataReader){function ArrayReader(data){DataReader.call(this,data);for(var i=0;i<this.data.length;i++)data[i]=255&data[i]}return ArrayReader.__proto__=DataReader,ArrayReader.prototype=Object.create(DataReader.prototype),ArrayReader.prototype.constructor=ArrayReader,ArrayReader.prototype.byteAt=function byteAt(i){return this.data[this.zero+i]},ArrayReader.prototype.lastIndexOfSignature=function lastIndexOfSignature(sig){for(var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3),i=this.length-4;i>=0;--i)if(this.data[i]===sig0&&this.data[i+1]===sig1&&this.data[i+2]===sig2&&this.data[i+3]===sig3)return i-this.zero;return-1},ArrayReader.prototype.readAndCheckSignature=function readAndCheckSignature(sig){var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3),data=this.readData(4);return sig0===data[0]&&sig1===data[1]&&sig2===data[2]&&sig3===data[3]},ArrayReader.prototype.readData=function readData(size){if(this.checkOffset(size),0===size)return[];var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);return this.index+=size,result},ArrayReader}(DataReader),StringReader=function(DataReader){function StringReader(data){DataReader.call(this,data)}return StringReader.__proto__=DataReader,StringReader.prototype=Object.create(DataReader.prototype),StringReader.prototype.constructor=StringReader,StringReader.prototype.byteAt=function byteAt(i){return this.data.charCodeAt(this.zero+i)},StringReader.prototype.lastIndexOfSignature=function lastIndexOfSignature(sig){return this.data.lastIndexOf(sig)-this.zero},StringReader.prototype.readAndCheckSignature=function readAndCheckSignature(sig){return sig===this.readData(4)},StringReader.prototype.readData=function readData(size){this.checkOffset(size);var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);return this.index+=size,result},StringReader}(DataReader),Uint8ArrayReader=function(ArrayReader){function Uint8ArrayReader(data){ArrayReader.call(this,data)}return Uint8ArrayReader.__proto__=ArrayReader,Uint8ArrayReader.prototype=Object.create(ArrayReader.prototype),Uint8ArrayReader.prototype.constructor=Uint8ArrayReader,Uint8ArrayReader.prototype.readData=function readData(size){if(this.checkOffset(size),0===size)return new Uint8Array(0);var result=this.data.subarray(this.zero+this.index,this.zero+this.index+size);return this.index+=size,result},Uint8ArrayReader}(ArrayReader);function readerFor(data){var type=getTypeOf(data);return checkSupport(type),"string"!==type||support.uint8array?support.uint8array?new Uint8ArrayReader(transformTo("uint8array",data)):new ArrayReader(transformTo("array",data)):new StringReader(data)}var ZipEntry=function ZipEntry(options,loadOptions){this.options=options,this.loadOptions=loadOptions};ZipEntry.prototype.isEncrypted=function isEncrypted(){return!(1&~this.bitFlag)},ZipEntry.prototype.useUTF8=function useUTF8(){return!(2048&~this.bitFlag)},ZipEntry.prototype.readLocalPart=function readLocalPart(reader){var compression,localExtraFieldsLength;if(reader.skip(22),this.fileNameLength=reader.readInt(2),localExtraFieldsLength=reader.readInt(2),this.fileName=reader.readData(this.fileNameLength),reader.skip(localExtraFieldsLength),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(compression=function(compressionMethod){for(var method in compressions)if(compressions.hasOwnProperty(method)&&compressions[method].magic===compressionMethod)return compressions[method];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+pretty(this.compressionMethod)+" unknown (inner file : "+transformTo("string",this.fileName)+")");this.decompressed=new CompressedObject(this.compressedSize,this.uncompressedSize,this.crc32,compression,reader.readData(this.compressedSize))},ZipEntry.prototype.readCentralPart=function readCentralPart(reader){this.versionMadeBy=reader.readInt(2),reader.skip(2),this.bitFlag=reader.readInt(2),this.compressionMethod=reader.readString(2),this.date=reader.readDate(),this.crc32=reader.readInt(4),this.compressedSize=reader.readInt(4),this.uncompressedSize=reader.readInt(4);var fileNameLength=reader.readInt(2);if(this.extraFieldsLength=reader.readInt(2),this.fileCommentLength=reader.readInt(2),this.diskNumberStart=reader.readInt(2),this.internalFileAttributes=reader.readInt(2),this.externalFileAttributes=reader.readInt(4),this.localHeaderOffset=reader.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");reader.skip(fileNameLength),this.readExtraFields(reader),this.parseZIP64ExtraField(reader),this.fileComment=reader.readData(this.fileCommentLength)},ZipEntry.prototype.processAttributes=function processAttributes(){this.unixPermissions=null,this.dosPermissions=null;var madeBy=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===madeBy&&(this.dosPermissions=63&this.externalFileAttributes),3===madeBy&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},ZipEntry.prototype.parseZIP64ExtraField=function parseZIP64ExtraField(reader){if(this.extraFields[1]){var extraReader=readerFor(this.extraFields[1].value);-1===this.uncompressedSize&&(this.uncompressedSize=extraReader.readInt(8)),-1===this.compressedSize&&(this.compressedSize=extraReader.readInt(8)),-1===this.localHeaderOffset&&(this.localHeaderOffset=extraReader.readInt(8)),-1===this.diskNumberStart&&(this.diskNumberStart=extraReader.readInt(4))}},ZipEntry.prototype.readExtraFields=function readExtraFields(reader){var extraFieldId,extraFieldLength,extraFieldValue,end=reader.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});reader.index<end;)extraFieldId=reader.readInt(2),extraFieldLength=reader.readInt(2),extraFieldValue=reader.readData(extraFieldLength),this.extraFields[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}},ZipEntry.prototype.handleUTF8=function handleUTF8(){var decodeParamType=support.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=utf8decode(this.fileName),this.fileCommentStr=utf8decode(this.fileComment);else{var upath=this.findExtraFieldUnicodePath();if(null!==upath)this.fileNameStr=upath;else{var fileNameByteArray=transformTo(decodeParamType,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(fileNameByteArray)}var ucomment=this.findExtraFieldUnicodeComment();if(null!==ucomment)this.fileCommentStr=ucomment;else{var commentByteArray=transformTo(decodeParamType,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(commentByteArray)}}},ZipEntry.prototype.findExtraFieldUnicodePath=function findExtraFieldUnicodePath(){var upathField=this.extraFields[28789];if(upathField){var extraReader=readerFor(upathField.value);return 1!==extraReader.readInt(1)||crc32wrapper(this.fileName)!==extraReader.readInt(4)?null:utf8decode(extraReader.readData(upathField.length-5))}return null},ZipEntry.prototype.findExtraFieldUnicodeComment=function findExtraFieldUnicodeComment(){var ucommentField=this.extraFields[25461];if(ucommentField){var extraReader=readerFor(ucommentField.value);return 1!==extraReader.readInt(1)||crc32wrapper(this.fileComment)!==extraReader.readInt(4)?null:utf8decode(extraReader.readData(ucommentField.length-5))}return null};var ZipEntries=function ZipEntries(loadOptions){this.files=[],this.loadOptions=loadOptions};function checkEntryCRC32(zipEntry){return new external.Promise((function(resolve,reject){var worker=zipEntry.decompressed.getContentWorker().pipe(new Crc32Probe);worker.on("error",(function(e){reject(e)})).on("end",(function(){worker.streamInfo.crc32!==zipEntry.decompressed.crc32?reject(new Error("Corrupted zip : CRC32 mismatch")):resolve()})).resume()}))}function load(data,options){var zip=this;return options=extend(options||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:utf8decode}),prepareContent("the loaded zip file",data,!0,options.optimizedBinaryString,options.base64).then((function(data){var zipEntries=new ZipEntries(options);return zipEntries.load(data),zipEntries})).then((function checkCRC32(zipEntries){var promises=[external.Promise.resolve(zipEntries)],files=zipEntries.files;if(options.checkCRC32)for(var i=0;i<files.length;i++)promises.push(checkEntryCRC32(files[i]));return external.Promise.all(promises)})).then((function addFiles(results){for(var zipEntries=results.shift(),files=zipEntries.files,i=0;i<files.length;i++){var input=files[i],unsafeName=input.fileNameStr,safeName=resolve(input.fileNameStr);zip.file(safeName,input.decompressed,{binary:!0,optimizedBinaryString:!0,date:input.date,dir:input.dir,comment:input.fileCommentStr.length?input.fileCommentStr:null,unixPermissions:input.unixPermissions,dosPermissions:input.dosPermissions,createFolders:options.createFolders}),input.dir||(zip.file(safeName).unsafeOriginalName=unsafeName)}return zipEntries.zipComment.length&&(zip.comment=zipEntries.zipComment),zip}))}ZipEntries.prototype.checkSignature=function checkSignature(expectedSignature){if(!this.reader.readAndCheckSignature(expectedSignature)){this.reader.index-=4;var signature=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+pretty(signature)+", expected "+pretty(expectedSignature)+")")}},ZipEntries.prototype.isSignature=function isSignature(askedIndex,expectedSignature){var currentIndex=this.reader.index;this.reader.setIndex(askedIndex);var result=this.reader.readString(4)===expectedSignature;return this.reader.setIndex(currentIndex),result},ZipEntries.prototype.readBlockEndOfCentral=function readBlockEndOfCentral(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var zipComment=this.reader.readData(this.zipCommentLength),decodeParamType=support.uint8array?"uint8array":"array",decodeContent=transformTo(decodeParamType,zipComment);this.zipComment=this.loadOptions.decodeFileName(decodeContent)},ZipEntries.prototype.readBlockZip64EndOfCentral=function readBlockZip64EndOfCentral(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var extraFieldId,extraFieldLength,extraFieldValue,extraDataSize=this.zip64EndOfCentralSize-44;0<extraDataSize;)extraFieldId=this.reader.readInt(2),extraFieldLength=this.reader.readInt(4),extraFieldValue=this.reader.readData(extraFieldLength),this.zip64ExtensibleData[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}},ZipEntries.prototype.readBlockZip64EndOfCentralLocator=function readBlockZip64EndOfCentralLocator(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},ZipEntries.prototype.readLocalFiles=function readLocalFiles(){var i,file;for(i=0;i<this.files.length;i++)file=this.files[i],this.reader.setIndex(file.localHeaderOffset),this.checkSignature("PK"),file.readLocalPart(this.reader),file.handleUTF8(),file.processAttributes()},ZipEntries.prototype.readCentralDir=function readCentralDir(){var file;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature("PK");)(file=new ZipEntry({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(file);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},ZipEntries.prototype.readEndOfCentral=function readEndOfCentral(){var offset=this.reader.lastIndexOfSignature("PK");if(offset<0)throw!this.isSignature(0,"PK")?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(offset);var endOfCentralDirOffset=offset;if(this.checkSignature("PK"),this.readBlockEndOfCentral(),65535===this.diskNumber||65535===this.diskWithCentralDirStart||65535===this.centralDirRecordsOnThisDisk||65535===this.centralDirRecords||-1===this.centralDirSize||-1===this.centralDirOffset){if(this.zip64=!0,(offset=this.reader.lastIndexOfSignature("PK"))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(offset),this.checkSignature("PK"),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,"PK")&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature("PK"),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature("PK"),this.readBlockZip64EndOfCentral()}var expectedEndOfCentralDirOffset=this.centralDirOffset+this.centralDirSize;this.zip64&&(expectedEndOfCentralDirOffset+=20,expectedEndOfCentralDirOffset+=12+this.zip64EndOfCentralSize);var extraBytes=endOfCentralDirOffset-expectedEndOfCentralDirOffset;if(extraBytes>0)this.isSignature(endOfCentralDirOffset,"PK")||(this.reader.zero=extraBytes);else if(extraBytes<0)throw new Error("Corrupted zip: missing "+Math.abs(extraBytes)+" bytes.")},ZipEntries.prototype.prepareReader=function prepareReader(data){this.reader=readerFor(data)},ZipEntries.prototype.load=function load(data){this.prepareReader(data),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()};var fileAdd=function(name,data,originalOptions){var parent,dataType=getTypeOf(data),o=extend(originalOptions||{},defaults);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(name=forceTrailingSlash(name)),o.createFolders&&(parent=parentFolder(name))&&folderAdd.call(this,parent,!0);var isUnicodeString="string"===dataType&&!1===o.binary&&!1===o.base64;originalOptions&&void 0!==originalOptions.binary||(o.binary=!isUnicodeString),(data instanceof CompressedObject&&0===data.uncompressedSize||o.dir||!data||0===data.length)&&(o.base64=!1,o.binary=!0,data="",o.compression="STORE",dataType="string");var zipObjectContent=null;zipObjectContent=data instanceof CompressedObject||data instanceof GenericWorker?data:prepareContent(name,data,o.binary,o.optimizedBinaryString,o.base64);var object=new ZipObject(name,zipObjectContent,o);this.files[name]=object},parentFolder=function(path){"/"===path.slice(-1)&&(path=path.substring(0,path.length-1));var lastSlash=path.lastIndexOf("/");return lastSlash>0?path.substring(0,lastSlash):""},forceTrailingSlash=function(path){return"/"!==path.slice(-1)&&(path+="/"),path},folderAdd=function(name,createFolders$1){return createFolders$1=void 0===createFolders$1||createFolders$1,name=forceTrailingSlash(name),this.files[name]||fileAdd.call(this,name,null,{dir:!0,createFolders:createFolders$1}),this.files[name]};function isRegExp(object){return"[object RegExp]"===Object.prototype.toString.call(object)}var JSZip=function JSZip(){if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var newObj=new JSZip;for(var i in this)"function"!=typeof this[i]&&(newObj[i]=this[i]);return newObj}},staticAccessors={support:{configurable:!0},defaults:{configurable:!0},version:{configurable:!0},external:{configurable:!0}};function columnName(colIndex){const letter=Math.floor(colIndex/26)-1;return(letter>=0?columnName(letter):"")+String.fromCharCode(65+colIndex%26)}function displaySheet(sheet){return/^[a-z_][a-z0-9_]*$/i.test(sheet)?sheet:"'"+sheet.replace(/\x27/g,"\\'")+"'"}function displayRef(sheet,row,col,rel){let aa="";return++row,isFinite(row)?null==rel||2&rel||(row="$"+row):row="",isFinite(col)?(aa=columnName(col),null==rel||1&rel||(aa="$"+aa)):col="",sheet?displaySheet(sheet)+"!"+aa+row:aa+row}JSZip.prototype.load=function load(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},JSZip.prototype.forEach=function forEach(cb){var filename,relativePath,file;for(filename in this.files)file=this.files[filename],(relativePath=filename.slice(this.root.length,filename.length))&&filename.slice(0,this.root.length)===this.root&&cb(relativePath,file)},JSZip.prototype.filter=function filter(search){var result=[];return this.forEach((function(relativePath,entry){search(relativePath,entry)&&result.push(entry)})),result},JSZip.prototype.file=function file(name,data,o){if(1===arguments.length){if(isRegExp(name)){var regexp=name;return this.filter((function(relativePath,file){return!file.dir&&regexp.test(relativePath)}))}var obj=this.files[this.root+name];return obj&&!obj.dir?obj:null}return name=this.root+name,fileAdd.call(this,name,data,o),this},JSZip.prototype.folder=function folder(arg){if(!arg)return this;if(isRegExp(arg))return this.filter((function(relativePath,file){return file.dir&&arg.test(relativePath)}));var name=this.root+arg,newFolder=folderAdd.call(this,name),ret=this.clone();return ret.root=newFolder.name,ret},JSZip.prototype.remove=function remove(name){name=this.root+name;var file=this.files[name];if(file||("/"!==name.slice(-1)&&(name+="/"),file=this.files[name]),file&&!file.dir)delete this.files[name];else for(var kids=this.filter((function(relativePath,file){return file.name.slice(0,name.length)===name})),i=0;i<kids.length;i++)delete this.files[kids[i].name];return this},JSZip.prototype.generate=function generate(options){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},JSZip.prototype.generateInternalStream=function generateInternalStream(options){var worker,opts={};try{if((opts=extend(options||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:utf8encode})).type=opts.type.toLowerCase(),opts.compression=opts.compression.toUpperCase(),"binarystring"===opts.type&&(opts.type="string"),!opts.type)throw new Error("No output type specified.");checkSupport(opts.type),"darwin"!==opts.platform&&"freebsd"!==opts.platform&&"linux"!==opts.platform&&"sunos"!==opts.platform||(opts.platform="UNIX"),"win32"===opts.platform&&(opts.platform="DOS");var comment=opts.comment||this.comment||"";worker=generateWorker(this,opts,comment)}catch(e){(worker=new GenericWorker("error")).error(e)}return new StreamHelper(worker,opts.type||"string",opts.mimeType)},JSZip.prototype.generateAsync=function generateAsync(options,onUpdate){return this.generateInternalStream(options).accumulate(onUpdate)},JSZip.prototype.loadAsync=function loadAsync(data,options){return load.apply(this,[data,options])},JSZip.loadAsync=function loadAsync(content,options){return(new JSZip).loadAsync(content,options)},staticAccessors.support.get=function(){return support},staticAccessors.defaults.get=function(){return defaults},staticAccessors.version.get=function(){return"3.2.2-esm"},staticAccessors.external.get=function(){return external},Object.defineProperties(JSZip,staticAccessors);class Ref{constructor(){this.type="ref",this.sheet=""}clone(){return this}hasSheet(){return this._hasSheet}simplify(){return this}setSheet(sheet,hasSheet){return this.sheet=sheet,null!=hasSheet&&(this._hasSheet=hasSheet),this}absolute(_arow,_acol){return this}relative(..._args){return this}adjust(_row,_col,_trow,_tcol,_forRow,_start,_delta){return this}toString(){return this.relative(0,0,3,3).print(0,0)}forEach(callback,obj){callback.call(obj,this)}map(callback,obj){return callback.call(obj,this)}intersect(_ref){return this}intersects(ref){return this.intersect(ref)!==NULLREF}isCell(){return!1}toRow(_row){return this}toColumn(_col){return this}first(){return this}lastRange(){return this}size(){return 1}rangeAt(_index){return this}nextRangeIndex(_index){return 0}previousRangeIndex(_index){return 0}eq(reference){let r1=this,r2=reference;if(r1===NULLREF||r2===NULLREF)return r1===r2;if((r2 instanceof CellRef||r2 instanceof RangeRef&&!(r1 instanceof CellRef))&&(r1=reference,r2=this),r1 instanceof CellRef)return r2=r2.simplify(),r2 instanceof CellRef&&r1.row==r2.row&&r1.col==r2.col&&r1.sheet==r2.sheet;if(r1 instanceof RangeRef){if(r2 instanceof RangeRef)return r2.topLeft.eq(r1.topLeft)&&r2.bottomRight.eq(r1.bottomRight);if(r2 instanceof UnionRef)return r2.single()&&r1.eq(r2.refs[0])}else if(r1 instanceof UnionRef&&r2 instanceof UnionRef){const refs1=r1.refs,refs2=r2.refs;if(refs1.length!=refs2.length)return!1;for(let i=0,len=refs1.length;i<len;i++)if(!refs1[i].eq(refs2[i]))return!1;return!0}return r1===r2}concat(ref){return new UnionRef([this,ref])}replaceAt(_index,ref){return ref}forEachColumnIndex(callback){this.forEachAxisIndex("col",callback)}forEachRowIndex(callback){this.forEachAxisIndex("row",callback)}forEachRow(_callback){}forEachColumn(_callback){}forEachAxisIndex(axis,callback){let sorted=[];this["row"===axis?"forEachRow":"forEachColumn"]((function(ref){let index=ref.first()[axis];-1===sorted.indexOf(index)&&sorted.push(index)})),sorted.sort((function(a,b){return a>b?1:a<b?-1:0})).forEach(callback)}valid(){return!1}renameSheet(oldSheetName,newSheetName){if(this.sheet&&this.sheet.toLowerCase()==oldSheetName.toLowerCase())return this.sheet=newSheetName,!0}}Ref.display=displayRef;const NULLREF=new class NULLREFClass extends Ref{print(){return"#NULL!"}eq(ref){return ref===this}forEach(){}};class NameRef extends Ref{constructor(name){super(),this.name=name,this.ref="name"}clone(){return new NameRef(this.name).setSheet(this.sheet,this.hasSheet())}print(){let ret=displaySheet(this.name);return this.hasSheet()&&(ret=displaySheet(this.sheet)+"!"+ret),ret}}class CellRef extends Ref{constructor(row,col,rel){super(),this.row=row,this.col=col,this.rel=rel||0,this.ref="cell"}clone(){return new CellRef(this.row,this.col,this.rel).setSheet(this.sheet,this.hasSheet())}intersect(ref){return ref instanceof CellRef?this.eq(ref)?this:NULLREF:ref.intersect(this)}print(trow,tcol,mod){let abs,col=this.col,row=this.row,rel=this.rel;if(null==trow&&rel){let sheet=this.hasSheet()?displaySheet(this.sheet)+"!":"";return col=isFinite(col)?1&rel?"C["+col+"]":"C"+(col+1):"",row=isFinite(row)?2&rel?"R["+row+"]":"R"+(row+1):"",sheet+row+col}return abs=this.absolute(trow,tcol),mod?(row=abs.row%1048576,col=abs.col%16384,row<0&&(row+=1048576),col<0&&(col+=16384),displayRef(this._hasSheet&&this.sheet,row,col,rel)):abs.valid()?displayRef(this._hasSheet&&this.sheet,abs.row,abs.col,rel):"#REF!"}absolute(arow,acol){let ret=this.clone();return 3&ret.rel?(1&ret.rel&&(ret.col=(ret.col+acol)%16384),2&ret.rel&&(ret.row=(ret.row+arow)%1048576),ret.rel=0,ret):ret}toRangeRef(){return new RangeRef(this,this)}relative(arow,acol,rel){null==rel&&(rel=this.rel);let row=2&rel?this.row-arow:this.row,col=1&rel?this.col-acol:this.col;return new CellRef(row,col,rel).setSheet(this.sheet,this.hasSheet())}height(){return 1}width(){return 1}toString(){return displayRef(null,this.row,this.col,3)}isCell(){return!0}leftColumn(){return this}rightColumn(){return this}topRow(){return this}bottomRow(){return this}forEachRow(callback){callback(this.toRangeRef())}forEachColumn(callback){callback(this.toRangeRef())}adjust(row,col,trow,tcol,forRow,start,delta){let ref=this.absolute(row,col);if(forRow){if(ref.row>=start){if(delta<0&&ref.row<start-delta)return NULLREF;ref.row+=delta}}else if(ref.col>=start){if(delta<0&&ref.col<start-delta)return NULLREF;ref.col+=delta}return null!=trow&&null!=tcol&&(ref=ref.relative(trow,tcol,this.rel)),ref}valid(){if(this.rel)throw new Error("valid() called on relative reference");let col=this.col,row=this.row;return!(isFinite(col)&&col<0||isFinite(row)&&row<0)}}class RangeRef extends Ref{constructor(tl,br){super(),this.ref="range",tl._hasSheet&&br._hasSheet&&tl.sheet.toLowerCase()!=br.sheet.toLowerCase()&&(this.endSheet=br.sheet),this.topLeft=new CellRef(tl.row,tl.col,tl.rel),this.bottomRight=new CellRef(br.row,br.col,br.rel),this.normalize()}clone(){return new RangeRef(this.topLeft.clone(),this.bottomRight.clone()).setSheet(this.sheet,this.hasSheet())}_containsRange(range){return this._containsCell(range.topLeft)&&this._containsCell(range.bottomRight)}_containsCell(cell){return cell.sheet==this.sheet&&cell.row>=this.topLeft.row&&cell.col>=this.topLeft.col&&cell.row<=this.bottomRight.row&&cell.col<=this.bottomRight.col}contains(ref){if(ref instanceof Array){let that=this;return ref.some((function(_ref){return Boolean(that.contains(_ref))}))}return ref instanceof CellRef?this._containsCell(ref):ref instanceof RangeRef&&this._containsRange(ref)}_intersectRange(ref){if(this.sheet!=ref.sheet)return NULLREF;let a_left=this.topLeft.col,a_top=this.topLeft.row,a_right=this.bottomRight.col,a_bottom=this.bottomRight.row,b_left=ref.topLeft.col,b_top=ref.topLeft.row,b_right=ref.bottomRight.col,b_bottom=ref.bottomRight.row;return a_left<=b_right&&b_left<=a_right&&a_top<=b_bottom&&b_top<=a_bottom?new RangeRef(new CellRef(Math.max(a_top,b_top),Math.max(a_left,b_left)),new CellRef(Math.min(a_bottom,b_bottom),Math.min(a_right,b_right))).setSheet(this.sheet,this.hasSheet()):NULLREF}intersect(ref){return ref instanceof CellRef?this._containsCell(ref)?ref:NULLREF:ref instanceof RangeRef?this._intersectRange(ref).simplify():ref instanceof UnionRef?ref.intersect(this):NULLREF}simplify(){return this.isCell()?new CellRef(this.topLeft.row,this.topLeft.col,this.topLeft.rel).setSheet(this.sheet,this.hasSheet()):this}normalize(){let tmp,a=this.topLeft,b=this.bottomRight,r1=a.row,c1=a.col,r2=b.row,c2=b.col,rr1=2&a.rel,rc1=1&a.rel,rr2=2&b.rel,rc2=1&b.rel,changes=!1;return rr1===rr2&&rc1===rc2&&(r1>r2&&(changes=!0,tmp=r1,r1=r2,r2=tmp,tmp=rr1,rr1=rr2,rr2=tmp),c1>c2&&(changes=!0,tmp=c1,c1=c2,c2=tmp,tmp=rc1,rc1=rc2,rc2=tmp),changes&&(this.topLeft=new CellRef(r1,c1,rc1|rr1),this.bottomRight=new CellRef(r2,c2,rc2|rr2))),this}print(trow,tcol,mod){if(mod||this.absolute(trow,tcol).valid()){let ret=this.topLeft.print(trow,tcol,mod)+":"+this.bottomRight.print(trow,tcol,mod);return this.hasSheet()&&(ret=displaySheet(this.sheet)+(this.endSheet?":"+displaySheet(this.endSheet):"")+"!"+ret),ret}return"#REF!"}absolute(arow,acol){return new RangeRef(this.topLeft.absolute(arow,acol),this.bottomRight.absolute(arow,acol)).setSheet(this.sheet,this.hasSheet())}relative(arow,acol,relTL,relBR){return null==relBR&&(relBR=relTL),new RangeRef(this.topLeft.relative(arow,acol,relTL),this.bottomRight.relative(arow,acol,relBR)).setSheet(this.sheet,this.hasSheet())}height(){if(this.topLeft.rel!=this.bottomRight.rel)throw new Error("Mixed relative/absolute references");return this.bottomRight.row-this.topLeft.row+1}width(){if(this.topLeft.rel!=this.bottomRight.rel)throw new Error("Mixed relative/absolute references");return this.bottomRight.col-this.topLeft.col+1}collapse(){return this.topLeft.toRangeRef()}leftColumn(){return new RangeRef(this.topLeft,new CellRef(this.bottomRight.row,this.topLeft.col))}rightColumn(){return new RangeRef(new CellRef(this.topLeft.row,this.bottomRight.col),this.bottomRight)}topRow(){return new RangeRef(this.topLeft,new CellRef(this.topLeft.row,this.bottomRight.col))}bottomRow(){return new RangeRef(new CellRef(this.bottomRight.row,this.topLeft.col),this.bottomRight)}toRangeRef(){return this}toRow(row){return row+=Math.max(0,this.topLeft.row),new RangeRef(new CellRef(row,this.topLeft.col),new CellRef(row,this.bottomRight.col)).setSheet(this.sheet,this.hasSheet())}toColumn(col){return col+=Math.max(0,this.topLeft.col),new RangeRef(new CellRef(this.topLeft.row,col),new CellRef(this.bottomRight.row,col)).setSheet(this.sheet,this.hasSheet())}toCell(row,col){return row+=Math.max(0,this.topLeft.row),col+=Math.max(0,this.topLeft.col),new CellRef(row,col,0).setSheet(this.sheet,this.hasSheet())}forEachRow(callback){let startRow=this.topLeft.row,endRow=this.bottomRight.row,startCol=this.topLeft.col,endCol=this.bottomRight.col;for(let i=startRow;i<=endRow;i++)callback(new RangeRef(new CellRef(i,startCol),new CellRef(i,endCol)))}forEachColumn(callback){let startRow=this.topLeft.row,endRow=this.bottomRight.row,startCol=this.topLeft.col,endCol=this.bottomRight.col;for(let i=startCol;i<=endCol;i++)callback(new RangeRef(new CellRef(startRow,i),new CellRef(endRow,i)))}intersecting(refs){return refs.filter((ref=>ref.toRangeRef().intersects(this)))}union(refs,callback){let intersecting=this.intersecting(refs),topLeftRow=this.topLeft.row,topLeftCol=this.topLeft.col,bottomRightRow=this.bottomRight.row,bottomRightCol=this.bottomRight.col,modified=!1;intersecting.forEach((function(ref){(ref=ref.toRangeRef()).topLeft.row<topLeftRow&&(modified=!0,topLeftRow=ref.topLeft.row),ref.topLeft.col<topLeftCol&&(modified=!0,topLeftCol=ref.topLeft.col),ref.bottomRight.row>bottomRightRow&&(modified=!0,bottomRightRow=ref.bottomRight.row),ref.bottomRight.col>bottomRightCol&&(modified=!0,bottomRightCol=ref.bottomRight.col),callback&&callback(ref)}));let result=new RangeRef(new CellRef(topLeftRow,topLeftCol),new CellRef(bottomRightRow,bottomRightCol));return modified?result.union(refs,callback):result}resize(options){let limit=Math.max.bind(Math,0);function num(value){return value||0}let top=this.topLeft.row+num(options.top),left=this.topLeft.col+num(options.left),bottom=this.bottomRight.row+num(options.bottom),right=this.bottomRight.col+num(options.right);return left<0&&right<0||top<0&&bottom<0?NULLREF:top<=bottom&&left<=right?new RangeRef(new CellRef(limit(top),limit(left)),new CellRef(limit(bottom),limit(right))):NULLREF}move(rows,cols){return new RangeRef(new CellRef(this.topLeft.row+rows,this.topLeft.col+cols),new CellRef(this.bottomRight.row+rows,this.bottomRight.col+cols))}first(){return this.topLeft.clone().setSheet(this.sheet,this.hasSheet())}isCell(){return!this.endSheet&&this.topLeft.eq(this.bottomRight)}toString(){return this.topLeft+":"+this.bottomRight}adjust(row,col,trow,tcol,forRow,start,delta){let tl=this.topLeft.adjust(row,col,trow,tcol,forRow,start,delta),tr=this.bottomRight.adjust(row,col,trow,tcol,forRow,start,delta);return tl===NULLREF&&tr===NULLREF?NULLREF:(tl===NULLREF?(tl=this.topLeft.absolute(row,col),forRow?tl.row=start:tl.col=start,null!=trow&&null!=tcol&&(tl=tl.relative(trow,tcol,this.topLeft.rel))):tr===NULLREF&&(tr=this.bottomRight.absolute(row,col),forRow?tr.row=start-1:tr.col=start-1,null!=trow&&null!=tcol&&(tr=tr.relative(trow,tcol,this.bottomRight.rel))),new RangeRef(tl,tr).setSheet(this.sheet,this.hasSheet()).simplify())}valid(){return this.topLeft.valid()&&this.bottomRight.valid()}}class UnionRef extends Ref{constructor(refs){super(),this.refs=refs,this.length=refs.length}clone(){return new UnionRef(this.refs.slice())}intersect(ref){let a=[];for(let i=0;i<this.length;++i){let x=ref.intersect(this.refs[i]);x!==NULLREF&&a.push(x)}return a.length>0?new UnionRef(a).simplify():NULLREF}simplify(){let u=new UnionRef(this.refs.reduce((function(a,ref){return(ref=ref.simplify())!==NULLREF&&a.push(ref),a}),[]));return u.empty()?NULLREF:u.single()?u.refs[0]:u}absolute(arow,acol){return new UnionRef(this.refs.map((function(ref){return ref.absolute(arow,acol)})))}forEach(callback,obj){this.refs.forEach((function(ref){ref instanceof UnionRef?ref.forEach(callback,obj):callback.call(obj,ref)}),obj)}toRangeRef(){return this.refs[0].toRangeRef()}contains(theRef){return this.refs.some((function(ref){return ref.contains(theRef)}))}map(callback,obj){let refs=[];return this.forEach((function(ref){refs.push(callback.call(obj,ref))})),new UnionRef(refs)}first(){return this.refs[0].first()}lastRange(){return this.refs[this.length-1]}size(){return this.length}single(){return 1==this.length}empty(){return 0===this.length}isCell(){return this.single()&&this.refs[0].isCell()}rangeAt(index){return this.refs[index]}nextRangeIndex(index){return index===this.length-1?0:index+1}previousRangeIndex(index){return 0===index?this.length-1:index-1}concat(ref){return new UnionRef(this.refs.concat([ref]))}print(row,col,mod){return this.refs.map((function(ref){return ref.print(row,col,mod)})).join(",")}replaceAt(index,ref){let newRefs=this.refs.slice();return newRefs.splice(index,1,ref),new UnionRef(newRefs)}leftColumn(){return this.map((function(ref){return ref.leftColumn()}))}rightColumn(){return this.map((function(ref){return ref.rightColumn()}))}topRow(){return this.map((function(ref){return ref.topRow()}))}bottomRow(){return this.map((function(ref){return ref.bottomRow()}))}forEachRow(callback){this.forEach((function(ref){ref.forEachRow(callback)}))}forEachColumn(callback){this.forEach((function(ref){ref.forEachColumn(callback)}))}adjust(row,col,trow,tcol,forRow,start,delta){return this.map((function(ref){return ref.adjust(row,col,trow,tcol,forRow,start,delta)})).simplify()}toString(){return this.refs.map((function(ref){return ref.toString()})).join(", ")}valid(){for(let i=this.refs.length;--i>=0;)if(this.refs[i].valid())return!1;return!0}renameSheet(oldSheetName,newSheetName){this.refs.forEach((function(ref){ref.renameSheet(oldSheetName,newSheetName)}))}}const FIRSTREF=new CellRef(0,0),SHEETREF=new RangeRef(new CellRef(0,0),new CellRef(1/0,1/0));SHEETREF.print=function(){return"#SHEET"};const index_esm_messages={view:{nameBox:"Name Box",errors:{modifyMerged:"Cannot change part of a merged cell.",openUnsupported:"Unsupported format. Please select an .xlsx file.",shiftingNonblankCells:"Cannot insert cells due to data loss possibility. Select another insert location or delete the data from the end of your worksheet.",insertColumnWhenRowIsSelected:"Cannot insert column when all columns are selected.",insertRowWhenColumnIsSelected:"Cannot insert row when all rows are selected.",filterRangeContainingMerges:"Cannot create a filter within a range containing merges",sortRangeContainingMerges:"Cannot sort a range containing merges",cantSortMultipleSelection:"Cannot sort multiple selection",cantSortNullRef:"Cannot sort empty selection",cantSortMixedCells:"Cannot sort range containing cells of mixed shapes",validationError:"The value that you entered violates the validation rules set on the cell.",cannotModifyDisabled:"Cannot modify disabled cells.",insertRowBelowLastRow:"Cannot insert row below the last row.",insertColAfterLastCol:"Cannot insert column to the right of the last column."},tabs:{home:"Home",insert:"Insert",data:"Data"}},menus:{cut:"Cut",copy:"Copy",paste:"Paste",merge:"Merge",unmerge:"Unmerge",delete:"Delete",hide:"Hide",unhide:"Unhide",bringToFront:"Bring to front",sendToBack:"Send to back"},workbook:{defaultSheetName:"Sheet"}},options={name:"Spreadsheet",toolbar:!0,sheetsbar:!0,rows:200,columns:50,rowHeight:20,columnWidth:64,headerHeight:20,headerWidth:32,excel:{fileName:"Workbook.xlsx",forceProxy:!1,proxyURL:""},messages:index_esm_messages,pdf:{area:"workbook",fileName:"Workbook.pdf",proxyURL:"",paperSize:"a4",landscape:!0,margin:null,title:null,author:null,subject:null,keywords:null,creator:"Kendo UI PDF Generator",date:null},defaultCellStyle:{fontFamily:"Arial",fontSize:12},useCultureDecimals:!1,locale:"en"},ALL_REASONS={recalc:!0,selection:!0,activeCell:!0,layout:!0,sheetSelection:!0,resize:!0,editorChange:!1,editorClose:!1},index_esm_keys={INSERT:45,DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,END:35,HOME:36,SPACEBAR:32,PAGEUP:33,PAGEDOWN:34,F2:113,F10:121,F12:123,NUMPAD_PLUS:107,NUMPAD_MINUS:109,NUMPAD_DOT:110},RX_UNICODE_LETTER=new RegExp("[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function memoize(f){let cache=Object.create(null);return function(){let id="";for(let i=arguments.length;--i>=0;)id+=":"+arguments[i];return id in cache?cache[id]:cache[id]=f.apply(this,arguments)}}function withExit(f,obj){try{return f.call(obj,(function(value){throw new Return(value)}))}catch(ex){if(ex instanceof Return)return ex.value;throw ex}function Return(value){this.value=value}}const getterCache={};function expr(expression,safe,paramName){return"string"==typeof safe&&(paramName=safe,safe=!1),paramName=paramName||"d",(expression=expression||"")&&"["!==expression.charAt(0)&&(expression="."+expression),safe?(expression=function(members,paramName){let index,idx,length,member,result=paramName||"d",count=1;for(idx=0,length=members.length;idx<length;idx++)member=members[idx],""!==member&&(index=member.indexOf("["),0!==index&&(-1===index?member="."+member:(count++,member="."+member.substring(0,index)+" || {})"+member.substring(index))),count++,result+=member+(idx<length-1?" || {})":")"));return new Array(count).join("(")+result}((expression=(expression=expression.replace(/"([^.]*)\.([^"]*)"/g,'"$1_$DOT$_$2"')).replace(/'([^.]*)\.([^']*)'/g,"'$1_$DOT$_$2'")).split("."),paramName),expression=expression.replace(/_\$DOT\$_/g,".")):expression=paramName+expression,expression}function deepExtend(destination){let i=1,length=arguments.length;for(i=1;i<length;i++)deepExtendOne(destination,arguments[i]);return destination}function isFunction(fn){return"function"==typeof fn}function deepExtendOne(destination,source){let property,propValue,propType,propInit,destProp;for(property in source)propValue=source[property],propType=typeof propValue,propInit="object"===propType&&null!==propValue?propValue.constructor:null,!propInit||propInit===Array||propInit===RegExp||isFunction(window.ArrayBuffer)&&propInit===ArrayBuffer||propValue instanceof HTMLElement?"undefined"!==propType&&(destination[property]=propValue):propValue instanceof Date?destination[property]=new Date(propValue.getTime()):isFunction(propValue.clone)?destination[property]=propValue.clone():(destProp=destination[property],destination[property]="object"==typeof destProp&&destProp||{},deepExtendOne(destination[property],propValue));return destination}const index_esm_support={},scrollbar=function(refresh){if(!isNaN(index_esm_support._scrollbar)&&!refresh)return index_esm_support._scrollbar;let result,div=document.createElement("div");return div.style.cssText="overflow:scroll;overflow-x:hidden;zoom:1;clear:both;display:block",div.innerHTML="&nbsp;",document.body.appendChild(div),index_esm_support._scrollbar=result=div.offsetWidth-div.scrollWidth,document.body.removeChild(div),result},createFragment=function(content){const template=document.createElement("template");return template.innerHTML=content,template.content};const insertAfter=function(newElement,after){after.parentNode.insertBefore(newElement,after.nextSibling)};class CalcError{constructor(code){if(code instanceof CalcError)return code;this.code=code}toString(){return"#"+this.code+("NAME"===this.code?"?":"!")}}let intlValue={};const intl=value=>{if(!value)return intlValue;intlValue=value},culture=()=>intl().localeInfo();function Node(){this.node=null}function NullNode(){}Node.prototype={remove:function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.attr={}},attr:{},text:function(){return""}},NullNode.prototype={nodeName:"#null",attr:{style:{}},children:[],remove:function(){}};let NULL_NODE=new NullNode;function index_esm_Element(nodeName,attr,children){this.nodeName=nodeName,this.attr=attr||{},this.children=children||[]}function TextNode(nodeValue){this.nodeValue=String(nodeValue)}function HtmlNode(html){this.html=html}index_esm_Element.prototype=new Node,index_esm_Element.prototype.appendTo=function(parent){let node=document.createElement(this.nodeName),children=this.children;for(let index=0;index<children.length;index++)children[index].render(node,NULL_NODE);return parent.appendChild(node),node},index_esm_Element.prototype.render=function(parent,cached){let node;if(cached.nodeName!==this.nodeName)cached.remove(),node=this.appendTo(parent);else{let index;node=cached.node;let children=this.children,length=children.length,cachedChildren=cached.children,cachedLength=cachedChildren.length;if(Math.abs(cachedLength-length)>2)return void this.render({appendChild:function(node){parent.replaceChild(node,cached.node)}},NULL_NODE);for(index=0;index<length;index++)children[index].render(node,cachedChildren[index]||NULL_NODE);for(index=length;index<cachedLength;index++)cachedChildren[index].remove()}this.node=node,this.syncAttributes(cached.attr),this.removeAttributes(cached.attr)},index_esm_Element.prototype.syncAttributes=function(cachedAttr){let attr=this.attr;for(let name in attr){let value=attr[name],cachedValue=cachedAttr[name];"style"===name?this.setStyle(value,cachedValue):value!==cachedValue&&this.setAttribute(name,value,cachedValue)}},index_esm_Element.prototype.setStyle=function(style,cachedValue){let key,node=this.node;if(cachedValue)for(key in style)style[key]!==cachedValue[key]&&(node.style[key]=style[key]);else for(key in style)node.style[key]=style[key]},index_esm_Element.prototype.removeStyle=function(cachedStyle){let style=this.attr.style||{},node=this.node;for(let key in cachedStyle)void 0===style[key]&&(node.style[key]="")},index_esm_Element.prototype.removeAttributes=function(cachedAttr){let attr=this.attr;for(let name in cachedAttr)"style"===name?this.removeStyle(cachedAttr.style):void 0===attr[name]&&this.removeAttribute(name)},index_esm_Element.prototype.removeAttribute=function(name){let node=this.node;"style"===name?node.style.cssText="":"className"===name?node.className="":node.removeAttribute(name)},index_esm_Element.prototype.setAttribute=function(name,value){let node=this.node;void 0!==node[name]?node[name]=value:node.setAttribute(name,value)},index_esm_Element.prototype.text=function(){let str="";for(let i=0;i<this.children.length;++i)str+=this.children[i].text();return str},TextNode.prototype=new Node,TextNode.prototype.nodeName="#text",TextNode.prototype.render=function(parent,cached){let node;cached.nodeName!==this.nodeName?(cached.remove(),node=document.createTextNode(this.nodeValue),parent.appendChild(node)):(node=cached.node,this.nodeValue!==cached.nodeValue&&node.parentNode&&(node.nodeValue=this.nodeValue)),this.node=node},TextNode.prototype.text=function(){return this.nodeValue},HtmlNode.prototype={nodeName:"#html",attr:{},remove:function(){for(let index=0;index<this.nodes.length;index++){let el=this.nodes[index];el.parentNode&&el.parentNode.removeChild(el)}},render:function(parent,cached){if(cached.nodeName!==this.nodeName||cached.html!==this.html){cached.remove();let lastChild=parent.lastChild;!function insertHtml(node,html){HTML_CONTAINER.innerHTML=html;for(;HTML_CONTAINER.firstChild;)node.appendChild(HTML_CONTAINER.firstChild)}(parent,this.html),this.nodes=[];for(let child=lastChild?lastChild.nextSibling:parent.firstChild;child;child=child.nextSibling)this.nodes.push(child)}else this.nodes=cached.nodes.slice(0)}};let HTML_CONTAINER=document.createElement("div");function html(value){return new HtmlNode(value)}function index_esm_element(nodeName,attrs,children){return new index_esm_Element(nodeName,attrs,children)}function text$1(value){return new TextNode(value)}function Tree(root){this.root=root,this.children=[]}Tree.prototype={html,element:index_esm_element,text:text$1,render:function(children){let index,length,cachedChildren=this.children;for(index=0,length=children.length;index<length;index++){let cached=cachedChildren[index];cached?cached.node&&cached.node.parentNode||(cached.remove(),cached=NULL_NODE):cached=NULL_NODE,children[index].render(this.root,cached)}for(index=length;index<cachedChildren.length;index++)cachedChildren[index].remove();this.children=children}};const dom={html,text:text$1,element:index_esm_element,Tree,Node};var calc={runtime:{}},FUNCS=Object.create(null);calc.runtime.FUNCS=FUNCS;const kendo=function createKendoObj(calc,CalcError,Ref,CellRef,RangeRef){const kendo={};return kendo.spreadsheet={calc,CalcError,Ref,CellRef,RangeRef},kendo.culture=()=>culture(),kendo}(calc,CalcError,Ref,CellRef,RangeRef);class Context{constructor(callback,formula,ss,parent){this.callback=callback,this.formula=formula,this.ss=ss,this.parent=parent}resolve(val){var self=this;val instanceof Ref?self.resolveCells([val],(function(){self._resolve(val)})):self._resolve(val)}error(val){return new CalcError(val)}_resolve(val){val=void 0===val?null:Array.isArray(val)?this.asMatrix(val):function maybeRoundFloatErrors(num){return"number"==typeof num?limitPrecision(num):num}(val);var f=this.formula;f.arrayFormulaRange?val=this.asMatrix(val)||this.asMatrix([[val]]):val instanceof RangeRef&&(val=this._arrayArg(val)),f.value=val,this.ss.onFormula(f)&&this.callback&&this.callback.call(f,val)}resolveCells(a,f){var context=this,formulas=[];if(function loop(a){for(var i=0;i<a.length;++i){var x=a[i];x instanceof Ref&&add(context.getRefCells(x)),Array.isArray(x)&&loop(x)}}(a),!formulas.length)return f.call(context);for(var pending=formulas.length,i=0;i<formulas.length;++i)formulas[i].exec(context.ss,(function(){--pending||f.call(context)}),context);function add(a){for(var i=0;i<a.length;++i){var cell=a[i];cell.formula&&formulas.push(cell.formula)}return!0}}cellValues(a,wantNulls){for(var ret=[],i=0;i<a.length;++i){var val=a[i];val instanceof Ref?(val=this.getRefData(val,wantNulls),ret=ret.concat(val)):Array.isArray(val)?ret=ret.concat(this.cellValues(val,wantNulls)):val instanceof Matrix?ret=ret.concat(this.cellValues(val.data,wantNulls)):ret.push(val)}return ret}fetchName(ref,callback){var f=this.formula,val=this.ss.nameValue(ref,f.sheet,f.row,f.col);if(val instanceof Formula$1){val=val.clone(f.sheet,f.row,f.col,!0);var ss=new ValidationFormulaContext(this.ss.workbook);val.exec(ss,callback,this)}else val instanceof Ref&&((val=val.absolute(f.row,f.col))instanceof RangeRef&&this.ss.isMerged(val)&&(val=val.topLeft),val.sheet||(val.sheet=f.sheet)),callback(null==val?new CalcError("NAME"):val)}force(val){return val instanceof Ref?this.getRefData(val):val}func(fname,callback,args){fname=fname.toLowerCase();var f=FUNCS[fname];if(f)return f.call(this,callback,args);callback(new CalcError("NAME"))}bool(val){return val instanceof Ref&&(val=this.getRefData(val)),"string"==typeof val?"true"==val.toLowerCase():"number"==typeof val?0!==val:"boolean"==typeof val?val:null!=val}_arrayArg(ref){var f=this.formula;return!f.arrayFormulaRange&&ref instanceof RangeRef?1==ref.height()&&f.col>=ref.topLeft.col&&f.col<=ref.bottomRight.col?this.getRefData(new CellRef(ref.topLeft.row,f.col).setSheet(ref.sheet)):1==ref.width()&&f.row>=ref.topLeft.row&&f.row<=ref.bottomRight.row?this.getRefData(new CellRef(f.row,ref.topLeft.col).setSheet(ref.sheet)):new CalcError("VALUE"):this.asMatrix(ref)}asMatrix(range){if(range instanceof Matrix)return range;var self=this;if(range instanceof RangeRef){var tl=range.topLeft,top=tl.row,left=tl.col,cells=self.getRefCells(range),m=new Matrix(self);return isFinite(range.width())&&(m.width=range.width()),isFinite(range.height())&&(m.height=range.height()),isFinite(top)||(top=0),isFinite(left)||(left=0),cells.forEach((function(cell){m.set(cell.row-top,cell.col-left,cell.value)})),m}if(Array.isArray(range)&&range.length>0){m=new Matrix(self);var row=0;return range.forEach((function(line){var col=0,h=1;line.forEach((function(el){var isRange=el instanceof RangeRef;el instanceof Ref&&!isRange&&(el=self.getRefData(el)),(isRange||Array.isArray(el))&&(el=self.asMatrix(el)),el instanceof Matrix?(el.each((function(el,r,c){m.set(row+r,col+c,el)})),h=Math.max(h,el.height),col+=el.width):("string"==typeof el&&el.length&&!isNaN(el)&&(el=Number(el)),m.set(row,col++,el))})),row+=h})),m}}getRefCells(refs,hiddenInfo,wantNulls){var f=this.formula;return this.ss.getRefCells(refs,hiddenInfo,f.sheet,f.row,f.col,wantNulls)}getRefData(ref,wantNulls){var f=this.formula;return this.ss.getData(ref,f.sheet,f.row,f.col,wantNulls)}workbook(){return this.ss.workbook}}class Matrix{constructor(context){this.context=context,this.height=0,this.width=0,this.data=[]}clone(){var m=new Matrix(this.context);return m.height=this.height,m.width=this.width,m.data=this.data.map((function(row){return row.slice()})),m}get(row,col){var line=this.data[row],val=line?line[col]:null;return val instanceof Ref?this.context.getRefData(val):val}getNA(row,col){return row<this.height&&col<this.width?this.get(row,col):new CalcError("N/A")}set(row,col,data){var line=this.data[row];null==line&&(line=this.data[row]=[]),line[col]=data,row>=this.height&&(this.height=row+1),col>=this.width&&(this.width=col+1)}each(f,includeEmpty){for(var row=0;row<this.height;++row)for(var col=0;col<this.width;++col){var val=this.get(row,col);if((includeEmpty||null!=val)&&void 0!==(val=f.call(this.context,val,row,col)))return val}}map(f,includeEmpty){var m=new Matrix(this.context);return this.each((function(el,row,col){m.set(row,col,f.call(this,el,row,col))}),includeEmpty),m}eachRow(f){for(var row=0;row<this.height;++row){var val=f.call(this.context,row);if(void 0!==val)return val}}eachCol(f){for(var col=0;col<this.width;++col){var val=f.call(this.context,col);if(void 0!==val)return val}}mapRow(f){var m=new Matrix(this.context);return this.eachRow((function(row){m.set(row,0,f.call(this.context,row))})),m}mapCol(f){var m=new Matrix(this.context);return this.eachCol((function(col){m.set(0,col,f.call(this.context,col))})),m}toString(){return JSON.stringify(this.data)}transpose(){var m=new Matrix(this.context);return this.each((function(el,row,col){m.set(col,row,el)})),m}unit(n){this.width=this.height=n;for(var a=this.data=new Array(n),i=n;--i>=0;)for(var row=a[i]=new Array(n),j=n;--j>=0;)row[j]=i==j?1:0;return this}multiply(b){for(var a=this,m=new Matrix(a.context),row=0;row<a.height;++row)for(var col=0;col<b.width;++col){for(var s=0,i=0;i<a.width;++i){var va=a.get(row,i),vb=b.get(i,col);if("number"!=typeof va||"number"!=typeof vb)throw new CalcError("VALUE");s+=va*vb}m.set(row,col,s)}return m}adds(b,s){for(var a=this,m=new Matrix(a.context),sign=s?-1:1,row=0;row<a.height;++row)for(var col=0;col<a.width;++col){var x=a.get(row,col),y=b.get(row,col);m.set(row,col,x+sign*y)}return m}determinant(){var C,L,i,k,a=this.clone().data,n=a.length,d=1;for(C=0;C<n;C++){for(L=C;L<n&&!a[L][C];L++);if(L==n)return 0;if(L!=C)for(d=-d,k=C;k<n;k++){var t=a[C][k];a[C][k]=a[L][k],a[L][k]=t}for(i=C+1;i<n;i++)for(k=C+1;k<n;k++)a[i][k]-=a[C][k]*a[i][C]/a[C][C];d*=a[C][C]}return d}inverse(){for(var tmp,n=this.width,m=this.augment(new Matrix(this.context).unit(n)),a=m.data,k=0;k<n;++k){var imax=argmax(k,n,(function(i){return a[i][k]}));if(!a[imax][k])return null;k!=imax&&(tmp=a[k],a[k]=a[imax],a[imax]=tmp);for(var i=k+1;i<n;++i){for(var j=k+1;j<2*n;++j)a[i][j]-=a[k][j]*a[i][k]/a[k][k];a[i][k]=0}}for(i=0;i<n;++i){var f=a[i][i];for(j=0;j<2*n;++j)a[i][j]/=f}for(k=n;--k>=0;)for(i=k;--i>=0;)if(a[i][k])for(j=2*n;--j>=n;)a[i][j]-=a[k][j]*a[i][k];return m.slice(0,n,n,n)}augment(m){var ret=this.clone(),n=ret.width;return m.each((function(val,row,col){ret.set(row,col+n,val)})),ret}slice(row,col,height,width){for(var m=new Matrix(this.context),i=0;i<height;++i)for(var j=0;j<width;++j)m.set(i,j,this.get(row+i,col+j));return m}}function argmax(i,end,f){for(var max=f(i),pos=i;++i<end;){var v=f(i);v>max&&(max=v,pos=i)}return pos}let Formula$1=class Formula{constructor(refs,handler,printer,sheet,row,col,arrayFormulaRange){this.refs=refs,this.handler=handler,this.print=printer,this.absrefs=null,this.sheet=sheet,this.row=row,this.col=col,this.onReady=[],this.pending=!1,this.arrayFormulaRange=arrayFormulaRange}setArrayFormulaRange(ref){this.arrayFormulaRange=ref.clone().setSheet(this.sheet)}clone(sheet,row,col,forceRefs){var lcsheet=sheet.toLowerCase(),refs=this.refs,range=this.arrayFormulaRange;return(forceRefs||lcsheet!=this.sheet.toLowerCase())&&(refs=refs.map((function(ref){return ref.hasSheet()||ref.sheet&&ref.sheet.toLowerCase()==lcsheet||(ref=ref.clone().setSheet(sheet)),ref})),range&&(range=range.clone().setSheet(sheet))),new Formula(refs,this.handler,this.print,sheet,row,col,range)}deepClone(){var refs=this.refs.map((function(ref){return ref.clone()}));return new Formula(refs,this.handler,this.print,this.sheet,this.row,this.col,this.arrayFormulaRange)}resolve(val){this.pending=!1,this.onReady.forEach((function(callback){callback(val)}))}exec(ss,callback,parentContext){if("value"in this)callback&&callback(this.value);else{callback&&this.onReady.push(callback);for(var ctx=new Context(this.resolve,this,ss,parentContext),level=0;parentContext;){if(parentContext.formula===this)return this.pending=!1,void ctx.resolve(new CalcError("CIRCULAR"));parentContext=parentContext.parent,++level}if(this.pending)return;this.pending=!0;var next=function(){this.absrefs||(this.absrefs=this.refs.map((function(ref){return ref.absolute(this.row,this.col)}),this)),this.handler.call(ctx)}.bind(this);level<20?next():setTimeout(next,0)}}reset(){this.onReady=[],this.pending=!1,delete this.value}renameSheet(oldSheetName,newSheetName){oldSheetName=oldSheetName.toLowerCase(),this.absrefs=null,this.sheet.toLowerCase()==oldSheetName&&(this.sheet=newSheetName),this.refs.forEach((function(ref){ref.renameSheet(oldSheetName,newSheetName)}))}adjust(affectedSheet,operation,start,delta){affectedSheet=affectedSheet.toLowerCase();var formulaRow=this.row,formulaCol=this.col,formulaSheet=this.sheet.toLowerCase(),formulaMoves=!1;formulaSheet==affectedSheet&&("row"==operation&&formulaRow>=start&&(this.row+=delta,formulaMoves=!0),"col"==operation&&formulaCol>=start&&(this.col+=delta,formulaMoves=!0));var newFormulaRow=this.row,newFormulaCol=this.col;this.absrefs=null;var prevRefs=this.refs,modified=formulaMoves;this.refs=prevRefs.map((function(ref){var newRef=adjust(ref);return modified||sameRef(newRef,ref)||(modified=!0),newRef}));var prevRange=this.arrayFormulaRange;if(prevRange&&(this.arrayFormulaRange=adjust(prevRange),modified||sameRef(prevRange,this.arrayFormulaRange)||(modified=!0)),modified)return new Formula(prevRefs,this.handler,this.print,this.sheet,formulaRow,formulaCol,prevRange);function adjust(ref){return ref===NULLREF?ref:ref.sheet.toLowerCase()!=affectedSheet?(formulaMoves&&("row"==operation&&formulaRow>=start&&(ref=ref.relative(delta,0)),"col"==operation&&formulaCol>=start&&(ref=ref.relative(0,delta))),ref):ref.adjust(formulaRow,formulaCol,newFormulaRow,newFormulaCol,"row"==operation,start,delta)}}toString(){return this.print(this.row,this.col)}};function sameRef(r1,r2){if(r1.constructor!==r2.constructor)return!1;if(r1 instanceof CellRef)return r1.sheet==r2.sheet&&r1.row==r2.row&&r1.col==r2.col&&r1.rel==r2.rel;if(r1 instanceof RangeRef)return sameRef(r1.topLeft,r2.topLeft)&&sameRef(r1.bottomRight,r2.bottomRight)&&r1.endSheet==r2.endSheet;if(r1 instanceof UnionRef){var i=r1.refs.length;if(i!=r2.refs.length)return!1;for(;--i>=0;)if(!sameRef(r1.refs[i],r2.refs[i]))return!1}return!0}function compileArgumentChecks(functionName,args){var name,forced,f,arrayArgs="function arrayArgs(args) { var xargs = [], width = 0, height = 0, arrays = [], i = 0; ",resolve="function resolve(args, callback) { var toResolve = [], i = 0; ",main="'use strict'; function check(args) { var stack = [], tmp, xargs = [], i = 0, m, err = 'VALUE'; ",haveForced=!1,canBeArrayArg=!1,hasArrayArgs=!1;return main+=args.map((function comp(x){name=x[0];var code="{ ";if(Array.isArray(name))arrayArgs+="while (i < args.length) { ",resolve+="while (i < args.length) { ",code+="xargs.push(tmp = []); stack.push(xargs); xargs = tmp; ",code+="while (i < args.length) { ",code+=x.map(comp).join(""),code+="} ",code+="xargs = stack.pop(); ",resolve+="} ",arrayArgs+="} ";else if("+"==name)arrayArgs+="while (i < args.length) { ",resolve+="while (i < args.length) { ",code+="if (i >= args.length) return new CalcError('N/A'); ",code+="xargs.push(tmp = []); stack.push(xargs); xargs = tmp; ",code+="do { ",code+=x.slice(1).map(comp).join(""),code+="} while (i < args.length); ",code+="xargs = stack.pop(); ",resolve+="} ",arrayArgs+="} ";else if("?"==name)code+="if (!("+cond(x[1])+")) return new CalcError(err); ";else{var type=x[1];if(Array.isArray(type)&&/^#?collect/.test(type[0])){var wantNulls=/!$/.test(type[0]),n=type[2];force(),code+="try {var $"+name+" = this.cellValues(args.slice(i",n&&(code+=", i + "+n),code+=")"+(wantNulls?",true":"")+").reduce(function(ret, $"+name+"){ ","#"!=type[0].charAt(0)&&(code+="if ($"+name+" instanceof CalcError) throw $"+name+"; "),code+="if ("+cond(type[1])+") ret.push($"+name+"); ",code+="return ret; ",code+="}.bind(this), []); ",code+=n?"i += "+n+"; ":"i = args.length; ",code+="xargs.push($"+name+")} catch(ex) { if (ex instanceof CalcError) return ex; throw ex; } ",resolve+="toResolve.push(args.slice(i)); "}else if("rest"==type)code+="xargs.push(args.slice(i)); i = args.length; ";else{(canBeArrayArg=/^\*/.test(name))&&(hasArrayArgs=!0,name=name.substr(1)),code+="var $"+name+" = args[i++]; ";var allowError=!1;/!$/.test(type)?(type=type.substr(0,type.length-1),allowError=!0):code+="if ($"+name+" instanceof CalcError) return $"+name+"; ",code+=function typeCheck(type,allowError){forced=!1;var ret="if (!("+cond(type)+")) { ";forced&&!allowError&&(ret+=" if ($"+name+" instanceof CalcError) return $"+name+"; ");forced||(resolve+="i++; ");arrayArgs+=canBeArrayArg?"var $"+name+" = this._arrayArg(args[i]); if ($"+name+") { xargs.push($"+name+"); width = Math.max(width, $"+name+".width); height = Math.max(height, $"+name+".height); arrays.push(true) } else { xargs.push(args[i]); arrays.push(false); } i++; ":"xargs.push(args[i++]); arrays.push(false); ";return ret+="return new CalcError(err); } "}(type,allowError)+"xargs.push($"+name+"); "}}return code+="} "})).join(""),main+="if (i < args.length) return new CalcError('N/A'); ",main+="return xargs; } ",arrayArgs+="return { args: xargs, width: width, height: height, arrays: arrays }; } ",haveForced?(resolve+="this.resolveCells(toResolve, callback); } ",f=new Function("kendo","CalcError","round",main+resolve+arrayArgs+" return { resolve: resolve, check: check, arrayArgs: arrayArgs };")):f=new Function("kendo","CalcError","round",main+" return { check: check };"),f=f(kendo,CalcError,limitPrecision),hasArrayArgs||delete f.arrayArgs,f;function force(){return forced?"$"+name:(haveForced=!0,forced=!0,resolve+="toResolve.push(args[i++]); ","($"+name+" = this.force($"+name+"))")}function forceNum(round){return"("+(round?"(typeof "+force()+" == 'number' ? ($"+name+" = round($"+name+"), true) : false) || ":"(typeof "+force()+" == 'number') || ")+"(typeof $"+name+" == 'boolean' ? ($"+name+" = +$"+name+", true) : false) || (typeof $"+name+" == 'string' && !/^(?:=|true|false)/i.test($"+name+") ? (tmp = kendo.spreadsheet.calc.parse(0, 0, 0, $"+name+"), /^date|number|percent$/.test(tmp.type) ? ($"+name+" = +tmp.value, true) : false) : false))"}function cond(type){if(Array.isArray(type)){if("or"==type[0])return"("+type.slice(1).map(cond).join(") || (")+")";if("and"==type[0])return"("+type.slice(1).map(cond).join(") && (")+")";if("values"==type[0])return"("+type.slice(1).map((function(val){return force()+" === "+val})).join(") || (")+")";if("null"==type[0])return"("+cond("null")+" ? (($"+name+" = "+type[1]+"), true) : false)";if("between"==type[0]||"[between]"==type[0])return"("+force()+" >= "+type[1]+" && $"+name+" <= "+type[2]+" ? true : ((err = 'NUM'), false))";if("(between)"==type[0])return"("+force()+" > "+type[1]+" && $"+name+" < "+type[2]+" ? true : ((err = 'NUM'), false))";if("(between]"==type[0])return"("+force()+" > "+type[1]+" && $"+name+" <= "+type[2]+" ? true : ((err = 'NUM'), false))";if("[between)"==type[0])return"("+force()+" >= "+type[1]+" && $"+name+" < "+type[2]+" ? true : ((err = 'NUM'), false))";if("assert"==type[0]){var err=type[2]||"N/A";return"(("+type[1]+") ? true : (err = "+JSON.stringify(err)+", false))"}if("not"==type[0])return"!("+cond(type[1])+")";throw new Error("Unknown array type condition: "+type[0])}if("number"==type||"datetime"==type)return forceNum(!0);if("number!"==type)return"(typeof "+force()+" == 'number' ? ($"+name+" = round($"+name+"), true) : false)";if("integer"==type||"date"==type)return"("+forceNum()+" && (($"+name+" |= 0), true))";if("divisor"==type)return"("+forceNum(!0)+" && ($"+name+" == 0 ? ((err = 'DIV/0'), false) : true))";if("number+"==type)return"("+forceNum(!0)+" && ($"+name+" >= 0 ? true : ((err = 'NUM'), false)))";if("integer+"==type)return"("+forceNum()+" && (($"+name+" |= 0) >= 0 ? true : ((err = 'NUM'), false)))";if("number++"==type)return"("+forceNum(!0)+" && ($"+name+" > 0 ? true : ((err = 'NUM'), false)))";if("integer++"==type)return"("+forceNum()+" && (($"+name+" |= 0) > 0 ? true : ((err = 'NUM'), false)))";if("string"==type)return"((typeof "+force()+" == 'string' || typeof $"+name+" == 'boolean' || typeof $"+name+" == 'number') ? ($"+name+" += '', true) : ($"+name+" === undefined ? (($"+name+" = ''), true) : false))";if("boolean"==type)return"(typeof "+force()+" == 'boolean')";if("logical"==type)return"(typeof "+force()+" == 'boolean' || (typeof $"+name+" == 'number' ? ($"+name+" = !!$"+name+", true) : false))";if("matrix"==type)return force(),"((m = this.asMatrix($"+name+")) ? ($"+name+" = m) : false)";if("#matrix"==type)return"((m = this.asMatrix($"+name+")) ? ($"+name+" = m) : false)";if("ref"==type)return"($"+name+" instanceof kendo.spreadsheet.Ref)";if("area"==type)return"($"+name+" instanceof kendo.spreadsheet.CellRef || $"+name+" instanceof kendo.spreadsheet.RangeRef)";if("cell"==type)return"($"+name+" instanceof kendo.spreadsheet.CellRef)";if("null"==type)return"("+force()+" == null)";if("anyvalue"==type)return"("+force()+" != null && i <= args.length)";if("forced"==type)return"("+force()+", i <= args.length)";if("anything"==type)return"(i <= args.length)";if("blank"==type)return"("+force()+" == null || $"+name+" === '')";throw new Error("Can't check for type: "+type)}}function limitPrecision(num){return num===parseInt(num,10)?num:+num.toPrecision(16)}function withErrorHandling(obj,f,args){if(args instanceof CalcError)return args;try{return f.apply(obj,args)}catch(ex){if(ex instanceof CalcError)return ex;throw ex}}function defineFunction(name,func){return name=name.toLowerCase(),FUNCS[name]=func,{args:function(args,log){var code=compileArgumentChecks(0,args);log&&(code.arrayArgs&&window.console.log(code.arrayArgs.toString()),code.resolve&&window.console.log(code.resolve.toString()),code.check&&window.console.log(code.check.toString()));var f=FUNCS[name]=function makeSyncFunction(handler,resolve,check,arrayArgs){return function(callback,args){function doit(){if(arrayArgs){var x=arrayArgs.call(this,args);if(args=x.args,x.width>0&&x.height>0){for(var result=new Matrix(this),row=0;row<x.height;++row)for(var col=0;col<x.width;++col){for(var xargs=[],i=0;i<args.length;++i)x.arrays[i]?xargs[i]=args[i].getNA(row,col):xargs[i]=args[i];xargs=check.call(this,xargs),result.set(row,col,withErrorHandling(this,handler,xargs))}return callback(result)}}xargs=check.call(this,args),callback(withErrorHandling(this,handler,xargs))}resolve?resolve.call(this,args,doit):doit.call(this)}}(func,code.resolve,code.check,code.arrayArgs);return f.kendoSpreadsheetArgs=args,this},argsAsync:function(args,log){var code=compileArgumentChecks(0,args);log&&(code.arrayArgs&&window.console.log(code.arrayArgs.toString()),code.resolve&&window.console.log(code.resolve.toString()),code.check&&window.console.log(code.check.toString()));var f=FUNCS[name]=function makeAsyncFunction(handler,resolve,check,arrayArgs){return function(callback,args){function doit(){if(arrayArgs){var x=arrayArgs.call(this,args);if(args=x.args,x.width>0&&x.height>0){for(var result=new Matrix(this),count=x.width*x.height,makeCallback=function(row,col){return function(value){if(result.set(row,col,value),0===--count)return callback(result)}},row=0;row<x.height&&count>0;++row)for(var col=0;col<x.width&&count>0;++col){for(var xargs=[],i=0;i<args.length;++i)x.arrays[i]?xargs[i]=args[i].getNA(row,col):xargs[i]=args[i];if((xargs=check.call(this,xargs))instanceof CalcError){if(result.set(row,col,xargs),0===--count)return callback(result)}else xargs.unshift(makeCallback(row,col)),handler.apply(this,xargs)}return}}(x=check.call(this,args))instanceof CalcError?callback(x):(x.unshift(callback),handler.apply(this,x))}resolve?resolve.call(this,args,doit):doit.call(this)}}(func,code.resolve,code.check,code.arrayArgs);return f.kendoSpreadsheetArgs=args,this}}}function dateToJulianDays(y,m,d){return(1461*(y+4800+((++m-14)/12|0))/4|0)+(367*(m-2-12*((m-14)/12|0))/12|0)-(3*((y+4900+((m-14)/12|0))/100|0)/4|0)+d-32075}FUNCS.if=function(callback,args){var self=this,co=args[0],th=args[1],el=args[2];this.resolveCells([co],(function(){var comatrix=self.asMatrix(co);comatrix?th((function(th){el((function(el){var thmatrix=self.asMatrix(th),elmatrix=self.asMatrix(el);callback(comatrix.map((function(val,row,col){return val instanceof CalcError?val:self.bool(val)?thmatrix?thmatrix.get(row,col):th:elmatrix?elmatrix.get(row,col):el})))}))})):(co=this.force(co))instanceof CalcError?callback(co):self.bool(co)?th(callback):el(callback)}))},FUNCS[""]=function(callback){callback((1+Math.sqrt(5))/2)};var BASE_DATE=dateToJulianDays(1900,0,-1),DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],ORDINAL_ADD_DAYS=[[0,31,59,90,120,151,181,212,243,273,304,334],[0,31,60,91,121,152,182,213,244,274,305,335]];function isLeapYear(yr){return yr%4?0:yr%100?1:yr%400?0:1}function daysInYear(yr){return isLeapYear(yr)?366:365}function daysInMonth(yr,mo){return isLeapYear(yr)&&1==mo?29:DAYS_IN_MONTH[mo]}function unpackDate(serial){return function julianDaysToDate(jd){var l,n,j,i,m,d,y;return l=jd+68569,d=(l=(l-=(146097*(n=4*l/146097|0)+3)/4|0)-(1461*(i=4e3*(l+1)/1461001|0)/4|0)+31)-(2447*(j=80*l/2447|0)/80|0),m=j+2-12*(l=j/11|0),{year:y=100*(n-49)+i+l,month:--m,date:d,day:(jd+1)%7,ord:ORDINAL_ADD_DAYS[isLeapYear(y)][m]+d}}((0|serial)+BASE_DATE)}function packDate(year,month,date){return dateToJulianDays(year,month,date)-BASE_DATE}function unpackTime(serial){var frac=serial-(0|serial);frac<0&&frac++;var ms=Math.round(864e5*frac),hours=Math.floor(ms/36e5);ms-=36e5*hours;var minutes=Math.floor(ms/6e4);ms-=6e4*minutes;var seconds=Math.floor(ms/1e3);return{hours,minutes,seconds,milliseconds:ms-=1e3*seconds}}function serialToDate(serial){var d=unpackDate(serial),t=unpackTime(serial);return new Date(d.year,d.month,d.date,t.hours,t.minutes,t.seconds,t.milliseconds)}function packTime(hh,mm,ss,ms){return(hh+(mm+(ss+ms/1e3)/60)/60)/24}function dateToSerial(date){var time=packTime(date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds());return(date=packDate(date.getFullYear(),date.getMonth(),date.getDate()))<0?date-1+time:date+time}calc.runtime.CalcError=CalcError,calc.runtime.Formula=Formula$1,calc.runtime.Matrix=Matrix,calc.runtime.packDate=packDate,calc.runtime.unpackDate=unpackDate,calc.runtime.packTime=packTime,calc.runtime.unpackTime=unpackTime,calc.runtime.serialToDate=serialToDate,calc.runtime.dateToSerial=dateToSerial,calc.runtime.daysInMonth=daysInMonth,calc.runtime.validDate=function validDate(yr,mo,da){return mo>=1&&mo<=12&&da>=1&&da<=daysInMonth(yr,mo-1)},calc.runtime.isLeapYear=isLeapYear,calc.runtime.daysInYear=daysInYear,calc.runtime.parseDate=function parseDate(str,format){format&&(format=formatting.makeDateFormat(format));const parseExactDate=intl().parseDate;return parseExactDate(str,format)||parseExactDate(str)||parseExactDate(str,["MMMM dd yyyy","MMMM dd yy","MMM dd yyyy","MMM dd yy","dd MMMM yyyy","dd MMMM yy","dd MMM yyyy","dd MMM yy","MMMM dd, yyyy","MMMM dd, yy","MMM dd, yyyy","MMM dd, yy","MMMM dd","MMM dd","MMMM yyyy","MMM yyyy","dd MMMM","dd MMM"])},calc.runtime.limitPrecision=limitPrecision,calc.runtime.defineFunction=defineFunction,calc.runtime.defineAlias=function defineAlias(alias,name){var orig=FUNCS[name];if(!orig)throw new Error("Function "+name+" is not yet defined");orig.kendoSpreadsheetAliases||(orig.kendoSpreadsheetAliases=[name]),orig.kendoSpreadsheetAliases.push(alias),FUNCS[alias]=orig};var NUMBER_OR_ZERO=["or","number",["null",0]],ARGS_NUMERIC=[["*a",NUMBER_OR_ZERO],["*b",NUMBER_OR_ZERO]],ARGS_ANYVALUE=[["*a","forced"],["*b","forced"]];function equals(a,b){return a="string"==typeof a?a.toLowerCase():a,b="string"==typeof b?b.toLowerCase():b,!1===a&&null==b||(!1===b&&null==a||(0===a&&null==b||(0===b&&null==a||(""===a&&null==b||(""===b&&null==a||a===b)))))}function binaryCompare(func){return function(left,right){return"string"==typeof left&&"string"!=typeof right&&(right=null==right?"":right+""),"string"!=typeof left&&"string"==typeof right&&(left=null==left?"":left+""),"number"==typeof left&&null==right&&(right=0),"number"==typeof right&&null==left&&(left=0),"string"==typeof left&&"string"==typeof right&&(left=left.toLowerCase(),right=right.toLowerCase()),typeof right==typeof left?func(left,right):new CalcError("VALUE")}}defineFunction("binary+",(function(a,b){return a+b})).args(ARGS_NUMERIC),defineFunction("binary-",(function(a,b){return a-b})).args(ARGS_NUMERIC),defineFunction("binary*",(function(a,b){return a*b})).args(ARGS_NUMERIC),defineFunction("binary/",(function(a,b){return a/b})).args([["*a",NUMBER_OR_ZERO],["*b","divisor"]]),defineFunction("binary^",(function(a,b){return Math.pow(a,b)})).args(ARGS_NUMERIC),defineFunction("binary&",(function(a,b){return null==a&&(a=""),null==b&&(b=""),""+a+b})).args([["*a",["or","number","string","boolean","null"]],["*b",["or","number","string","boolean","null"]]]),defineFunction("binary=",equals).args(ARGS_ANYVALUE),defineFunction("binary<>",(function(a,b){return!equals(a,b)})).args(ARGS_ANYVALUE),defineFunction("binary<",binaryCompare((function(a,b){return a<b}))).args(ARGS_ANYVALUE),defineFunction("binary<=",binaryCompare((function(a,b){return a<=b}))).args(ARGS_ANYVALUE),defineFunction("binary>",binaryCompare((function(a,b){return a>b}))).args(ARGS_ANYVALUE),defineFunction("binary>=",binaryCompare((function(a,b){return a>=b}))).args(ARGS_ANYVALUE),defineFunction("unary+",(function(a){return a})).args([["*a",NUMBER_OR_ZERO]]),defineFunction("unary-",(function(a){return-a})).args([["*a",NUMBER_OR_ZERO]]),defineFunction("unary%",(function(a){return a/100})).args([["*a",NUMBER_OR_ZERO]]),defineFunction("binary:",(function(a,b){return new RangeRef(a,b).setSheet(a.sheet||this.formula.sheet,a.hasSheet())})).args([["a","cell"],["b","cell"]]),defineFunction("binary,",(function(a,b){return new UnionRef([a,b])})).args([["a","ref"],["b","ref"]]),defineFunction("binary ",(function(a,b){return a.intersect(b)})).args([["a","ref"],["b","ref"]]),defineFunction("not",(function(a){return!this.bool(a)})).args([["*a",["or","anyvalue",["null",0]]]]),defineFunction("isblank",(function(val){return val instanceof CellRef&&null==(val=this.getRefData(val))})).args([["*value","anything!"]]),defineFunction("iserror",(function(val){return val instanceof CalcError})).args([["*value","forced!"]]),defineFunction("iserr",(function(val){return val instanceof CalcError&&"N/A"!=val.code})).args([["*value","forced!"]]),defineFunction("isna",(function(val){return val instanceof CalcError&&"N/A"==val.code})).args([["*value","forced!"]]),defineFunction("islogical",(function(val){return"boolean"==typeof val})).args([["*value","forced!"]]),defineFunction("isnontext",(function(val){return"string"!=typeof val})).args([["*value","forced!"]]),defineFunction("istext",(function(val){return"string"==typeof val})).args([["*value","forced!"]]),defineFunction("isnumber",(function(val){return"number"==typeof val})).args([["*value","forced!"]]),defineFunction("isref",(function(val){return val instanceof CellRef||val instanceof RangeRef})).args([["*value","anything!"]]),defineFunction("_matrix",(function(m){return"string"==typeof m&&(m=this.asMatrix([m.split(/\s*,\s*/)])),m})).args([["m",["or","matrix","string"]]]),FUNCS[",getname"]=function(callback,args){this.fetchName(args[0],callback)};let OPERATORS_STANDARD=Object.create(null),OPERATORS_COMMA=Object.create(null);var ops;(ops=[[":"],[" "],[","],["%"],["^"],["*","/"],["+","-"],["&"],["=","<",">","<=",">=","<>"]]).forEach((function(cls,i){cls.forEach((function(op){OPERATORS_STANDARD[op]=ops.length-i,OPERATORS_COMMA[","===op?";":op]=ops.length-i}))}));let OPERATORS=OPERATORS_STANDARD,SEPARATORS={DEC:".",ARG:",",COL:","};function setDecimalSeparator(sep){SEPARATORS.DEC=sep,SEPARATORS.ARG=","===sep?";":",",SEPARATORS.COL=","===sep?"\\":",",OPERATORS=","===sep?OPERATORS_COMMA:OPERATORS_STANDARD}calc.withDecimalSeparator=function(sep,f){if(SEPARATORS.DEC===sep)return f();let save=SEPARATORS.DEC;setDecimalSeparator(sep);try{return f()}finally{setDecimalSeparator(save)}},calc._separators=SEPARATORS;class ParseError{constructor(message,pos){this.message=message,this.pos=pos}toString(){return this.message}}let TRUE={type:"bool",value:!0},FALSE={type:"bool",value:!1};function getcol(str){str=str.toUpperCase();let col=0;for(let i=0;i<str.length;++i)col=26*col+str.charCodeAt(i)-64;return col-1}function getrow(str){return parseInt(str,10)-1}function parseFormula(sheet,row,col,input){let refs=[],is=(input=TokenStream(input,{row,col})).is;return{type:"exp",ast:parseExpression(!0),refs,sheet,row,col};function addReference(ref){return ref.index=refs.length,refs.push(ref),ref}function skip(type,value,allowEOF){if(is(type,value))return input.next();{let tok=input.peek();tok?input.croak("Expected "+type+" "+value+" but found "+tok.type+" "+tok.value+""):allowEOF||input.croak("Expected "+type+" "+value+"")}}function parseExpression(commas){return maybeBinary(function maybeIntersect(exp){return is("punc","(")||is("ref")||is("num")||is("func")?{type:"binary",op:" ",left:exp,right:parseExpression(!1)}:exp}(parseAtom()),0,commas)}function parseAtom(){let exp;return is("ref")?exp=function fixReference(ref){return ref.hasSheet()||ref.setSheet(sheet),addReference(ref)}(input.next()):is("func")?exp=function parseFuncall(){let fname=input.next();fname=fname.value,skip("punc","(");let args=[];for(;!is("punc",")");)if(is("op",SEPARATORS.ARG))args.push({type:"null"}),input.next();else{if(args.push(parseExpression(!1)),input.eof()||is("punc",")"))break;skip("op",SEPARATORS.ARG)}return skip("punc",")",!0),{type:"func",func:fname,args}}():is("punc","(")?(input.next(),exp=parseExpression(!0),skip("punc",")",!0)):is("punc","{")?(input.next(),exp=function parseArray(){let row=[],value=[row],first=!0;for(;!input.eof()&&!is("punc","}");)first?first=!1:is(null,";")?(value.push(row=[]),input.next()):skip(null,SEPARATORS.COL),row.push(parseExpression(!1));return{type:"matrix",value}}(),skip("punc","}",!0)):is("num")||is("str")||is("error")?exp=input.next():is("sym")?exp=function parseSymbol(tok){return"TRUE"===tok.upper||"FALSE"===tok.upper?"TRUE"===tok.upper?TRUE:FALSE:addReference(new NameRef(tok.value))}(input.next()):is("op","+")||is("op","-")?exp={type:"prefix",op:input.next().value,exp:parseAtom()}:input.peek()?is("punc","[")?input.croak("External reference not supported"):input.croak("Parse error"):input.croak("Incomplete expression"),maybePercent(exp)}function maybePercent(exp){return is("op","%")?(input.next(),maybePercent({type:"postfix",op:"%",exp})):exp}function maybeBinary(left,my_prec,commas){let tok=is("op");if(tok&&(commas||tok.value!==SEPARATORS.ARG)){let his_prec=OPERATORS[tok.value];if(his_prec>my_prec){input.next();let right=maybeBinary(parseAtom(),his_prec,commas);return maybeBinary({type:"binary",op:";"===tok.value?",":tok.value,left,right},my_prec,commas)}}return left}}let makeClosure=(cache=Object.create(null),function(code){let f=cache[code];return f||(f=cache[code]=new Function("kendo","'use strict';return("+code+")")(kendo)),f});var cache;function toCPS(ast,k){let GENSYM=0;return cps(ast,k);function cps(node,k){switch(node.type){case"ref":return function cpsRef(node,k){return"name"===node.ref?function cpsNameRef(node,k){return{type:"func",func:",getname",args:[makeContinuation(k),node]}}(node,k):cpsAtom(node,k)}(node,k);case"num":case"str":case"null":case"error":case"bool":return cpsAtom(node,k);case"prefix":case"postfix":return function cpsUnary(node,k){return cps({type:"func",func:"unary"+node.op,args:[node.exp]},k)}(node,k);case"binary":return function cpsBinary(node,k){return cps({type:"func",func:"binary"+node.op,args:[node.left,node.right]},k)}(node,k);case"func":return function cpsFunc(node,k){switch(node.func.toLowerCase()){case"if":return function cpsIf(co,th,el,k){return cps(co,(function(co){let rest=makeContinuation(k),thenK=gensym("T"),elseK=gensym("E");return{type:"func",func:"if",args:[rest,co,{type:"lambda",vars:[thenK],body:cps(th||TRUE,(function(th){return{type:"call",func:{type:"var",name:thenK},args:[th]}}))},{type:"lambda",vars:[elseK],body:cps(el||FALSE,(function(el){return{type:"call",func:{type:"var",name:elseK},args:[el]}}))}]}}))}(node.args[0],node.args[1],node.args[2],k);case"and":return function cpsAnd(args,k){if(0===args.length)return cpsAtom(TRUE,k);return cps({type:"func",func:"IF",args:[args[0],{type:"func",func:"AND",args:args.slice(1)},FALSE]},k)}(node.args,k);case"or":return function cpsOr(args,k){if(0===args.length)return cpsAtom(FALSE,k);return cps({type:"func",func:"IF",args:[args[0],TRUE,{type:"func",func:"OR",args:args.slice(1)}]},k)}(node.args,k);case"true":return k(TRUE);case"false":return k(FALSE)}return function loop(args,i){return i===node.args.length?{type:"func",func:node.func,args}:cps(node.args[i],(function(value){return loop(args.concat([value]),i+1)}))}([makeContinuation(k)],0)}(node,k);case"lambda":return function cpsLambda(node,k){let cont=gensym("K"),body=cps(node.body,(function(body){return{type:"call",func:{type:"var",value:cont},args:[body]}}));return k({type:"lambda",vars:[cont].concat(node.vars),body})}(node,k);case"matrix":return cpsMatrix(node.value,k,!0)}throw new Error("Cannot CPS "+node.type)}function cpsAtom(node,k){return k(node)}function cpsMatrix(elements,k,isMatrix){let a=[];return function loop(i){return i===elements.length?k({type:"matrix",value:a}):(isMatrix?cpsMatrix:cps)(elements[i],(function(val){return a[i]=val,loop(i+1)}))}(0)}function makeContinuation(k){let cont=gensym("R");return{type:"lambda",vars:[cont],body:k({type:"var",name:cont})}}function gensym(name){return name||(name=""),(name="_"+name)+ ++GENSYM}}let FORMULA_CACHE=Object.create(null);function makeFormula(exp){let printer=function makePrinter(exp){return makeClosure("function(row, col, mod){return("+function print(node,parent,prec){switch(node.type){case"num":return"(kendo.spreadsheet.calc._separators.DEC == '.' ? "+JSON.stringify(JSON.stringify(node.value))+" : "+JSON.stringify(JSON.stringify(node.value))+".replace('.' , kendo.spreadsheet.calc._separators.DEC))";case"bool":return JSON.stringify(node.value);case"error":return JSON.stringify("#"+node.value);case"str":return JSON.stringify(JSON.stringify(node.value));case"ref":return"this.refs["+node.index+"].print(row, col, mod)";case"prefix":return withParens((function(){return JSON.stringify(node.op)+" + "+print(node.exp,node,OPERATORS[node.op])}));case"postfix":return withParens((function(){return print(node.exp,node,OPERATORS[node.op])+" + "+JSON.stringify(node.op)}));case"binary":return withParens((function(){let left=parenthesize(print(node.left,node,OPERATORS[node.op]),node.left instanceof NameRef&&":"===node.op),right=parenthesize(print(node.right,node,OPERATORS[node.op]),node.right instanceof NameRef&&":"===node.op);return/^[,;]/.test(node.op)?left+" + kendo.spreadsheet.calc._separators.ARG + "+right:left+" + "+JSON.stringify(node.op)+" + "+right}));case"func":return JSON.stringify(node.func+"(")+" + "+(node.args.length>0?node.args.map((function(arg){return print(arg,node,0)})).join(" + kendo.spreadsheet.calc._separators.ARG + ' ' + "):"''")+" + ')'";case"matrix":return"'{ ' + "+node.value.map((function(el){return el.map((function(el){return print(el,node,0)})).join(" + kendo.spreadsheet.calc._separators.COL + ' ' + ")})).join(" + '; ' + ")+"+ ' }'";case"null":return"''"}throw new Error("Cannot make printer for node "+node.type);function withParens(f){let op=node.op,needParens=OPERATORS[op]<prec||!prec&&","===op||"prefix"===parent.type&&prec===OPERATORS[op]&&"-"===parent.op||"binary"===parent.type&&prec===OPERATORS[op]&&node===parent.right;return parenthesize(f(),needParens)}}(exp.ast,exp,0)+")}");function parenthesize(code,cond){return cond?"'(' + "+code+" + ')'":code}}(exp),hash=printer.call(exp),formula=FORMULA_CACHE[hash];if(formula)return formula.clone(exp.sheet,exp.row,exp.col);let code=js(toCPS(exp.ast,(function(ret){return{type:"return",value:ret}})));return code=["function(){","let context = this, refs = context.formula.absrefs",code,"}"].join(";\n"),formula=new calc.runtime.Formula(exp.refs,makeClosure(code),printer,exp.sheet,exp.row,exp.col),FORMULA_CACHE[hash]=formula.clone(exp.sheet,exp.row,exp.col),formula;function js(node){let type=node.type;if("num"===type)return node.value+"";if("str"===type)return JSON.stringify(node.value);if("error"===type)return"context.error("+JSON.stringify(node.value)+")";if("return"===type)return"context.resolve("+js(node.value)+")";if("func"===type)return"context.func("+JSON.stringify(node.func)+", "+js(node.args[0])+", "+jsArray(node.args.slice(1))+")";if("call"===type)return js(node.func)+"("+node.args.map(js).join(", ")+")";if("ref"===type)return"refs["+node.index+"]";if("bool"===type)return""+node.value;if("if"===type)return"(context.bool("+js(node.co)+") ? "+js(node.th)+" : "+js(node.el)+")";if("lambda"===type)return"(function("+node.vars.join(", ")+"){ return("+js(node.body)+") })";if("var"===type)return node.name;if("matrix"===type)return jsArray(node.value);if("null"===type)return"null";throw new Error("Cannot compile expression "+type)}function jsArray(a){return"[ "+a.map(js).join(", ")+" ]"}}function identity$1(x){return x}function TokenStream(input,options){input=function RawTokenStream(input,options){let tokens=[],index=0,readWhile=input.readWhile;return{next,peek,eof,croak:input.croak,ahead,skip};function isDigit(ch){return/[0-9]/i.test(ch)}function isIdStart(ch){return/[a-z$_]/i.test(ch)||function isUnicodeLetter(ch){return RX_UNICODE_LETTER.test(ch)}(ch)}function isId(ch){return isIdStart(ch)||isDigit(ch)||"."===ch}function isOpChar(ch){return ch in OPERATORS}function isPunc(ch){return"\\!;(){}[]".indexOf(ch)>=0}function readNumber(){let has_dot=!1,number=readWhile((function(ch){return ch===SEPARATORS.DEC?!has_dot&&(has_dot=!0,!0):isDigit(ch)}));return number===SEPARATORS.DEC?{type:"punc",value:SEPARATORS.DEC}:{type:"num",value:parseFloat(number.replace(SEPARATORS.DEC,"."))}}function symbol(id,quote){return{type:"sym",value:id,upper:id.toUpperCase(),space:isWhitespace(input.peek()),quote}}function getRC(a,b,c){if(!a&&!b&&!c)return null;if(!a&&!c||a&&c){let num=b?parseInt(b,10):0;return a?num:num-1}}function readSymbol(){let m=input.lookingAt(/^R(\[)?(-?[0-9]+)?(\])?C(\[)?(-?[0-9]+)?(\])?/i);if(m){let row=getRC(m[1],m[2],m[3]),col=getRC(m[4],m[5],m[6]);if(null!=row&&null!=col)return input.skip(m),{type:"rc",row,col,rel:(m[4]||!(m[4]||m[5]||m[6])?1:0)|(m[1]||!(m[1]||m[2]||m[3])?2:0)}}return symbol(readWhile(isId))}function readString(){return input.next(),{type:"str",value:input.readEscaped('"')}}function readSheetName(){return input.next(),symbol(input.readEscaped("'"),!0)}function readOperator(){return{type:"op",value:readWhile((function(ch,op){return op+ch in OPERATORS}))}}function readPunc(){return{type:"punc",value:input.next()}}function readNext(){if(input.eof())return null;let m,ch=input.peek();return'"'===ch?readString():"'"===ch?readSheetName():isDigit(ch)||ch===SEPARATORS.DEC?readNumber():isIdStart(ch)?readSymbol():isOpChar(ch)?readOperator():isPunc(ch)?readPunc():(m=input.lookingAt(/^#([a-z\/]+)[?!]?/i))?(input.skip(m),{type:"error",value:m[1]}):(options.forEditor||input.croak("Can't handle character with code: "+ch.charCodeAt(0)),{type:"error",value:input.next()})}function peek(){for(;tokens.length<=index;){readWhile(isWhitespace);let begin=input.pos(),tok=readNext();options.forEditor&&tok&&(tok.begin=begin,tok.end=input.pos()),tokens.push(tok)}return tokens[index]}function next(){let tok=peek();return tok&&index++,tok}function ahead(n,f){let pos=index,a=[];for(;n-- >0;)a.push(next()||EOF);return index=pos,f.apply(a,a)}function skip(n){index+=n}function eof(){return null==peek()}}(InputStream(input),options);let ahead=input.ahead,skip=input.skip,token=null,fixCell=null!=options.row&&null!=options.col?function(cell){return 1&cell.rel&&(cell.col-=options.col),2&cell.rel&&(cell.row-=options.row),cell}:identity$1,addPos=options.forEditor?function(thing,startToken,endToken){return thing.begin=startToken.begin,thing.end=endToken.end,thing}:identity$1;return{peek,next:function next(){if(null!=token){let tmp=token;return token=null,tmp}return readNext()},croak:input.croak,eof:input.eof,is:function is(type,value){let tok=peek();return null==tok||null!=type&&tok.type!==type||null!=value&&tok.value!==value?null:tok}};function peek(){return null==token&&(token=readNext()),token}function readNext(){let ret,t=input.peek();return t&&("sym"!==t.type&&"rc"!==t.type&&"num"!==t.type||(ret=ahead(8,refRange3D)||ahead(6,refCell3D)||ahead(6,refSheetRange)||ahead(4,refSheetCell)||ahead(4,refRange)||ahead(2,refCell)||ahead(2,funcall)),ret||(ret=input.next())),ret}function toCell(tok,isFirst){if("rc"===tok.type)return!tok.rel||options.forEditor||null!=options.row&&null!=options.col||input.croak("Cannot read relative cell in RC notation"),new CellRef(tok.row,tok.col,tok.rel);if("num"===tok.type)return tok.value<=1048577?fixCell(new CellRef(getrow(tok.value),isFirst?-1/0:1/0,2)):null;let name=tok.value,m=/^(\$)?([a-z]+)(\$)?(\d+)$/i.exec(name);if(m){let row=getrow(m[4]),col=getcol(m[2]);return row<=1048576&&col<=16383?fixCell(new CellRef(getrow(m[4]),getcol(m[2]),(m[1]?0:1)|(m[3]?0:2))):null}let abs="$"===name.charAt(0);if(abs&&(name=name.substr(1)),/^\d+$/.test(name)){if(getrow(name)<=1048576)return fixCell(new CellRef(getrow(name),isFirst?-1/0:1/0,abs?0:2))}else{if(getcol(name)<=16383)return fixCell(new CellRef(isFirst?-1/0:1/0,getcol(name),abs?0:1))}}function refRange3D(a,b,c,d,e,f,g,h){if("sym"===a.type&&"op"===b.type&&":"===b.value&&"sym"===c.type&&"punc"===d.type&&"!"===d.value&&("sym"===e.type||"rc"===e.type||"num"===e.type&&e.value==e.value|0)&&"op"===f.type&&":"===f.value&&("sym"===g.type||"rc"===g.type||"num"===g.type&&g.value==g.value|0)&&g.type===e.type&&("punc"!==h.type||"("!==h.value||g.space)){let tl=toCell(e,!0),br=toCell(g,!1);if(tl&&br)return skip(7),addPos(new RangeRef(tl.setSheet(a.value,!0),br.setSheet(c.value,!0)).setSheet(a.value,!0),a,g)}}function refCell3D(a,b,c,d,e,f){if("sym"===a.type&&"op"===b.type&&":"===b.value&&"sym"===c.type&&"punc"===d.type&&"!"===d.value&&("sym"===e.type||"rc"===e.type||"num"===e.type&&e.value==e.value|0)&&("punc"!==f.type||"("!==f.value||e.space)){let tl=toCell(e);if(tl){skip(5);let br=tl.clone();return addPos(new RangeRef(tl.setSheet(a.value,!0),br.setSheet(c.value,!0)).setSheet(a.value,!0),a,e)}}}function refSheetRange(a,b,c,d,e,f){if("sym"===a.type&&"punc"===b.type&&"!"===b.value&&("sym"===c.type||"rc"===c.type||"num"===c.type&&c.value==c.value|0)&&"op"===d.type&&":"===d.value&&("sym"===e.type||"rc"===e.type||"num"===e.type&&e.value==e.value|0)&&("punc"!==f.type||"("!==f.value||e.space)){let tl=toCell(c,!0),br=toCell(e,!1);if(tl&&br)return skip(5),addPos(new RangeRef(tl,br).setSheet(a.value,!0),a,e)}}function refSheetCell(a,b,c,d){if("sym"===a.type&&"punc"===b.type&&"!"===b.value&&("sym"===c.type||"rc"===c.type||"num"===c.type&&c.value==c.value|0)&&("punc"!==d.type||"("!==d.value||c.space)){skip(3);let x=toCell(c);return x&&isFinite(x.row)||(x=new NameRef(c.value)),addPos(x.setSheet(a.value,!0),a,c)}}function refRange(a,b,c,d){if(("sym"===a.type||"rc"===a.type||"num"===a.type&&a.value==a.value|0)&&"op"===b.type&&":"===b.value&&("sym"===c.type||"rc"===c.type||"num"===c.type&&c.value==c.value|0)&&("punc"!==d.type||"("!==d.value||c.space)){let tl=toCell(a,!0),br=toCell(c,!1);if(tl&&br)return skip(3),addPos(new RangeRef(tl,br),a,c)}}function refCell(a,b){if(("sym"===a.type||"rc"===a.type)&&("punc"!==b.type||"("!==b.value||a.space)){let x=toCell(a);if(x&&isFinite(x.row)&&isFinite(x.col))return skip(1),addPos(x,a,a)}}function funcall(a,b){if("sym"===a.type&&"punc"===b.type&&"("===b.value&&!a.space)return a.type="func",skip(1),a}}function isWhitespace(ch){return" \t\r\n".indexOf(ch)>=0}let EOF={type:"eof"};function InputStream(input){let pos=0;return{next,peek,eof,croak,readWhile:function readWhile(predicate){let str="";for(;!eof()&&predicate(peek(),str);)str+=next();return str},readEscaped:function readEscaped(end){let escaped=!1,str="";for(;!eof();){let ch=next();if(escaped)str+=ch,escaped=!1;else if("\\"===ch)escaped=!0;else{if(ch===end)break;str+=ch}}return str},lookingAt:function lookingAt(rx){return rx.exec(input.substr(pos))},skip:function skip(ch){if("string"==typeof ch)input.substr(pos,ch.length)!==ch&&croak("Expected "+ch),forward(ch.length);else if(ch instanceof RegExp){let m=ch.exec(input.substr(pos));if(m)return forward(m[0].length),m}else forward(ch[0].length)},forward,pos:function location(){return pos}};function next(){return input.charAt(pos++)}function peek(){return input.charAt(pos)}function eof(){return""===peek()}function croak(msg){throw new ParseError(msg+" (input: "+input+")",pos)}function forward(n){for(;n-- >0;)next()}}let FORMAT_PARSERS=[],registerFormatParser=calc.registerFormatParser=function(p){FORMAT_PARSERS.push(p)};calc.parse=function(sheet,row,col,input,format){if(input instanceof Date)return{type:"date",value:calc.runtime.dateToSerial(input)};if("number"==typeof input)return{type:"number",value:input};if("boolean"==typeof input)return{type:"boolean",value:input};if(/^'/.test(input+=""))return{type:"string",value:input.substr(1)};if(/^-?[0-9]+%$/.test(input)){let str=input.substr(0,input.length-1),num=parseFloat(str);if(!isNaN(num)&&num===str)return{type:"percent",value:num/100}}if(/^=/.test(input))return input=input.substr(1),/\S/.test(input)?parseFormula(sheet,row,col,input):{type:"string",value:"="+input};for(let i=0;i<FORMAT_PARSERS.length;++i){let result=FORMAT_PARSERS[i](input,format);if(result)return result}if("true"===input.toLowerCase())return{type:"boolean",value:!0};if("false"===input.toLowerCase())return{type:"boolean",value:!1};let date=calc.runtime.parseDate(input,format);if(date)return{type:"date",value:calc.runtime.dateToSerial(date)};let num=parseFloat(input);return!isNaN(num)&&input.length>0&&num===input?(format=null,num!==Math.floor(num)&&(format="0."+String(num).split(".")[1].replace(/\d/g,"0")),{type:"number",value:num,format}):{type:"string",value:input}},calc.parseNameDefinition=function parseNameDefinition(name,def){let nameRef=parseFormula(null,0,0,name);if(!(nameRef.ast instanceof NameRef))throw new ParseError("Invalid name: "+name);if(nameRef=nameRef.ast,!(def instanceof Ref)){let defAST=parseFormula(nameRef.sheet,0,0,def);def=defAST.ast instanceof Ref?defAST.ast:/^(?:str|num|bool|error)$/.test(defAST.ast.type)?defAST.ast.value:makeFormula(defAST)}return{name:nameRef,value:def}},calc.parseFormula=parseFormula,calc.parseReference=function parseReference(name,noThrow){if("#sheet"===name.toLowerCase())return SHEETREF;OUT:{let m;if(m=/^(\$)?([a-z]+)(\$)?(\d+)$/i.exec(name)){let row=getrow(m[4]),col=getcol(m[2]);if(row<1048576&&col<16384)return new CellRef(getrow(m[4]),getcol(m[2]));break OUT}let stream=TokenStream(name,{}),a=[];for(;;){let ref=stream.next();if(ref instanceof CellRef)ref.rel=0;else{if(!(ref instanceof RangeRef))break OUT;ref.topLeft.rel=0,ref.bottomRight.rel=0}if(a.push(ref),stream.eof())break;if(!stream.is("op",SEPARATORS.ARG))break OUT;stream.next()}return 1===a.length?a[0]:new UnionRef(a)}if(!noThrow)throw new Error("Cannot parse reference: "+name)},calc.compile=makeFormula,calc.parseSqref=function parseSqref(input,row,col){input=TokenStream(input,{row:row=row||0,col:col=col||0});let refs=[];for(;!input.eof();){let ref=input.next();if("ref"!==ref.type)throw new ParseError("Expecting a reference but got: "+JSON.stringify(ref));refs.push(ref.absolute(row,col))}return refs},calc.InputStream=InputStream,calc.ParseError=ParseError,calc.tokenize=function tokenize(input,row,col){let tokens=[];for(input=TokenStream(input,{forEditor:!0,row,col});!input.eof();)tokens.push(next());let tok=tokens[0];return"op"===tok.type&&"="===tok.value&&(tok.type="startexp"),tokens;function next(){let tok=input.next();return"sym"===tok.type?"TRUE"===tok.upper?(tok.type="bool",tok.value=!0):"FALSE"===tok.upper&&(tok.type="bool",tok.value=!1):"ref"===tok.type&&(tok={type:"ref",ref:null!=row&&null!=col?tok.absolute(row,col):tok,begin:tok.begin,end:tok.end}),tok}},registerFormatParser((function(input,existingFormat){let m,date=0,format="";if(existingFormat||(existingFormat=culture().calendar.patterns.d),m=/^(\d+)([-/.])(\d+)\2(\d{2}(?:\d{2})?)(\s*)/.exec(input)){let mo=parseInt(m[1],10),sep=m[2],da=parseInt(m[3],10),yr=parseInt(m[4],10);yr<30?yr+=2e3:yr<100&&(yr+=1900);let monthFirst=!existingFormat||existingFormat.indexOf("M")<existingFormat.indexOf("d");if(mo>12||!monthFirst){let tmp=mo;mo=da,da=tmp,monthFirst=!1}if(!calc.runtime.validDate(yr,mo,da))return null;date=calc.runtime.packDate(yr,mo-1,da),date<0&&date--,format=monthFirst?["mm","dd","yyyy"].join(sep):["dd","mm","yyyy"].join(sep),format+=m[5],input=input.substr(m[0].length)}if(m=/^(\d+):(\d+)$/.exec(input)){let hh=parseInt(m[1],10),mm=parseInt(m[2],10);return{type:"date",format:format+"hh:mm",value:date+calc.runtime.packTime(hh,mm,0,0)}}if(m=/^(\d+):(\d+)(\.\d+)$/.exec(input)){let mm=parseInt(m[1],10),ss=parseInt(m[2],10),ms=1e3*parseFloat(m[3]);return{type:"date",format:format+"mm:ss.00",value:date+calc.runtime.packTime(0,mm,ss,ms)}}if(m=/^(\d+):(\d+):(\d+)$/.exec(input)){let hh=parseInt(m[1],10),mm=parseInt(m[2],10),ss=parseInt(m[3],10);return{type:"date",format:format+"hh:mm:ss",value:date+calc.runtime.packTime(hh,mm,ss,0)}}if(m=/^(\d+):(\d+):(\d+)(\.\d+)$/.exec(input)){let hh=parseInt(m[1],10),mm=parseInt(m[2],10),ss=parseInt(m[3],10),ms=1e3*parseFloat(m[4]);return{type:"date",format:format+"hh:mm:ss.00",value:date+calc.runtime.packTime(hh,mm,ss,ms)}}})),registerFormatParser((function(input){let m,n;var numbers=culture().numbers;let comma=numbers.symbols.group,dot=numbers.symbols.decimal,currency=numbers.currencies[numbers.localeCurrency].symbol,rxnum=function getNumberRegexp(comma,dot){let id=comma+dot,rx=NUMBER_FORMAT_RX[id];rx||(rx="^(\\d+(COM\\d{3})*(DOT\\d+)?)",rx=rx.replace(/DOT/g,"\\"+dot).replace(/COM/g,"\\"+comma),rx=new RegExp(rx),NUMBER_FORMAT_RX[id]=rx);return rx}(comma,dot),rxcur=new RegExp("^\\s*\\"+currency+"\\s*"),sign=1,format="",suffix="",has_currency=!1,has_percent=!1;if((input=InputStream(input.replace(/^\s+|\s+$/g,""))).skip(/^-\s*/)&&(sign=-1),(m=input.skip(rxcur))&&(has_currency=!0,format+='"'+m[0]+'"'),input.skip(/^-\s*/)){if(sign<0)return null;sign=-1}if(!(n=input.skip(rxnum)))return null;if(format+="0",m=input.skip(rxcur)){if(has_currency)return null;has_currency=!0,suffix='"'+m[0]+'"'}if(!has_currency&&(m=input.skip(/^\s*%\s*/))&&(has_percent=!0,suffix=m[0]),!input.eof())return null;(n[2]||has_currency)&&(format=format.replace("0","#"),format+=",0"),n[3]&&(format+="."+repeat("0",n[3].length-1));let value=n[0].replace(new RegExp("\\"+comma,"g"),"").replace(new RegExp("\\"+dot,"g"),".");return value=parseFloat(value),has_percent&&(value/=100),format+=suffix,has_currency&&(format+=";-"+format),{type:"number",currency:has_currency,format,value:sign*value}})),registerFormatParser((function(input){let m;if(m=/^([0-9]*)\.([0-9]+)(\s*%)$/.exec(input))return{type:"number",value:parseFloat(input)/100,format:"0."+repeat("0",m[2].length)+m[3]}}));let NUMBER_FORMAT_RX={};function repeat(str,len){let out="";for(;len-- >0;)out+=str;return out}function _cosh(n){return(Math.exp(n)+Math.exp(-n))/2}function _sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function _tanh(n){return _sinh(n)/_cosh(n)}function _gcd(a,b){for(;b;){var r=a%b;a=b,b=r}return a}function _lcm(a,b){return Math.abs(a*b)/_gcd(a,b)}function forIFS(args,f){for(var chunks=[],i=0,matrix=args[0];i<args.length;)chunks.push({matrix:args[i++],pred:parseCriteria(args[i++])});for(var row=0;row<matrix.height;++row)COL:for(var col=0;col<matrix.width;++col){for(i=0;i<chunks.length;++i){var val=chunks[i].matrix.get(row,col);if(!chunks[i].pred(null==val||""===val?0:val))continue COL}f(row,col)}}["abs","cos","sin","acos","asin","tan","atan","exp","sqrt"].forEach((function(name){defineFunction(name,Math[name]).args([["*n","number"]])})),defineFunction("ln",Math.log).args([["*n","number"]]),defineFunction("log",(function(num,base){return Math.log(num)/Math.log(base)})).args([["*num","number++"],["*base",["or","number++",["null",10]]],["?",["assert","$base != 1","DIV/0"]]]),defineFunction("log10",(function(num){return Math.log(num)/Math.log(10)})).args([["*num","number++"]]),defineFunction("pi",(function(){return Math.PI})).args([]),defineFunction("sqrtpi",(function(n){return Math.sqrt(n*Math.PI)})).args([["*num","number+"]]),defineFunction("degrees",(function(rad){return 180*rad/Math.PI%360})).args([["*radians","number"]]),defineFunction("radians",(function(deg){return Math.PI*deg/180})).args([["*degrees","number"]]),defineFunction("cosh",_cosh).args([["*num","number"]]),defineFunction("acosh",(function(n){return Math.log(n+Math.sqrt(n-1)*Math.sqrt(n+1))})).args([["*num","number"],["?",["assert","$num >= 1"]]]),defineFunction("sinh",_sinh).args([["*num","number"]]),defineFunction("asinh",(function(n){return Math.log(n+Math.sqrt(n*n+1))})).args([["*num","number"]]),defineFunction("sec",(function(n){return 1/Math.cos(n)})).args([["*num","number"]]),defineFunction("sech",(function(n){return 1/_cosh(n)})).args([["*num","number"]]),defineFunction("csc",(function(n){return 1/Math.sin(n)})).args([["*num","number"]]),defineFunction("csch",(function(n){return 1/_sinh(n)})).args([["*num","number"]]),defineFunction("atan2",(function(x,y){return Math.atan(y/x)})).args([["*x","divisor"],["*y","number"]]),defineFunction("tanh",_tanh).args([["*num","number"]]),defineFunction("atanh",(function(n){return Math.log(Math.sqrt(1-n*n)/(1-n))})).args([["*num",["and","number",["(between)",-1,1]]]]),defineFunction("cot",(function(n){return 1/Math.tan(n)})).args([["*num","divisor"]]),defineFunction("coth",(function(n){return 1/_tanh(n)})).args([["*num","divisor"]]),defineFunction("acot",(function(n){return Math.PI/2-Math.atan(n)})).args([["*num","number"]]),defineFunction("acoth",(function(n){return Math.log((n+1)/(n-1))/2})).args([["*num","number"],["?",["or",["assert","$num < -1"],["assert","$num > 1"]]]]),defineFunction("power",(function(a,b){return Math.pow(a,b)})).args([["*a","number"],["*b","number"]]),defineFunction("mod",(function(a,b){return a%b})).args([["*a","number"],["*b","divisor"]]),defineFunction("quotient",(function(a,b){return Math.floor(a/b)})).args([["*a","number"],["*b","divisor"]]),defineFunction("ceiling",(function(num,s){return s?s*Math.ceil(num/s):0})).args([["*number","number"],["*significance","number"],["?",["assert","$significance >= 0 || $number < 0"]]]),defineFunction("ceiling.precise",(function(num,s){return(s=Math.abs(s))?s*Math.ceil(num/s):0})).args([["*number","number"],["*significance",["or","number",["null",1]]]]),calc.runtime.defineAlias("iso.ceiling","ceiling.precise"),defineFunction("ceiling.math",(function(num,s,mode){return s&&num?(num<0&&(!mode&&s<0||mode&&s>0)&&(s=-s),s?s*Math.ceil(num/s):0):0})).args([["*number","number"],["*significance",["or","number",["null","$number < 0 ? -1 : 1"]]],["*mode",["or","logical",["null",0]]]]),defineFunction("floor",(function(num,s){return s?s*Math.floor(num/s):0})).args([["*number","number"],["*significance","number"],["?",["assert","$significance >= 0 || $number < 0"]]]),defineFunction("floor.precise",(function(num,s){return(s=Math.abs(s))?s*Math.floor(num/s):0})).args([["*number","number"],["*significance",["or","number",["null",1]]]]),defineFunction("floor.math",(function(num,s,mode){return s&&num?(num<0&&(!mode&&s<0||mode&&s>0)&&(s=-s),s?s*Math.floor(num/s):0):0})).args([["*number","number"],["*significance",["or","number",["null","$number < 0 ? -1 : 1"]]],["*mode",["or","logical",["null",0]]]]),defineFunction("int",Math.floor).args([["*number","number"]]),defineFunction("mround",(function(num,mult){return mult?mult*Math.round(num/mult):0})).args([["*number","number"],["*multiple","number"]]),defineFunction("round",(function(num,digits){var sign=num<0?-1:1;return sign<0&&(num=-num),num=limitPrecision(num*(digits=Math.pow(10,digits))),sign*(num=Math.round(num))/digits})).args([["*number","number"],["*digits","number"]]),defineFunction("roundup",(function(num,digits){return(num=(num=limitPrecision(num*(digits=Math.pow(10,digits))))<0?Math.floor(num):Math.ceil(num))/digits})).args([["*number","number"],["*digits","number"]]),defineFunction("rounddown",(function(num,digits){return(num=(num=limitPrecision(num*(digits=Math.pow(10,digits))))<0?Math.ceil(num):Math.floor(num))/digits})).args([["*number","number"],["*digits","number"]]),defineFunction("even",(function(num){var n=num<0?Math.floor(num):Math.ceil(num);return n%2?n+(n<0?-1:1):n})).args([["*number","number"]]),defineFunction("odd",(function(num){var n=num<0?Math.floor(num):Math.ceil(num);return n%2?n:n+(n<0?-1:1)})).args([["*number","number"]]),defineFunction("sign",(function(num){return num<0?-1:num>0?1:0})).args([["*number","number"]]),defineFunction("gcd",(function(args){for(var a=args[0],i=1;i<args.length;++i)a=_gcd(a,args[i]);return a})).args([["numbers",["collect","number"]]]),defineFunction("lcm",(function(args){for(var a=args[0],i=1;i<args.length;++i)a=_lcm(a,args[i]);return a})).args([["numbers",["collect","number"]]]),defineFunction("sum",(function(numbers){return numbers.reduce((function(sum,num){return sum+num}),0)})).args([["numbers",["collect","number"]]]),defineFunction("product",(function(numbers){return numbers.reduce((function(prod,num){return prod*num}),1)})).args([["numbers",["collect","number"]]]),defineFunction("sumproduct",(function(first,rest){var sum=0;return first.each((function(p,row,col){if("number"==typeof p){for(var i=0;i<rest.length;++i){var v=rest[i].get(row,col);if("number"!=typeof v)return;p*=v}sum+=p}})),sum})).args([["a1","matrix"],["+",["a2",["and","matrix",["assert","$a2.width == $a1.width"],["assert","$a2.height == $a1.height"]]]]]),defineFunction("sumsq",(function(numbers){return numbers.reduce((function(sum,num){return sum+num*num}),0)})).args([["numbers",["collect","number"]]]),defineFunction("sumx2my2",(function(a,b){var sum=0;return a.each((function(x,row,col){var y=b.get(row,col);"number"==typeof x&&"number"==typeof y&&(sum+=x*x-y*y)})),sum})).args([["a","matrix"],["b",["and","matrix",["assert","$b.width == $a.width"],["assert","$b.height == $a.height"]]]]),defineFunction("sumx2py2",(function(a,b){var sum=0;return a.each((function(x,row,col){var y=b.get(row,col);"number"==typeof x&&"number"==typeof y&&(sum+=x*x+y*y)})),sum})).args([["a","matrix"],["b",["and","matrix",["assert","$b.width == $a.width"],["assert","$b.height == $a.height"]]]]),defineFunction("sumxmy2",(function(a,b){var sum=0;return a.each((function(x,row,col){var y=b.get(row,col);"number"==typeof x&&"number"==typeof y&&(sum+=(x-y)*(x-y))})),sum})).args([["a","matrix"],["b",["and","matrix",["assert","$b.width == $a.width"],["assert","$b.height == $a.height"]]]]),defineFunction("seriessum",(function(x,n,m,a){var sum=0;return a.each((function(coef){if("number"!=typeof coef)throw new CalcError("VALUE");sum+=coef*Math.pow(x,n),n+=m})),sum})).args([["x","number"],["y","number"],["m","number"],["a","matrix"]]),defineFunction("min",(function(numbers){return numbers.length?Math.min.apply(Math,numbers):0})).args([["numbers",["collect","number!"]]]),defineFunction("max",(function(numbers){return numbers.length?Math.max.apply(Math,numbers):0})).args([["numbers",["collect","number!"]]]),defineFunction("counta",(function(values){return values.length})).args([["values",["#collect","anyvalue"]]]),defineFunction("count",(function(numbers){return numbers.length})).args([["numbers",["#collect","number"]]]),defineFunction("countunique",(function(values){var count=0,seen=[];return values.forEach((function(val){seen.indexOf(val)<0&&(count++,seen.push(val))})),count})).args([["values",["#collect","anyvalue"]]]),defineFunction("countblank",(function(a){var count=0;function add(val){null!=val&&""!==val||count++}return function loop(args){for(var i=0;i<args.length;++i){var x=args[i];x instanceof Matrix?x.each(add,!0):add(x)}}(a),count})).args([["+",["args",["or","matrix","anyvalue"]]]]),defineFunction("iseven",(function(num){return num%2==0})).args([["*number","number"]]),defineFunction("isodd",(function(num){return num%2!=0})).args([["*number","number"]]),defineFunction("n",(function(val){return"boolean"==typeof val?val?1:0:"number"==typeof val?val:0})).args([["*value","anyvalue"]]),defineFunction("na",(function(){return new CalcError("N/A")})).args([]);var ARGS_COUNTIFS=[["m1","matrix"],["c1","anyvalue"],[["m2","matrix"],["c2","anyvalue"]]];defineFunction("countifs",(function(m1,c1,rest){var count=0;return rest.unshift(m1,c1),forIFS(rest,(function(){count++})),count})).args(ARGS_COUNTIFS);var ARGS_SUMIFS=[["range","matrix"]].concat(ARGS_COUNTIFS);defineFunction("sumifs",(function(range,m1,c1,args){args.unshift(range,numericPredicate,m1,c1);var sum=0;return forIFS(args,(function(row,col){var val=range.get(row,col);val&&(sum+=val)})),sum})).args(ARGS_SUMIFS),defineFunction("averageifs",(function(range,m1,c1,args){args.unshift(range,numericPredicate,m1,c1);var sum=0,count=0;return forIFS(args,(function(row,col){var val=range.get(row,col);null!=val&&""!==val||(val=0),sum+=val,count++})),count?sum/count:new CalcError("DIV/0")})).args(ARGS_SUMIFS),defineFunction("countif",(function(matrix,criteria){criteria=parseCriteria(criteria);var count=0;return matrix.each((function(val){criteria(val)&&count++})),count})).args([["range","matrix"],["*criteria","anyvalue"]]);var def,ARGS_SUMIF=[["range","matrix"],["*criteria","anyvalue"],["sumRange",["or","area","#matrix",["null","$range"]]]];function fetchSumRange(continuation){return function(callback,range,criteria,sumRange){var self=this;if(sumRange instanceof Ref){var r=sumRange.clone().toRangeRef();if(r.width()!=range.width||r.height()!=range.height)return isFinite(r.topLeft.row)||(r.topLeft.row=0),isFinite(r.topLeft.col)||(r.topLeft.col=0),r.bottomRight.row=r.topLeft.row+range.height-1,r.bottomRight.col=r.topLeft.col+range.width-1,self.resolveCells([r],(function(){callback(continuation(range,criteria,self.asMatrix(r)))}))}callback(continuation(range,criteria,self.asMatrix(sumRange)))}}function _avg(numbers){return numbers.reduce((function(sum,num){return sum+num}),0)/numbers.length}function _var_sp(numbers,divisor,avg){return null==avg&&(avg=_avg(numbers)),numbers.reduce((function(sum,num){return sum+Math.pow(num-avg,2)}),0)/divisor}function _stdev_sp(numbers,divisor){return Math.sqrt(_var_sp(numbers,divisor))}function _percentrank(numbers,x,exc){var nlt=0,ngt=0,left=null,right=null,found=!1;return numbers.forEach((function(num){num<x?(nlt++,left=null==left?num:Math.max(left,num)):num>x?(ngt++,right=null==right?num:Math.min(right,num)):found=!0})),nlt||ngt?found?exc?(nlt+1)/(numbers.length+1):nlt/(nlt+ngt):((right-x)*_percentrank(numbers,left,exc)+(x-left)*_percentrank(numbers,right,exc))/(right-left):new CalcError("N/A")}defineFunction("sumif",fetchSumRange((function(range,criteria,sumRange){var sum=0;return criteria=parseCriteria(criteria),range.each((function(val,row,col){if(criteria(val)){var v=sumRange.get(row,col);numericPredicate(v)&&(sum+=v||0)}})),sum}))).argsAsync(ARGS_SUMIF),defineFunction("averageif",fetchSumRange((function(range,criteria,sumRange){var sum=0,count=0;return criteria=parseCriteria(criteria),range.each((function(val,row,col){if(criteria(val)){var v=sumRange.get(row,col);numericPredicate(v)&&(sum+=v||0,count++)}})),count?sum/count:new CalcError("DIV/0")}))).argsAsync(ARGS_SUMIF),def=function(name,handler){defineFunction(name,(function(matrix,nth){var numbers=[],error=matrix.each((function(val){if(val instanceof CalcError)return val;"number"==typeof val&&numbers.push(val)}));return error||(nth>numbers.length?new CalcError("NUM"):handler(numbers,nth-1))})).args([["array","matrix"],["*nth","number++"]])},def("large",(function(numbers,nth){return numbers.sort(descending)[nth]})),def("small",(function(numbers,nth){return numbers.sort(ascending)[nth]})),defineFunction("stdev.s",(function(numbers){return _stdev_sp(numbers,numbers.length-1)})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length >= 2","NUM"]]]),defineFunction("stdev.p",(function(numbers){return _stdev_sp(numbers,numbers.length)})).args([["numbers",["collect","number!"]],["?",["assert","$numbers.length >= 1","NUM"]]]),defineFunction("var.s",(function(numbers){return _var_sp(numbers,numbers.length-1)})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length >= 2","NUM"]]]),defineFunction("var.p",(function(numbers){return _var_sp(numbers,numbers.length)})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length >= 2","NUM"]]]),defineFunction("median",(function(numbers){var n=numbers.length;return numbers.sort(ascending),n%2?numbers[n>>1]:(numbers[n>>=1]+numbers[n-1])/2})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length > 0","N/A"]]]),defineFunction("mode.sngl",(function(numbers){numbers.sort(ascending);for(var prev=null,count=0,max=1,mode=null,i=0;i<numbers.length;++i){var n=numbers[i];n!=prev?(count=1,prev=n):count++,count>max&&(max=count,mode=n)}return null==mode?new CalcError("N/A"):mode})).args([["numbers",["collect","number"]]]),defineFunction("mode.mult",(function(numbers){var seen=Object.create(null),max=2,res=[];numbers.forEach((function(num){var s=seen[num]||0;seen[num]=++s,s==max?res.push(num):s>max&&(max=s,res=[num])}));var m=new Matrix(this);return res.forEach((function(num,i){m.set(i,0,num)})),m})).args([["numbers",["collect","number"]]]),defineFunction("geomean",(function(numbers){var n=numbers.length,p=numbers.reduce((function(p,num){if(num<0)throw new CalcError("NUM");return p*num}),1);return Math.pow(p,1/n)})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length > 0","NUM"]]]),defineFunction("harmean",(function(numbers){return numbers.length/numbers.reduce((function(s,num){if(!num)throw new CalcError("DIV/0");return s+1/num}),0)})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length > 0","NUM"]]]),defineFunction("trimmean",(function(numbers,p){var n=numbers.length;numbers.sort(ascending);var discard=Math.floor(n*p);discard%2&&--discard;for(var sum=0,i=discard/=2;i<n-discard;++i)sum+=numbers[i];return sum/(n-2*discard)})).args([["numbers",["collect","number",1]],["percent",["and","number",["[between)",0,1]]],["?",["assert","$numbers.length > 0","NUM"]]]),defineFunction("frequency",(function(data,bins){data.sort(ascending),bins.sort(ascending);var prev=-1/0,i=0;function count(max){for(var n=0;i<data.length&&data[i]>prev&&data[i]<=max;)++n,++i;return n}var m=new Matrix(this);return bins.forEach((function(val,i){var n=count(val);prev=val,m.set(i,0,n)})),m.set(m.height,0,data.length-i),m})).args([["data",["collect","number",1]],["bins",["collect","number",1]]]),defineFunction("rank.eq",(function(val,numbers,asc){numbers.sort(asc?ascending:descending);var pos=numbers.indexOf(val);return pos<0?new CalcError("N/A"):pos+1})).args([["value","number"],["numbers",["collect","number",1]],["order",["or","logical",["null",!1]]]]),calc.runtime.defineAlias("rank","rank.eq"),defineFunction("rank.avg",(function(val,numbers,asc){numbers.sort(asc?ascending:descending);var pos=numbers.indexOf(val);if(pos<0)return new CalcError("N/A");for(var i=pos;numbers[i]==val;++i);return(pos+i+1)/2})).args([["value","number"],["numbers",["collect","number"]],["order",["or","logical",["null",!1]]]]),defineFunction("kurt",(function(numbers){var n=numbers.length,avg=_avg(numbers),variance=_var_sp(numbers,n-1,avg),stddev=Math.sqrt(variance);return n*(n+1)/((n-1)*(n-2)*(n-3))*numbers.reduce((function(sum,num){return sum+Math.pow((num-avg)/stddev,4)}),0)-3*Math.pow(n-1,2)/((n-2)*(n-3))})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length >= 4","NUM"]]]);var ARGS_PERCENTRANK=[["array",["collect","number",1]],["x","number"],["significance",["or",["null",3],"integer++"]],["?",["assert","$array.length > 0","NUM"]]];function _covariance(x,y,divisor){for(var sum=0,ax=_avg(x),ay=_avg(y),n=x.length,i=0;i<n;++i)sum+=(x[i]-ax)*(y[i]-ay);return sum/divisor}defineFunction("percentrank.inc",(function(numbers,x,significance){var p=_percentrank(numbers,x,0);return p=p.toFixed(significance+1),parseFloat(p.substr(0,p.length-1))})).args(ARGS_PERCENTRANK),defineFunction("percentrank.exc",(function(numbers,x,significance){var p=_percentrank(numbers,x,1);return p=p.toFixed(significance+1),parseFloat(p.substr(0,p.length-1))})).args(ARGS_PERCENTRANK),calc.runtime.defineAlias("percentrank","percentrank.inc"),defineFunction("covariance.p",(function(x,y){return _covariance(x,y,x.length)})).args([["array1",["collect","number",1]],["array2",["collect","number",1]],["?",["assert","$array1.length == $array2.length","N/A"]],["?",["assert","$array1.length > 0","DIV/0"]]]),defineFunction("covariance.s",(function(x,y){return _covariance(x,y,x.length-1)})).args([["array1",["collect","number",1]],["array2",["collect","number",1]],["?",["assert","$array1.length == $array2.length","N/A"]],["?",["assert","$array1.length > 1","DIV/0"]]]),calc.runtime.defineAlias("covar","covariance.p");var _fact=memoize((function(n){for(var i=2,fact=1;i<=n;++i)fact*=i;return fact}));defineFunction("fact",_fact).args([["*n","integer+"]]),defineFunction("factdouble",(function(n){for(var i=2+(1&n),fact=1;i<=n;i+=2)fact*=i;return fact})).args([["*n","integer+"]]),defineFunction("multinomial",(function(numbers){var div=1,sum=0;return numbers.forEach((function(n){if(n<0)throw new CalcError("NUM");sum+=n,div*=_fact(n)})),_fact(sum)/div})).args([["numbers",["collect","number"]]]);var _combinations=memoize((function(n,k){for(var f1=k+1,f2=1,p1=1,p2=1;f2<=n-k;++f1,++f2)p1*=f1,p2*=f2;return p1/p2}));function _percentile(numbers,rank){numbers.sort(ascending);var n=numbers.length,k=0|rank,d=rank-k;return 0===k?numbers[0]:k>=n?numbers[n-1]:numbers[--k]+d*(numbers[k+1]-numbers[k])}function _percentile_inc(numbers,p){return _percentile(numbers,p*(numbers.length-1)+1)}function _percentile_exc(numbers,p){return _percentile(numbers,p*(numbers.length+1))}defineFunction("combin",_combinations).args([["*n","integer++"],["*k",["and","integer",["[between]",0,"$n"]]]]),defineFunction("combina",(function(n,k){return _combinations(n+k-1,n-1)})).args([["*n","integer++"],["*k",["and","integer",["[between]",1,"$n"]]]]),defineFunction("average",(function(numbers){return numbers.reduce((function(sum,num){return sum+num}),0)/numbers.length})).args([["numbers",["collect","number!"]],["?",["assert","$numbers.length > 0","DIV/0"]]]),defineFunction("averagea",(function(values){var sum=0,count=0;return values.forEach((function(num){"string"!=typeof num&&(sum+=num),++count})),count?sum/count:new CalcError("DIV/0")})).args([["values",["collect","anyvalue"]]]),defineFunction("percentile.inc",_percentile_inc).args([["numbers",["collect","number",1]],["p",["and","number",["[between]",0,1]]]]),defineFunction("percentile.exc",_percentile_exc).args([["numbers",["collect","number",1]],["p",["and","number",["(between)",0,1]]]]),defineFunction("quartile.inc",(function(numbers,quarter){return _percentile_inc(numbers,quarter/4)})).args([["numbers",["collect","number",1]],["quarter",["values",0,1,2,3,4]]]),defineFunction("quartile.exc",(function(numbers,quarter){return _percentile_exc(numbers,quarter/4)})).args([["numbers",["collect","number",1]],["quarter",["values",0,1,2,3,4]]]),calc.runtime.defineAlias("quartile","quartile.inc"),calc.runtime.defineAlias("percentile","percentile.inc");var AGGREGATE_FUNCS=["AVERAGE","COUNT","COUNTA","MAX","MIN","PRODUCT","STDEV.S","STDEV.P","SUM","VAR.S","VAR.P","MEDIAN","MODE.SNGL","LARGE","SMALL","PERCENTILE.INC","QUARTILE.INC","PERCENTILE.EXC","QUARTILE.EXC"];function fetchValuesForAggregate(self,args,options){var values=[];return function fetchValues(args){if(args instanceof Ref)self.getRefCells(args,!0).forEach((function(cell){var value=cell.value;if(!(1&options&&cell.hidden)){if(cell.formula){var str=cell.formula.print(cell.row,cell.col);if(/^\s*(?:aggregate|subtotal)\s*\(/i.test(str)&&!(4&options))return}2&options&&value instanceof CalcError||("number"==typeof value||value instanceof CalcError)&&values.push(value)}}));else if(Array.isArray(args))for(var i=0;i<args.length;++i)fetchValues(args[i]);else args instanceof Matrix?args.each(fetchValues):("number"==typeof args||args instanceof CalcError&&!(2&options))&&values.push(args)}(args),values}function _binom_dist(x,n,p,cumulative){if(cumulative){for(var sum=0,j=0;j<=x;++j)sum+=_combinations(n,j)*Math.pow(p,j)*Math.pow(1-p,n-j);return sum}return _combinations(n,x)*Math.pow(p,x)*Math.pow(1-p,n-x)}function weeksInYear(year){var d=unpackDate(packDate(year,0,1));return 4==d.day||3==d.day&&calc.runtime.isLeapYear(year)?53:52}function _days_360(start,end,method){var d1=unpackDate(start),d2=unpackDate(end);return method?(31==d1.date&&(d1.date=30),31==d2.date&&(d2.date=30)):(1==d1.month&&1==d2.month&&d1.date==daysInMonth(d1.year,1)&&d2.date==daysInMonth(d2.year,1)&&(d2.date=30),d1.date==daysInMonth(d1.year,d1.month)?(d1.date=30,31==d2.date&&(d2.date=30)):30==d1.date&&31==d2.date&&(d2.date=30)),360*(d2.year-d1.year)+30*(d2.month-d1.month)+(d2.date-d1.date)}defineFunction("aggregate",(function(callback,funcId,options,args){var self=this;self.resolveCells(args,(function(){var values;if(funcId>12){values=fetchValuesForAggregate(self,args[0],options);var k=args[1];if(k instanceof CellRef&&(k=self.getRefData(k)),"number"!=typeof k)return callback(new CalcError("VALUE"))}else values=fetchValuesForAggregate(self,args,options);self.func(AGGREGATE_FUNCS[funcId-1],callback,values)}))})).argsAsync([["funcId",["values",1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],["options",["or",["null",0],["values",0,1,2,3,4,5,6,7]]],["args","rest"]]),defineFunction("subtotal",(function(callback,funcId){var self=this,ignoreHidden=funcId>100;ignoreHidden&&(funcId-=100);for(var args=[],i=2;i<arguments.length;++i)args.push(arguments[i]);self.resolveCells(args,(function(){var values=fetchValuesForAggregate(self,args,ignoreHidden?1:0);self.func(AGGREGATE_FUNCS[funcId-1],callback,values)}))})).argsAsync([["funcId",["values",1,2,3,4,5,6,7,8,9,10,11,101,102,103,104,105,106,107,108,109,110,111]],["+",["ref",["or","ref","#matrix"]]]]),defineFunction("avedev",(function(numbers){var avg=numbers.reduce((function(sum,num){return sum+num}),0)/numbers.length;return numbers.reduce((function(sum,num){return sum+Math.abs(num-avg)}),0)/numbers.length})).args([["numbers",["collect","number"]],["?",["assert","$numbers.length >= 2","NUM"]]]),defineFunction("binom.dist",_binom_dist).args([["successes","integer+"],["trials",["and","integer",["assert","$trials >= $successes"]]],["probability",["and","number",["[between]",0,1]]],["cumulative","logical"]]),calc.runtime.defineAlias("binomdist","binom.dist"),defineFunction("binom.inv",(function(n,p,alpha){for(var x=0;x<=n;++x)if(_binom_dist(x,n,p,!0)>=alpha)return x;return new CalcError("N/A")})).args([["trials","integer+"],["probability",["and","number",["[between]",0,1]]],["alpha",["and","number",["[between]",0,1]]]]),calc.runtime.defineAlias("critbinom","binom.inv"),defineFunction("binom.dist.range",(function(n,p,s,s2){for(var sum=0,k=s;k<=s2;++k)sum+=_combinations(n,k)*Math.pow(p,k)*Math.pow(1-p,n-k);return sum})).args([["trials","integer+"],["probability",["and","number",["[between]",0,1]]],["successes_min",["and","integer",["[between]",0,"$trials"]]],["successes_max",["or",["and","integer",["[between]","$successes_min","$trials"]],["null","$successes_min"]]]]),defineFunction("negbinom.dist",(function(x,k,p,cumulative){if(cumulative){for(var sum=0;x>=0;)sum+=_combinations(x+k-1,x)*Math.pow(p,k)*Math.pow(1-p,x),x--;return sum}return _combinations(x+k-1,x)*Math.pow(p,k)*Math.pow(1-p,x)})).args([["number_f","integer+"],["number_s","integer+"],["probability_s",["and","number",["[between]",0,1]]],["cumulative","logical"]]),calc.runtime.defineAlias("negbinomdist","negbinom.dist"),defineFunction("address",(function(row,col,abs,a1,sheet){var cell=new CellRef(row-1,col-1,abs-1);return sheet&&cell.setSheet(sheet,!0),a1?cell.print(0,0):cell.print()})).args([["row","integer++"],["col","integer++"],["abs",["or",["null",1],["values",1,2,3,4]]],["a1",["or",["null",!0],"logical"]],["sheet",["or","null","string"]]]),defineFunction("areas",(function(ref){var count=0;return function loop(x){x instanceof CellRef||x instanceof RangeRef?count++:x instanceof UnionRef&&x.refs.forEach(loop)}(ref),count})).args([["ref","ref"]]),defineFunction("choose",(function(index,args){return index>args.length?new CalcError("N/A"):args[index-1]})).args([["*index","integer"],["+",["value","anything"]]]),defineFunction("column",(function(ref){return ref?ref instanceof CellRef?ref.col+1:this.asMatrix(ref).mapCol((function(col){return col+ref.topLeft.col+1})):this.formula.col+1})).args([["ref",["or","area","null"]]]),defineFunction("columns",(function(m){return m instanceof Ref?m.width():m.width})).args([["ref",["or","area","#matrix"]]]),defineFunction("formulatext",(function(ref){var cell=this.getRefCells(ref)[0];return cell.formula?cell.formula.print(cell.row,cell.col):new CalcError("N/A")})).args([["ref","ref"]]),defineFunction("hlookup",(function(value,m,row,approx){var resultCol=null;return m.eachCol((function(col){var data=m.get(0,col);if(approx){if(data>value)return!0;resultCol=col}else if(data===value)return resultCol=col,!0})),null==resultCol?new CalcError("N/A"):m.get(row-1,resultCol)})).args([["value","anyvalue"],["range","matrix"],["row","integer++"],["approx",["or","logical",["null",!0]]]]),defineFunction("index",(function(callback,ref,row,col,areanum){var self=this;if(ref instanceof UnionRef&&(ref=ref.refs[areanum-1]),!row&&!col||!ref)return callback(new CalcError("N/A"));if(ref instanceof CellRef&&(ref=ref.toRangeRef()),ref instanceof RangeRef){if(row&&col){if(col>ref.width()||row>ref.height())return callback(new CalcError("REF"));var cell=ref.toCell(row-1,col-1);return void self.resolveCells([cell],(function(){callback(self.getRefData(cell))}))}if(!row){var colRange=ref.toColumn(col-1);return void self.resolveCells([colRange],(function(){callback(self.asMatrix(colRange))}))}if(!col){var rowRange=ref.toRow(row-1);return void self.resolveCells([rowRange],(function(){callback(self.asMatrix(rowRange))}))}}else if(ref instanceof Matrix){if(ref.width>1&&ref.height>1){if(row&&col)return callback(ref.get(row-1,col-1));if(!row)return callback(ref.mapRow((function(row){return ref.get(row,col-1)})));if(!col)return callback(ref.mapCol((function(col){return ref.get(row-1,col)})))}if(1==ref.width)return callback(ref.get(row-1,0));if(1==ref.height)return callback(ref.get(0,col-1))}else callback(new CalcError("REF"))})).argsAsync([["range",["or","ref","matrix"]],["row",["or","integer+","null"]],["col",["or","integer+","null"]],["areanum",["or","integer++",["null",1]]]]),defineFunction("indirect",(function(thing){try{var f=this.formula,ref=calc.parseFormula(f.sheet,f.row,f.col,thing).ast;if(ref instanceof NameRef&&(ref=this.ss.nameValue(ref,f.sheet,f.row,f.col)),!(ref instanceof Ref))throw 1;return ref.absolute(f.row,f.col)}catch(ex){return new CalcError("REF")}})).args([["thing","string"]]),defineFunction("match",(function(val,m,type){var cmp,index=1;return 0===type?cmp=parseCriteria(val):-1===type?cmp=parseCriteria("<="+val):1===type&&(cmp=parseCriteria(">="+val)),m.each((function(el){if(null!=el&&cmp(el))return 0!==type&&val!=el&&--index,!0;index++}),!0)&&index>0?index:new CalcError("N/A")})).args([["value","anyvalue"],["range","matrix"],["type",["or",["values",-1,0,1],["null",1]]]]),defineFunction("offset",(function(ref,rows,cols,height,width){var topLeft=(ref instanceof CellRef?ref:ref.topLeft).clone();return topLeft.row+=rows,topLeft.col+=cols,topLeft.row<0||topLeft.col<0?new CalcError("VALUE"):height>1||width>1?new RangeRef(topLeft,new CellRef(topLeft.row+height-1,topLeft.col+width-1)).setSheet(ref.sheet,ref.hasSheet()):topLeft})).args([["ref","area"],["*rows","integer"],["*cols","integer"],["*height",["or","integer++",["null","$ref.height()"]]],["*width",["or","integer++",["null","$ref.width()"]]]]),defineFunction("row",(function(ref){return ref?ref instanceof CellRef?ref.row+1:this.asMatrix(ref).mapRow((function(row){return row+ref.topLeft.row+1})):this.formula.row+1})).args([["ref",["or","area","null"]]]),defineFunction("rows",(function(m){return m instanceof Ref?m.height():m.height})).args([["ref",["or","area","#matrix"]]]),defineFunction("vlookup",(function(value,m,col,approx){var resultRow=null;return"number"!=typeof value&&(approx=!1),"string"==typeof value&&(value=value.toLowerCase()),m.eachRow((function(row){var data=m.get(row,0);if(approx){if(data>value)return!0;resultRow=row}else if("string"==typeof data&&(data=data.toLowerCase()),data===value)return resultRow=row,!0})),null==resultRow?new CalcError("N/A"):m.get(resultRow,col-1)})).args([["value","anyvalue"],["range","matrix"],["col","integer++"],["approx",["or","logical",["null",!0]]]]),defineFunction("date",(function(year,month,date){return packDate(year,month-1,date)})).args([["*year","integer"],["*month","integer"],["*date","integer"]]),defineFunction("day",(function(date){return unpackDate(date).date})).args([["*date","date"]]),defineFunction("month",(function(date){return unpackDate(date).month+1})).args([["*date","date"]]),defineFunction("year",(function(date){return unpackDate(date).year})).args([["*date","date"]]),defineFunction("weekday",(function(date){return unpackDate(date).day+1})).args([["*date","date"]]),defineFunction("weeknum",(function(date,type){var diff,fw=packDate(unpackDate(date).year,0,1),sy=unpackDate(fw);return 21==type?((diff=3-(sy.day+6)%7)<0&&(diff+=7),fw+=diff,sy.date+=diff,sy.day=4,type=1):type=1==type?0:2==type?1:(type-10)%7,(diff=sy.day-type)<0&&(diff+=7),fw-=diff,Math.ceil((date+1-fw)/7)})).args([["*date","date"],["*type",["or",["null",1],["values",1,2,11,12,13,14,15,16,17,21]]]]),defineFunction("isoweeknum",(function isoweeknum(date){var d=unpackDate(date),dow=d.day||7,wk=Math.floor((d.ord-dow+10)/7);return wk<1?weeksInYear(d.year-1):53==wk&&wk>weeksInYear(d.year)?1:wk})).args([["*date","date"]]),defineFunction("now",(function(){return calc.runtime.dateToSerial(new Date)})).args([]),defineFunction("today",(function(){return 0|calc.runtime.dateToSerial(new Date)})).args([]),defineFunction("time",(function(hh,mm,ss){return calc.runtime.packTime(hh,mm,ss,0)})).args([["*hours","integer"],["*minutes","integer"],["*seconds","integer"]]),defineFunction("hour",(function(time){return calc.runtime.unpackTime(time).hours})).args([["*time","datetime"]]),defineFunction("minute",(function(time){return calc.runtime.unpackTime(time).minutes})).args([["*time","datetime"]]),defineFunction("second",(function(time){return calc.runtime.unpackTime(time).seconds})).args([["*time","datetime"]]),defineFunction("edate",(function(base,months){var d=unpackDate(base),m=d.month+months,y=d.year+Math.floor(m/12);return(m%=12)<0&&(m+=12),packDate(y,m,d=Math.min(d.date,daysInMonth(y,m)))})).args([["*start_date","date"],["*months","integer"]]),defineFunction("eomonth",(function(base,months){var d=unpackDate(base),m=d.month+months,y=d.year+Math.floor(m/12);return(m%=12)<0&&(m+=12),packDate(y,m,d=daysInMonth(y,m))})).args([["*start_date","date"],["*months","integer"]]),defineFunction("workday",(function(date,n,holidays){var inc=n>0?1:-1;n=Math.abs(n);for(var dow=unpackDate(date).day;n>0;)date+=inc,(dow=(dow+inc)%7)>0&&dow<6&&holidays.indexOf(date)<0&&--n;return date})).args([["start_date","date"],["days","integer"],["holidays",["collect","date"]]]),defineFunction("networkdays",(function(date,end,holidays){if(date>end){var tmp=date;date=end,end=tmp}for(var count=0,dow=unpackDate(date).day;date<=end;)dow>0&&dow<6&&holidays.indexOf(date)<0&&count++,date++,dow=(dow+1)%7;return count})).args([["start_date","date"],["end_date","date"],["holidays",["collect","date"]]]),defineFunction("days",(function(end,start){return end-start})).args([["*start_date","date"],["*end_date","date"]]),calc.runtime._days_360=_days_360,defineFunction("days360",_days_360).args([["*start_date","date"],["*end_date","date"],["*method",["or","logical",["null",!1]]]]),defineFunction("yearfrac",(function(start,end,method){switch(method){case 0:return _days_360(start,end,!1)/360;case 1:return(end-start)/daysInYear(unpackDate(start).year);case 2:return(end-start)/360;case 3:return(end-start)/365;case 4:return _days_360(start,end,!0)/360}})).args([["*start_date","date"],["*end_date","date"],["*method",["or",["null",0],["values",0,1,2,3,4]]]]),defineFunction("datevalue",(function(text){var date=calc.runtime.parseDate(text);return date?calc.runtime.dateToSerial(date):new CalcError("VALUE")})).args([["*text","string"]]),defineFunction("timevalue",(function(text){var m=text.toLowerCase().match(/(\d+):(\d+)(:(\d+)(\.(\d+))?)?\s*(am?|pm?)?/);if(m){var hh=parseFloat(m[1]),mm=parseFloat(m[2]),ss=m[3]?parseFloat(m[4]):0,ampm=m[7];return ampm&&(hh>12||hh<1)?new CalcError("VALUE"):(/^p/.test(ampm)&&(hh+=12),calc.runtime.packTime(hh,mm,ss,0))}return new CalcError("VALUE")})).args([["*text","string"]]),defineFunction("mdeterm",(function(m){return m.each((function(val){if("number"!=typeof val)return new CalcError("VALUE")}),!0)||m.determinant()})).args([["m",["and","matrix",["assert","$m.width == $m.height"]]]]),defineFunction("transpose",(function(m){return m.transpose()})).args([["range","matrix"]]),defineFunction("mmult",(function(a,b){return a.multiply(b)})).args([["a","matrix"],["b",["and","matrix",["assert","$b.height == $a.width"]]]]),defineFunction("munit",(function(n){return new Matrix(this).unit(n)})).args([["n","integer+"]]),defineFunction("minverse",(function(m){return m.each((function(val){if("number"!=typeof val)return new CalcError("VALUE")}),!0)||m.inverse()||new CalcError("VALUE")})).args([["m",["and","matrix",["assert","$m.width == $m.height"]]]]),defineFunction("rand",(function(){return Math.random()})).args([]),defineFunction("randbetween",(function(min,max){return min+Math.floor((max-min+1)*Math.random())})).args([["min","integer"],["max",["and","integer",["assert","$max >= $min"]]]]),defineFunction("true",(function(){return!0})).args([]),defineFunction("false",(function(){return!0})).args([]),defineFunction("roman",(function(num){return function arabicToRoman(n){let literals={1:"i",10:"x",100:"c",2:"ii",20:"xx",200:"cc",3:"iii",30:"xxx",300:"ccc",4:"iv",40:"xl",400:"cd",5:"v",50:"l",500:"d",6:"vi",60:"lx",600:"dc",7:"vii",70:"lxx",700:"dcc",8:"viii",80:"lxxx",800:"dccc",9:"ix",90:"xc",900:"cm",1e3:"m"},values=[1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],roman="";for(;n>0;)n<values[0]?values.shift():(roman+=literals[values[0]],n-=values[0]);return roman}(num).toUpperCase()})).args([["*number","integer"]]),defineFunction("arabic",(function(rom){var num=function romanToArabic(r){r=r.toLowerCase();let digits={i:1,v:5,x:10,l:50,c:100,d:500,m:1e3},value=0,prev=0;for(let i=0;i<r.length;++i){let v=digits[r.charAt(i)];if(!v)return null;value+=v,v>prev&&(value-=2*prev),prev=v}return value}(rom);return null==num?new CalcError("VALUE"):num})).args([["*roman","string"]]),defineFunction("base",(function(number,radix,minLen){for(var str=number.toString(radix).toUpperCase();str.length<minLen;)str="0"+str;return str})).args([["*number","integer"],["*radix",["and","integer",["[between]",2,36]]],["*minLen",["or","integer+",["null",0]]]]),defineFunction("decimal",(function(text,radix){text=text.toUpperCase();for(var val=0,i=0;i<text.length;++i){var d=text.charCodeAt(i);if(d>=48&&d<=57)d-=48;else{if(!(d>=65&&d<55+radix))return new CalcError("VALUE");d-=55}val=val*radix+d}return val})).args([["*text","string"],["*radix",["and","integer",["[between]",2,36]]]]),defineFunction("char",(function(code){return String.fromCharCode(code)})).args([["*code","integer+"]]);var RX_NON_PRINTABLE=/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g;function Hyperlink(link,text){this.link=link,this.text=text}defineFunction("clean",(function(text){return text.replace(RX_NON_PRINTABLE,"")})).args([["*text","string"]]),defineFunction("code",(function(text){return text.charAt(0)})).args([["*text","string"]]),calc.runtime.defineAlias("unichar","char"),calc.runtime.defineAlias("unicode","code"),defineFunction("concatenate",(function(args){for(var out="",i=0;i<args.length;++i)out+=args[i];return out})).args([["+",["*text","string"]]]),defineFunction("dollar",(function(number,decimals){for(var format="$#,##0DECIMALS;($#,##0DECIMALS)",dec="",denomitator=1;decimals-- >0;)dec+="0";for(;++decimals<0;)denomitator*=10;return""!==dec?dec="."+dec:1!==denomitator&&(number=Math.round(number/denomitator)*denomitator),format=format.replace(/DECIMALS/g,dec),formatting.text(number,format)})).args([["*number","number"],["*decimals",["or","integer",["null",2]]]]),defineFunction("exact",(function(a,b){return a===b})).args([["*text1","string"],["*text2","string"]]),defineFunction("find",(function(substring,string,start){var pos=string.indexOf(substring,start-1);return pos<0?new CalcError("VALUE"):pos+1})).args([["*substring","string"],["*string","string"],["*start",["or","integer++",["null",1]]]]),defineFunction("fixed",(function(number,decimals,noCommas){var scale=Math.pow(10,decimals);number=Math.round(number*scale)/scale;var format=noCommas?"0":"#,##0";if(decimals>0)for(format+=".";decimals-- >0;)format+="0";return formatting.text(number,format)})).args([["*number","number"],["*decimals",["or","integer",["null",2]]],["*noCommas",["or","boolean",["null",!1]]]]),defineFunction("left",(function(text,length){return text.substr(0,length)})).args([["*text","string"],["*length",["or","integer+",["null",1]]]]),defineFunction("right",(function(text,length){return text.substr(-length)})).args([["*text","string"],["*length",["or","integer+",["null",1]]]]),defineFunction("len",(function(text){return text.length})).args([["*text","string"]]),defineFunction("lower",(function(text){return text.toLowerCase()})).args([["*text","string"]]),defineFunction("upper",(function(text){return text.toUpperCase()})).args([["*text","string"]]),defineFunction("ltrim",(function(text){return text.replace(/^\s+/,"")})).args([["*text","string"]]),defineFunction("rtrim",(function(text){return text.replace(/\s+$/,"")})).args([["*text","string"]]),defineFunction("trim",(function(text){return text.replace(/^\s+|\s+$/,"")})).args([["*text","string"]]),defineFunction("mid",(function(text,start,length){return text.substr(start-1,length)})).args([["*text","string"],["*start","integer++"],["*length","integer+"]]),defineFunction("proper",(function(text){return text.toLowerCase().replace(/\b./g,(function(s){return s.toUpperCase()}))})).args([["*text","string"]]),defineFunction("replace",(function(text,start,length,newText){return text.substr(0,--start)+newText+text.substr(start+length)})).args([["*text","string"],["*start","integer++"],["*length","integer+"],["*newText","string"]]),defineFunction("rept",(function(text,number){for(var out="";number-- >0;)out+=text;return out})).args([["*text","string"],["*number","integer+"]]),defineFunction("search",(function(substring,string,start){var pos=string.toLowerCase().indexOf(substring.toLowerCase(),start-1);return pos<0?new CalcError("VALUE"):pos+1})).args([["*substring","string"],["*string","string"],["*start",["or","integer++",["null",1]]]]),defineFunction("substitute",(function(text,oldText,newText,nth){if(oldText===newText)return text;var a=text.split(oldText);if(null==nth)return a.join(newText);text="",nth--;for(var i=0;i<a.length;++i)text+=a[i],i<a.length-1&&(text+=i===nth?newText:oldText);return text})).args([["*text","string"],["*oldText","string"],["*newText","string"],["*nth",["or","integer++","null"]]]),defineFunction("t",(function(value){return"string"==typeof value?value:""})).args([["*value","anyvalue"]]),defineFunction("text",(function(value,format){return formatting.text(value,format)})).args([["*value","anyvalue"],["*format","string"]]),defineFunction("value",(function(value){return"number"==typeof value?value:"boolean"==typeof value?+value:(value=(value+"").replace(/[$,]/g,""),value=parseFloat(value),isNaN(value)?new CalcError("VALUE"):value)})).args([["*value","anyvalue"]]),Hyperlink.prototype.toString=function(){return this.text},defineFunction("hyperlink",(function(link,text){return new Hyperlink(link,text)})).args([["*link","string"],["*text",["or","string",["null","$link"]]]]),defineFunction("iferror",(function(value,valueIfError){return value instanceof CalcError?valueIfError:value})).args([["*value","forced!"],["*value_if_error","anyvalue!"]]);var parseCriteria=function(){var RXCACHE=Object.create(null);function makeComparator(cmp,x){if("string"==typeof x){var num=parseFloat(x);isNaN(num)||num!=x||(x=num)}return function(a){var b=x;return"string"==typeof a&&"string"==typeof b&&(a=a.toLowerCase(),b=b.toLowerCase()),cmp(a,b)}}function lc(a){var num,str;return"string"==typeof a&&(a=a.toLowerCase()),/^[0-9.]+%$/.test(a)?(str=a.substr(0,a.length-1),num=parseFloat(str),isNaN(num)||num!=str||(a=num/100)):/^[0-9.]+$/.test(a)&&(num=parseFloat(a),isNaN(num)||num!=a||(a=num)),a}function compLT(a,b){return lc(a)<lc(b)}function compLTE(a,b){return lc(a)<=lc(b)}function compGT(a,b){return lc(a)>lc(b)}function compGTE(a,b){return lc(a)>=lc(b)}function compNE(a,b){return!compEQ(a,b)}function compEQ(a,b){return b instanceof RegExp?b.test(a):("string"!=typeof a&&"string"!=typeof b||(a=String(a),b=String(b)),lc(a)==lc(b))}return function(cmp){if("function"==typeof cmp)return cmp;var m;if(m=/^=(.*)$/.exec(cmp))return makeComparator(compEQ,m[1]);if(m=/^<>(.*)$/.exec(cmp))return makeComparator(compNE,m[1]);if(m=/^<=(.*)$/.exec(cmp))return makeComparator(compLTE,m[1]);if(m=/^<(.*)$/.exec(cmp))return makeComparator(compLT,m[1]);if(m=/^>=(.*)$/.exec(cmp))return makeComparator(compGTE,m[1]);if(m=/^>(.*)$/.exec(cmp))return makeComparator(compGT,m[1]);if(/[?*]/.exec(cmp)){var rx=RXCACHE[cmp];return rx||(rx=cmp.replace(/(~\?|~\*|[\]({\+\.\|\^\$\\})\[]|[?*])/g,(function(s){switch(s){case"~?":return"\\?";case"~*":return"\\*";case"?":return".";case"*":return".*";default:return"\\"+s}})),rx=RXCACHE[cmp]=new RegExp("^"+rx+"$","i")),makeComparator(compEQ,rx)}return makeComparator(compEQ,cmp)}}();function numericPredicate(val){return"number"==typeof val||"boolean"==typeof val||null==val||""===val}function ascending(a,b){return a===b?0:a<b?-1:1}function descending(a,b){return a===b?0:a<b?1:-1}defineFunction("ERF",(function(ll,ul){return null==ul?ERF(ll):ERF(ul)-ERF(ll)})).args([["lower_limit","number"],["upper_limit",["or","number","null"]]]),defineFunction("ERFC",ERFC).args([["x","number"]]),defineFunction("GAMMALN",GAMMALN).args([["x","number++"]]),defineFunction("GAMMA",GAMMA).args([["x","number"]]),defineFunction("GAMMA.DIST",GAMMA_DIST).args([["x","number+"],["alpha","number++"],["beta","number++"],["cumulative","logical"]]),defineFunction("GAMMA.INV",GAMMA_INV).args([["p",["and","number",["[between]",0,1]]],["alpha","number++"],["beta","number++"]]),defineFunction("NORM.S.DIST",NORM_S_DIST).args([["z","number"],["cumulative","logical"]]),defineFunction("NORM.S.INV",NORM_S_INV).args([["p",["and","number",["[between]",0,1]]]]),defineFunction("NORM.DIST",(function NORM_DIST(x,m,s,cumulative){if(!cumulative)return Math.exp(-(x-m)*(x-m)/(2*s*s))/(s*Math.sqrt(2*Math.PI));return NORM_S_DIST((x-m)/s,!0)})).args([["x","number"],["mean","number"],["stddev","number++"],["cumulative","logical"]]),defineFunction("NORM.INV",NORM_INV).args([["p",["and","number",["[between]",0,1]]],["mean","number"],["stddev","number++"]]),defineFunction("BETADIST",(function BETADIST(x,a,b,m,M){return betastd_cdf((x-m)/(M-m),a,b)})).args([["x","number"],["alpha","number++"],["beta","number++"],["A",["or","number",["null",0]]],["B",["or","number",["null",1]]],["?",["assert","$x >= $A","NUM"]],["?",["assert","$x <= $B","NUM"]],["?",["assert","$A < $B","NUM"]]]),defineFunction("BETA.DIST",(function BETA_DIST(x,a,b,cdf,m,M){if(cdf)return betastd_cdf((x-m)/(M-m),a,b);return function betastd_pdf(x,a,b){return Math.exp((a-1)*Math.log(x)+(b-1)*Math.log(1-x)-BETALN(a,b))}((x-m)/(M-m),a,b)/(M-m)})).args([["x","number"],["alpha","number++"],["beta","number++"],["cumulative","logical"],["A",["or","number",["null",0]]],["B",["or","number",["null",1]]],["?",["assert","$x >= $A","NUM"]],["?",["assert","$x <= $B","NUM"]],["?",["assert","$A < $B","NUM"]]]),defineFunction("BETA.INV",BETA_INV).args([["p",["and","number",["[between]",0,1]]],["alpha","number++"],["beta","number++"],["A",["or","number",["null",0]]],["B",["or","number",["null",1]]]]),defineFunction("CHISQ.DIST",chisq_left).args([["x","number+"],["deg_freedom","integer++"],["cumulative","logical"]]),defineFunction("CHISQ.DIST.RT",chisq_right).args([["x","number+"],["deg_freedom","integer++"]]),defineFunction("CHISQ.INV",chisq_left_inv).args([["p",["and","number",["[between]",0,1]]],["deg_freedom","integer++"]]),defineFunction("CHISQ.INV.RT",(function chisq_right_inv(p,n){return chisq_left_inv(1-p,n)})).args([["p",["and","number",["[between]",0,1]]],["deg_freedom","integer++"]]),defineFunction("CHISQ.TEST",(function(ac,ex){return function chisq_test(obsv,expect){var i,j,rows=obsv.length,cols=obsv[0].length,x=0;for(i=0;i<rows;i++)for(j=0;j<cols;j++){var eij=expect[i][j],delta=obsv[i][j]-eij;x+=(delta*=delta)/eij}return chisq_right(x,(rows-1)*(cols-1))}(ac.data,ex.data)})).args([["actual_range","matrix"],["expected_range","matrix"],["?",["assert","$actual_range.width == $expected_range.width"]],["?",["assert","$actual_range.height == $expected_range.height"]]]),defineFunction("EXPON.DIST",(function expon(x,r,cdf){if(cdf)return 1-Math.exp(-r*x);return r*Math.exp(-r*x)})).args([["x","number+"],["lambda","number++"],["cumulative","logical"]]),defineFunction("POISSON.DIST",(function poisson(k,m,cdf){if(cdf)return 1-chisq_left(2*m,2*(k+1),!0);for(var lnf=0,i=2;i<=k;i++)lnf+=Math.log(i);return Math.exp(k*Math.log(m)-m-lnf)})).args([["x","integer+"],["mean","number+"],["cumulative","logical"]]),defineFunction("F.DIST",Fdist).args([["x","number+"],["deg_freedom1","integer++"],["deg_freedom2","integer++"],["cumulative","logical"]]),defineFunction("F.DIST.RT",(function Fdist_right(x,n,d){return 1-Fdist(x,n,d,!0)})).args([["x","number+"],["deg_freedom1","integer++"],["deg_freedom2","integer++"]]),defineFunction("F.INV",(function Finv(p,n,d){return d/n*(1/BETA_INV(1-p,d/2,n/2,0,1)-1)})).args([["p",["and","number",["[between]",0,1]]],["deg_freedom1","integer++"],["deg_freedom2","integer++"]]),defineFunction("F.INV.RT",(function Finv_right(p,n,d){return d/n*(1/BETA_INV(p,d/2,n/2,0,1)-1)})).args([["p",["and","number",["[between]",0,1]]],["deg_freedom1","integer++"],["deg_freedom2","integer++"]]),defineFunction("F.TEST",(function Ftest(arr1,arr2){var n1=arr1.length-1,n2=arr2.length-1,va1=_var_sq(arr1,_mean(arr1)),va2=_var_sq(arr2,_mean(arr2));if(!va1||!va2)throw new CalcError("DIV/0");return 2*Fdist(va1/va2,n1,n2,!0)})).args([["array1",["collect","number",1]],["array2",["collect","number",1]],["?",["assert","$array1.length >= 2","DIV/0"]],["?",["assert","$array2.length >= 2","DIV/0"]]]),defineFunction("FISHER",(function fisher(x){return.5*Math.log((1+x)/(1-x))})).args([["x",["and","number",["(between)",-1,1]]]]),defineFunction("FISHERINV",(function fisherinv(x){var e2=Math.exp(2*x);return(e2-1)/(e2+1)})).args([["y","number"]]),defineFunction("T.DIST",Tdist).args([["x","number"],["deg_freedom","integer++"],["cumulative","logical"]]),defineFunction("T.DIST.RT",Tdist_right).args([["x","number"],["deg_freedom","integer++"]]),defineFunction("T.DIST.2T",Tdist_2tail).args([["x","number+"],["deg_freedom","integer++"]]),defineFunction("T.INV",Tdist_inv).args([["p",["and","number",["(between]",0,1]]],["deg_freedom","integer++"]]),defineFunction("T.INV.2T",(function Tdist_2tail_inv(p,n){return Tdist_inv(1-p/2,n)})).args([["p",["and","number",["(between]",0,1]]],["deg_freedom","integer++"]]),defineFunction("T.TEST",(function Tdist_test(gr1,gr2,tail,type){var t_st,df,n1=gr1.length,n2=gr2.length;if(1==type){for(var d=0,d2=0,i=0;i<n1;i++){var delta=gr1[i]-gr2[i];d+=delta,d2+=delta*delta}var md=d/n1;return t_st=md/Math.sqrt((d2-d*md)/(n1*(n1-1))),1==tail?Tdist_right(t_st,n1-1):Tdist_2tail(t_st,n1-1)}var m1=_mean(gr1),m2=_mean(gr2),v1=_var_sq(gr1,m1),v2=_var_sq(gr2,m2);if(3==type){var u1=v1/n1,u2=v2/n2,u=u1+u2,q1=u1/u,q2=u2/u;return df=1/(q1*q1/(n1-1)+q2*q2/(n2-1)),t_st=f_abs(m1-m2)/Math.sqrt(u),1==tail?Tdist_right(t_st,df):Tdist_2tail(t_st,df)}return df=n1+n2-2,t_st=f_abs(m1-m2)*Math.sqrt(df*n1*n2/((n1+n2)*((n1-1)*v1+(n2-1)*v2))),1==tail?Tdist_right(t_st,df):Tdist_2tail(t_st,df)})).args([["array1",["collect","number",1]],["array2",["collect","number",1]],["tails",["and","integer",["values",1,2]]],["type",["and","integer",["values",1,2,3]]],["?",["assert","$type != 1 || $array1.length == $array2.length","N/A"]],["?",["assert","$array1.length >= 2","DIV/0"]],["?",["assert","$array2.length >= 2","DIV/0"]]]),defineFunction("CONFIDENCE.T",(function confidence_t(alpha,stddev,size){return-Tdist_inv(alpha/2,size-1)*stddev/Math.sqrt(size)})).args([["alpha",["and","number",["(between)",0,1]]],["standard_dev","number++"],["size",["and","integer++",["assert","$size != 1","DIV/0"]]]]),defineFunction("CONFIDENCE.NORM",(function confidence_norm(alpha,stddev,size){return-NORM_S_INV(alpha/2)*stddev/Math.sqrt(size)})).args([["alpha",["and","number",["(between)",0,1]]],["standard_dev","number++"],["size",["and","integer++"]]]),defineFunction("GAUSS",(function gauss(z){return NORM_S_DIST(z,!0)-.5})).args([["z","number"]]),defineFunction("PHI",(function phi(x){return NORM_S_DIST(x)})).args([["x","number"]]),defineFunction("LOGNORM.DIST",(function lognorm_dist(x,m,s,cumulative){if(cumulative)return.5+.5*ERF((Math.log(x)-m)/(s*Math.sqrt(2)));var t=Math.log(x)-m;return Math.exp(-t*t/(2*s*s))/(x*s*Math.sqrt(2*Math.PI))})).args([["x","number++"],["mean","number"],["standard_dev","number++"],["cumulative","logical"]]),defineFunction("LOGNORM.INV",(function lognorm_inv(p,m,s){return Math.exp(NORM_INV(p,m,s))})).args([["probability",["and","number",["(between)",0,1]]],["mean","number"],["standard_dev","number++"]]),defineFunction("PROB",(function prob(x_,p_,lw,up){var i,n=x_.length,s=0;for(i=0;i<n;i++){if(p_[i]<=0||p_[i]>1)throw new CalcError("NUM");s+=p_[i]}if(1!=s)throw new CalcError("NUM");var res=0;for(i=0;i<n;i++){var x=x_[i];x>=lw&&x<=up&&(res+=p_[i])}return res})).args([["x_range",["collect","number",1]],["prob_range",["collect","number",1]],["lower_limit","number"],["upper_limit",["or","number",["null","$lower_limit"]]],["?",["assert","$prob_range.length == $x_range.length","N/A"]]]),defineFunction("SLOPE",(function slope(y_,x_){for(var mx=_mean(x_),my=_mean(y_),b1=0,b2=0,i=0,n=y_.length;i<n;i++){var t=x_[i]-mx;b1+=t*(y_[i]-my),b2+=t*t}return b1/b2})).args([["known_y",["collect","number",1]],["known_x",["collect","number",1]],["?",["assert","$known_x.length == $known_y.length","N/A"]],["?",["assert","$known_x.length > 0 && $known_y.length > 0","N/A"]]]),defineFunction("INTERCEPT",(function intercept(y_,x_){for(var mx=_mean(x_),my=_mean(y_),b1=0,b2=0,i=0,n=y_.length;i<n;i++){var t=x_[i]-mx;b1+=t*(y_[i]-my),b2+=t*t}return my-b1*mx/b2})).args([["known_y",["collect","number",1]],["known_x",["collect","number",1]],["?",["assert","$known_x.length == $known_y.length","N/A"]],["?",["assert","$known_x.length > 0 && $known_y.length > 0","N/A"]]]),defineFunction("PEARSON",pearson).args([["array1",["collect!","anything",1]],["array2",["collect!","anything",1]],["?",["assert","$array2.length == $array1.length","N/A"]],["?",["assert","$array2.length > 0 && $array1.length > 0","N/A"]]]),defineFunction("RSQ",(function rsq(x_,y_){var r=pearson(x_,y_);return r*r})).args([["known_y",["collect","number",1]],["known_x",["collect","number",1]],["?",["assert","$known_x.length == $known_y.length","N/A"]],["?",["assert","$known_x.length > 0 && $known_y.length > 0","N/A"]],["?",["assert","$known_x.length != 1 && $known_y.length != 1","N/A"]]]),defineFunction("STEYX",(function steyx(y_,x_){for(var n=x_.length,mx=_mean(x_),my=_mean(y_),s1=0,s2=0,s3=0,i=0;i<n;i++){var t1=x_[i]-mx,t2=y_[i]-my;s1+=t2*t2,s2+=t1*t2,s3+=t1*t1}return Math.sqrt((s1-s2*s2/s3)/(n-2))})).args([["known_y",["collect","number",1]],["known_x",["collect","number",1]],["?",["assert","$known_x.length == $known_y.length","N/A"]],["?",["assert","$known_x.length >= 3 && $known_y.length >= 3","DIV/0"]]]),defineFunction("FORECAST",(function forecast(x,y_,x_){for(var mx=_mean(x_),my=_mean(y_),s1=0,s2=0,i=0,n=x_.length;i<n;i++){var t1=x_[i]-mx;s1+=t1*(y_[i]-my),s2+=t1*t1}if(0===s2)throw new CalcError("N/A");var b=s1/s2;return my-b*mx+b*x})).args([["x","number"],["known_y",["collect","number",1]],["known_x",["collect","number",1]],["?",["assert","$known_x.length == $known_y.length","N/A"]],["?",["assert","$known_x.length > 0 && $known_y.length > 0","N/A"]]]),defineFunction("LINEST",linest).args([["known_y","matrix"],["known_x",["or","matrix","null"]],["const",["or","logical",["null",!0]]],["stats",["or","logical",["null",!1]]]]),defineFunction("LOGEST",(function logest(Y,X,konst,stats){return linest.call(this,Y.map(Math.log),X,konst,stats).map(Math.exp)})).args([["known_y","matrix"],["known_x",["or","matrix","null"]],["const",["or","logical",["null",!0]]],["stats",["or","logical",["null",!1]]]]),defineFunction("TREND",trend).args([["known_y","matrix"],["known_x",["or","matrix","null"]],["new_x",["or","matrix","null"]],["const",["or","logical",["null",!0]]]]),defineFunction("GROWTH",(function growth(Y,X,new_X,konst){return trend.call(this,Y.map(Math.log),X,new_X,konst).map(Math.exp)})).args([["known_y","matrix"],["known_x",["or","matrix","null"]],["new_x",["or","matrix","null"]],["const",["or","logical",["null",!0]]]]),defineFunction("FV",FV).args([["rate","number"],["nper","number"],["pmt",["or","number",["null",0]]],["pv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]],["?",["assert","$pmt || $pv"]]]),defineFunction("PV",(function PV(rate,nper,pmt,fv,type){if(!rate)return-fv-pmt*nper;var h1=Math.pow(1+rate,nper);return-(fv+pmt*(h1-1)/rate*(1+rate*type))/h1})).args([["rate","number"],["nper","number"],["pmt",["or","number",["null",0]]],["fv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]]]),defineFunction("PMT",PMT).args([["rate","number"],["nper","number"],["pmt","number"],["fv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]]]),defineFunction("NPER",(function NPER(rate,pmt,pv,fv,type){if(!rate)return-(fv+pv)/pmt;var h1=pmt*(1+rate*type);return Math.log((h1-fv*rate)/(h1+pv*rate))/Math.log(1+rate)})).args([["rate","number"],["pmt","number"],["pv","number"],["fv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]]]),defineFunction("RATE",(function RATE(nper,pmt,pv,fv,type,guess){return root_newton((function xfd(x){var h2=Math.pow(1+x,nper-1),h1=h2*(1+x);return[pv*h1+pmt*(1/x+type)*(h1-1)+fv,nper*pv*h2+pmt*(-(h1-1)/(x*x)+(1/x+type)*nper*h2)]}),guess)})).args([["nper","number"],["pmt",["or","number",["null",0]]],["pv","number"],["fv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]],["guess",["or","number++",["null",.01]]],["?",["assert","$pmt || $fv"]]]),defineFunction("IPMT",IPMT).args([["rate","number"],["per","number++"],["nper","number++"],["pv","number"],["fv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]],["?",["assert","$per >= 1 && $per <= $nper"]]]),defineFunction("PPMT",(function PPMT(rate,per,nper,pv,fv,type){return PMT(rate,nper,pv,fv,type)-IPMT(rate,per,nper,pv,fv,type)})).args([["rate","number"],["per","number++"],["nper","number++"],["pv","number"],["fv",["or","number",["null",0]]],["type",["or",["values",0,1],["null",0]]],["?",["assert","$per >= 1 && $per <= $nper"]]]),defineFunction("CUMPRINC",(function CUMPRINC(rate,nper,pv,start,end,type){1==type&&(start--,end--);var tn=Math.pow(1+rate,nper),ts=Math.pow(1+rate,start-1),te=Math.pow(1+rate,end),monthlyPayment=rate*pv*tn/(tn-1);return te*pv-(te-1)/rate*monthlyPayment-(ts*pv-(ts-1)/rate*monthlyPayment)})).args([["rate","number++"],["nper","number++"],["pv","number++"],["start_period","number++"],["end_period","number++"],["type",["or",["values",0,1],["null",0]]],["?",["assert","$end_period >= $start_period","NUM"]]]),defineFunction("CUMIPMT",(function CUMIPMT(rate,nper,pv,start,end,type){for(var cip=0,i=start;i<=end;i++)cip+=IPMT(rate,i,nper,pv,0,type);return cip})).args([["rate","number++"],["nper","number++"],["pv","number++"],["start_period","number++"],["end_period","number++"],["type",["or",["values",0,1],["null",0]]],["?",["assert","$end_period >= $start_period","NUM"]]]),defineFunction("NPV",(function NPV(rate,flows){for(var npv=0,i=0,n=flows.length;i<n;i++)npv+=flows[i]*Math.pow(1+rate,-i-1);return npv})).args([["rate","number"],["values",["collect","number"]],["?",["assert","$values.length > 0","N/A"]]]),defineFunction("IRR",(function IRR(flows,guess){return root_newton((function xfd(x){for(var npv=0,npv1=0,j=0,n=flows.length;j<n;j++)npv+=flows[j]*Math.pow(1+x,-j-1),npv1+=-j*flows[j]*Math.pow(1+x,-j-2);return[npv,npv1]}),guess)})).args([["values",["collect","number",1]],["guess",["or","number",["null",.1]]]]),defineFunction("EFFECT",(function EFFECT(nominal_rate,npery){return Math.pow(1+nominal_rate/npery,npery)-1})).args([["nominal_rate","number++"],["npery","integer++"]]),defineFunction("NOMINAL",(function NOMINAL(effect_rate,npery){return npery*(Math.pow(effect_rate+1,1/npery)-1)})).args([["effect_rate","number++"],["npery","integer++"]]),defineFunction("XNPV",(function XNPV(rate,values,dates){for(var npv=0,i=0,n=values.length;i<n;i++)npv+=values[i]*Math.pow(1+rate,(dates[0]-dates[i])/365);return npv})).args([["rate","number"],["values",["collect","number",1]],["dates",["collect","date",1]],["?",["assert","$values.length == $dates.length","NUM"]]]),defineFunction("XIRR",(function XIRR(values,dates,guess){return root_newton((function xfd(x){for(var npv=values[0],npv1=0,j=1,n=values.length;j<n;j++){var delta=(dates[0]-dates[j])/365;npv+=values[j]*Math.pow(1+x,delta),npv1+=delta*values[j]*Math.pow(1+x,delta-1)}return[npv,npv1]}),guess)})).args([["values",["collect","number",1]],["dates",["collect","date",1]],["guess",["or","number",["null",.1]]],["?",["assert","$values.length == $dates.length","NUM"]]]),defineFunction("ISPMT",(function ISPMT(rate,per,nper,pv){return-pv*rate*(1-per/nper)})).args([["rate","number"],["per","number++"],["nper","number++"],["pv","number"],["?",["assert","$per >= 1 && $per <= $nper"]]]),defineFunction("DB",(function DB(cost,salvage,life,period,month){var rate=1-Math.pow(salvage/cost,1/life);rate=Math.floor(1e3*rate+.5)/1e3;var db=cost*rate*month/12;if(1==period)return db;for(var i=1;i<life;i++){if(i==period-1)return(cost-db)*rate;db+=(cost-db)*rate}return(cost-db)*rate*(12-month)/12})).args([["cost","number"],["salvage","number"],["life","number++"],["period","number++"],["month",["or","number",["null",12]]]]),defineFunction("DDB",(function DDB(cost,salvage,life,period,factor){var f=factor/life,prior=-cost*(Math.pow(1-f,period-1)-1),dep=(cost-prior)*f;return dep=Math.min(dep,Math.max(0,cost-prior-salvage))})).args([["cost","number"],["salvage","number"],["life","number++"],["period","number++"],["factor",["or","number",["null",2]]]]),defineFunction("SLN",(function SLN(cost,salvage,life){return(cost-salvage)/life})).args([["cost","number"],["salvage","number"],["life","number++"]]),defineFunction("SYD",(function SYD(cost,salvage,life,per){return(cost-salvage)*(life-per+1)*2/(life*(life+1))})).args([["cost","number"],["salvage","number"],["life","number++"],["per","number++"]]),defineFunction("VDB",(function VDB(cost,salvage,life,start,end,factor,no_switch){var interest=factor>=life?1:factor/life;function _getGDA(value,period){var gda,oldValue,newValue;return oldValue=1==interest?1==period?value:0:value*Math.pow(1-interest,period-1),(gda=(newValue=value*Math.pow(1-interest,period))<salvage?oldValue-salvage:oldValue-newValue)<0?0:gda}function _interVDB(cost,life1,period){for(var term,remValue=cost-salvage,intEnd=Math.ceil(period),lia=0,vdb=0,nowLia=!1,i=1;i<=intEnd;i++){if(nowLia)term=lia;else{var gda=_getGDA(cost,i);(lia=remValue/(life1-i+1))>gda?(term=lia,nowLia=!0):(term=gda,remValue-=gda)}i==intEnd&&(term*=period+1-intEnd),vdb+=term}return vdb}var intStart=Math.floor(start),intEnd=Math.ceil(end),vdb=0;if(no_switch)for(var i=intStart+1;i<=intEnd;i++){var term=_getGDA(cost,i);i==intStart+1?term*=Math.min(end,intStart+1)-start:i==intEnd&&(term*=end+1-intEnd),vdb+=term}else{var life1=life;if(start!=Math.floor(start)&&factor>1&&start>=life/2){var part=start-life/2;start=life/2,end-=part,life1+=1}cost-=_interVDB(cost,life1,start),vdb=_interVDB(cost,life-start,end-start)}return vdb})).args([["cost","number+"],["salvage","number+"],["life","number++"],["start_period","number+"],["end_period","number+"],["factor",["or","number+",["null",2]]],["no_switch",["or","logical",["null",!1]]],["?",["assert","$end_period >= $start_period","NUM"]]]);var COUPS_ARGS=[["settlement","date"],["maturity","date"],["frequency",["and","integer",["values",1,2,4]]],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$settlement < $maturity","NUM"]]];defineFunction("COUPDAYBS",(function COUPDAYBS(settlement,maturity,frequency,basis){return _daysBetween(_borderCoupons(settlement,maturity,frequency)[0],settlement,basis)})).args(COUPS_ARGS),defineFunction("COUPDAYS",(function COUPDAYS(settl,matur,freq,basis){if(1==basis){var borders=_borderCoupons(settl,matur,freq);return _daysBetween(borders[0],borders[1],1)}if(3==basis)return 365/freq;return 360/freq})).args(COUPS_ARGS),defineFunction("COUPDAYSNC",(function COUPDAYSNC(settl,matur,freq,basis){var next=_borderCoupons(settl,matur,freq)[1];return _daysBetween(settl,next,basis)})).args(COUPS_ARGS),defineFunction("COUPPCD",(function COUPPCD(settl,matur,freq){return _borderCoupons(settl,matur,freq)[0]})).args(COUPS_ARGS),defineFunction("COUPNCD",(function COUPNCD(settl,matur,freq){return _borderCoupons(settl,matur,freq)[1]})).args(COUPS_ARGS),defineFunction("COUPNUM",(function COUPNUM(settl,matur,freq){var sett=unpackDate(settl),mat=unpackDate(matur);return 1+((12*(mat.year-sett.year)+mat.month-sett.month)*freq/12|0)})).args(COUPS_ARGS),defineFunction("ACCRINTM",(function ACCRINTM(issue,maturity,rate,par,basis){var year_days=daysInYear2(unpackDate(maturity).year,basis);return rate*par*_daysBetween(issue,maturity,basis)/year_days})).args([["issue","date"],["settlement","date"],["rate","number++"],["par",["or",["null",1e3],"number++"]],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$issue < $settlement","NUM"]]]),defineFunction("ACCRINT",(function ACCRINT(issue,first,settl,rate,par,freq,basis,calc){var brace,prev,next,prev1,next1,nrc,accr=0,cost=par*rate/freq,annual=basis%2==0?360:365;function _numCoupons(from,to){return(to-from)*freq/annual|0}return settl<=first?(prev=(brace=_borderCoupons(settl,first,freq))[0],next=brace[1],prev<=issue?cost*_daysBetween(issue,settl,basis)/_daysBetween(prev,next,basis):(prev1=(brace=_borderCoupons(issue,prev,freq))[0],cost*((nrc=_numCoupons(next1=brace[1],settl))+_daysBetween(issue,next1,basis)/_daysBetween(prev1,next1,basis)+(settl<next?_daysBetween(prev,settl,basis)/_daysBetween(prev,next,basis):0)))):(brace=function _borderCoupons_fw(first,settlement,freq){var sett=unpackDate(settlement),base=unpackDate(first),periods=sett.year-base.year;periods>0&&(periods=(periods-1)*freq);var next,prev=first,months=12/freq;for(;settlement>prev;)next=prev,prev=_edate(first,++periods*months);return[next,prev]}(first,settl,freq),prev=brace[0],next=brace[1],nrc=_numCoupons(first,settl),accr=next==settl?cost*nrc:cost*(nrc+_daysBetween(prev,settl,basis)/_daysBetween(prev,next,basis)),calc?(prev=(brace=_borderCoupons(issue,first,freq))[0],next=brace[1],accr+=cost*((nrc=_numCoupons(issue,first))+_daysBetween(issue,next,basis)/_daysBetween(prev,next,basis))):accr)})).args([["issue","date"],["first_interest","date"],["settlement","date"],["rate","number++"],["par",["or",["null",1e3],"number++"]],["frequency",["and","integer",["values",1,2,4]]],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["calc_method",["or","logical",["null",!0]]],["?",["assert","$issue < $settlement","NUM"]]]),defineFunction("DISC",(function DISC(settl,matur,pr,redemption,basis){var annual=basis%2==0?360:isLeapYear(unpackDate(settl).year)?366:365;return(redemption-pr)/redemption*annual/_daysBetween(settl,matur,basis)})).args([["settlement","date"],["maturity","date"],["pr","number++"],["redemption","number++"],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$settlement < $maturity","NUM"]]]),defineFunction("INTRATE",(function INTRATE(settl,matur,investment,redemption,basis){var annual=basis%2==0?360:isLeapYear(unpackDate(settl).year)?366:365;return(redemption-investment)/investment*annual/_daysBetween(settl,matur,basis)})).args([["settlement","date"],["maturity","date"],["investment","number++"],["redemption","number++"],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$settlement < $maturity","NUM"]]]),defineFunction("RECEIVED",(function RECEIVED(settl,matur,investment,discount,basis){var annual=basis%2==0?360:isLeapYear(unpackDate(settl).year)?366:365;return investment/(1-discount*_daysBetween(settl,matur,basis)/annual)})).args([["settlement","date"],["maturity","date"],["investment","number++"],["discount","number++"],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$settlement < $maturity","NUM"]]]),defineFunction("PRICE",(function PRICE(settl,matur,rate,yld,redemption,freq,basis){var N=1+((matur-settl)*freq/(basis%2==0?360:365)|0),brace=_borderCoupons(settl,matur,freq),prev=brace[0],next=brace[1],beg_settl=_daysBetween(prev,settl,basis),settl_end=_daysBetween(settl,next,basis),beg_end=_daysBetween(prev,next,basis),den=100*rate/freq,yf=yld/freq,frac=settl_end/beg_end;if(1==N)return(redemption+den)/(1+frac*yf)-beg_settl/beg_end*den;return redemption/Math.pow(1+yf,N-1+frac)+den*Math.pow(1+yf,1-N-frac)*(Math.pow(1+yf,N)-1)/yf-beg_settl/beg_end*den})).args([["settlement","date"],["maturity","date"],["rate","number++"],["yld","number++"],["redemption","number++"],["frequency",["and","integer",["values",1,2,4]]],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$settlement < $maturity","NUM"]]]),defineFunction("PRICEDISC",(function PRICEDISC(settl,matur,discount,redemption,basis){var dsm=_daysBetween(settl,matur,basis),dy=daysInYear2(unpackDate(matur).year,basis);return redemption-discount*redemption*dsm/dy})).args([["settlement","date"],["maturity","date"],["discount","number++"],["redemption","number++"],["basis",["or",["null",0],["and","integer",["values",0,1,2,3,4]]]],["?",["assert","$settlement < $maturity","NUM"]]]);var MAX_IT=300,EPS=22204e-20,FP_MIN=1e-30,f_abs=Math.abs;function ERF(x){if(f_abs(x)>=3.3)return 1-ERFC(x);var S=x>0?1:-1;-1==S&&(x=-x);for(var m=0,an=1,n=1;n<100;n++)m+=an,an*=2*x*x/(2*n+1);return 2*S/Math.sqrt(Math.PI)*x*Math.exp(-x*x)*m}function ERFC(x){if(f_abs(x)<3.3)return 1-ERF(x);var s=1;x<0&&(s=-1,x=-x);for(var frac=x,n=8;n>=1;n-=.5)frac=x+n/frac;return frac=1/(x+frac),1==s?Math.exp(-x*x)/Math.sqrt(Math.PI)*frac:2-Math.exp(-x*x)/Math.sqrt(Math.PI)*frac}function GAMMALN(x){var cof=[1.000000000190015,76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],y=x,tmp=x+5.5,ser=cof[0];tmp-=(x+.5)*Math.log(tmp);for(var j=1;j<=6;j++)ser+=cof[j]/(y+=1);return-tmp+Math.log(Math.sqrt(2*Math.PI)*ser/x)}function GAMMA(x){if(x>0)return Math.exp(GAMMALN(x));var pi=Math.PI,y=-x;return-pi/(y*GAMMA(y)*Math.sin(pi*y))}function BETALN(a,b){return GAMMALN(a)+GAMMALN(b)-GAMMALN(a+b)}function BETA(a,b){return Math.exp(BETALN(a,b))}function gamma_inc(a,x){return x<a+1?function g_series(a,x){var n,sum=1/a,frac=sum,ap=a,gln=GAMMALN(a);for(n=1;n<=MAX_IT&&(sum+=frac*=x/++ap,!(f_abs(frac)<f_abs(sum)*EPS));n++);return sum*Math.exp(-x+a*Math.log(x)-gln)}(a,x):1-function g_contfrac(a,x){for(var f=FP_MIN,c=f,d=0,aj=1,bj=x+1-a,gln=GAMMALN(a),i=1;i<=MAX_IT;i++){f_abs(d=bj+aj*d)<FP_MIN&&(d=FP_MIN),f_abs(c=bj+aj/c)<FP_MIN&&(c=FP_MIN);var delta=c*(d=1/d);if(f*=delta,f_abs(delta-1)<EPS)break;bj+=2,aj=-i*(i-a)}return f*Math.exp(-x-gln+a*Math.log(x))}(a,x)}function GAMMA_DIST(x,a,b,cumulative){return cumulative?gamma_inc(a,x/b):Math.pow(x/b,a-1)*Math.exp(-x/b)/(b*GAMMA(a))}function GAMMA_INV(p,a,b){if(0===p)return 0;if(1==p)return 1/0;var m=0,M=10,x=0,ab=a*b;ab>1&&(M*=ab);for(var i=0;i<MAX_IT;i++){var q=GAMMA_DIST(x=.5*(m+M),a,b,!0);if(f_abs(p-q)<1e-16)break;q>p?M=x:m=x}return x}function NORM_S_DIST(x,cumulative){return cumulative?.5+.5*ERF(x/Math.sqrt(2)):Math.exp(-x*x/2)/Math.sqrt(2*Math.PI)}function NORM_S_INV(p){var q,r,a=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],b=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],c=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],d=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416];return p<.02425?(q=Math.sqrt(-2*Math.log(p)),(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5])/((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1)):.97575<p?(q=Math.sqrt(-2*Math.log(1-p)),-(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5])/((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1)):(((((a[0]*(r=(q=p-.5)*q)+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])*q/(((((b[0]*r+b[1])*r+b[2])*r+b[3])*r+b[4])*r+1)}function NORM_INV(p,m,s){return m+s*NORM_S_INV(p)}function betastd_cdf(x,a,b){var k=Math.exp(a*Math.log(x)+b*Math.log(1-x)-BETALN(a,b));return x<(a+1)/(a+b+2)?k*beta_lentz(a,b,x)/a:1-k*beta_lentz(b,a,1-x)/b}function beta_lentz(a,b,x){var m,m2,aa,c,d,del,h,qab,qam,qap;for(qam=a-1,c=1,f_abs(d=1-(qab=a+b)*x/(qap=a+1))<FP_MIN&&(d=FP_MIN),h=d=1/d,m=1;m<=MAX_IT&&(f_abs(d=1+(aa=m*(b-m)*x/((qam+(m2=2*m))*(a+m2)))*d)<FP_MIN&&(d=FP_MIN),f_abs(c=1+aa/c)<FP_MIN&&(c=FP_MIN),h*=(d=1/d)*c,f_abs(d=1+(aa=-(a+m)*(qab+m)*x/((a+m2)*(qap+m2)))*d)<FP_MIN&&(d=FP_MIN),f_abs(c=1+aa/c)<FP_MIN&&(c=FP_MIN),h*=del=(d=1/d)*c,!(f_abs(del-1)<EPS));m++);return h}function betastd_inv(p,a,b){for(var m=0,M=1,x=0,i=0;i<MAX_IT;i++){var q=betastd_cdf(x=.5*(m+M),a,b);if(f_abs(p-q)<EPS)break;q>p?M=x:m=x}return x}function BETA_INV(p,a,b,m,M){return m+(M-m)*betastd_inv(p,a,b)}function chisq_left(x,n,cds){return GAMMA_DIST(x,n/2,2,cds)}function chisq_right(x,n){return 1-chisq_left(x,n,!0)}function chisq_left_inv(p,n){return GAMMA_INV(p,n/2,2)}function Fdist(x,n,d,cdf){if(cdf)return betastd_cdf(n*x/(d+n*x),n/2,d/2);var u=n/d;return u/BETA(n/=2,d/=2)*Math.pow(u*x,n-1)/Math.pow(1+u*x,n+d)}function _mean(arr){for(var me=0,n=arr.length,i=0;i<n;i++)me+=arr[i];return me/n}function _var_sq(arr,m){for(var v=0,n=arr.length,i=0;i<n;i++){var delta=arr[i]-m;v+=delta*delta}return v/(n-1)}function Tdist(x,n,cdf){return cdf?1-.5*betastd_cdf(n/(x*x+n),n/2,.5):1/(Math.sqrt(n)*BETA(.5,n/2))*Math.pow(1+x*x/n,-(n+1)/2)}function Tdist_right(x,n){return 1-Tdist(x,n,!0)}function Tdist_2tail(x,n){return x<0&&(x=-x),2*Tdist_right(x,n)}function Tdist_inv(p,n){var x=betastd_inv(2*Math.min(p,1-p),n/2,.5);return x=Math.sqrt(n*(1-x)/x),p>.5?x:-x}function pearson(x_,y_){!function whipNumberArrays(a,b){for(var i=a.length;--i>=0;)"number"==typeof a[i]&&"number"==typeof b[i]||(a.splice(i,1),b.splice(i,1))}(x_,y_);for(var mx=_mean(x_),my=_mean(y_),s1=0,s2=0,s3=0,i=0,n=x_.length;i<n;i++){var t1=x_[i]-mx,t2=y_[i]-my;s1+=t1*t2,s2+=t1*t1,s3+=t2*t2}return s1/Math.sqrt(s2*s3)}function _mat_mean(Mat){for(var n=Mat.height,sum=0,i=0;i<n;i++)sum+=Mat.data[i][0];return sum/n}function _mat_devsq(Mat,mean){for(var n=Mat.height,sq=0,i=0;i<n;i++){var x=Mat.data[i][0]-mean;sq+=x*x}return sq}function linest(Y,X,konst,stats){var i=0;X||(X=Y.map((function(){return++i}))),konst&&((X=X.clone()).eachRow((function(row){X.data[row].unshift(1)})),++X.width);var Xt=X.transpose(),B=Xt.multiply(X).inverse().multiply(Xt).multiply(Y),line_1=[];for(i=B.height-1;i>=0;i--)line_1.push(B.data[i][0]);if(konst||line_1.push(0),!stats)return this.asMatrix([line_1]);var Y1=X.multiply(B),y_y1=Y.adds(Y1,!0),SSreg=_mat_devsq(Y1,konst?_mat_mean(Y1):0),SSresid=_mat_devsq(y_y1,konst?_mat_mean(y_y1):0),line_5=[];line_5.push(SSreg,SSresid);var R2=SSreg/(SSreg+SSresid),degfre=Y.height-X.width,err_est=Math.sqrt(SSresid/degfre),line_3=[];line_3.push(R2,err_est);var F_sta=konst?SSreg/(X.width-1)/(SSresid/degfre):R2/X.width/((1-R2)/degfre),line_4=[];line_4.push(F_sta,degfre);var SCP=Xt.multiply(X).inverse(),line_2=[];for(i=SCP.height-1;i>=0;i--)line_2.push(Math.sqrt(SCP.data[i][i]*SSresid/degfre));return this.asMatrix([line_1,line_2,line_3,line_4,line_5])}function trend(Y,X,W,konst){var i=0;X||(X=Y.map((function(){return++i}))),konst&&((X=X.clone()).eachRow((function(row){X.data[row].unshift(1)})),++X.width);var Xt=X.transpose(),B=Xt.multiply(X).inverse().multiply(Xt).multiply(Y);return W?konst&&((W=W.clone()).eachRow((function(row){W.data[row].unshift(1)})),++W.width):W=X,W.multiply(B)}function root_newton(func,guess,max_it,eps){for(var MAX_IT=max_it||20,EPS=eps||1e-7,root=guess,j=1;j<=MAX_IT;j++){var f_d=func(root),dx=f_d[0]/f_d[1];if(root-=dx,Math.abs(dx)<EPS)return root}return new CalcError("NUM")}function FV(rate,nper,pmt,pv,type){var h1=Math.pow(1+rate,nper);return-(pv*h1+pmt*(rate?(h1-1)/rate:nper)*(1+rate*type))}function PMT(rate,nper,pv,fv,type){if(!rate)return-(fv+pv)/nper;var h1=Math.pow(1+rate,nper);return-rate*(fv+pv*h1)/((1+rate*type)*(h1-1))}function IPMT(rate,per,nper,pv,fv,type){if(1==type&&1==per)return 0;var ipmt=FV(rate,per-1,PMT(rate,nper,pv,fv,type),pv,type)*rate;return type?ipmt/(1+rate):ipmt}function _edate(base,months){var d=unpackDate(base),m=d.month+months,y=d.year+Math.floor(m/12);return(m%=12)<0&&(m+=12),packDate(y,m,d=Math.min(d.date,daysInMonth(y,m)))}function _daysBetween(from,to,basis){return 1==basis||2==basis||3==basis?to-from:_days_360(from,to,basis)}function _borderCoupons(settlement,maturity,freq){var sett=unpackDate(settlement),periods=unpackDate(maturity).year-sett.year;periods>0&&(periods=(periods-1)*freq);var prev,months=12/freq;do{prev=_edate(maturity,-++periods*months)}while(settlement<prev);return[prev,_edate(maturity,- --periods*months)]}function daysInYear2(yr,basis){return 3==basis?365:1==basis?isLeapYear(yr)?366:365:360}class FormulaContext{constructor(workbook){this.workbook=workbook}getRefCells(ref,hiddenInfo,fsheet,frow,fcol,wantNulls){let sheet,formula,value,i;if(ref instanceof CellRef)return sheet=this.workbook.sheetByName(ref.sheet),sheet&&ref.valid()?(formula=sheet.formula(ref),value=sheet.range(ref.row,ref.col).value(),wantNulls||null!=formula||null!=value?[{formula,value,row:ref.row,col:ref.col,sheet:ref.sheet,hidden:!!hiddenInfo&&(0===sheet.columnWidth(ref.col)||0===sheet.rowHeight(ref.row))}]:[]):[{value:new CalcError("REF")}];if(ref instanceof RangeRef){i=this.workbook.sheetIndex(ref.sheet);let states=[],n=i;if(ref.endSheet&&(n=this.workbook.sheetIndex(ref.endSheet),i>n)){let tmp=i;i=n,n=tmp}if(i<0||n<0||!ref.valid())return[{value:new CalcError("REF")}];for(;i<=n;){sheet=this.workbook.sheetByIndex(i++);let tl=sheet._grid.normalize(ref.topLeft),br=sheet._grid.normalize(ref.bottomRight),startCellIndex=sheet._grid.cellRefIndex(tl),endCellIndex=sheet._grid.cellRefIndex(br),values=sheet._properties.iterator("value",startCellIndex,endCellIndex);for(let col=tl.col;col<=br.col;++col)for(let row=tl.row;row<=br.row;++row){let index=sheet._grid.index(row,col);formula=sheet._properties.get("formula",index),value=values.at(index),(wantNulls||null!=formula||null!=value)&&states.push({formula,value,row,col,sheet:sheet.name(),hidden:!!hiddenInfo&&(0===sheet.columnWidth(col)||0===sheet.rowHeight(row))})}}return states}if(ref instanceof UnionRef){let a=[];for(i=0;i<ref.refs.length;++i)a=a.concat(this.getRefCells(ref.refs[i],hiddenInfo,fsheet,frow,fcol));return a}if(ref instanceof NameRef){let val=this.nameValue(ref,fsheet,frow,fcol);return val instanceof Ref?this.getRefCells(val,hiddenInfo,fsheet,frow,fcol):[{value:null==val?new CalcError("NAME"):val}]}return[]}isMerged(ref){return this.workbook.sheetByName(ref.sheet).isMerged(ref)}nameValue(ref,fsheet,frow,fcol){let val;return ref.hasSheet()?val=this.workbook.nameValue(this._displayString(ref.print())):(ref=ref.clone().setSheet(fsheet,!0),val=this.workbook.nameValue(this._displayString(ref.print())),null==val&&(val=this.workbook.nameValue(this._displayString(ref.name)))),val instanceof Ref&&(val=val.absolute(frow,fcol)),val}getData(ref,fsheet,frow,fcol,wantNulls){let single=ref instanceof CellRef;ref instanceof NameRef&&(single=this.workbook.nameValue(ref.name)instanceof CellRef);let data=this.getRefCells(ref,!1,fsheet,frow,fcol,wantNulls).map((function(cell){let val=cell.value;return val instanceof calc.runtime.Formula&&(val=val.value),val}));return single?data[0]:data}onFormula(f){let sheet=this.workbook.sheetByName(f.sheet),row=f.row,col=f.col,value=f.value;if(sheet.formula({row,col})!==f)return!1;let arrayRange=f.arrayFormulaRange;if(arrayRange){let tlRow,tlCol,width=value.width,height=value.height;sheet.forEach(arrayRange,(function(row,col){void 0===tlRow&&(tlRow=row,tlCol=col);let val,vrow=row-tlRow,vcol=col-tlCol;val=vrow<height&&vcol<width?value.get(vrow,vcol):new CalcError("N/A"),sheet._value(row,col,val)}))}else value instanceof Ref&&(value=this.getData(value,f.sheet,row,col),Array.isArray(value)&&(value=value[0]),void 0===value&&(value=null)),value instanceof calc.runtime.Matrix&&(value=value.get(0,0)),sheet._value(row,col,value);return clearTimeout(sheet._formulaContextRefresh),sheet._formulaContextRefresh=setTimeout((function(){sheet.batch((function(){}),{layout:!0})}),50),!0}_displayString(val){return/^[a-z_][a-z0-9_]*$/i.test(val)?val:"'"+val.replace(/\x27/g,"\\'")+"'"}}class ValidationFormulaContext extends FormulaContext{onFormula(){return!0}}let RX_COLORS=/^\[(black|green|white|blue|magenta|yellow|cyan|red)\]/i,RX_CONDITION=/^\[(<=|>=|<>|<|>|=)(-?[0-9.]+)\]/;function parse$2(input){input=calc.InputStream(input);let decimalPart,sections=[],haveConditional=!1;for(;!input.eof();){let sec=readSection();sections.push(sec),sec.cond&&(haveConditional=!0)}return haveConditional||(1===sections.length?sections[0].cond="num":2===sections.length?(sections[0].cond={op:">=",value:0},sections[1].cond={op:"<",value:0}):sections.length>=3&&(sections[0].cond={op:">",value:0},sections[1].cond={op:"<",value:0},sections[2].cond={op:"=",value:0},sections.length>3&&(sections[3].cond="text",sections=sections.slice(0,4)))),sections;function maybeColor(){let m=input.skip(RX_COLORS);if(m)return m[1].toLowerCase()}function readFormat(){let tok,format=[],prev=null;for(;!input.eof()&&(tok=readNext());)"date"===tok.type?prev&&/^(el)?time$/.test(prev.type)&&"h"===prev.part&&"m"===tok.part&&tok.format<3&&(tok.type="time"):/^(el)?time$/.test(tok.type)&&"s"===tok.part&&prev&&"date"===prev.type&&"m"===prev.part&&prev.format<3&&(prev.type="time"),/^(?:str|space|fill)$/.test(tok.type)||(prev=tok),format.push(tok);return format}function maybeFraction(tok){if("date"!==tok.type||"m"===tok.part&&tok.format<3){let m=input.skip(/^\.(0+)/);m&&(tok.fraction=m[1].length,"date"===tok.type&&(tok.type="time"))}return tok}function readNext(){let ch,m;if(m=input.skip(/^([#0?]+)(?:,([#0?]+))+/))return{type:"digit",sep:!0,format:m[1]+m[2],decimal:decimalPart};if(m=input.skip(/^[#0?]+/))return{type:"digit",sep:!1,format:m[0],decimal:decimalPart};if(m=input.skip(/^(e)([+-])/i))return{type:"exp",ch:m[1],sign:m[2]};if(m=input.skip(/^(d{1,4}|m{1,5}|yyyy|yy|y)/i))return m=m[1].toLowerCase(),maybeFraction({type:"date",part:m.charAt(0),format:m.length});if(m=input.skip(/^(hh?|ss?)/i))return m=m[1].toLowerCase(),maybeFraction({type:"time",part:m.charAt(0),format:m.length});if(m=input.skip(/^\[(hh?|mm?|ss?)\]/i))return m=m[1].toLowerCase(),maybeFraction({type:"eltime",part:m.charAt(0),format:m.length});if(m=input.skip(/^(a[.]?m[.]?\/p[.]?m[.]?|a\/p)/i))return m=m[1].split("/"),{type:"ampm",am:m[0],pm:m[1]};switch(ch=input.next()){case";":return null;case"\\":return{type:"str",value:input.next()};case'"':return{type:"str",value:input.readEscaped(ch)};case"@":return{type:"text"};case"_":return{type:"space",value:input.next()};case"*":return{type:"fill",value:input.next()};case".":return input.lookingAt(/^\s*[#0?]/)?(decimalPart=!0,{type:"dec"}):{type:"str",value:"."};case"%":return{type:"percent"};case",":return{type:"comma"}}return{type:"str",value:ch}}function readSection(){decimalPart=!1;let color=maybeColor(),cond=function maybeCondition(){let m=input.skip(RX_CONDITION);if(m){let val=parseFloat(m[2]);if(!isNaN(val))return{op:m[1],value:val,custom:!0}}}();return!color&&cond&&(color=maybeColor()),{color,cond,body:readFormat()}}}function compileFormatPart(format){let input=function TokenStream2(parts){let index=0;return{next:function(){return parts[index++]},eof:function(){return index>=parts.length},ahead:function(n,f){if(index+n<=parts.length){let val=f.apply(null,parts.slice(index,index+n));return val&&(index+=n),val}},restart:function(){index=0}}}(format.body),hasDate=!1,hasTime=!1,hasAmpm=!1,percentCount=0,currency=/[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]/,scaleCount=0,code="let intPart, decPart, isNegative, date, time; ",separeThousands=!1,declen=0,intFormat=[],decFormat=[],condition=format.cond,preamble="";if("text"===condition)preamble="if (typeof value == 'string' || value instanceof kendo.spreadsheet.CalcError) { ";else if("num"===condition)preamble="if (typeof value == 'number') { ";else if(condition){preamble="if (typeof value == 'number' && value "+("="===condition.op?"==":condition.op)+" "+condition.value+") { ",condition.custom||(code+="value = Math.abs(value); ")}function checkComma(a,b){("digit"===a.type&&"comma"===b.type||"comma"===a.type&&a.hidden&&"comma"===b.type)&&(b.hidden=!0,scaleCount++)}for(format.color&&(code+="result.color = "+JSON.stringify(format.color)+"; ");!input.eof();){input.ahead(2,checkComma);let tok=input.next();"percent"===tok.type?percentCount++:"digit"===tok.type?tok.decimal?(declen+=tok.format.length,decFormat.push(tok.format)):(intFormat.push(tok.format),tok.sep&&(separeThousands=!0)):"time"===tok.type?hasTime=!0:"date"===tok.type?hasDate=!0:"ampm"===tok.type&&(hasAmpm=hasTime=!0)}for(percentCount>0&&(code+="value *= "+Math.pow(100,percentCount)+"; "),scaleCount>0&&(code+="value /= "+Math.pow(1e3,scaleCount)+"; "),intFormat.length&&(code+="intPart = runtime.formatInt(culture, value, "+JSON.stringify(intFormat)+", "+declen+", "+separeThousands+"); ",code+="isNegative = parseInt(intPart[0]) < 0;"),decFormat.length&&(code+="decPart = runtime.formatDec(value, "+JSON.stringify(decFormat)+", "+declen+"); "),(intFormat.length||decFormat.length)&&(code+="type = 'number'; "),hasDate&&(code+="date = runtime.unpackDate(value); "),hasTime&&(code+="time = runtime.unpackTime(value); "),(hasDate||hasTime)&&(code+="type = 'date'; "),(percentCount>0||scaleCount>0||intFormat.length||decFormat.length||hasDate||hasTime)&&(preamble||(preamble="if (typeof value == 'number') { ")),input.restart(),code+="let matchedCurrency = false;";!input.eof();){let tok=input.next();"dec"===tok.type?code+="output += culture.numbers.symbols.decimal; ":"comma"!==tok.type||tok.hidden?"percent"===tok.type?(code+="type = 'percent'; ",code+="output += culture.numbers.symbols.percentSign; "):"str"===tok.type?(currency.test(tok.value)&&(code+="type = 'currency'; ",code+="if (isNegative) { output += '-'; matchedCurrency = true; }"),code+="output += "+JSON.stringify(tok.value)+"; "):"text"===tok.type?(code+="type = 'text'; ",code+="output += value; "):"space"===tok.type?(code+="if (output) result.body.push(output); ",code+="output = ''; ",code+="result.body.push({ type: 'space', value: "+JSON.stringify(tok.value)+" }); "):"fill"===tok.type?code+="output += runtime.fill("+JSON.stringify(tok.value)+"); ":"digit"===tok.type?(code+="if (isNegative && intPart[0] && matchedCurrency) {intPart[0] = intPart[0].replace('-', '');}",code+="output += "+(tok.decimal?"decPart":"intPart")+".shift(); "):"date"===tok.type?code+="output += runtime.date(culture, date, "+JSON.stringify(tok.part)+", "+tok.format+"); ":"time"===tok.type?code+="output += runtime.time(time, "+JSON.stringify(tok.part)+", "+tok.format+", "+hasAmpm+", "+tok.fraction+"); ":"eltime"===tok.type?code+="output += runtime.eltime(value, "+JSON.stringify(tok.part)+", "+tok.format+", "+tok.fraction+"); ":"ampm"===tok.type&&(code+="output += time.hours < 12 ? "+JSON.stringify(tok.am)+" : "+JSON.stringify(tok.pm)+"; "):code+="output += ','; "}return code+="if (output) result.body.push(output); ",code+="result.type = type; ",code+="return result; ",preamble&&(code=preamble+code+"}"),code}let TEXT=compileFormatPart({cond:"text",body:[{type:"text"}]}),compile=memoize((function(format){let code=parse$2(format).map(compileFormatPart);return code.push(TEXT),code=code.join("\n"),code="'use strict'; return function(value, culture){ if (!culture) culture = kendo.culture();let output = '', type = null, result = { body: [] }; "+code+"; return result; };",new Function("kendo","runtime",code)(kendo,runtime$1)})),makeDateFormat=memoize((function(format){let section,tree=parse$2(format),found=!1,hasAmpm=!1;for(let i=0;i<tree.length;++i){section=tree[i];for(let j=0;j<section.body.length;++j)/^(?:date|time|ampm)$/.test(section.body[j].type)&&(found=!0,"ampm"===section.body[j].type&&(hasAmpm=!0));if(found)break}return found?section.body.map((function printToken(tok){if("digit"===tok.type)return tok.sep?tok.format.charAt(0)+","+tok.format.substr(1):tok.format;if("exp"===tok.type)return tok.ch+tok.sign;if("date"===tok.type||"time"===tok.type){let part=tok.part;return"date"===tok.type&&/^m/.test(part)?part="M":"time"===tok.type&&/^h/.test(part)&&(hasAmpm||(part=part.toUpperCase())),function maybeFraction(fmt,tok){tok.fraction&&(fmt+=padLeft("",Math.max(tok.fraction,3),"f"));return fmt}(padLeft("",tok.format,part),tok)}return"ampm"===tok.type?"tt":"str"===tok.type?tok.value:"space"===tok.type?" ":"dec"===tok.type?".":"percent"===tok.type?"%":"comma"===tok.type?",":""})).join(""):null})),runtime$1={unpackDate,unpackTime,date:function(culture,d,part,length){switch(part){case"d":switch(length){case 1:return d.date;case 2:return padLeft(d.date,2,"0");case 3:return culture.calendar.days.format.abbreviated[d.day];case 4:return culture.calendar.days.format.wide[d.day]}break;case"m":switch(length){case 1:return d.month+1;case 2:return padLeft(d.month+1,2,"0");case 3:return culture.calendar.months.format.abbreviated[d.month];case 4:return culture.calendar.months.format.wide[d.month];case 5:return culture.calendar.months.format.narrow[d.month]}break;case"y":switch(length){case 1:case 4:return d.year;case 2:return d.year%100}}return"##"},time:function(t,part,length,ampm,fraclen){let ret,fraction;switch(part){case"h":ret=padLeft(ampm?t.hours%12||12:t.hours,length,"0"),fraclen&&(fraction=(t.minutes+(t.seconds+t.milliseconds/1e3)/60)/60);break;case"m":ret=padLeft(t.minutes,length,"0"),fraclen&&(fraction=(t.seconds+t.milliseconds/1e3)/60);break;case"s":ret=padLeft(t.seconds,length,"0"),fraclen&&(fraction=t.milliseconds/1e3)}return fraction&&(ret+=runtime$1.toFixed(fraction,fraclen).replace(/^0+/,"")),ret},eltime:function(value,part,length,fraclen){let ret,fraction;switch(part){case"h":ret=24*value;break;case"m":ret=24*value*60;break;case"s":ret=24*value*60*60}return fraclen&&(fraction=ret-(0|ret)),ret=padLeft(0|ret,length,"0"),fraction&&(ret+=runtime$1.toFixed(fraction,fraclen).replace(/^0+/,"")),ret},fill:function(ch){return ch},formatInt:function(culture,value,parts,declen,sep){value=runtime$1.toFixed(value,declen).replace(/\..*$/,"");let lastPart=parts[parts.length-1];declen>0&&"0"!=lastPart[parts.length-1]&&("0"===value?value="":"-0"===value&&(value="-"));let str,shouldInsertMinus=!1,iv=value.length-1,result=[],len=0;function add(ch,skipMinus){sep&&len&&len%3==0&&/^[0-9]$/.test(ch)&&(str=culture.numbers.symbols.group+str),skipMinus&&"-"===ch&&(shouldInsertMinus=!0,ch="0"),str=ch+str,len++}for(let j=parts.length;--j>=0;){let format=parts[j];str="";for(let k=format.length;--k>=0;){let chf=format.charAt(k);iv<0?"0"==chf?add("0"):"?"==chf&&add(" "):("0"==value&&"?"==chf?add(" "):"0"==chf?add(value.charAt(iv),!0):add(value.charAt(iv)),iv--)}if(0===j)for(;iv>=0;)add(value.charAt(iv--));result.unshift(str)}return shouldInsertMinus&&(result[0]="-"+result[0]),result},formatDec:function(value,parts,declen){let pos=(value=runtime$1.toFixed(value,declen)).indexOf(".");value=pos>=0?value.substr(pos+1).replace(/0+$/,""):"";let iv=0,result=[];for(let j=0;j<parts.length;++j){let format=parts[j],str="";for(let k=0;k<format.length;++k){let chf=format.charAt(k);iv<value.length?str+=value.charAt(iv++):"0"==chf?str+="0":"?"==chf&&(str+=" ")}result.push(str)}return result},toFixed:function(value,decimals){return function toFixed(value,last){if(!isFinite(value))return"#NUM!";if(value<0)return"-"+toFixed(-value);if(0===decimals)return String(Math.round(value));if(value===Math.round(value)&&!/e/i.test(String(value)))return value.toFixed(decimals);let num=function digNumber(num){let intpart,decpart,m,str=String(num).toLowerCase(),pos=str.indexOf(".");pos<0?(pos=str.indexOf("e"),pos<0?(intpart=str,decpart=""):(intpart=str.substr(0,pos),decpart=str.substr(pos))):(intpart=str.substr(0,pos),decpart=str.substr(pos+1));if(m=/(\d*)e([-+]?\d+)/.exec(decpart)){let exp=parseInt(m[2],10);exp>=0?(decpart=function padRight(val,width,ch){val+="";for(;val.length<width;)val+=ch;return val}(m[1],exp,"0"),intpart+=decpart.substr(0,exp),decpart=decpart.substr(exp)):(intpart=padLeft(intpart,-exp,"0"),decpart=intpart.substr(exp)+m[1],intpart=intpart.substr(0,intpart.length+exp))}return{intpart:intpart||"0",decpart}}(value),intpart=num.intpart,decpart=num.decpart;if(decpart.length<=decimals){for(;decpart.length<decimals;)decpart+="0";return intpart+"."+decpart}if(last)return intpart+"."+decpart.substr(0,decimals);let f=Math.pow(10,decimals);return toFixed(Math.round(value*f)/f,!0)}(Number(value.toFixed(14)))}};function padLeft(val,width,ch){for(val+="";val.length<width;)val=ch+val;return val}function index_esm_text(f){let a=f.body,text="";for(let i=0;i<a.length;++i){let el=a[i];"string"==typeof el?text+=el:"space"===el.type&&(text+=" ")}return text}const formatting={compile,parse:parse$2,format:function(value,format,culture){let f=compile(format)(value,culture),span=dom.element("span");span.__dataType=f.type;let a=f.body;f.color&&(span.attr.style={color:f.color});for(let i=0;i<a.length;++i){let el=a[i];"string"==typeof el?span.children.push(dom.text(el)):"space"===el.type&&span.children.push(dom.element("span",{style:{visibility:"hidden"}},[dom.text(el.value)]))}return span},text:function(value,format,culture){return index_esm_text(compile(format)(value,culture))},textAndColor:function(value,format,culture){let f=compile(format)(value,culture);return{text:index_esm_text(f),color:f.color,type:f.type}},type:function(value,format){return compile(format)(value).type},adjustDecimals:function(format,diff){let ast=parse$2(format);return function adjustDecimals(sections,x){sections.forEach((function(sec){let diff=x;if("text"===sec.cond)return;let body=sec.body,adjusted=!1,i=body.length;for(;0!==diff&&--i>=0;){let tok=body[i];if("digit"===tok.type){if(tok.decimal){if(adjusted=!0,diff>0)tok.format+=padLeft("",diff,"0");else if(diff<0){let tmp=tok.format.length;tok.format=tok.format.substr(0,tmp+diff),diff+=tmp-tok.format.length}if(0===tok.format.length)for(body.splice(i,1);--i>=0;){if(tok=body[i],"digit"===tok.type&&tok.decimal){++i;break}if("dec"===tok.type){body.splice(i,1);break}}}if(diff>0)break}}!adjusted&&diff>0&&body.splice(i+1,0,{type:"dec"},{type:"digit",sep:!1,decimal:!0,format:padLeft("",diff,"0")})}))}(ast,diff),function print(sections){return sections.map((function printSection(sec){let out="";return sec.color&&(out+="["+sec.color+"]"),sec.cond&&"text"!==sec.cond&&"num"!==sec.cond&&(out+="["+sec.cond.op+sec.cond.value+"]"),out+=sec.body.map(printToken).join(""),out})).join(";");function maybeFraction(fmt,tok){return tok.fraction&&(fmt+="."+padLeft("",tok.fraction,"0")),fmt}function printToken(tok){return"digit"===tok.type?tok.sep?tok.format.charAt(0)+","+tok.format.substr(1):tok.format:"exp"===tok.type?tok.ch+tok.sign:"date"===tok.type||"time"===tok.type?maybeFraction(padLeft("",tok.format,tok.part),tok):"eltime"===tok.type?maybeFraction("["+padLeft("",tok.format,tok.part)+"]",tok):"ampm"===tok.type?tok.am+"/"+tok.pm:"str"===tok.type?JSON.stringify(tok.value):"text"===tok.type?"@":"space"===tok.type?"_"+tok.value:"fill"===tok.type?"*"+tok.value:"dec"===tok.type?".":"percent"===tok.type?"%":"comma"===tok.type?",":void 0}}(ast)},makeDateFormat};let KEY_NAMES$1={8:"backspace",9:"tab",13:"enter",27:"esc",37:"left",38:"up",39:"right",40:"down",35:"end",36:"home",32:"spacebar",33:"pageup",34:"pagedown",46:"delete",113:":edit"},Mac=navigator.platform.toUpperCase().indexOf("MAC")>=0;class EventListener{constructor(target,observer,handlers){if(this._handlers={},this.target=target,this._observer=observer||window,this.keyDownProxy=this.keyDown.bind(this),this.mouseProxy=this.mouse.bind(this),this.touchProxy=this.touch.bind(this),this.threshold=5,this._pressLocation=null,this._attachEvent(target,"keydown",this.keyDownProxy),this._attachEvent(target,"contextmenu mousedown cut copy paste scroll wheel click dblclick focus",this.mouseProxy),this._attachEvent(target,"touchmove touchend",this.touchProxy),this._attachEvent(document.documentElement,"mousemove mouseup",this.mouseProxy),this._attachEvent(document.documentElement,"touchmove touchend",this.touchProxy),handlers)for(let key in handlers)this.on(key,handlers[key])}_attachEvent(element,events,handler){events.split(" ").forEach((eventType=>{element.addEventListener(eventType,handler)}))}_removeEvent(element,events,handler){events.split(" ").forEach((eventType=>{element.removeEventListener(eventType,handler)}))}keyDown(e){(!e.altKey||"n"!==e.key&&"h"!==e.key&&"a"!==e.key)&&this.handleEvent(e,function(event){let keyCode=event.keyCode,name=KEY_NAMES$1[keyCode];return!name&&function(keyCode){return keyCode>47&&keyCode<58||keyCode>64&&keyCode<91||keyCode>95&&keyCode<112||keyCode>185&&keyCode<193||keyCode>218&&keyCode<223||229===keyCode}(keyCode)&&(name=":alphanum"),!name&&event.key&&1===event.key.length&&(name=":alphanum"),name}(e))}touch(e){this.handleEvent(e,e.type)}mouse(e){let rightClick;e.which?rightClick=3===e.which:e.button&&(rightClick=2===e.button);let type=e.type;if("mousedown"===type&&(rightClick?type="rightmousedown":this._pressLocation={x:e.pageX,y:e.pageY}),"mouseup"===type&&(rightClick||(this._pressLocation=null)),"mousemove"===type&&this._pressLocation){let dx=this._pressLocation.x-e.pageX,dy=this._pressLocation.y-e.pageY;Math.sqrt(dx*dx+dy*dy)>this.threshold&&(type="mousedrag")}this.handleEvent(e,type)}handleEvent(e,name){let eventKey="";e.mod=Mac?e.metaKey:e.ctrlKey&&!e.altKey,e.altKey&&(eventKey+="alt+"),e.shiftKey&&(eventKey+="shift+"),e.ctrlKey&&(eventKey+="ctrl+"),eventKey+=name;let catchAllHandler=this._handlers["*+"+name];catchAllHandler&&catchAllHandler.call(this._observer,e,eventKey);let handler=this._handlers[eventKey];handler&&handler.call(this._observer,e,eventKey)}on(event,callback){let handlers=this._handlers;"string"==typeof callback&&(callback=this._observer[callback]),"string"==typeof event&&(event=event.split(",")),event.forEach((function(e){handlers[e]=callback}))}destroy(){this._removeEvent(this.target,"keydown",this.keyDownProxy),this._removeEvent(this.target,"contextmenu mousedown cut copy paste scroll wheel click dblclick focus",this.mouseProxy),this._removeEvent(this.target,"touchmove touchend",this.touchProxy),this._removeEvent(document.documentElement,"mousemove mouseup",this.mouseProxy),this._removeEvent(document.documentElement,"touchmove touchend",this.touchProxy)}}let alphaNumRegExp=/:alphanum$/,ACTIONS={up:"up",down:"down",left:"left",right:"right",home:"first-col",end:"last-col","ctrl+left":"word-left","ctrl+right":"word-right","ctrl+up":"word-up","ctrl+down":"word-down","ctrl+home":"first","ctrl+end":"last",pageup:"prev-page",pagedown:"next-page"},ENTRY_ACTIONS={tab:"next","shift+tab":"previous",enter:"lower","shift+enter":"upper",delete:"clearContents",backspace:"clearContents","shift+:alphanum":"edit","alt+:alphanum":"edit",":alphanum":"edit","ctrl+:alphanum":"ctrl","alt+ctrl+:alphanum":"edit",":edit":"edit"},CONTAINER_EVENTS={wheel:"onWheel","*+mousedown":"onMouseDown",contextmenu:"onContextMenu","*+mousedrag":"onMouseDrag","*+mouseup":"onMouseUp","*+dblclick":"onDblClick",mousemove:"onMouseMove"},CLIPBOARD_EVENTS={pageup:"onPageUp",pagedown:"onPageDown",mouseup:"onMouseUp","*+cut":"onCut","*+paste":"onPaste","*+copy":"onCopy"},EDITOR_EVENTS={esc:"onEditorEsc",enter:"onEditorBlur","alt+enter":"insertNewline","shift+enter":"onEditorBlur",tab:"onEditorBlur","shift+tab":"onEditorBlur","shift+ctrl+enter":"onEditorArrayFormula"},FORMULABAR_EVENTS=Object.assign({focus:"onEditorBarFocus"},EDITOR_EVENTS),FORMULAINPUT_EVENTS=Object.assign({focus:"onEditorCellFocus"},EDITOR_EVENTS),SELECTION_MODES={cell:"range",rowheader:"row",columnheader:"column",topcorner:"sheet",autofill:"autofill"},ACTION_KEYS=[],SHIFT_ACTION_KEYS=[],ENTRY_ACTION_KEYS=[];for(let key in ACTIONS)ACTION_KEYS.push(key),SHIFT_ACTION_KEYS.push("shift+"+key);for(let key in ENTRY_ACTIONS)ENTRY_ACTION_KEYS.push(key);CLIPBOARD_EVENTS[ACTION_KEYS]="onAction",CLIPBOARD_EVENTS[SHIFT_ACTION_KEYS]="onShiftAction",CLIPBOARD_EVENTS[ENTRY_ACTION_KEYS]="onEntryAction",FORMULAINPUT_EVENTS[ACTION_KEYS]="onEditorAction",FORMULAINPUT_EVENTS[SHIFT_ACTION_KEYS]="onEditorShiftAction";class Controller{constructor(view,workbook){this.view=view,this.workbook(workbook),this.container=view.container,this.clipboardElement=view.clipboard,this.scroller=view.scroller,this.tabstrip=view.tabstrip,this.sheetsbar=view.sheetsbar,view.nameEditor.bind("enter",this.onNameEditorEnter.bind(this)),view.nameEditor.bind("cancel",this.onNameEditorCancel.bind(this)),view.nameEditor.bind("select",this.onNameEditorSelect.bind(this)),view.nameEditor.bind("delete",this.onNameEditorDelete.bind(this)),this.editor=view.editor,this.editor.bind("change",this.onEditorChange.bind(this)),this.editor.bind("activate",this.onEditorActivate.bind(this)),this.editor.bind("deactivate",this.onEditorDeactivate.bind(this)),this.editor.bind("update",this.onEditorUpdate.bind(this)),view.scroller.addEventListener("scroll",this.onScroll.bind(this)),this.listener=new EventListener(this.container,this,CONTAINER_EVENTS),view.scroller.addEventListener("mousedown",this.onMouseDown.bind(this)),this._enableEditorEvents(),this.sheetsbar&&(this.sheetsbar.bind("select",this.onSheetBarSelect.bind(this)),this.sheetsbar.bind("reorder",this.onSheetBarReorder.bind(this)),this.sheetsbar.bind("rename",this.onSheetBarRename.bind(this)),this.sheetsbar.bind("remove",this.onSheetBarRemove.bind(this)))}executeCommand(options){return this._execute(options)}_enableEditorEvents(enable){void 0===enable||enable?(this.keyListener=new EventListener(this.clipboardElement,this,CLIPBOARD_EVENTS),this.barKeyListener=new EventListener(this.editor.barElement(),this,FORMULABAR_EVENTS),this.inputKeyListener=new EventListener(this.editor.cellElement(),this,FORMULAINPUT_EVENTS)):(this.keyListener.destroy(),this.barKeyListener.destroy(),this.inputKeyListener.destroy())}_execute(options){let result=this._workbook.execute(options);return"EditCommand"!==options.command||result||this._workbook.trigger("change",{editorClose:!0}),result&&(this._preventNavigation=!0,"error"===result.reason?(this.editor.deactivate(!0),this.view.showError(result,function(){}.bind(this))):this.view.openDialog(result.reason)),result}_activeTooltip(){return this._workbook.activeSheet().activeCell().simplify().toString()}onContextMenuSelect(e){let command;switch(e.item.getAttribute("data-action")){case"cut":command={command:"ToolbarCutCommand",options:{workbook:this._workbook}};break;case"copy":command={command:"ToolbarCopyCommand",options:{workbook:this._workbook}};break;case"paste":command={command:"ToolbarPasteCommand",options:{workbook:this._workbook}};break;case"delete-drawing":command={command:"DeleteDrawingCommand",options:{drawing:this.navigator._sheet._activeDrawing}};break;case"bring-to-front":command={command:"BringToFrontCommand",options:{drawing:this.navigator._sheet._activeDrawing}};break;case"send-to-back":command={command:"SendToBackCommand",options:{drawing:this.navigator._sheet._activeDrawing}};break;case"unmerge":command={command:"MergeCellCommand",options:{value:"unmerge"}};break;case"merge":this.view.openDialog("merge");break;case"hide-row":command={command:"HideLineCommand",options:{axis:"row"}};break;case"hide-column":command={command:"HideLineCommand",options:{axis:"column"}};break;case"unhide-row":command={command:"UnHideLineCommand",options:{axis:"row"}};break;case"unhide-column":command={command:"UnHideLineCommand",options:{axis:"column"}};break;case"delete-row":command={command:"DeleteRowCommand"};break;case"delete-column":command={command:"DeleteColumnCommand"}}command&&this._execute(command)}onSheetBarRemove(e){let sheet=this._workbook.sheetByName(e.name);sheet&&this._workbook.removeSheet(sheet)}destroy(){this.listener.destroy(),this._enableEditorEvents(!1),this.keyListener.destroy(),this.inputKeyListener.destroy()}onSheetBarSelect(e){let sheet,workbook=this._workbook;if(e.isAddButton){if(this._workbook.trigger("insertSheet"))return;sheet=workbook.insertSheet()}else sheet=workbook.sheetByName(e.name);if(workbook.activeSheet().name()!==sheet.name()){if(this._workbook.trigger("selectSheet",{sheet}))return;this.editor.canInsertRef(!1)||this.editor.deactivate(),workbook.activeSheet(sheet)}}onSheetBarReorder(e){let workbook=this._workbook,sheet=workbook.sheetByIndex(e.oldIndex),activeSheet=workbook.activeSheet(),activeSheetName=activeSheet.name();if(workbook.moveSheetToIndex(sheet,e.newIndex),activeSheetName!==sheet.name()){if(workbook.trigger("selectSheet",{sheet}))return void workbook.activeSheet(activeSheet);this.editor.canInsertRef(!1)||this.editor.deactivate(),workbook.activeSheet(sheet)}}onSheetBarRename(e){let sheet=this._workbook.sheetByIndex(e.sheetIndex);this._workbook.sheetByName(e.name)?this.view.showError({reason:"error",type:"duplicateSheetName"}):(this._workbook.renameSheet(sheet,e.name),this.clipboardElement.focus())}sheet(sheet){this.navigator=sheet.navigator(),this.axisManager=sheet.axisManager()}workbook(workbook){this._workbook=workbook,this.clipboard=workbook.clipboard(),workbook.bind("commandRequest",this.onCommandRequest.bind(this))}refresh(){let editor=this.editor,sheet=this._workbook.activeSheet();this._viewPortHeight=this.view.scroller.clientHeight,this.navigator.height(this._viewPortHeight),editor.isActive()||this.isEditorDisabled||(editor.enable(!1!==sheet.selection().enable()),this.resetEditorValue());let ref=sheet.selection()._ref.simplify(),def=this._workbook.nameForRef(ref,sheet.name());this.view.nameEditor.value(def.name)}onScroll(){this.view.render({scroll:!0})}onWheel(event){let deltaX=event.deltaX,deltaY=event.deltaY;1===event.deltaMode&&(deltaX*=10,deltaY*=10),this.scrollWith(deltaX,deltaY),event.preventDefault()}onAction(event,action){this._workbook.activeSheet()._activeDrawing=null,this.navigator.moveActiveCell(ACTIONS[action]),event.preventDefault()}onPageUp(){this.scrollDown(-this._viewPortHeight)}onPageDown(){this.scrollDown(this._viewPortHeight)}onEntryAction(event,action){let sheet=this._workbook.activeSheet();if(event.mod){let shouldPrevent=!0;switch(String.fromCharCode(event.keyCode)){case"A":sheet._activeDrawing=null,this.navigator.selectAll();break;case"Y":this._workbook.undoRedoStack.redo();break;case"Z":this._workbook.undoRedoStack.undo();break;default:shouldPrevent=!1}shouldPrevent&&event.preventDefault()}else{let disabled=!1===sheet.selection().enable(),casual=":edit"!==action;if("delete"==action||"backspace"==action)sheet._activeDrawing?this._execute({command:"DeleteDrawingCommand",options:{drawing:sheet._activeDrawing}}):disabled||this._execute({command:"ClearContentCommand"}),event.preventDefault();else if(alphaNumRegExp.test(action)||!casual){if(sheet._activeDrawing=null,disabled)return void event.preventDefault();casual&&this.editor.value(""),this.activateEditor(casual)}else this.navigator.navigateInSelection(ENTRY_ACTIONS[action]),event.preventDefault()}}onShiftAction(event,action){this.navigator.modifySelection(ACTIONS[action.replace("shift+","")],this.appendSelection),event.preventDefault()}onMouseMove(event){let sheet=this._workbook.activeSheet();if(sheet.resizingInProgress()||sheet.selectionInProgress())return;let object=this.objectAt(event);"columnresizehandle"===object.type||"rowresizehandle"===object.type?sheet.positionResizeHandle(object.ref):sheet.removeResizeHandle(),sheet._renderComment("cell"==object.type?object.ref:null)}onMouseDown(event){let object=this.objectAt(event);if(object.pane&&(this.originFrame=object.pane),this._startResizingDrawing(event,object))return void event.stopPropagation();let sheet=this._workbook.activeSheet();if(sheet._activeDrawing=null,"drawing"===object.type)return sheet._activeDrawing=object.drawing,object.copy=object.drawing.clone(),object.startBox=sheet.drawingBoundingBox(object.copy),sheet.startDragging(object),sheet.triggerChange({dragging:!0}),void event.preventDefault();if("outside"===object.type)return event.preventDefault(),void event.stopPropagation();if("editor"===object.type)return this.onEditorEsc(),this.openCustomEditor(),void event.preventDefault();if(this.editor.canInsertRef(!1)&&object.ref)return this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs()),this.navigator.startSelection(object.ref,this._selectionMode,this.appendSelection,event.shiftKey,this.view),void event.preventDefault();if(this._preventNavigation=!1,this.editor.deactivate(),!this._preventNavigation){if("columnresizehandle"===object.type||"rowresizehandle"===object.type)return sheet.startResizing({x:object.x,y:object.y}),void event.preventDefault();if("filtericon"===object.type)return this.openFilterMenu(event),void event.preventDefault();this._selectionMode=SELECTION_MODES[object.type],this.appendSelection=event.mod,this.navigator.startSelection(object.ref,this._selectionMode,this.appendSelection,event.shiftKey,this.view)}}_startResizingDrawing(event){let handle=event.target.closest(".k-spreadsheet-drawing-handle");if(handle){let location=this.translateCoords(event),direction=handle.getAttribute("data-direction"),sheet=this._workbook.activeSheet(),drawing=sheet._activeDrawing;return sheet.startDragging({pane:this.originFrame,drawing,copy:drawing.clone(),startBox:sheet.drawingBoundingBox(drawing),resize:direction,startX:location.x,startY:location.y}),!0}}onContextMenu(event){let sheet=this._workbook.activeSheet();event.preventDefault(),!sheet.resizingInProgress()&&sheet.draggingInProgress()}prevent(event){event.preventDefault()}constrainResize(type,ref){let resizeHandle=this._workbook.activeSheet().resizeHandlePosition();return!resizeHandle||"outside"===type||"topcorner"===type||ref.col<resizeHandle.col||ref.row<resizeHandle.row}_dragDrawing(event){let sheet=this._workbook.activeSheet(),drag=sheet.draggingInProgress();if(!drag)return!1;let location=this.translateCoords(event),drawing=drag.drawing,deltaX=location.x-drag.startX,deltaY=location.y-drag.startY;return"SE"==drag.resize?drag.aspect?Math.abs(deltaX)>Math.abs(deltaY)?(drawing.width=Math.max(drag.copy.width+deltaX,20),drawing.height=drawing.width/drag.aspect):(drawing.height=Math.max(drag.copy.height+deltaY,20),drawing.width=drawing.height*drag.aspect):(drawing.width=Math.max(drag.copy.width+deltaX,20),drawing.height=Math.max(drag.copy.height+deltaY,20)):"E"==drag.resize?drawing.width=Math.max(drag.copy.width+deltaX,20):"S"==drag.resize?drawing.height=Math.max(drag.copy.height+deltaY,20):"N"==drag.resize?drag.copy.height-deltaY>20&&(drawing.height=drag.copy.height-deltaY,drawing.offsetY=drag.copy.offsetY+deltaY):"W"==drag.resize?drag.copy.width-deltaX>20&&(drawing.width=drag.copy.width-deltaX,drawing.offsetX=drag.copy.offsetX+deltaX):"NE"==drag.resize?(drawing.width=Math.max(drag.copy.width+deltaX,20),drag.copy.height-deltaY>20&&(drawing.height=drag.copy.height-deltaY,drawing.offsetY=drag.copy.offsetY+deltaY)):"SW"==drag.resize?(drawing.height=Math.max(drag.copy.height+deltaY,20),drag.copy.width-deltaX>20&&(drawing.width=drag.copy.width-deltaX,drawing.offsetX=drag.copy.offsetX+deltaX)):"NW"==drag.resize?(drag.copy.height-deltaY>20&&(drawing.height=drag.copy.height-deltaY,drawing.offsetY=drag.copy.offsetY+deltaY),drag.copy.width-deltaX>20&&(drawing.width=drag.copy.width-deltaX,drawing.offsetX=drag.copy.offsetX+deltaX)):(drawing.offsetX=drag.copy.offsetX+deltaX,drawing.offsetY=drag.copy.offsetY+deltaY),sheet.triggerChange({dragging:!0}),!0}onMouseDrag(event){if("sheet"===this._selectionMode)return;let location={clientX:event.clientX,clientY:event.clientY},sheet=this._workbook.activeSheet();if(this._dragDrawing(event))return;let object=this.objectAt(location);if(sheet.resizingInProgress())this.constrainResize(object.type,object.ref)||sheet.resizeHintPosition({x:object.x,y:object.y});else if("outside"!==object.type){if(this.originFrame===object.pane)this.selectToLocation(location);else{let frame=this.originFrame._grid;object.x,frame.right,object.y>frame.bottom&&this.scrollTop(),object.y<frame.top||object.x<frame.left?this.startAutoScroll(object,location):this.selectToLocation(location)}event.preventDefault()}else this.startAutoScroll(object)}onMouseUp(event){let sheet=this._workbook.activeSheet();sheet.completeResizing(),sheet.completeDragging(),this.navigator.completeSelection(),this.stopAutoScroll();let editor=this.editor.activeEditor();if(!editor)return;let el=event.target;for(;el;){if(el===editor.element)return;el=el.parentNode}let object=this.objectAt(event);object&&object.ref&&editor.canInsertRef(!1)&&(editor.refAtPoint(sheet),sheet._setFormulaSelections(editor.highlightedRefs()))}onDblClick(event){let object=this.objectAt(event),disabled=!1===this._workbook.activeSheet().selection().enable();if("cell"!==object.type||disabled)return;let sel=this._workbook.activeSheet().selection();this.activateEditor(!sel.value()&&!sel.formula()),this.onEditorUpdate()}onCut(e){let self=this;setTimeout((function(){self.clipboard.menuInvoked=void 0===e,self._execute({command:"CutCommand",options:{workbook:self.view._workbook,event:e}})}))}clipBoardValue(){return this.clipboardElement.html()}_pasteImage(blob){let self=this,img=new window.Image;img.src=window.URL.createObjectURL(blob),img.onload=function(){self._execute({command:"InsertImageCommand",options:{blob,width:img.width,height:img.height}})},setTimeout((function(){window.URL.revokeObjectURL(img.src)}),10)}onPaste(e){let self=this,html="",plain="";if(self.clipboard.menuInvoked=void 0===e,e){let clipboardData=e.clipboardData;if(!clipboardData||!clipboardData.getData){if(window.clipboardData.files&&window.clipboardData.files.length){let file=window.clipboardData.files[0];if(/^image\/(?:png|jpe?g|gif)$/i.test(file.type))return self._pasteImage(file)}return plain=window.clipboardData.getData("Text"),plain&&(plain=plain.trim()),self.clipboardElement.empty(),void setTimeout((function(){html=self.clipboardElement.html(),(html||plain)&&(self.clipboard.external({html,plain}),self._execute({command:"PasteCommand",options:{workbook:self.view._workbook,event:e}}))}))}{e.preventDefault();let hasHTML=!1,hasPlainText=!1;if(window.DOMStringList&&clipboardData.types instanceof window.DOMStringList?(hasHTML=clipboardData.types.contains("text/html"),hasPlainText=clipboardData.types.contains("text/plain")):Array.isArray(clipboardData.types)?(hasHTML=clipboardData.types.indexOf("text/html")>=0,hasPlainText=clipboardData.types.indexOf("text/plain")>=0):(hasHTML=/text\/html/.test(clipboardData.types),hasPlainText=/text\/plain/.test(clipboardData.types)),hasHTML&&(html=clipboardData.getData("text/html").trim()),hasPlainText&&(plain=clipboardData.getData("text/plain").trim()),!html&&!plain&&clipboardData.items&&clipboardData.items.length)for(let i=0;i<clipboardData.items.length;++i){let item=clipboardData.items[i];if("file"===item.kind&&/^image\/(?:png|jpe?g|gif)$/i.test(item.type))return self._pasteImage(item.getAsFile())}}}else self.clipboard.menuInvoked=!0;(html||plain)&&(self.clipboard.external({html,plain}),self._execute({command:"PasteCommand",options:{workbook:self.view._workbook,event:e}}))}onCopy(e){this.clipboard.menuInvoked=void 0===e,this._execute({command:"CopyCommand",options:{workbook:this.view._workbook,event:e}})}scrollTop(){this.scroller.scrollTop=0}scrollLeft(){this.scroller.scrollLeft=0}scrollDown(value){this.scroller.scrollTop+=value}scrollRight(value){this.scroller.scrollLeft+=value}scrollWith(right,down){this.scroller.scrollTop+=down,this.scroller.scrollLeft+=right}translateCoords(location){let box=this.container.getBoundingClientRect();return{x:location.clientX-box.left,y:location.clientY-box.top}}objectAt(location,noDrawing){if(!location)return;const loc=this.translateCoords(location);return this.view.objectAt(loc.x,loc.y,noDrawing)}selectToLocation(cellLocation){let object=this.objectAt(cellLocation,!0);object.pane&&object.ref&&(this.extendSelection(object),this.lastKnownCellLocation=cellLocation,this.originFrame=object.pane),this.stopAutoScroll()}extendSelection(object){this.navigator.extendSelection(object.ref,this._selectionMode)}autoScroll(){let x=this._autoScrollTarget.x,y=this._autoScrollTarget.y,boundaries=this.originFrame._grid,scroller=this.view.scroller,scrollLeft=scroller.scrollLeft,scrollTop=scroller.scrollTop;x<boundaries.left&&this.scrollRight(-8),x>boundaries.right&&this.scrollRight(8),y<boundaries.top&&this.scrollDown(-8),y>boundaries.bottom&&this.scrollDown(8),scrollTop===scroller.scrollTop&&scrollLeft===scroller.scrollLeft?this.selectToLocation(this.finalLocation):this.extendSelection(this.objectAt(this.lastKnownCellLocation))}startAutoScroll(viewObject,location){this._scrollInterval||(this._scrollInterval=setInterval(this.autoScroll.bind(this),50)),this.finalLocation=location||this.lastKnownCellLocation,this._autoScrollTarget=viewObject}stopAutoScroll(){clearInterval(this._scrollInterval),this._scrollInterval=null}openCustomEditor(){this.view.openCustomEditor()}openFilterMenu(event){let object=this.objectAt(event),column=this._workbook.activeSheet().filterColumn(object.ref),filterMenu=this.view.createFilterMenu(column);filterMenu.bind("action",this.onCommandRequest.bind(this)),filterMenu.bind("action",filterMenu.close.bind(filterMenu)),filterMenu.openFor(event.target,event)}_saveEditorValue(arrayFormula){let sheet=this.editor._range.sheet(),value=this.editor.value();this._workbook.activeSheet()!==sheet&&(this._workbook.activeSheet()._setFormulaSelections(),this._workbook.activeSheet(sheet)),sheet.isInEditMode(!1),this._lastEditorValue=value,this._execute({command:"EditCommand",options:{value,arrayFormula}})}onEditorChange(){this._saveEditorValue(!1)}onEditorArrayFormula(){this._saveEditorValue(!0),this.editor.deactivate(!0)}onEditorActivate(){let sheet=this._workbook.activeSheet();sheet._setFormulaSelections(this.editor.highlightedRefs()),sheet.isInEditMode(!0)}onEditorDeactivate(){let sheet=this._workbook.activeSheet();sheet.isInEditMode(!1),sheet._setFormulaSelections([])}onEditorUpdate(){this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs())}onEditorBarFocus(){!1===this._workbook.activeSheet().selection().enable()||this.editor.activate({range:this._workbook.activeSheet().selection(),rect:this.view.activeCellRectangle(),tooltip:this._activeTooltip()})}onEditorCellFocus(){this.editor.scale()}onEditorEsc(){this.resetEditorValue(),this.editor.deactivate(),this.clipboardElement.focus()}insertNewline(e){e.preventDefault(),this.editor.insertNewline()}onEditorBlur(e,action){e.defaultPrevented||this.editor.isFiltered()||(this._preventNavigation=!1,this.editor.deactivate(),this._preventNavigation||(this.clipboardElement.focus(),this.navigator.navigateInSelection(ENTRY_ACTIONS[action])))}onEditorAction(event,action){if(event.defaultPrevented)return;let editor=this.editor,sheet=this._workbook.activeSheet();this._casualEditing&&/^(?:up|right|down|left)$/.test(action)?(this.deactivateEditor(),this.navigator.moveActiveCell(ACTIONS[action]),event.preventDefault()):editor.canInsertRef(!0)&&(this.navigator.moveActiveCell(ACTIONS[action]),editor.activeEditor().refAtPoint(sheet),sheet._setFormulaSelections(editor.highlightedRefs()),event.preventDefault())}onEditorShiftAction(event,action){let editor=this.editor,sheet=this._workbook.activeSheet();editor.canInsertRef(!0)&&(this.navigator.modifySelection(ACTIONS[action.replace("shift+","")],this.appendSelection),editor.activeEditor().refAtPoint(sheet),sheet._setFormulaSelections(editor.highlightedRefs()),event.preventDefault())}resetEditorValue(){let sheet=this._workbook.activeSheet(),ref=sheet.activeCell(),input=this._workbook._inputForRef(ref),x=sheet.range(ref).intersectingArrayFormula();x&&(input="="+x.formula),this.editor.value(input,Boolean(x))}activateEditor(casual){this._casualEditing=casual,this.editor.activate({range:this._workbook.activeSheet().selection(),rect:this.view.activeCellRectangle(),tooltip:this._activeTooltip()}).focus()}deactivateEditor(){this.view.editor.deactivate()}onCommandRequest(e){e.command?this._execute(e):this._workbook.undoRedoStack[e.action]()}onDialogRequest(e){let additionalOptions={pdfExport:this._workbook.options.pdf,excelExport:this._workbook.options.excel};e.options?deepExtend(e.options,additionalOptions):e.options=additionalOptions,this.view.openDialog(e.name,e.options)}onNameEditorEnter({value}){let ref,workbook=this._workbook,sheet=workbook.activeSheet(),name=void 0!==value?value:this.view.nameEditor.value();if(ref=calc.parseReference(name,!0)||workbook.nameValue(name),ref instanceof Ref){if(ref.sheet&&ref.sheet.toLowerCase()!==sheet.name().toLowerCase()){let tmp=workbook.sheetByName(ref.sheet);tmp&&(workbook.activeSheet(tmp),sheet=tmp)}sheet.range(ref).select()}else ref=sheet.selection()._ref.clone().simplify().setSheet(sheet.name(),!0),this._execute({command:"DefineNameCommand",options:{name,value:ref}}),this.clipboardElement.focus()}onNameEditorCancel(){this.clipboardElement.focus()}onNameEditorSelect(ev){let name=ev.name,workbook=this._workbook,sheet=workbook.activeSheet(),ref=workbook.nameValue(name);if(ref instanceof Ref){if(ref.sheet&&ref.sheet.toLowerCase()!==sheet.name().toLowerCase()){let tmp=workbook.sheetByName(ref.sheet);tmp&&(workbook.activeSheet(tmp),sheet=tmp)}sheet.range(ref).select()}else this.clipboardElement.focus()}onNameEditorDelete(ev){this._execute({command:"DeleteNameCommand",options:{name:ev.name}}),this.clipboardElement.focus()}}class RangeTreeNode{constructor(level,value,left,right){this.level=level,this.value=value,this.left=left,this.right=right}}const NilNode={left:void 0,right:void 0,level:0};function skew(n){let node=n;if(node.left.level===node.level){let temp=node;node=node.left,temp.left=node.right,node.right=temp}return node}function split(n){let node=n;if(node.right.right.level===node.level){let temp=node;node=node.right,temp.right=node.left,node.left=temp,node.level+=1}return node}function index_esm_insert(node,value){return node===NilNode?new RangeTreeNode(1,value,NilNode,NilNode):(node.value.start>value.start?node.left=index_esm_insert(node.left,value):node.right=index_esm_insert(node.right,value),split(skew(node)))}function remove(n,value){let node=n;if(node===NilNode)return node;let diff=node.value.start-value.start;if(0===diff)if(node.left!==NilNode&&node.right!==NilNode){let heir=node.left;for(;heir.right!==NilNode;)heir=heir.right;node.value=heir.value,node.left=remove(node.left,node.value)}else node=node.left===NilNode?node.right:node.left;else diff>0?node.left=remove(node.left,value):node.right=remove(node.right,value);return(node.left.level<node.level-1||node.right.level<node.level-1)&&(node.level-=1,node.right.level>node.level&&(node.right.level=node.level),node=skew(node),node.right=skew(node.right),node.right.right=skew(node.right.right),node=split(node),node.right=split(node.right)),node}NilNode.left=NilNode,NilNode.right=NilNode;class ValueRange{constructor(start,end,value){this.start=start,this.end=end,this.value=value}intersects(range){return range.start<=this.end&&range.end>=this.start}clone(){return new ValueRange(this.start,this.end,this.value)}}class RangeTree{constructor(){this.root=NilNode}insert(value){this.root=index_esm_insert(this.root,value)}remove(value){this.root=remove(this.root,value)}findrange(value){let node=this.root;for(;node!==NilNode;)if(value<node.value.start)node=node.left;else{if(!(value>node.value.end))return node.value;node=node.right}return null}values(){let result=[];return values(this.root,result),result}intersecting(start,end){let ranges=[];return intersecting(this.root,new ValueRange(start,end),ranges),ranges}map(callback){let tree=new RangeTree;return map(tree,this.root,callback),tree}forEach(callback){forEach(this.root,callback)}clone(){return this.map((function(value){return value.clone()}))}first(){let first=this.root;for(;first.left!==NilNode;)first=first.left;return first}last(){let last=this.root;for(;last.right!==NilNode;)last=last.right;return last}}function values(node,result){node!==NilNode&&(values(node.left,result),result.push(node.value),values(node.right,result))}function intersecting(node,range,ranges){if(node===NilNode)return;let value=node.value;range.start<value.start&&intersecting(node.left,range,ranges),value.intersects(range)&&ranges.push(value),range.end>value.end&&intersecting(node.right,range,ranges)}function map(tree,root,callback){root!==NilNode&&(map(tree,root.left,callback),tree.insert(callback(root.value)),map(tree,root.right,callback))}function forEach(root,callback){root!==NilNode&&(forEach(root.left,callback),callback(root.value),forEach(root.right,callback))}class RangeList{constructor(start,end,value){void 0===end?this.tree=start:(this.tree=new RangeTree,this.tree.insert(new ValueRange(start,end,value)))}values(){return this.tree.values()}map(callback){return new RangeList(this.tree.map(callback))}forEach(callback){this.tree.forEach(callback)}intersecting(start,end){return this.tree.intersecting(start,end)}first(){return this.tree.first().value}last(){return this.tree.last().value}insert(start,end,value){return this.tree.insert(new ValueRange(start,end,value))}value(s,e,value){let start=s,end=e;if(void 0===value)return void 0===end&&(end=start),this.intersecting(start,end)[0].value;let ranges=this.tree.intersecting(start-1,end+1);if(ranges.length){let firstRange=ranges[0],lastRange=ranges[ranges.length-1];firstRange.end<start&&(firstRange.value===value?start=firstRange.start:ranges.shift()),lastRange.start>end&&(lastRange.value===value?end=lastRange.end:ranges.pop());for(let i=0,length=ranges.length;i<length;i++){let range=ranges[i],rangeValue=range.value,rangeStart=range.start,rangeEnd=range.end;this.tree.remove(range),rangeStart<start&&(rangeValue!==value?this.insert(rangeStart,start-1,rangeValue):start=rangeStart),rangeEnd>end&&(rangeValue!==value?this.insert(end+1,rangeEnd,rangeValue):end=rangeEnd)}}this.insert(start,end,value)}expandedValues(start,end){let ranges=this.intersecting(start,end),result=[],rangeIndex=0;for(let i=start;i<=end;i++)ranges[rangeIndex].end<i&&rangeIndex++,result.push({index:i-start,value:ranges[rangeIndex].value});return result}sortedIndices(start,end,valueComparer,indices){let result=this.expandedValues(start,end),comparer=function(a,b){return a.value===b.value?a.index-b.index:valueComparer(a.value,b.value)};return indices&&(comparer=function(a,b){let x=indices[a.index],y=indices[b.index];return x.value===y.value?valueComparer(a.value,b.value):a.index-b.index}),result.sort(comparer),result}sort(start,end,indices){if(1===this.intersecting(start,end).length)return;let expValues=this.expandedValues(start,end);for(let i=0,len=indices.length;i<len;i++)this.value(i+start,i+start,expValues[indices[i].index].value)}copy(sourceStart,sourceEnd,targetStart){let end,intValues=this.intersecting(sourceStart,sourceEnd),start=targetStart;for(let i=0,len=intValues.length;i<len;i++){let rangeStart=intValues[i].start;rangeStart<sourceStart&&(rangeStart=sourceStart);let rangeEnd=intValues[i].end;rangeEnd>sourceEnd&&(rangeEnd=sourceEnd),end=start+(rangeEnd-rangeStart),this.value(start,end,intValues[i].value),start=++end}}iterator(start,end){return new Iterator(start,end,this.intersecting(start,end))}getState(){return this.tree.clone()}setState(state){this.tree=state.clone()}toJSON(){return this.values()}fromJSON(vals){vals.forEach((v=>{this.value(v.start,v.end,v.value)}))}}class Iterator{constructor(start,end,ranges){this.start=start,this.end=end,this.index=0,this.ranges=ranges}unique(){return this.ranges.map((function(range){return range.value}))}at(index){for(;this.ranges[this.index]&&this.ranges[this.index].end<index;)this.index++;return this.ranges[this.index]&&this.ranges[this.index].value}forEach(callback){for(let i=this.start;i<=this.end;i++)callback(this.at(i),i);this.index=0}}class SparseRangeList extends RangeList{constructor(start,end,value){super(start,end,value),this._defaultValue=value,this.tree=new RangeTree,this.range=new ValueRange(start,end,value)}intersecting(s,end){let range,start=s,ranges=this.tree.intersecting(start,end),result=[];if(!ranges.length)return[this.range];for(let i=0,len=ranges.length;i<len;i++)range=ranges[i],range.start>start&&result.push(new ValueRange(start,range.start-1,this.range.value)),result.push(range),start=range.end+1;return range.end<end&&result.push(new ValueRange(range.end+1,end,this.range.value)),result}insert(start,end,v){let value=v;null==value&&(value=this._defaultValue),value!==this.range.value&&this.tree.insert(new ValueRange(start,end,value))}lastRangeStart(){let node=this.tree.root;if(node===NilNode)return this.range.start;for(;node.right!==NilNode;)node=node.right;return node.value.end+1}}class Property{constructor(list){this.list=list}get(index){return this.parse(this.list.value(index,index))}set(start,end,value){void 0===value&&(value=end,end=start),this.list.value(start,end,value)}parse(value){return value}copy(start,end,dst){this.list.copy(start,end,dst)}iterator(start,end){return this.list.iterator(start,end)}}class JsonProperty extends Property{set(start,end,value){this.list.value(start,end,JSON.stringify(value))}parse(value){return JSON.parse(value)}}const propertyBagSpec=[{property:Property,name:"format",value:null,sortable:!0,serializable:!0},{property:class ValueProperty extends Property{constructor(values,formats){super(values),this.formats=formats}set(start,end,value){value instanceof Date?(value=dateToSerial(value),this.formats.value(start,end)||this.formats.value(start,end,function toExcelFormat$1(format){return format.replace(/M/g,"m").replace(/'/g,'"').replace(/tt/,"am/pm")}(culture().calendar.patterns.d))):"number"==typeof value&&(value=calc.runtime.limitPrecision(value)),this.list.value(start,end,value)}},name:"value",value:null,sortable:!0,serializable:!0,depends:"format"},{property:Property,name:"formula",value:null,sortable:!0,serializable:!0},{property:Property,name:"background",value:null,sortable:!0,serializable:!0},{property:JsonProperty,name:"vBorders",value:null,sortable:!1,serializable:!1},{property:JsonProperty,name:"hBorders",value:null,sortable:!1,serializable:!1},{property:JsonProperty,name:"dBorders",value:null,sortable:!1,serializable:!0},{property:Property,name:"color",value:null,sortable:!0,serializable:!0},{property:Property,name:"fontFamily",value:null,sortable:!0,serializable:!0},{property:Property,name:"underline",value:null,sortable:!0,serializable:!0},{property:Property,name:"fontSize",value:null,sortable:!0,serializable:!0},{property:Property,name:"italic",value:null,sortable:!0,serializable:!0},{property:Property,name:"bold",value:null,sortable:!0,serializable:!0},{property:Property,name:"textAlign",value:null,sortable:!0,serializable:!0},{property:Property,name:"indent",value:null,sortable:!0,serializable:!0},{property:Property,name:"verticalAlign",value:null,sortable:!0,serializable:!0},{property:Property,name:"wrap",value:null,sortable:!0,serializable:!0},{property:Property,name:"validation",value:null,sortable:!1,serializable:!0},{property:Property,name:"enable",value:null,sortable:!1,serializable:!0},{property:Property,name:"link",value:null,sortable:!0,serializable:!0},{property:Property,name:"editor",value:null,sortable:!0,serializable:!0},{property:Property,name:"comment",value:null,sortable:!0,serializable:!0},{property:Property,name:"html",value:null,sortable:!0,serializable:!0}];class PropertyBag{constructor(rowCount,columnCount,defaultValues){defaultValues=defaultValues||{};let cellCount=rowCount*columnCount-1;this.specs=propertyBagSpec,this.rowCount=rowCount,this.columnCount=columnCount,this.cellCount=cellCount,this.properties={},this.lists={},this.specs.forEach((function(spec){let name=spec.name,value=defaultValues[name];void 0===value&&(value=spec.value),this.lists[name]=new SparseRangeList(0,cellCount,value),(this.properties[name]=new spec.property(this.lists[name],this.lists[spec.depends])).spec=spec}),this),this.lists.formula.tree.clone=cloneFormulaTree,this.lists.validation.tree.clone=cloneFormulaTree}_resize(new_rows,new_cols){let self=this,old_rows=self.rowCount,cell_count=new_rows*new_cols-1;function scaleIndex(index){return(index/old_rows|0)*new_rows+index%old_rows}function scaleNode(node){node.start=scaleIndex(node.start),node.end=scaleIndex(node.end)}Object.keys(self.lists).forEach((function(name){let list=self.lists[name];new_rows!==old_rows&&list.forEach(scaleNode),list.range.end=cell_count})),self.rowCount=new_rows,self.columnCount=new_cols,self.cellCount=cell_count}getState(){let state={};return this.specs.forEach((function(spec){state[spec.name]=this.lists[spec.name].getState()}),this),state}setState(state){this.specs.forEach((function(spec){this.lists[spec.name].setState(state[spec.name])}),this)}get(name,index){if(void 0===index)return this.lists[name];switch(name){case"borderRight":index+=this.rowCount;case"borderLeft":name="vBorders";break;case"borderBottom":index++;case"borderTop":name="hBorders"}return index>this.cellCount?null:this.properties[name].get(index)}set(name,start,end,value){switch(name){case"borderRight":start+=this.rowCount,end+=this.rowCount;case"borderLeft":name="vBorders";break;case"borderBottom":start++,end++;case"borderTop":name="hBorders"}start<=end&&end<=this.cellCount&&this.properties[name].set(start,end,value)}fromJSON(index,value){for(let si=0;si<this.specs.length;si++){let spec=this.specs[si];spec.serializable&&void 0!==value[spec.name]&&this.set(spec.name,index,index,value[spec.name],!1)}["borderLeft","borderRight","borderTop","borderBottom"].forEach((function(b){void 0!==value[b]&&this.set(b,index,index,value[b])}),this)}copy(sourceStart,sourceEnd,targetStart){this.specs.forEach((function(spec){this.properties[spec.name].copy(sourceStart,sourceEnd,targetStart)}),this)}iterator(name,start,end){let prop=this.properties[name],iter=prop.iterator(start,end),at=iter.at,cellCount=this.cellCount;return iter.at=function(index){return index>cellCount?null:prop.parse(at.call(iter,index))},iter.name=name,iter.value=prop.spec.value,iter}sortable(){return this.specs.filter((function(spec){return spec.sortable})).map((function(spec){return this.lists[spec.name]}),this)}iterators(start,end){return this.specs.reduce(function(ret,spec){return spec.serializable&&ret.push(this.iterator(spec.name,start,end)),ret}.bind(this),[])}forEach(start,end,callback){let values,index,iterators=this.iterators(start,end),hBorders=this.iterator("hBorders",start,end+1),leftBorders=this.iterator("vBorders",start,end),rightBorders=this.iterator("vBorders",start+this.rowCount,end+this.rowCount);function addBorder(name,iterator,index){let val=iterator.at(index);val!==iterator.value&&(values[name]=val)}for(index=start;index<=end;index++){values={};for(let i=0;i<iterators.length;i++){let iterator=iterators[i],value=iterator.at(index);value!==iterator.value&&(values[iterator.name]=value)}addBorder("borderLeft",leftBorders,index),addBorder("borderRight",rightBorders,index+this.rowCount),addBorder("borderTop",hBorders,index),(index+1)%this.rowCount&&addBorder("borderBottom",hBorders,index+1),callback(values)}}forEachProperty(callback){for(let name in this.properties)callback(this.properties[name])}}function cloneFormulaValue(x){return(x=x.clone()).value=x.value.deepClone(),x}function cloneFormulaTree(){let tree=this.map(cloneFormulaValue);return tree.clone=cloneFormulaTree,tree}const ALL_PROPERTIES=propertyBagSpec.reduce((function(a,spec){return spec.serializable&&a.push(spec.name),a}),["borderTop","borderRight","borderBottom","borderLeft"]);class Validation{constructor(options){this.handler=options.handler,this.from=options.from,this.to=options.to,this.dataType=options.dataType,this.comparerType=options.comparerType,this.type=options.type?options.type:"warning",this.allowNulls=!!options.allowNulls,this.fromIsDateValue=!!options.fromIsDateValue,this.toIsDateValue=!!options.toIsDateValue,this.showButton=options.showButton,this.fromIsListValue=!!options.fromIsListValue,this.sheet=options.sheet,this.row=options.row,this.col=options.col,options.tooltipMessageTemplate&&(this.tooltipMessageTemplate=options.tooltipMessageTemplate),options.tooltipTitleTemplate&&(this.tooltipTitleTemplate=options.tooltipTitleTemplate),options.messageTemplate&&(this.messageTemplate=options.messageTemplate),options.titleTemplate&&(this.titleTemplate=options.titleTemplate)}_formatMessages(format){let from=this.from?this.from_value:"",to=this.to?this.to_value:"",fromFormula=this.from?this.from.toString():"",toFormula=this.to?this.to.toString():"",dataType=this.dataType,type=this.type,comparerType=this.comparerType;return intl().format(format,from,to,fromFormula,toFormula,dataType,type,comparerType)}_setMessages(){this.title="",this.message="",this.tooltipTitleTemplate&&(this.tooltipTitle=this._formatMessages(this.tooltipTitleTemplate)),this.tooltipMessageTemplate&&(this.tooltipMessage=this._formatMessages(this.tooltipMessageTemplate)),this.titleTemplate&&(this.title=this._formatMessages(this.titleTemplate)),this.messageTemplate&&(this.message=this._formatMessages(this.messageTemplate))}_getListData(){if(!this.from_value||!this.from_value.data)return[];let i,y,cube=this.from_value.data,data=[];for(i=0;i<cube.length;i++){let array=cube[i];if(array)for(y=0;y<array.length;y++)data.push(array[y])}return data}clone(sheet,row,col){let options=this._getOptions();options.from&&(options.from=options.from.clone(sheet,row,col)),options.to&&(options.to=options.to.clone(sheet,row,col));const optionsResult=Object.assign({},options);return optionsResult.handler=this.handler,optionsResult.sheet=sheet,optionsResult.row=row,optionsResult.col=col,new Validation(optionsResult)}deepClone(){let v=new Validation(this);return v.from=v.from.deepClone(),v.to&&(v.to=v.to.deepClone()),v}exec(ss,compareValue,compareFormat,callback){let self=this;function getValue(val){return val instanceof Ref&&(val=ss.getData(val),Array.isArray(val)&&(val=val[0])),val}let calculateFromCallBack=function(val){self.from_value=getValue(val),self.value=self.handler.call(self,compareValue,compareFormat),self._setMessages(),callback&&callback(self.value)};self.to?self.to.exec(ss,(function(val){self.to_value=getValue(val),self.from.exec(ss,calculateFromCallBack)})):self.from.exec(ss,calculateFromCallBack)}reset(){this.from&&this.from.reset(),this.to&&this.to.reset(),delete this.value}adjust(affectedSheet,operation,start,delta){let prevFrom,prevTo,modified,formulaRow=this.row,formulaCol=this.col;if(this.from&&(prevFrom=this.from.adjust(affectedSheet,operation,start,delta)),this.to&&(prevTo=this.to.adjust(affectedSheet,operation,start,delta)),this.sheet.toLowerCase()===affectedSheet.toLowerCase())switch(operation){case"row":formulaRow>=start&&(modified=!0,this.row+=delta);break;case"col":formulaCol>=start&&(modified=!0,this.col+=delta)}if(modified||prevFrom||prevTo){let v=new Validation(this);return v.from=prevFrom,v.to=prevTo,v.row=formulaRow,v.col=formulaCol,v}}toJSON(){let options=this._getOptions();return options.from&&(options.from=options.from.toString(),"list"===options.dataType&&(options.from=options.from.replace(/^_matrix\((.*)\)$/i,"$1"),delete options.fromIsListValue),"date"===options.dataType&&this.fromIsDateValue&&(options.from=options.from.replace(/^DATEVALUE\("(.*)"\)$/i,"$1"),delete options.fromIsDateValue)),options.to&&(options.to=options.to.toString(),"date"===options.dataType&&this.toIsDateValue&&(options.to=options.to.replace(/^DATEVALUE\("(.*)"\)$/i,"$1"),delete options.toIsDateValue)),options}_getOptions(){return{from:this.from,to:this.to,dataType:this.dataType,type:this.type,comparerType:this.comparerType,row:this.row,col:this.col,sheet:this.sheet,allowNulls:this.allowNulls,fromIsListValue:this.fromIsListValue,fromIsDateValue:this.fromIsDateValue,toIsDateValue:this.toIsDateValue,tooltipMessageTemplate:this.tooltipMessageTemplate,tooltipTitleTemplate:this.tooltipTitleTemplate,messageTemplate:this.messageTemplate,titleTemplate:this.titleTemplate,showButton:this.showButton}}}const validationExport={compile:function compileValidation(sheet,row,col,validation){let validationHandler,comparer,parsedFromDate,parsedToDate;if("string"==typeof validation&&(validation=JSON.parse(validation)),validation.from&&("list"!==validation.dataType||validation.fromIsListValue||(validation.from.indexOf("{")>-1&&(validation.from=validation.from.replace(/\"/g,"").replace("{",'"').replace("}",'"')),validation.from=intl().format("_matrix({0})",validation.from),validation.fromIsListValue=!0),"date"===validation.dataType&&(parsedFromDate=calc.runtime.parseDate(validation.from),parsedFromDate&&(validation.from=intl().format('DATEVALUE("{0}")',validation.from),validation.fromIsDateValue=!0)),validation.from=calc.compile(calc.parseFormula(sheet,row,col,validation.from))),validation.to&&("date"===validation.dataType&&(parsedToDate=calc.runtime.parseDate(validation.to),parsedToDate&&(validation.to=intl().format('DATEVALUE("{0}")',validation.to),validation.toIsDateValue=!0)),validation.to=calc.compile(calc.parseFormula(sheet,row,col,validation.to))),comparer="custom"===validation.dataType?validationExport.validationComparers.custom:"list"===validation.dataType?validationExport.validationComparers.list:validationExport.validationComparers[validation.comparerType],!comparer)throw intl().format("'{0}' comparer is not implemented.",validation.comparerType);validationHandler=function(valueToCompare){let toValue=this.to&&(this.to_value||0===this.to_value)?this.to_value:void 0;if(null===valueToCompare||""===valueToCompare)this.allowNulls?this.value=!0:this.value=!1;else if("custom"===this.dataType)this.value=comparer(valueToCompare,this.from_value,toValue);else if("list"===this.dataType){let data=this._getListData();this.value=comparer(valueToCompare,data,toValue)}else this.value=comparer(valueToCompare,this.from_value,toValue);return this.value};const resultOptions=Object.assign({},validation);return resultOptions.handler=validationHandler,resultOptions.sheet=sheet,resultOptions.row=row,resultOptions.col=col,new Validation(resultOptions)},validationComparers:{greaterThan:function(valueToCompare,from){return valueToCompare>from},lessThan:function(valueToCompare,from){return valueToCompare<from},between:function(valueToCompare,from,to){return valueToCompare>=from&&valueToCompare<=to},equalTo:function(valueToCompare,from){return valueToCompare===from},notEqualTo:function(valueToCompare,from){return valueToCompare!==from},greaterThanOrEqualTo:function(valueToCompare,from){return valueToCompare>=from},lessThanOrEqualTo:function(valueToCompare,from){return valueToCompare<=from},notBetween:function(valueToCompare,from,to){return valueToCompare<from||valueToCompare>to},custom:function(valueToCompare,from){return from},list:function(valueToCompare,data){return data.indexOf(valueToCompare)>-1}}};validationExport.Validation=Validation;const{measureText}=util;let PROPERTIES=["color","fontFamily","underline","italic","bold","textAlign","indent","verticalAlign","background","format","link","editor","borderTop","borderRight","borderBottom","borderLeft","comment","html"],Range$1=class Range{constructor(ref,sheet){this._sheet=sheet,this._ref=ref}clone(){return new Range(this._ref.clone(),this._sheet)}skipHiddenCells(){let refs=[],self=this,sheet=self._sheet,skipHiddenRows=sheet.isHiddenRow.bind(sheet),skipHiddenCols=sheet.isHiddenColumn.bind(sheet);return self._ref.forEach((function(ref){let tl=(ref=self._normalize(ref.toRangeRef())).topLeft,br=ref.bottomRight,rows=partition(tl.row,br.row,skipHiddenRows),cols=partition(tl.col,br.col,skipHiddenCols);for(let i=0;i<rows.length;++i)for(let j=0;j<cols.length;++j)refs.push(new RangeRef(new CellRef(rows[i].begin,cols[j].begin),new CellRef(rows[i].end,cols[j].end)))})),sheet.range(refs.length>1?new UnionRef(refs):refs[0])}_normalize(ref){return this._sheet._grid.normalize(ref)}_set(name,value,noTrigger){let self=this,sheet=self._sheet;return self._ref.forEach((function(ref){let result=ref;if(("value"===name||"formula"===name||"link"===name)&&ref.topLeft){let topLeftRef=new CellRef(ref.topLeft.row,ref.topLeft.col);sheet.forEachMergedCell((function(f){f.intersects(topLeftRef)&&(result=topLeftRef)}))}sheet._set(result.toRangeRef(),name,value)})),noTrigger||sheet.triggerChange({recalc:"formula"===name||"value"===name||"validation"===name,value,range:self,ref:self._ref,isValue:"value"===name}),self}_get(name){return this._sheet._get(this._ref.toRangeRef(),name)}_property(name,value){return void 0===value?this._get(name):this._set(name,value)}value(value){return void 0!==value&&this._set("formula",null,!0),this._property("value",value)}html(value){return this._property("html",value)}resize(direction){let ref=this._resizedRef(direction);return new Range(ref,this._sheet)}_resizedRef(direction){return this._ref.map((function(ref){return ref.toRangeRef().resize(direction)}))}input(value,options){options=Object.assign({},options,{arrayFormula:!1});let x,existingFormat=this._get("format");if(void 0!==value){let tl=this._ref.toRangeRef().topLeft;return x=calc.parse(this._sheet.name(),tl.row,tl.col,value,existingFormat),this._sheet.batch(function(){let formula=null;if("exp"===x.type)formula=calc.compile(x);else if("@"!==existingFormat){let existingFormatType=existingFormat&&formatting.type(x.value,existingFormat);"date"===x.type&&"date"!==existingFormatType?this.format(x.format||function toExcelFormat(format){return format.replace(/M/g,"m").replace(/'/g,'"').replace(/tt/,"am/pm")}(culture().calendar.patterns.d)):"percent"===x.type&&"percent"!==existingFormatType?this.format(100*x.value==(100*x.value|0)?"0%":"0.00%"):x.format&&(!existingFormat||x.currency||"number"===existingFormatType&&"number"===x.type&&x.format.length>existingFormat.length)&&this.format(x.format)}else"string"!==x.type&&(x.value=value);this.formula(formula,options.arrayFormula),formula||this.value(x.value)}.bind(this),{recalc:!0,value,ref:this._ref,editorChange:this._sheet.isInEditMode(),isValue:!0}),this}{value=this._get("value");let formula=this._get("formula"),type=existingFormat&&!formula&&formatting.type(value,existingFormat);if(formula)value="="+formula;else OUT:{if(existingFormat&&"date"===type){let t1=formatting.text(value,existingFormat);if(x=calc.parse(null,null,null,t1,existingFormat),t1===formatting.text(x.value,existingFormat)){value=t1;break OUT}}if("date"===type){const intlVal=intl();value=intlVal.toString(serialToDate(value),culture().calendar.patterns.d,intlVal.locale)}else"percent"===type?value=calc.runtime.limitPrecision(100*value)+"%":"string"==typeof value&&(/^[=']/.test(value)||/^(?:true|false)$/i.test(value)||function looksLikeANumber(str){return!/^=/.test(str)&&/number|percent/.test(calc.parse(null,0,0,str).type)}(value))?value="'"+value:this._sheet._useCultureDecimals()&&"number"==typeof value&&value!==Math.floor(value)&&(value=String(value).replace(".",culture().numbers.symbols.decimal))}return value}}enable(value){return void 0===value?!withExit((function(exit){this._sheet.forEach(this._ref,(function(_,__,data){!1===data.enable&&exit(!0)}))}),this):this._property("enable",value)}formula(value,arrayFormula){let self=this;if(void 0===value){let f=self._get("formula");return f?""+f:null}if(arrayFormula){let ref=this._ref.toRangeRef();(value=self._sheet.range(ref.topLeft)._set("formula",value)._get("formula"))&&value.setArrayFormulaRange(ref)}else self._set("formula",value);return self}intersectingArrayFormula(){let ref=this._ref.clone().simplify().setSheet(this._sheet.name());return withExit((function(exit){this._sheet._forFormulas((function(f){let r=f.arrayFormulaRange;r&&(r=ref.intersect(r))!==NULLREF&&exit({formula:f,intersection:r})}))}),this)}canEditArrayFormula(){let x=this.intersectingArrayFormula();return!x||x.formula.arrayFormulaRange.eq(x.intersection)}validation(value){if(void 0===value){let f=this._get("validation");return f?f.toJSON():null}return this._property("validation",value)}_getValidationState(){let ci,ri,ref=this._ref.toRangeRef(),topLeftRow=ref.topLeft.row,topLeftCol=ref.topLeft.col,bottomRightRow=ref.bottomRight.row,bottomRightCol=ref.bottomRight.col;for(ci=topLeftCol;ci<=bottomRightCol;ci++)for(ri=topLeftRow;ri<=bottomRightRow;ri++){let validation=this._sheet._validation(ri,ci);if(validation&&"reject"===validation.type&&!1===validation.value)return validation}return!1}merge(){return this._ref=this._sheet._merge(this._ref),this}unmerge(){let mergedCells=this._sheet._mergedCells;return this._ref.forEach((function(ref){ref.toRangeRef().intersecting(mergedCells).forEach((function(mergedRef){mergedCells.splice(mergedCells.indexOf(mergedRef),1)}))})),this._sheet.triggerChange({}),this}select(){return this._sheet.select(this._ref),this}values(values){if(this._ref instanceof UnionRef)throw new Error("Unsupported for multiple ranges.");if(this._ref===NULLREF){if(void 0!==values)throw new Error("Unsupported for NULLREF.");return[]}let ci,ri,ref=this._ref.toRangeRef(),topLeftRow=ref.topLeft.row,topLeftCol=ref.topLeft.col,bottomRightRow=ref.bottomRight.row,bottomRightCol=ref.bottomRight.col;if(void 0===values){values=new Array(ref.height());for(let vi=0;vi<values.length;vi++)values[vi]=new Array(ref.width());for(ci=topLeftCol;ci<=bottomRightCol;ci++)for(ri=topLeftRow;ri<=bottomRightRow;ri++)values[ri-topLeftRow][ci-topLeftCol]=this._sheet._value(ri,ci);return values}for(this._sheet._set(ref,"formula",null),ci=topLeftCol;ci<=bottomRightCol;ci++)for(ri=topLeftRow;ri<=bottomRightRow;ri++){let row=values[ri-topLeftRow];if(row){let value=row[ci-topLeftCol];void 0!==value&&this._sheet._value(ri,ci,value)}}return this._sheet.triggerChange({recalc:!0,ref}),this}_properties(props,isAutofill){if(this._ref instanceof UnionRef)throw new Error("Unsupported for multiple ranges.");if(this._ref===NULLREF){if(void 0!==props)throw new Error("Unsupported for NULLREF.");return[]}let ci,ri,ref=this._ref.toRangeRef(),topLeftRow=ref.topLeft.row,topLeftCol=ref.topLeft.col,bottomRightRow=ref.bottomRight.row,bottomRightCol=ref.bottomRight.col,sheet=this._sheet;if(void 0===props)return props=new Array(ref.height()),sheet.forEach(ref,(function(row,col,data){col-=topLeftCol,(props[row-=topLeftRow]||(props[row]=[]))[col]=data})),props;{let data;ref=ref.clone();let setProp=function(propName){let propValue=data[propName];ref.topLeft.row=ref.bottomRight.row=ri,ref.topLeft.col=ref.bottomRight.col=ci,"value"===propName&&sheet._set(ref,"formula",null),sheet._set(ref,propName,propValue)};for(ci=topLeftCol;ci<=bottomRightCol;ci++)if(isAutofill||!sheet.isHiddenColumn(ci))for(ri=topLeftRow;ri<=bottomRightRow;ri++){if(!isAutofill&&sheet.isHiddenRow(ri))continue;if(isAutofill&&sheet.isFilteredRow(ri))continue;let row=props[ri-topLeftRow];row&&(data=row[ci-topLeftCol],data&&Object.keys(data).forEach(setProp))}return sheet.triggerChange({recalc:!0,ref:this._ref}),this}}clear(options){let clearAll=(options=options||{}).clearAll||!Object.keys(options).length,sheet=this._sheet,reason={recalc:clearAll||options.contentsOnly,ref:this._ref};return sheet.batch(function(){reason.recalc&&this.formula(null),clearAll&&this.validation(null),(clearAll||options.formatOnly)&&(PROPERTIES.forEach(function(x){options.keepBorders&&/^border/i.test(x)||this[x](null)}.bind(this)),this.fontSize(null),this.wrap(null),this.unmerge())}.bind(this),reason),this}clearContent(){return this.clear({contentsOnly:!0})}clearFormat(){return this.clear({formatOnly:!0})}isSortable(){return!this.cantSort()}cantSort(){if(this._ref instanceof UnionRef)return{code:"cantSortMultipleSelection",message:"Unsupported for multiple ranges."};if(this._ref===NULLREF)return{code:"cantSortNullRef",message:"Unsupported for NULLREF."};let mc=this._sheet._getMergedCells(this._ref.toRangeRef()),primary=mc.primary,secondary=mc.secondary,width=null,height=null,cant={};try{this._sheet.forEach(this,(function(row,col){let id=new CellRef(row,col).print(),merged=primary[id];if(merged){if(null===width)width=merged.width(),height=merged.height();else if(width!==merged.width()||height!==merged.height())throw cant}else if(!secondary[id]&&mc.hasMerged)throw cant}))}catch(ex){if(ex!==cant)throw ex;return{code:"cantSortMixedCells",message:"Unsupported for range containing cells of different shapes."}}return!1}sort(spec){let reason=this.cantSort();if(reason)throw new Error(reason.message);return void 0===spec&&(spec={column:0}),spec=spec instanceof Array?spec:[spec],this._sheet._sortBy(this._ref.toRangeRef(),spec.map((function(spec,index){return"number"==typeof spec&&(spec={column:spec}),{index:void 0===spec.column?index:spec.column,ascending:void 0===spec.ascending||spec.ascending}}))),this}isFilterable(){return!(this._ref instanceof UnionRef)}filter(spec){if(this._ref instanceof UnionRef)throw new Error("Unsupported for multiple ranges.");return!1===spec?this.clearFilters():(spec=!0===spec?[]:spec instanceof Array?spec:[spec],this._sheet._filterBy(this._ref.toRangeRef(),spec.map((function(spec,index){return{index:void 0===spec.column?void 0===spec.index?index:spec.index:spec.column,filter:spec.filter}})))),this}clearFilter(spec){this._sheet.clearFilter(spec)}clearFilters(){let filter=this._sheet.filter(),spec=[];if(filter){for(let i=0;i<filter.columns.length;i++)spec.push(filter.columns[i].index);this._sheet.batch((function(){this.clearFilter(spec),this._filter=null}),{layout:!0,filter:!0})}}hasFilter(){let filter=this._sheet.filter();return Boolean(filter)}leftColumn(){return new Range(this._ref.leftColumn(),this._sheet)}rightColumn(){return new Range(this._ref.rightColumn(),this._sheet)}topRow(){return new Range(this._ref.topRow(),this._sheet)}bottomRow(){return new Range(this._ref.bottomRow(),this._sheet)}column(column){return new Range(this._ref.toColumn(column),this._sheet)}row(row){return new Range(this._ref.toRow(row),this._sheet)}forEachRow(callback){this._ref.forEachRow(function(ref){callback(new Range(ref,this._sheet))}.bind(this))}forEachColumn(callback){this._ref.forEachColumn(function(ref){callback(new Range(ref,this._sheet))}.bind(this))}sheet(){return this._sheet}topLeft(){return this._ref.toRangeRef().topLeft}intersectingMerged(){let sheet=this._sheet,mergedCells=[];return sheet._mergedCells.forEach(function(ref){ref.intersects(this._ref)&&mergedCells.push(ref.toString())}.bind(this)),mergedCells}getState(propertyName){let properties,topLeft=this._ref.first(),state={ref:topLeft,data:[],origRef:this._ref,rows:this._sheet._rows.getState()};propertyName?properties="input"===propertyName?["value","formula"]:"border"===propertyName?["borderLeft","borderTop","borderRight","borderBottom"]:[propertyName]:(properties=ALL_PROPERTIES,state.mergedCells=this.intersectingMerged());let data=state.data;return this.forEachCell((function(row,col,cell){let cellState={},dr=row-topLeft.row,dc=col-topLeft.col;data[dr]||(data[dr]=[]),data[dr][dc]=cellState,properties.forEach((function(property){let value=void 0===cell[property]?null:cell[property];(value instanceof calc.runtime.Formula||value instanceof validationExport.Validation)&&(value=value.deepClone()),cellState[property]=value}))})),state}setState(state,clipboard){let sheet=this._sheet,origin=this._ref.first(),rowDelta=state.ref.row-origin.row,colDelta=state.ref.col-origin.col,internalClipboard=clipboard&&!clipboard.isExternal(),externalClipboard=clipboard&&!internalClipboard;sheet.batch(function(){state.mergedCells&&this.unmerge(),clipboard||this._sheet._rows.setState(state.rows);let row=origin.row,hasFilter=this.hasFilter();state.data.forEach((function(data,dr){if(hasFilter&&internalClipboard&&sheet.isHiddenRow(state.ref.row+dr))return;let col=origin.col;data.forEach((function(cellState,dc){if(hasFilter&&internalClipboard&&sheet.isHiddenColumn(state.ref.col+dc))return;let range=clipboard?sheet.range(row,col):sheet.range(origin.row+dr,origin.col+dc);if(range.enable()){for(let property in cellState)"value"!==property&&(clipboard&&"enable"===property||range._set(property,cellState[property]));if(!cellState.formula)if(externalClipboard)try{null==cellState.value?range._set("value",null):range.input(cellState.value)}catch(ex){range._set("value",cellState.value)}else range._set("value",cellState.value)}col++})),row++})),state.mergedCells&&state.mergedCells.forEach((function(merged){merged=sheet._ref(merged).relative(rowDelta,colDelta,3),sheet.range(merged).merge()}),this)}.bind(this),{recalc:!0,ref:this._ref})}_adjustRowHeight(){let that=this,sheet=that._sheet,mc=sheet._getMergedCells(that._ref.toRangeRef()),primary=mc.primary,secondary=mc.secondary;sheet.batch((function(){that.forEachRow((function(rowRange){let row=rowRange._ref.topLeft.row,height=sheet.rowHeight(row);height&&(rowRange.forEachCell((function(row,col,cell){let id=new CellRef(row,col).print();if(secondary[id])return;let width,merged=primary[id];width=merged?sheet._columns.sum(merged.topLeft.col,merged.bottomRight.col):sheet.columnWidth(col);let data=cell.value;cell.format&&null!=data&&(data=formatting.format(data,cell.format));let textHeight=function getTextHeight(text,width,fontFamily,fontSize,wrap){let styles={baselineMarkerSize:0,width:!0===wrap?width+"px":"auto","font-size":(fontSize||12)+"px","font-family":fontFamily||"Arial","white-space":!0===wrap?"pre-wrap":"pre","overflow-wrap":!0===wrap?"break-word":"normal","word-wrap":!0===wrap?"break-word":"normal"};return measureText(text,styles,{box:measureBox,normalizeText:!1}).height}(data,width,cell.fontFamily,cell.fontSize,cell.wrap);height=Math.max(height,textHeight)})),sheet.rowHeight(row,height))}))}),{layout:!0})}forEachCell(callback){this._ref.forEach(function(ref){this._sheet.forEach(ref.toRangeRef(),callback.bind(this))}.bind(this))}hasValue(){let defStyle=this._sheet._defaultCellStyle;return withExit((function(exit){this.forEachCell((function(row,col,cell){for(let key in cell){let val=cell[key];null!=val&&val!==defStyle[key]&&exit(!0)}}))}),this)}wrap(flag){return void 0===flag?Boolean(this._property("wrap")):(this._property("wrap",flag),null!==flag&&this._adjustRowHeight(),this)}fontSize(size){return void 0===size?this._property("fontSize"):(this._property("fontSize",size),null!==size&&this._adjustRowHeight(),this)}draw(options,callback){this._sheet.draw(this,options,callback)}insideBorders(value){return this.insideVerticalBorders(value).insideHorizontalBorders(value)}insideVerticalBorders(value){return this._ref.forEach((function(ref){ref instanceof RangeRef&&ref.width()>1&&((ref=ref.clone()).topLeft.col++,this._sheet.range(ref)._set("vBorders",value))}),this),this}insideHorizontalBorders(value){return this._ref.forEach((function(ref){ref instanceof RangeRef&&ref.height()>1&&((ref=ref.clone()).topLeft.row++,this._sheet.range(ref)._set("hBorders",value))}),this),this}};function partition(begin,end,predicate){for(;begin<=end&&predicate(begin);)begin++;if(begin>end)return[];for(let i=begin+1;i<=end;++i)if(predicate(i))return[{begin,end:i-1}].concat(partition(i+1,end,predicate));return[{begin,end}]}PROPERTIES.forEach((function(property){Range$1.prototype[property]=function(value){return this._property(property,value)}}));const measureBox=document.createElement("div");measureBox.setAttribute("style","position: absolute !important; top: -4000px !important; height: auto !important;padding: 1px 3px !important; box-sizing: border-box; margin: 0 !important; border: 1px solid black !important;line-height: normal !important; visibility: hidden !important;white-space: pre-wrap;");var Formula=calc.runtime.Formula,FillError=Range$1.FillError=function(msg){this.code=msg};function linearRegression(data){for(var N=data.length,mx=(N+1)/2,my=data.reduce((function(a,b){return a+b}),0)/N,s1=0,s2=0,i=0;i<N;i++){var t1=i+1-mx;s1+=t1*(data[i]-my),s2+=t1*t1}if(!s2)return function(N){return data[N%data.length]};var b=s1/s2,a=my-b*mx;return function(N){return a+b*(N+1)}}function findSeries(properties){function getData(a){return a.map((function(v){return v.number}))}var series=[],data=properties.map((function(x){return x.formula||x.value}));return function forEachSeries(data,f){for(var type,prev=null,start=0,a=[],i=0;i<data.length;++i)type=getType(data[i]),a.push(type),null!=prev&&type.type!==prev.type&&(f(start,i,prev.type,a.slice(start,i)),start=i),prev=type;f(start,i,prev.type,a.slice(start,i))}(data,(function(begin,end,type,a){var f,values;if("number"==type)f=linearRegression(values=getData(a));else if("string"==type||"formula"==type||"boolean"==type)f=function(N,i){return data[i]};else if(Array.isArray(type))if(1==a.length)f=function(N){return type[(a[0].number+N)%type.length]};else{var diff=function findStep(a){for(var diff=a[1]-a[0],i=2;i<a.length;++i)if(a[i]-a[i-1]!=diff)return null;return diff}(getData(a));f=null==diff?function(N){return a[N%a.length].value}:function(N){var idx=a[0].number+diff*N;return type[idx%type.length]}}else"null"!=type?(1==(values=getData(a)).length&&values.push(values[0]+1),values=linearRegression(values),f=function(N,i){return data[i].replace(/^(.*[\D0]+)\d+/,"$1"+values(N,i))}):f=function(){return null};for(var s={f,begin,end,len:end-begin},i=begin;i<end;++i)series[i]=s})),function(N,i){var s=series[i],q=N/data.length|0,r=N%data.length,n=q*s.len+r-s.begin,value=s.f(n,i),props=function clone$1(obj){var copy={};return Object.keys(obj||{}).forEach((function(key){copy[key]=obj[key]})),copy}(properties[i]);return delete props.enable,value instanceof Formula?props.formula=value:props.value=value,props}}function getType(el){if("number"==typeof el)return{type:"number",number:el};if("string"==typeof el){var lst=function findStringList(str){for(var strl=str.toLowerCase(),lists=function stringLists(){const calendar=culture().calendar;return[calendar.days.format.abbreviated,calendar.days.format.wide,calendar.months.format.abbreviated,calendar.months.format.wide]}(),i=0;i<lists.length;++i)for(var a=lists[i],j=a.length;--j>=0;){if(a[j].toLowerCase()==strl)return{type:a,number:j,value:str}}}(el);if(lst)return lst;var m=/^(.*\D)(\d+)/.exec(el);return m?{type:el=el.replace(/^(.*\D)\d+/,"$1-######"),match:m,number:parseFloat(m[2])}:{type:"string"}}if("boolean"==typeof el)return{type:"boolean"};if(null==el)return{type:"null"};if(el instanceof Formula)return{type:"formula"};throw window.console.error(el),new Error("Cannot fill data")}function transpose(a){for(var height=a.length,width=a[0].length,t=[],i=0;i<width;++i){t[i]=[];for(var j=0;j<height;++j)t[i][j]=a[j][i]}return t}Range$1.prototype._previewFillFrom=function(srcRange,direction){var sheet=this._sheet;"string"==typeof srcRange&&(srcRange=sheet.range(srcRange));var src=srcRange._ref.toRangeRef().clone().setSheet(sheet.name()),dest=this._ref.toRangeRef().clone().setSheet(sheet.name());if(src.intersects(dest)){if(src.eq(dest))return null;if(dest=dest.clone(),src.topLeft.eq(dest.topLeft))if(src.width()==dest.width())dest.topLeft.row+=src.height(),direction=0;else{if(src.height()!=dest.height())throw new FillError("incompatibleRanges");dest.topLeft.col+=src.width(),direction=1}else{if(!src.bottomRight.eq(dest.bottomRight))throw new FillError("incompatibleRanges");if(src.width()==dest.width())dest.bottomRight.row-=src.height(),direction=2;else{if(src.height()!=dest.height())throw new FillError("incompatibleRanges");dest.bottomRight.col-=src.width(),direction=3}}return sheet.range(dest)._previewFillFrom(srcRange,direction)}if(null==direction)if(src.topLeft.col==dest.topLeft.col)direction=src.topLeft.row<dest.topLeft.row?0:2;else{if(src.topLeft.row!=dest.topLeft.row)throw new FillError("noFillDirection");direction=src.topLeft.col<dest.topLeft.col?1:3}var horizontal=1&direction,descending=2&direction;if(horizontal&&src.height()!=dest.height()||!horizontal&&src.width()!=dest.width())throw new FillError("incompatibleRanges");var n,data=srcRange._properties();horizontal?n=dest.width():(data=transpose(data),n=dest.height());for(var fill=new Array(data.length),hint=null,i=0;i<data.length;++i)for(var s=data[i],f=findSeries(s),a=fill[i]=new Array(n),j=0;j<n;++j){var idx=descending?-j-1:s.length+j,srcIdx=descending?s.length-j%s.length-1:j%s.length,cell=a[descending?n-j-1:j]=f(idx,srcIdx);null!=cell.value&&(hint=cell.value)}return horizontal||(fill=transpose(fill)),{props:fill,direction,dest:this,hint}},Range$1.prototype.fillFrom=function(srcRange,direction){var x=this._previewFillFrom(srcRange,direction);return x.dest._properties(x.props,!0),x.dest};let preventDefault=function(){this._defaultPrevented=!0},isDefaultPrevented=function(){return!0===this._defaultPrevented};class Observable{constructor(){this._events={}}bind(eventName,handlers,one){let idx,length,original,handler,events,that=this,eventNames="string"==typeof eventName?[eventName]:eventName,handlersIsFunction="function"==typeof handlers;if(void 0===handlers){for(idx in eventName)that.bind(idx,eventName[idx]);return that}for(idx=0,length=eventNames.length;idx<length;idx++)eventName=eventNames[idx],handler=handlersIsFunction?handlers:handlers[eventName],handler&&(one&&(original=handler,handler=function(){that.unbind(eventName,handler),original.apply(that,arguments)},handler.original=original),events=that._events[eventName]=that._events[eventName]||[],events.push(handler));return that}one(eventNames,handlers){return this.bind(eventNames,handlers,!0)}first(eventName,handlers){let idx,length,handler,events,that=this,eventNames="string"==typeof eventName?[eventName]:eventName,handlersIsFunction="function"==typeof handlers;for(idx=0,length=eventNames.length;idx<length;idx++)eventName=eventNames[idx],handler=handlersIsFunction?handlers:handlers[eventName],handler&&(events=that._events[eventName]=that._events[eventName]||[],events.unshift(handler));return that}trigger(eventName,e){let idx,length,that=this,events=that._events[eventName];if(events){for((e=e||{}).sender=that,e._defaultPrevented=!1,e.preventDefault=preventDefault,e.isDefaultPrevented=isDefaultPrevented,events=events.slice(),idx=0,length=events.length;idx<length;idx++)events[idx].call(that,e);return!0===e._defaultPrevented}return!1}unbind(eventName,handler){let idx,that=this,events=that._events[eventName];if(void 0===eventName)that._events={};else if(events)if(handler)for(idx=events.length-1;idx>=0;idx--)events[idx]!==handler&&events[idx].original!==handler||events.splice(idx,1);else that._events[eventName]=[];return that}}class Widget extends Observable{constructor(element,options){super(),this.element=element,this.events=[],this.options=options}setOptions(options){this._setEvents(options),deepExtend({},this.options,options)}_setEvents(options){let e,that=this,idx=0,length=that.events.length;for(;idx<length;idx++)e=that.events[idx],that.options[e]&&options[e]&&(that.unbind(e,that.options[e]),that._events&&that._events[e]&&delete that._events[e]);that.bind(that.events,options)}resize(force){const size=this.getSize(),currentSize=this._size;(force||(size.width>0||size.height>0)&&(!currentSize||size.width!==currentSize.width||size.height!==currentSize.height))&&(this._size=size,this._resize(size,force),this.trigger("resize",size))}getSize(){return{width:this.element.offsetWidth,height:this.element.offsetHeight}}destroy(){this.unbind()}}class SheetEditor extends Observable{constructor(view){super(),this.events=["activate","deactivate","change","update"],this.view=view,this.formulaBar=view.formulaBar,this._active=!1,this.barInput=view.formulaBar.formulaInput,this.cellInput=view.formulaInput,this.barInput.syncWith(this.cellInput),this.cellInput.syncWith(this.barInput),this.barInput.bind("keyup",this._triggerUpdate.bind(this)),this.cellInput.bind("keyup",this._triggerUpdate.bind(this)),this.barInput.bind("blur",this._blur.bind(this)),this.cellInput.bind("blur",this._blur.bind(this))}_blur(){this.deactivate()}_triggerUpdate(){this.trigger("update",{value:this.value()})}activeEditor(){let editor=null,activeElement=function(){try{return document.activeElement}catch(e){return document.documentElement.activeElement}}();return this.barElement()===activeElement?editor=this.barInput:this.cellElement()===activeElement&&(editor=this.cellInput),editor}activate(options){let viewWidth,scrollerElement,scrollbarWidth,viewElement=this.view.element;return this._active=!0,this._rect=options.rect,this._range=options.range,this.cellInput.position(options.rect),this.cellInput.resize(options.rect),this.cellInput.tooltip(options.tooltip),this.cellInput.activeCell=this.barInput.activeCell=this._range.topLeft(),this.cellInput.activeSheet=this.barInput.activeSheet=this._range._sheet,viewElement&&(viewWidth=viewElement.offsetWidth,scrollerElement=viewElement.querySelector(".k-spreadsheet-scroller"),scrollbarWidth=scrollerElement.offsetWidth-scrollerElement.clientWidth,this.cellInput.element.style.maxWidth=viewWidth-scrollbarWidth-parseFloat(this.cellInput.element.style.left)+"px"),this.trigger("activate"),this}deactivate(noChange){let cellInput=this.cellInput;this._active&&(this._active=!1,noChange||cellInput.value()===this._value||this.trigger("change",{value:cellInput.value(),range:this._range}),this._rect=null,cellInput.hide(),this.trigger("deactivate"))}enable(enable){this.barInput.enable(enable),this.cellInput.enable(enable)}barElement(){return this.barInput.element}cellElement(){return this.cellInput.element}focus(inputType){"cell"===(inputType=inputType||"cell")?(this.cellInput.element.focus(),this.cellInput.end()):this.barInput.focus()}isActive(){return this._active}isFiltered(){return this.barInput.popup.visible()||this.cellInput.popup.visible()}canInsertRef(isKeyboardAction){let editor=this.activeEditor();return editor&&editor.canInsertRef(isKeyboardAction)}highlightedRefs(){let editor=this.activeEditor(),refs=[];return editor&&(refs=editor.highlightedRefs()),refs}scale(){this.cellInput.scale()}toggleTooltip(rect){this.cellInput.toggleTooltip(function notEqual(oldRect,newRect){return oldRect&&(oldRect.top!==newRect.top||oldRect.left!==newRect.left)}(this._rect,rect))}value(value,isArrayFormula){if(void 0===value)return this.barInput.value();null===value&&(value=""),this._value=value,this.barInput.value(value),this.cellInput.value(value),this.barInput.element.classList.toggle("k-spreadsheet-array-formula",Boolean(isArrayFormula))}insertNewline(){this.activeEditor().insertNewline(),this.scale()}select(){this.activeEditor().select()}}const ampRegExp=/&/g,ltRegExp=/</g,quoteRegExp=/"/g,aposRegExp=/'/g,gtRegExp=/>/g;class Axis{constructor(count,value){this._value=value,this._count=count,this.values=new RangeList(0,count-1,value),this._hidden=new RangeList(0,count-1,0),this.scrollBarSize=scrollbar(),this._refresh()}_resize(count){count>this._count?(this.values.value(this._count,count-1,this._value),this._hidden.value(this._count,count-1,0)):count<this._count&&(this.values.value(count,this._count-1,0),this._hidden.value(count,this._count-1,0)),this._count=count,this._refresh()}adjust(start,delta){delta<0?(this.values.copy(start-delta,this._count-1,start),this._hidden.copy(start-delta,this._count-1,start)):(this.values.copy(start,this._count,start+delta),this._hidden.copy(start,this._count,start+delta),this.values.value(start,start+delta-1,this._value),this._hidden.value(start,start+delta-1,0)),this._refresh()}toJSON(field,positions){let values=[],iterator=this.values.iterator(0,this._count-1);for(let idx=0;idx<this._count;idx++){let value=iterator.at(idx),hidden=this._hidden.value(idx,idx);if(value===this._value&&!hidden)continue;let position=positions[idx];if(void 0===position){position=values.length;let item={index:idx};item[field]=value,hidden&&(item.hidden=hidden),values.push(item),positions[idx]=position}}return values}fromJSON(field,values){for(let idx=0;idx<values.length;idx++){let el=values[idx],index=el.index;void 0===index&&(index=idx);let value=el[field];0===value?(this._hidden.value(index,index,el.hidden||this._value),this.value(index,index,0)):this.value(index,index,value)}}hide(index){if(!this.hidden(index)){let value=this.value(index,index);this._hidden.value(index,index,value),this.value(index,index,0)}}hidden(index){return 0!==this._hidden.value(index,index)}includesHidden(start,end){return this._hidden.intersecting(start,end).length>1}nextVisible(index){let end=this._count-1,i=index;for(;++i<=end;)if(!this.hidden(i))return i;return index}nextUntil(index,pred){let end=this._count-1,i=index,advanced=!1;for(;++i<=end;){let val=pred(i,advanced,this.hidden(i));if("number"==typeof val)return val;if(val)break;advanced=!0}return i-1}nextPage(index,pageSize){return this.index(this.sum(0,index-1)+pageSize)}prevPage(index,pageSize){return this.index(this.sum(0,index)-pageSize)}firstVisible(){let firstHidden=this._hidden.first();return 0===firstHidden.value?0:firstHidden.end+1}lastVisible(){let lastHidden=this._hidden.last();return 0===lastHidden.value?this._count-1:lastHidden.start-1}prevVisible(index){let i=index;for(;--i>=0;)if(!this.hidden(i))return i;return index}prevUntil(index,pred){let i=index,advanced=!1;for(;--i>=0;){let val=pred(i,advanced,this.hidden(i));if("number"==typeof val)return val;if(val)break;advanced=!0}return i+1}unhide(index){if(this.hidden(index)){let value=this._hidden.value(index,index);this._hidden.value(index,index,0),this.value(index,index,value)}}value(start,end,value){if(void 0===value)return this.values.iterator(start,end).at(0);this.values.value(start,end,value),this._refresh()}sum(start,end){let values=this.values.iterator(start,end),sum=0;for(let idx=start;idx<=end;idx++)sum+=values.at(idx);return sum}locate(start,end,predicate){let values=this.values.iterator(start,end),sum=0;for(let idx=start;idx<=end;idx++){if(sum+=values.at(idx),predicate(sum))return idx}return null}visible(start,end){let startSegment=null,endSegment=null,lastPage=!1;end>=this.total+this.scrollBarSize&&(lastPage=!0);let ranges=this._pixelValues.intersecting(start,end);if(startSegment=ranges[0],endSegment=ranges[ranges.length-1],!startSegment)return{values:this.values.iterator(0,0),offset:0};let startOffset=start-startSegment.start,startIndex=(startOffset/startSegment.value.value|0)+startSegment.value.start,offset=startOffset-(startIndex-startSegment.value.start)*startSegment.value.value,endOffset=end-endSegment.start,endIndex=(endOffset/endSegment.value.value|0)+endSegment.value.start;return endIndex>endSegment.value.end&&(endIndex=endSegment.value.end),lastPage&&(offset+=endSegment.value.value-(endOffset-(endIndex-endSegment.value.start)*endSegment.value.value)),offset=Math.min(-offset,0),{values:this.values.iterator(startIndex,endIndex),offset}}index(value){let index=0,iterator=this.values.iterator(0,this._count-1),current=iterator.at(0);for(;current<value&&index<this._count-1;)current+=iterator.at(++index);return index}indexVisible(value){let index=this.index(value);return this.hidden(index)&&(index=this.prevVisible(index)),index}_refresh(){let current=0;this._pixelValues=this.values.map((function(range){let start=current;return current+=(range.end-range.start+1)*range.value,new ValueRange(start,current-1,range)})),this.total=current}getState(){return{values:this.values.getState(),hidden:this._hidden.getState(),count:this._count}}setState(state){this.values.setState(state.values),this._hidden.setState(state.hidden);let nowCount=this._count;nowCount>state.count?(this._count=state.count,this._resize(nowCount)):this._refresh()}}class PaneAxis{constructor(axis,start,count,headerSize){this._axis=axis,this._start=start,this._count=count,this.hasHeader=0===start,this.headerSize=headerSize,this.defaultValue=axis._value,this.frozen=count>0}viewSize(viewSize){this._viewSize=viewSize}sum(start,end){return this._axis.sum(start,end-1)}start(){return this.sum(0,this._start)}size(){return this.sum(this._start,this._start+this._count)}index(value,offset){return this._axis.index(value+(this.frozen?0:offset)-this.headerSize)}indexVisible(value,offset){return this._axis.indexVisible(value+(this.frozen?0:offset)-this.headerSize)}paneSegment(){let length,offset=this.start();return this.hasHeader||(offset+=this.headerSize),this.frozen?(length=this.size(),this.hasHeader?length+=this.headerSize:length-=this.headerSize):length=this._viewSize-offset,{offset,length}}visible(offset){let size,start=this.start();this.frozen?(size=this.size(),this.hasHeader||(size-=this.headerSize)):(size=this._viewSize-start-this.headerSize,start+=offset);let result=this._axis.visible(start,start+size-1);return this.frozen&&(result.offset=0),result.start=start,this.hasHeader&&(result.offset+=this.headerSize,result.start-=this.headerSize),result}contains(start,end){return this.frozen?!(start>this._start+this._count)&&!(end<this._start):end>=this._start}}class Rectangle{constructor(left,top,width,height){this.left=left,this.top=top,this.width=width,this.height=height,this.right=this.left+this.width,this.bottom=this.top+this.height}offset(left,top){return new Rectangle(this.left+left,this.top+top,this.width,this.height)}resize(width,height){return new Rectangle(this.left,this.top,this.width+width,this.height+height)}intersects(x,y){return x instanceof Rectangle?this.intersectsRect(x):this.left<x&&x<this.left+this.width&&this.top<y&&y<this.top+this.height}intersectsRect(b){let a=this;return a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom}toDiv(className){return dom.element("div",{className,style:{width:this.width+"px",height:this.height+"px",top:this.top+"px",left:this.left+"px"}})}}class Grid{constructor(rows,columns,rowCount,columnCount,headerHeight,headerWidth){this.rowCount=rowCount,this.columnCount=columnCount,this._columns=columns,this._rows=rows,this._headerHeight=headerHeight,this._headerWidth=headerWidth}_resize(new_rows,new_cols){this.rowCount=new_rows,this.columnCount=new_cols}isAxis(ref){let topLeft=(ref=ref.toRangeRef()).topLeft,bottomRight=ref.bottomRight;return 0===topLeft.row&&bottomRight.row===this.rowCount-1||0===topLeft.col&&bottomRight.col===this.columnCount-1}width(start,end){return this._columns.sum(start,end)}height(start,end){return this._rows.sum(start,end)}totalHeight(){return this._rows.total+this._headerHeight}totalWidth(){return this._columns.total+this._headerWidth}index(row,column){return column*this.rowCount+row}cellRef(index){return new CellRef(index%this.rowCount,index/this.rowCount|0)}rowRef(row){return new RangeRef(new CellRef(row,0),new CellRef(row,this.columnCount-1))}colRef(col){return new RangeRef(new CellRef(0,col),new CellRef(this.rowCount-1,col))}cellRefIndex(ref){return this.index(ref.row,ref.col)}normalize(ref){return ref instanceof RangeRef?new RangeRef(this.normalize(ref.topLeft),this.normalize(ref.bottomRight)).setSheet(ref.sheet,ref.hasSheet()):ref instanceof UnionRef?ref.map((function(ref){return this.normalize(ref)}),this):(ref instanceof CellRef&&((ref=ref.clone()).col=Math.max(0,Math.min(this.columnCount-1,ref.col)),ref.row=Math.max(0,Math.min(this.rowCount-1,ref.row))),ref)}rectangle(ref){let topLeft=this.normalize(ref.topLeft),bottomRight=this.normalize(ref.bottomRight);return new Rectangle(this.width(0,topLeft.col-1),this.height(0,topLeft.row-1),this.width(topLeft.col,bottomRight.col),this.height(topLeft.row,bottomRight.row))}pane(options){return new PaneGrid(new PaneAxis(this._rows,options.row,options.rowCount,this._headerHeight),new PaneAxis(this._columns,options.column,options.columnCount,this._headerWidth),this)}rangeDimensions(rangeRef){return{rows:this._rows.values.iterator(rangeRef.topLeft.row,rangeRef.bottomRight.row),columns:this._columns.values.iterator(rangeRef.topLeft.col,rangeRef.bottomRight.col)}}forEach(ref,callback){let topLeft=this.normalize(ref.topLeft),bottomRight=this.normalize(ref.bottomRight);for(let ci=topLeft.col;ci<=bottomRight.col;ci++)for(let ri=topLeft.row;ri<=bottomRight.row;ri++)callback(new CellRef(ri,ci))}trim(ref,property){let topLeft=this.normalize(ref.topLeft),bottomRight=this.normalize(ref.bottomRight),bottomRightRow=topLeft.row,bottomRightCol=topLeft.col;for(let ci=topLeft.col;ci<=bottomRight.col;ci++){let start=this.index(topLeft.row,ci),end=this.index(bottomRight.row,ci),values=property.tree.intersecting(start,end);if(values.length){let cell=this.cellRef(values[values.length-1].end);bottomRightRow=Math.max(bottomRightRow,cell.row),bottomRightCol=ci}}return new RangeRef(ref.topLeft,new CellRef(Math.min(bottomRightRow,ref.bottomRight.row),bottomRightCol))}}class PaneGrid{constructor(rows,columns,grid){this.rows=rows,this.columns=columns,this._grid=grid,this.headerHeight=rows.headerSize,this.headerWidth=columns.headerSize,this.hasRowHeader=columns.hasHeader,this.hasColumnHeader=rows.hasHeader}refresh(width,height){this.columns.viewSize(width),this.rows.viewSize(height);let x=this.columns.paneSegment(),y=this.rows.paneSegment();this.left=x.offset,this.top=y.offset,this.right=x.offset+x.length,this.bottom=y.offset+y.length,this.style={top:y.offset+"px",left:x.offset+"px",height:y.length+"px",width:x.length+"px"}}view(left,top){let rows=this.rows.visible(top),columns=this.columns.visible(left);return{rows,columns,rowOffset:rows.offset,columnOffset:columns.offset,mergedCellLeft:columns.start,mergedCellTop:rows.start,ref:new RangeRef(new CellRef(rows.values.start,columns.values.start),new CellRef(rows.values.end,columns.values.end))}}contains(ref){return this.rows.contains(ref.topLeft.row,ref.bottomRight.row)&&this.columns.contains(ref.topLeft.col,ref.bottomRight.col)}index(row,column){return this._grid.index(row,column)}boundingRectangle(ref){return this._grid.rectangle(ref)}cellRefIndex(ref){return this._grid.cellRefIndex(ref)}scrollBoundaries(cell){let position=this.boundingRectangle(cell),boundaries={top:Math.max(0,position.top-this.top+(this.hasColumnHeader?0:this.headerHeight)),left:Math.max(0,position.left-this.left+(this.hasRowHeader?0:this.headerWidth)),right:position.right-this.columns._viewSize+this.headerWidth,bottom:position.bottom-this.rows._viewSize+this.headerHeight},widthCompensation=this.columns.defaultValue/2,heightCompensation=this.rows.defaultValue/2;return boundaries.scrollTop=boundaries.top-heightCompensation,boundaries.scrollBottom=boundaries.bottom+heightCompensation,boundaries.scrollLeft=boundaries.left-widthCompensation,boundaries.scrollRight=boundaries.right+widthCompensation,boundaries}}class Sorter{constructor(grid,lists){this._grid=grid,this._lists=lists}indices(rangeRef,list,ascending,indices){let comparer=Sorter.ascendingComparer;return!1===ascending&&(comparer=Sorter.descendingComparer),list.sortedIndices(this._grid.cellRefIndex(rangeRef.topLeft),this._grid.cellRefIndex(rangeRef.bottomRight),comparer,indices)}sortBy(ref,column,list,ascending,indices){let sortedIndices=this.indices(ref.toColumn(column),list,ascending,indices);for(let ci=ref.topLeft.col;ci<=ref.bottomRight.col;ci++){let start=this._grid.index(ref.topLeft.row,ci),end=this._grid.index(ref.bottomRight.row,ci);for(let li=0;li<this._lists.length;li++)start<this._lists[li].lastRangeStart()&&this._lists[li].sort(start,end,sortedIndices)}return sortedIndices}}Sorter.ascendingComparer=function(a,b){if(null===a&&null===b)return 0;if(null===a)return 1;if(null===b)return-1;let typeA=typeof a,typeB=typeof b;if("number"===typeA)return"number"===typeB?a-b:-1;if("string"===typeA)switch(typeB){case"number":return 1;case"string":return a.localeCompare(b);default:return-1}if("boolean"===typeA)switch(typeB){case"number":case"string":return 1;case"boolean":return a-b;default:return-1}if(a instanceof CalcError)return b instanceof CalcError?0:1;throw new Error("Cannot compare "+a+" and "+b)},Sorter.descendingComparer=function(a,b){return null===a&&null===b?0:null===a?1:null===b?-1:Sorter.ascendingComparer(b,a)};class AxisManager{constructor(sheet){this._sheet=sheet}forEachSelectedColumn(callback){let sheet=this._sheet;sheet.batch((function(){sheet.select().forEachColumnIndex((function(index,i){callback(sheet,index,i)}))}),{layout:!0,recalc:!0})}forEachSelectedRow(callback){let sheet=this._sheet;sheet.batch((function(){sheet.select().forEachRowIndex((function(index,i){callback(sheet,index,i)}))}),{layout:!0,recalc:!0})}includesHiddenColumns(ref){return this._sheet._grid._columns.includesHidden(ref.topLeft.col,ref.bottomRight.col)}includesHiddenRows(ref){return this._sheet._grid._rows.includesHidden(ref.topLeft.row,ref.bottomRight.row)}selectionIncludesHiddenColumns(){return this.includesHiddenColumns(this._sheet.select())}selectionIncludesHiddenRows(){return this.includesHiddenRows(this._sheet.select())}deleteSelectedColumns(){let indexes=[],delta=0;return this.forEachSelectedColumn((function(sheet,index){if(index-=delta,sheet.isHiddenColumn(index))return;delta++;let formulas=[];indexes.unshift({index,formulas,width:sheet.columnWidth(index)}),sheet._saveModifiedFormulas(formulas,(function(){sheet.deleteColumn(index)}))})),indexes}deleteSelectedRows(){let indexes=[],delta=0;return this.forEachSelectedRow((function(sheet,index){if(index-=delta,sheet.isHiddenRow(index))return;delta++;let formulas=[];indexes.unshift({index,formulas,height:sheet.rowHeight(index)}),sheet._saveModifiedFormulas(formulas,(function(){sheet.deleteRow(index)}))})),indexes}hideSelectedColumns(){this.forEachSelectedColumn((function(sheet,index){sheet.hideColumn(index)}));let sheet=this._sheet,ref=sheet.select().toRangeRef(),left=ref.topLeft.col,right=ref.bottomRight.col,sel=null;for(;;){let hasRight=right<sheet._columns._count,hasLeft=left>=0;if(!hasLeft&&!hasRight)break;if(hasRight&&!sheet.isHiddenColumn(right)){sel=right;break}if(hasLeft&&!sheet.isHiddenColumn(left)){sel=left;break}left--,right++}null!==sel&&(ref=new RangeRef(new CellRef(0,sel),new CellRef(sheet._rows._count-1,sel)),sheet.range(ref).select())}hideSelectedRows(){this.forEachSelectedRow((function(sheet,index){sheet.hideRow(index)}));let sheet=this._sheet,ref=sheet.select().toRangeRef(),top=ref.topLeft.row,bottom=ref.bottomRight.row,sel=null;for(;;){let hasBottom=bottom<sheet._rows._count,hasTop=top>=0;if(!hasTop&&!hasBottom)break;if(hasBottom&&!sheet.isHiddenRow(bottom)){sel=bottom;break}if(hasTop&&!sheet.isHiddenRow(top)){sel=top;break}top--,bottom++}null!==sel&&(ref=new RangeRef(new CellRef(sel,0),new CellRef(sel,sheet._columns._count-1)),sheet.range(ref).select())}unhideSelectedColumns(){this.forEachSelectedColumn((function(sheet,index){sheet.unhideColumn(index)}))}unhideSelectedRows(){this.forEachSelectedRow((function(sheet,index){sheet.unhideRow(index)}))}addColumnLeft(){let base,sheet=this._sheet,count=0;return sheet.batch((function(){sheet.select().forEachColumnIndex((function(index){base||(base=index),sheet.insertColumn(base),++count}))}),{recalc:!0,layout:!0}),{base,count}}addColumnRight(){let base,sheet=this._sheet,count=0;return sheet.batch((function(){sheet.select().forEachColumnIndex((function(index){base=index+1,++count}));for(let i=0;i<count;++i)sheet.insertColumn(base)}),{recalc:!0,layout:!0}),{base,count}}addRowAbove(){let base,sheet=this._sheet,count=0,selectedRows=sheet.select();return sheet.batch((function(){selectedRows.forEachRowIndex((function(index){base||(base=index),sheet.insertRow(base),++count}))}),{recalc:!0,layout:!0}),{base,count}}addRowBelow(){let base,sheet=this._sheet,count=0;return sheet.batch((function(){sheet.select().forEachRowIndex((function(index){base=index+1,++count}));for(let i=0;i<count;++i)sheet.insertRow(base)}),{recalc:!0,layout:!0}),{base,count}}}class AutoFillCalculator{constructor(grid){this._grid=grid}rectIsVertical(start,end,x,y){let startRect=this._grid.rectangle(start.toRangeRef()),endRect=this._grid.rectangle(end.toRangeRef());return Math.abs(endRect[y]-startRect[y])>Math.abs(startRect[x]-endRect[x])}autoFillDest(selection,cursor){let quadrant,pivot,opposite,cornerResult,expanding,topLeft=selection.topLeft,bottomRight=selection.bottomRight,lower=cursor.row>=topLeft.row,further=cursor.col>=topLeft.col;if(quadrant=lower?further?4:3:further?2:1,4===quadrant)pivot=topLeft,opposite=bottomRight,expanding=cursor.row>opposite.row||cursor.col>opposite.col,expanding&&(cursor=new CellRef(Math.max(cursor.row,opposite.row),Math.max(cursor.col,opposite.col))),cornerResult=this.rectIsVertical(opposite,cursor,"right","bottom")?new CellRef(cursor.row,opposite.col):new CellRef(opposite.row,cursor.col);else if(3===quadrant){let bottomLeft=new CellRef(topLeft.col,bottomRight.row);cursor.row>bottomRight.row&&this.rectIsVertical(bottomLeft,cursor,"left","bottom")?(pivot=topLeft,cornerResult=new CellRef(cursor.row,bottomRight.col)):(pivot=bottomRight,cornerResult=new CellRef(topLeft.row,cursor.col))}else if(2===quadrant){let topRight=new CellRef(topLeft.row,bottomRight.col);cursor.col>bottomRight.col&&!this.rectIsVertical(topRight,cursor,"right","top")?(pivot=topLeft,cornerResult=new CellRef(bottomRight.row,cursor.col)):(pivot=bottomRight,cornerResult=new CellRef(cursor.row,topLeft.col))}else pivot=bottomRight,cornerResult=this.rectIsVertical(topLeft,cursor,"left","top")?new CellRef(cursor.row,topLeft.col):new CellRef(topLeft.row,cursor.col);return this._grid.normalize(new RangeRef(pivot,cornerResult))}}class EdgeNavigator{constructor(field,axis,rangeGetter,union){this.rangeGetter=rangeGetter,this.prevLeft=function(index){var current=union(this.range(index)),range=this.range(axis.prevVisible(current.topLeft[field]));return union(range).topLeft[field]},this.nextRight=function(index){var current=union(this.range(index)),range=this.range(axis.nextVisible(current.bottomRight[field]));return union(range).bottomRight[field]},this.nextLeft=function(index){var range=union(this.range(index));return axis.nextVisible(range.bottomRight[field])},this.prevRight=function(index){var range=union(this.range(index));return axis.prevVisible(range.topLeft[field])}}boundary(top,bottom){this.top=top,this.bottom=bottom}range(index){return this.rangeGetter(index,this.top,this.bottom)}}class SheetNavigator{constructor(sheet){this._sheet=sheet,this.autoFillCalculator=new AutoFillCalculator(sheet._grid),this.colEdge=new EdgeNavigator("col",this._sheet._grid._columns,this.columnRange.bind(this),this.union.bind(this)),this.rowEdge=new EdgeNavigator("row",this._sheet._grid._rows,this.rowRange.bind(this),this.union.bind(this))}height(height){this._viewPortHeight=height}union(ref){return this._sheet.unionWithMerged(ref)}columnRange(col,topRow,bottomRow){return this._sheet._ref(topRow,col,bottomRow-topRow,1)}rowRange(row,leftCol,rightCol){return this._sheet._ref(row,leftCol,1,rightCol-leftCol)}selectionIncludesMergedCells(){return this._sheet.select().contains(this._sheet._mergedCells)}setSelectionValue(value){var selection=this._sheet.selection();setTimeout((function(){selection.value(value())}))}selectAll(){this._sheet.select(this._sheet._sheetRef)}select(ref,mode,addToExisting){ref=this.refForMode(ref,mode),addToExisting&&(ref=this._sheet.select().concat(ref)),this._sheet.select(ref)}refForMode(ref,mode){var grid=this._sheet._grid;switch(mode){case"range":ref=grid.normalize(ref);break;case"row":ref=grid.rowRef(ref.row);break;case"column":ref=grid.colRef(ref.col);break;case"sheet":ref=this._sheet._sheetRef}return ref}startSelection(ref,mode,addToExisting,shiftKey,view){if("autofill"===mode)this._sheet.startAutoFill();else if(shiftKey&&"range"===mode){var range=new RangeRef(this._sheet.activeCell().first(),ref);this._sheet.select(range,!1,!1),this._sheet.startSelection(view)}else this._sheet.startSelection(view),this.select(ref,mode,addToExisting)}completeSelection(){this._sheet.completeSelection()}selectForContextMenu(ref,mode){var sheet=this._sheet;sheet._activeDrawing=null,sheet.select().contains(this.refForMode(ref,mode))||this.select(ref,mode)}selectDrawingForContextMenu(drawing){var sheet=this._sheet;sheet._activeDrawing=drawing,sheet.triggerChange({selection:!0})}modifySelection(action){var scrollInto,direction=this.determineDirection(action),sheet=this._sheet,viewPortHeight=this._viewPortHeight,rows=sheet._grid._rows,columns=sheet._grid._columns,originalSelection=sheet.currentOriginalSelectionRange(),selection=sheet.select().toRangeRef(),activeCell=sheet.activeCell(),topLeft=originalSelection.topLeft.clone(),bottomRight=originalSelection.bottomRight.clone(),bottomLeft=new CellRef(bottomRight.row,topLeft.col);switch(this.colEdge.boundary(selection.topLeft.row,selection.bottomRight.row),this.rowEdge.boundary(selection.topLeft.col,selection.bottomRight.col),direction){case"expand-left":topLeft.col=this.colEdge.prevLeft(topLeft.col),scrollInto=topLeft;break;case"shrink-right":topLeft.col=this.colEdge.nextLeft(topLeft.col),scrollInto=topLeft;break;case"expand-right":bottomRight.col=this.colEdge.nextRight(bottomRight.col),scrollInto=bottomRight;break;case"shrink-left":bottomRight.col=this.colEdge.prevRight(bottomRight.col),scrollInto=bottomRight;break;case"expand-up":topLeft.row=this.rowEdge.prevLeft(topLeft.row),scrollInto=topLeft;break;case"shrink-down":topLeft.row=this.rowEdge.nextLeft(topLeft.row),scrollInto=topLeft;break;case"expand-down":bottomRight.row=this.rowEdge.nextRight(bottomRight.row),scrollInto=bottomRight;break;case"shrink-up":bottomRight.row=this.rowEdge.prevRight(bottomRight.row),scrollInto=bottomRight;break;case"expand-page-up":topLeft.row=rows.prevPage(topLeft.row,viewPortHeight);break;case"shrink-page-up":bottomRight.row=rows.prevPage(bottomRight.row,viewPortHeight);break;case"expand-page-down":bottomRight.row=rows.nextPage(bottomRight.row,viewPortHeight);break;case"shrink-page-down":topLeft.row=rows.nextPage(topLeft.row,viewPortHeight);break;case"first-col":topLeft.col=columns.firstVisible(),bottomRight.col=activeCell.bottomRight.col,scrollInto=topLeft;break;case"last-col":bottomRight.col=columns.lastVisible(),topLeft.col=activeCell.topLeft.col,scrollInto=bottomRight;break;case"first-row":topLeft.row=rows.firstVisible(),bottomRight.row=activeCell.bottomRight.row,scrollInto=topLeft;break;case"last-row":bottomRight.row=rows.lastVisible(),topLeft.row=activeCell.topLeft.row,scrollInto=bottomRight;break;case"last":bottomRight.row=rows.lastVisible(),bottomRight.col=columns.lastVisible(),topLeft=activeCell.topLeft,scrollInto=bottomRight;break;case"first":topLeft.row=rows.firstVisible(),topLeft.col=columns.firstVisible(),bottomRight=activeCell.bottomRight,scrollInto=topLeft;break;case"expand-word-right":bottomRight.col=columns.nextUntil(bottomRight.col,makeWordMovement(sheet,bottomRight,!0)),scrollInto=bottomRight;break;case"shrink-word-right":topLeft.col=columns.nextUntil(bottomLeft.col,makeWordMovement(sheet,bottomLeft,!0)),scrollInto=topLeft;break;case"expand-word-left":topLeft.col=columns.prevUntil(bottomLeft.col,makeWordMovement(sheet,bottomLeft,!0)),scrollInto=topLeft;break;case"shrink-word-left":bottomRight.col=columns.prevUntil(bottomRight.col,makeWordMovement(sheet,bottomRight,!0)),scrollInto=bottomRight;break;case"expand-word-up":topLeft.row=rows.prevUntil(topLeft.row,makeWordMovement(sheet,topLeft,!1)),scrollInto=topLeft;break;case"shrink-word-up":bottomRight.row=rows.prevUntil(bottomRight.row,makeWordMovement(sheet,bottomRight,!1)),scrollInto=bottomRight;break;case"expand-word-down":bottomRight.row=rows.nextUntil(bottomRight.row,makeWordMovement(sheet,bottomRight,!1)),scrollInto=bottomRight;break;case"shrink-word-down":topLeft.row=rows.nextUntil(topLeft.row,makeWordMovement(sheet,topLeft,!1)),scrollInto=topLeft}var newSelection=new RangeRef(topLeft,bottomRight);this.union(newSelection).intersects(activeCell)?(scrollInto&&sheet.focus(scrollInto),this.updateCurrentSelectionRange(newSelection)):this.modifySelection(direction.replace("shrink","expand"))}moveActiveCell(direction){var sheet=this._sheet,activeCell=sheet.activeCell(),topLeft=activeCell.topLeft,bottomRight=activeCell.bottomRight,cell=sheet.originalActiveCell(),rows=sheet._grid._rows,columns=sheet._grid._columns,row=cell.row,column=cell.col;switch(direction){case"left":column=columns.prevVisible(topLeft.col);break;case"up":row=rows.prevVisible(topLeft.row);break;case"right":column=columns.nextVisible(bottomRight.col);break;case"down":row=rows.nextVisible(bottomRight.row);break;case"first-col":column=columns.firstVisible();break;case"last-col":column=columns.lastVisible();break;case"first-row":row=rows.firstVisible();break;case"last-row":row=rows.lastVisible();break;case"last":row=rows.lastVisible(),column=columns.lastVisible();break;case"first":row=rows.firstVisible(),column=columns.firstVisible();break;case"next-page":row=rows.nextPage(bottomRight.row,this._viewPortHeight);break;case"prev-page":row=rows.prevPage(bottomRight.row,this._viewPortHeight);break;case"word-right":column=columns.nextUntil(column,makeWordMovement(sheet,bottomRight,!0));break;case"word-left":column=columns.prevUntil(column,makeWordMovement(sheet,bottomRight,!0));break;case"word-up":row=rows.prevUntil(row,makeWordMovement(sheet,bottomRight,!1));break;case"word-down":row=rows.nextUntil(row,makeWordMovement(sheet,bottomRight,!1))}sheet.select(new CellRef(row,column))}navigateInSelection(direction){var selTopLeft,selBottomRight,tmp,sheet=this._sheet,topLeft=sheet.activeCell().topLeft,cell=sheet.originalActiveCell(),rows=sheet._grid._rows,columns=sheet._grid._columns,row=cell.row,column=cell.col,isFirstCell=!1,isLastCell=!1,topLeftCol=topLeft.col,topLeftRow=topLeft.row;function setSelection(sel){selTopLeft=sel.topLeft,selBottomRight=sel.bottomRight}setSelection(sheet.currentNavigationRange());for(var done=!1,navigatedAway=!1;!done&&!navigatedAway;){var current=new CellRef(row,column);switch(sheet.singleCellSelection()&&(isFirstCell=selTopLeft.eq(current)&&sheet._sheetRef.topLeft.eq(current),isLastCell=selBottomRight.eq(current)&&sheet._sheetRef.bottomRight.eq(current),isFirstCell||(isFirstCell=columns.firstVisible()===column&&rows.firstVisible()===row),isLastCell||(isLastCell=columns.lastVisible()===column&&rows.lastVisible()===row)),direction){case"next":isLastCell?navigatedAway=!0:selBottomRight.eq(current)?(setSelection(sheet.nextNavigationRange()),row=selTopLeft.row,column=selTopLeft.col):((column=columns.nextVisible(topLeftCol))===topLeftCol||column>selBottomRight.col)&&(column=selTopLeft.col,row=(tmp=rows.nextVisible(row))===row||tmp>selBottomRight.row?selTopLeft.row:tmp);break;case"previous":isFirstCell?(navigatedAway=!0,this._sheet._workbook._view.element.querySelector(".k-spreadsheet-name-editor .k-input-inner").focus()):selTopLeft.eq(current)?(setSelection(sheet.previousNavigationRange()),row=selBottomRight.row,column=selBottomRight.col):((column=columns.prevVisible(topLeftCol))===topLeftCol||column<selTopLeft.col)&&(column=selBottomRight.col,row=(tmp=rows.prevVisible(row))===row||tmp<selTopLeft.row?selBottomRight.row:tmp);break;case"lower":selBottomRight.eq(current)?(setSelection(sheet.nextNavigationRange()),row=selTopLeft.row,column=selTopLeft.col):((row=rows.nextVisible(topLeftRow))===topLeftRow||row>selBottomRight.row)&&(row=selTopLeft.row,column=(tmp=columns.nextVisible(column))===column||tmp>selBottomRight.col?selTopLeft.col:tmp);break;case"upper":selTopLeft.eq(current)?(setSelection(sheet.previousNavigationRange()),row=selBottomRight.row,column=selBottomRight.col):((row=rows.prevVisible(topLeftRow))===topLeftRow||row<selTopLeft.row)&&(row=selBottomRight.row,column=(tmp=columns.prevVisible(column))===column||tmp<selTopLeft.col?selBottomRight.col:tmp);break;default:throw new Error("Unknown entry navigation: "+direction)}done=!this.shouldSkip(row,column),topLeftCol=column,topLeftRow=row}done&&(sheet.singleCellSelection()?sheet.select(new CellRef(row,column)):sheet.activeCell(new CellRef(row,column)))}extendSelection(ref,mode){var sheet=this._sheet,grid=sheet._grid;if("autofill"!==mode){"range"===mode?ref=grid.normalize(ref):"row"===mode?ref=grid.rowRef(ref.row).bottomRight:"column"===mode&&(ref=grid.colRef(ref.col).bottomRight);var activeCell=sheet.originalActiveCell().toRangeRef();this.updateCurrentSelectionRange(new RangeRef(activeCell.topLeft,ref))}else this.resizeAutoFill(ref)}shouldSkip(row,col){if(this._sheet.isHiddenRow(row)||this._sheet.isHiddenColumn(col))return!0;var ref=new CellRef(row,col),isMerged=!1;return this._sheet.forEachMergedCell((function(merged){merged.intersects(ref)&&!merged.collapse().eq(ref)&&(isMerged=!0)})),isMerged}resizeAutoFill(ref){var hint,direction,sheet=this._sheet,selection=sheet.select(),origin=sheet._autoFillOrigin,dest=this.autoFillCalculator.autoFillDest(selection,ref),punch=this.punch(selection,dest);if(!punch){var preview=sheet.range(dest)._previewFillFrom(sheet.range(origin));preview&&(direction=preview.direction,hint=preview.hint)}sheet.updateAutoFill(dest,punch,hint,direction)}determineDirection(action){var selection=this._sheet.currentSelectionRange(),activeCell=this._sheet.activeCell(),leftMode=activeCell.topLeft.col===selection.topLeft.col,rightMode=activeCell.bottomRight.col===selection.bottomRight.col,topMode=activeCell.topLeft.row===selection.topLeft.row,bottomMode=activeCell.bottomRight.row===selection.bottomRight.row;switch(action){case"left":action=rightMode?"expand-left":"shrink-left";break;case"right":action=leftMode?"expand-right":"shrink-right";break;case"up":action=bottomMode?"expand-up":"shrink-up";break;case"down":action=topMode?"expand-down":"shrink-down";break;case"prev-page":action=bottomMode?"expand-page-up":"shrink-page-up";break;case"next-page":action=topMode?"expand-page-down":"shrink-page-down";break;case"word-left":action=rightMode?"expand-word-left":"shrink-word-left";break;case"word-right":action=leftMode?"expand-word-right":"shrink-word-right";break;case"word-up":action=bottomMode?"expand-word-up":"shrink-word-up";break;case"word-down":action=topMode?"expand-word-down":"shrink-word-down"}return action}updateCurrentSelectionRange(ref){var sheet=this._sheet;sheet.select(sheet.originalSelect().replaceAt(sheet.selectionRangeIndex(),ref),!1)}punch(selection,subset){var punch;if(subset.topLeft.eq(selection.topLeft))if(subset.bottomRight.row<selection.bottomRight.row){var bottomRow=this.rowEdge.nextRight(subset.bottomRight.row);punch=new RangeRef(new CellRef(bottomRow,selection.topLeft.col),selection.bottomRight)}else if(subset.bottomRight.col<selection.bottomRight.col){var bottomCol=this.colEdge.nextRight(subset.bottomRight.col);punch=new RangeRef(new CellRef(selection.topLeft.row,bottomCol),selection.bottomRight)}return punch}}function makeWordMovement(sheet,pivot,isCol){var firstVal=sheet.range(pivot).value();return function(pos,advanced,hidden){if(hidden)return!0;var val=(isCol?sheet.range(pivot.row,pos):sheet.range(pos,pivot.col)).value();return null===firstVal?null!==val&&pos:advanced||null!==val?null===val:(firstVal=null,!1)}}function numberToDate(val){return null==val?null:serialToDate(val)}var index_esm_identity=function(o){return o};class SheetDataSourceBinder{constructor(options){this.options=Object.assign({columns:[]},this.options,options),this.columns=this._normalizeColumns(this.options.columns),this._sheet(),this._dataSource(),this._header(),this._boundRowsCount=0,this.dataSource.fetch()}_sheet(){this.sheet=this.options.sheet,this._sheetChangeHandler=this._sheetChange.bind(this),this._sheetDeleteRowHandler=this._sheetDeleteRow.bind(this),this._sheetInsertRowHandler=this._sheetInsertRow.bind(this),this.sheet.bind("change",this._sheetChangeHandler).bind("afterDeleteRow",this._sheetDeleteRowHandler).bind("afterInsertRow",this._sheetInsertRowHandler)}_sheetInsertRow(e){void 0!==e.index&&this.dataSource.insert(Math.max(e.index-1,0),{})}_sheetDeleteRow(e){if(void 0!==e.index){var dataSource=this.dataSource,model=dataSource.view()[e.index-1];model&&dataSource.remove(model)}}_header(){this.sheet.batch(function(){this.columns.forEach(function(column,index){this.sheet.range(0,index).value(column.title)}.bind(this))}.bind(this))}_sheetChange(e){if(!e.insertRow&&!e.deleteRow&&e.recalc&&e.ref&&e.isValue){var fields,getters,normalizedRef,i,normalizedRefs,dataSource=this.dataSource,data=dataSource.view(),columns=this.columns,values=[],sheet=this.sheet,setValues=function(ref){for(var record,valueIndex=0,ri=(ref=ref.toRangeRef()).topLeft.row;ri<=ref.bottomRight.row;ri++){(record=data[ri-1])||(record=dataSource.insert(ri-1,{}),data=dataSource.view());for(var colValueIndex=0,ci=ref.topLeft.col;ci<=ref.bottomRight.col&&ci<columns.length;ci++){var currentValue=values[i][valueIndex][colValueIndex++];record.set(columns[ci].field,getters[ci](currentValue))}valueIndex++}};for(dataSource.reader.model&&(fields=dataSource.reader.model.fields),!columns.length&&data.length&&(columns=Object.keys(data[0].toJSON())),getters=columns.map((function(column){var field=column.field;return field&&fields&&fields[field]&&"date"===fields[field].type?numberToDate:index_esm_identity})),this._skipRebind=!0,(normalizedRef=sheet._grid.normalize(e.ref))instanceof UnionRef||(normalizedRef=new UnionRef([normalizedRef])),(normalizedRefs=normalizedRef.refs).forEach((function(ref){values.push(sheet.range(ref).values())})),i=0;i<normalizedRefs.length;i++)normalizedRefs[i].forEach(setValues);this._boundRowsCount=dataSource.view().length,this._skipRebind=!1}}_normalizeColumns(columns){return columns.map((function(column){var field=column.field||column;return{field,title:column.title||field}}))}_dataSource(){var dataSource=this.options.dataSource;this.dataSource={data:dataSource}}_error(){this._progress(!1)}_requestStart(){this._progress(!0)}_progress(toggle){this.sheet.trigger("progress",{toggle})}_change(){if(!this._skipRebind&&!this.sheet.trigger("dataBinding")){var data=this.dataSource.view(),columns=this.columns;!columns.length&&data.length&&(this.columns=columns=this._normalizeColumns(Object.keys(data[0].toJSON())),this._header());var getters=columns.map((function(column){return function index_esm_getter(expression,safe){let key=expression+safe;return getterCache[key]=getterCache[key]||new Function("d","return "+expr(expression,safe)),getterCache[key]}(column.field)}));this.sheet.batch(function(){for(var length=Math.max(data.length,this._boundRowsCount,this.sheet._grid.rowCount-1),idx=0;idx<length;idx++)for(var getterIdx=0;getterIdx<getters.length;getterIdx++){var value=data[idx]?getters[getterIdx](data[idx]):null;this.sheet.range(idx+1,getterIdx).value(value)}}.bind(this)),this._boundRowsCount=data.length,this._progress(!1),this.sheet.trigger("dataBound")}}destroy(){this.dataSource.unbind("change",this._changeHandler).unbind("progress",this._progressHandler).unbind("error",this._errorHandler),this.sheet.unbind("change",this._sheetChangeHandler).unbind("deleteRow",this._sheetDeleteRowHandler).unbind("insertRow",this._sheetInsertRowHandler)}}const kendoDate=function(){function today(){return(0,get_date.p)(new Date)}return{dayOfWeek:day_of_week.m,getDate:get_date.p,isToday:function isToday(date){return(0,get_date.p)(date).getTime()===today().getTime()},addDays:add_days.f,today,firstDayOfMonth:first_day_of_month.G}}(),dateRegExp=/^\/Date\((.*?)\)\/$/;var operators=function(){function quote(str){return"string"==typeof str&&(str=str.replace(/[\r\n]+/g,"")),JSON.stringify(str)}function textOp(impl){return function(a,b,ignore,accentFoldingFiltering){return b+="",ignore&&(a="("+a+" + '').toString()"+(accentFoldingFiltering?".toLocaleLowerCase('"+accentFoldingFiltering+"')":".toLowerCase()"),b=accentFoldingFiltering?b.toLocaleLowerCase(accentFoldingFiltering):b.toLowerCase()),impl(a,quote(b),ignore)}}function operator(op,a,b,ignore,accentFoldingFiltering){if(null!=b){if("string"==typeof b){var date=dateRegExp.exec(b);date?b=new Date(+date[1]):ignore?(b=quote(accentFoldingFiltering?b.toLocaleLowerCase(accentFoldingFiltering):b.toLowerCase()),a="(("+a+" || '')+'')"+(accentFoldingFiltering?".toLocaleLowerCase('"+accentFoldingFiltering+"')":".toLowerCase()")):b=quote(b)}b.getTime&&(a="("+a+"&&"+a+".getTime?"+a+".getTime():"+a+")",b=b.getTime())}return a+" "+op+" "+b}function getMatchRegexp(pattern){for(var rx="/^",esc=!1,i=0;i<pattern.length;++i){var ch=pattern.charAt(i);if(esc)rx+="\\"+ch;else{if("~"===ch){esc=!0;continue}"*"===ch?rx+=".*":"?"===ch?rx+=".":".+^$()[]{}|\\/\n\r\u2028\u2029".indexOf(ch)>=0?rx+="\\"+ch:rx+=ch}esc=!1}return rx+"$/"}return{quote:function(value){return value&&value.getTime?"new Date("+value.getTime()+")":quote(value)},eq:function(a,b,ignore,accentFoldingFiltering){return operator("==",a,b,ignore,accentFoldingFiltering)},neq:function(a,b,ignore,accentFoldingFiltering){return operator("!=",a,b,ignore,accentFoldingFiltering)},gt:function(a,b,ignore){return operator(">",a,b,ignore)},gte:function(a,b,ignore){return operator(">=",a,b,ignore)},lt:function(a,b,ignore){return operator("<",a,b,ignore)},lte:function(a,b,ignore){return operator("<=",a,b,ignore)},startswith:textOp((function(a,b){return a+".lastIndexOf("+b+", 0) == 0"})),doesnotstartwith:textOp((function(a,b){return a+".lastIndexOf("+b+", 0) == -1"})),endswith:textOp((function(a,b){return a+".indexOf("+b+", "+a+".length - "+(b?b.length-2:0)+") >= 0"})),doesnotendwith:textOp((function(a,b){return a+".indexOf("+b+", "+a+".length - "+(b?b.length-2:0)+") < 0"})),contains:textOp((function(a,b){return a+".indexOf("+b+") >= 0"})),doesnotcontain:textOp((function(a,b){return a+".indexOf("+b+") == -1"})),matches:textOp((function(a,b){return getMatchRegexp(b=b.substring(1,b.length-1))+".test("+a+")"})),doesnotmatch:textOp((function(a,b){return"!"+getMatchRegexp(b=b.substring(1,b.length-1))+".test("+a+")"})),isempty:function(a){return a+" === ''"},isnotempty:function(a){return a+" !== ''"},isnull:function(a){return"("+a+" == null)"},isnotnull:function(a){return"("+a+" != null)"},isnullorempty:function(a){return"("+a+" === null) || ("+a+" === '')"},isnotnullorempty:function(a){return"("+a+" !== null) && ("+a+" !== '')"}}}();const filterExpr=function(expression){var idx,length,filter,expr$1,field,operator,expressions=[],fieldFunctions=[],operatorFunctions=[],filters=expression.filters;for(idx=0,length=filters.length;idx<length;idx++)field=(filter=filters[idx]).field,operator=filter.operator,filter.filters?(filter=(expr$1=filterExpr(filter)).expression.replace(/__o\[(\d+)\]/g,(function(match,index){return index=+index,"__o["+(operatorFunctions.length+index)+"]"})).replace(/__f\[(\d+)\]/g,(function(match,index){return index=+index,"__f["+(fieldFunctions.length+index)+"]"})),operatorFunctions.push.apply(operatorFunctions,expr$1.operators),fieldFunctions.push.apply(fieldFunctions,expr$1.fields)):("function"==typeof field?(expr$1="__f["+fieldFunctions.length+"](d)",fieldFunctions.push(field)):expr$1=expr(field),"function"==typeof operator?(filter="__o["+operatorFunctions.length+"]("+expr$1+", "+operators.quote(filter.value)+")",operatorFunctions.push(operator)):filter=operators[(operator||"eq").toLowerCase()](expr$1,filter.value,void 0===filter.ignoreCase||filter.ignoreCase,expression.accentFoldingFiltering)),expressions.push(filter);return{expression:"("+expressions.join({and:" && ",or:" || "}[expression.logic])+")",fields:fieldFunctions,operators:operatorFunctions}};let filtersObj={};class Filter{prepare(){}value(cell){return cell.value}matches(){throw new Error("The 'matches' method is not implemented.")}toJSON(){throw new Error("The 'toJSON' method is not implemented.")}}Filter.create=function(options){var filter=options.filter;if(!filter)throw new Error("Filter type not specified.");var constructor=filtersObj[filter.charAt(0).toUpperCase()+filter.substring(1)+"Filter"];if(!constructor)throw new Error("Filter type not recognized.");return new constructor(options)};class ValueFilter extends Filter{constructor(options){super(options),this._values=[],this._dates=[],this._blanks=!1,void 0!==options.values&&(this._values=options.values),void 0!==options.blanks&&(this._blanks=options.blanks),void 0!==options.dates&&(this._dates=options.dates)}value(cell){var value=cell.value;this._dates.length>0&&cell.format&&"number"==typeof value&&("date"===formatting.type(value,cell.format)&&(value=serialToDate(value)));return value}matches(value){return null==value?this._blanks:value instanceof Date?this._dates.some((function(date){return!(date.year!==value.getFullYear()||void 0!==date.month&&date.month!==value.getMonth()||void 0!==date.day&&date.day!==value.getDate()||void 0!==date.hours&&date.hours!==value.getHours()||void 0!==date.minutes&&date.minutes!==value.getMinutes()||void 0!==date.seconds&&date.seconds!==value.getSeconds())})):this._values.indexOf(value)>=0}toJSON(){return{filter:"value",blanks:this._blanks,values:this._values.slice(0)}}}class CustomFilter extends Filter{constructor(options){if(super(options),this._logic="and",void 0!==options.logic&&(this._logic=options.logic),void 0===options.criteria)throw new Error("Must specify criteria.");this._criteria=options.criteria;var expression=filterExpr({logic:this._logic,filters:this._criteria,accentFoldingFiltering:culture().name}).expression;this._matches=new Function("d","return "+expression)}matches(value){return null!==value&&this._matches(value)}value(cell){var value=cell.value,criterionValue=this._criteria[0].value,criterionType=criterionValue instanceof Date?"date":typeof criterionValue,valueType=typeof value;return cell.format&&(valueType=formatting.type(value,cell.format)),valueType!=criterionType?"string"==criterionType&&(cell.format&&(value=formatting.text(value,cell.format)),value+=""):"date"==valueType&&(value=serialToDate(value)),value}toJSON(){return{filter:"custom",logic:this._logic,criteria:this._criteria}}}class TopFilter extends Filter{constructor(options){super(options),this._type=options.type,this._value=options.value,this._values=[]}prepare(cells){var values=cells.map(this.value).sort().filter((function(value,index,array){return 0===index||value!==array[index-1]}));"topNumber"===this._type||"topPercent"==this._type?values.sort((function(x,y){return y-x})):values.sort((function(x,y){return x-y}));var count=this._value;"topPercent"!==this._type&&"bottomPercent"!==this._type||(count=values.length*count/100|0),this._values=values.slice(0,count)}matches(value){return this._values.indexOf(value)>=0}toJSON(){return{filter:"top",type:this._type,value:this._value}}}class DynamicFilter extends Filter{constructor(options){if(super(options),this._type=options.type,this._predicate=this[options.type],"function"!=typeof this._predicate)throw new Error("DynamicFilter type '"+options.type+"' not recognized.")}value(cell){var value=cell.value;cell.format&&("date"===formatting.type(value,cell.format)&&(value=serialToDate(value)));return value}prepare(cells){for(var sum=0,count=0,ci=0;ci<cells.length;ci++){var value=this.value(cells[ci]);"number"==typeof value&&(sum+=value,count++)}this._average=count>0?sum/count:0}matches(value){return this._predicate(value)}aboveAverage(value){return value instanceof Date&&(value=dateToSerial(value)),"number"==typeof value&&value>this._average}belowAverage(value){return value instanceof Date&&(value=dateToSerial(value)),"number"==typeof value&&value<this._average}tomorrow(value){if(value instanceof Date){var tomorrow=kendoDate.addDays(kendoDate.today(),1);return kendoDate.getDate(value).getTime()===tomorrow.getTime()}return!1}today(value){return value instanceof Date&&kendoDate.isToday(value)}yesterday(value){if(value instanceof Date){var yesterday=kendoDate.addDays(kendoDate.today(),-1);return kendoDate.getDate(value).getTime()===yesterday.getTime()}return!1}nextWeek(value){return sameWeek(kendoDate.addDays(kendoDate.today(),7),value)}thisWeek(value){return sameWeek(kendoDate.today(),value)}lastWeek(value){return sameWeek(kendoDate.addDays(kendoDate.today(),-7),value)}nextMonth(value){return sameMonth(value,1)}thisMonth(value){return sameMonth(value,0)}lastMonth(value){return sameMonth(value,-1)}nextQuarter(value){if(value instanceof Date){var today=kendoDate.today(),diff=quarter(value)-quarter(today);return 1===diff&&today.getFullYear()===value.getFullYear()||-3==diff&&today.getFullYear()+1===value.getFullYear()}return!1}thisQuarter(value){if(value instanceof Date){var today=kendoDate.today();return 0===quarter(value)-quarter(today)&&today.getFullYear()===value.getFullYear()}return!1}lastQuarter(value){if(value instanceof Date){var today=kendoDate.today(),diff=quarter(today)-quarter(value);return 1===diff&&today.getFullYear()===value.getFullYear()||-3==diff&&today.getFullYear()-1===value.getFullYear()}return!1}nextYear(value){return sameYear(value,1)}thisYear(value){return sameYear(value,0)}lastYear(value){return sameYear(value,-1)}yearToDate(value){if(value instanceof Date){var today=kendoDate.today();return value.getFullYear()===today.getFullYear()&&value<=today}return!1}toJSON(){return{filter:"dynamic",type:this._type}}}filtersObj={Filter,ValueFilter,CustomFilter,TopFilter},[1,2,3,4].forEach((function(target){DynamicFilter.prototype["quarter"+target]=function(value){return value instanceof Date&&quarter(value)===target}}));function quarter(value){var month=value.getMonth()+1;return month>=1&&month<=3?1:month>=4&&month<=6?2:month>=7&&month<=9?3:4}function sameYear(value,offset){if(value instanceof Date){var today=kendoDate.today();return today.setFullYear(today.getFullYear()+offset),today.getFullYear()===value.getFullYear()}return!1}function sameMonth(value,offset){if(value instanceof Date){var today=kendoDate.firstDayOfMonth(kendoDate.today());return today.setMonth(today.getMonth()+offset,1),today.getTime()===kendoDate.firstDayOfMonth(value).getTime()}return!1}function sameWeek(a,b){if(b instanceof Date){var firstWeek=kendoDate.dayOfWeek(kendoDate.getDate(a),1),secondWeek=kendoDate.dayOfWeek(kendoDate.getDate(b),1);return firstWeek.getTime()===secondWeek.getTime()}return!1}var MODIFIED_FORMULAS;class Selection{constructor(sheet){this._sheet=sheet,this.selection=FIRSTREF.toRangeRef(),this.originalSelection=FIRSTREF.toRangeRef(),this._activeCell=FIRSTREF.toRangeRef(),this.originalActiveCell=FIRSTREF}currentSelectionRange(){return this.selection.rangeAt(this.selectionRangeIndex).toRangeRef()}currentOriginalNavigationRange(){return this.originalSelection.rangeAt(this.selectionRangeIndex).toRangeRef()}currentNavigationRange(){return this.singleCellSelection()?this._sheet._sheetRef:this.selection.rangeAt(this.selectionRangeIndex).toRangeRef()}nextNavigationRange(){return this.singleCellSelection()||(this.selectionRangeIndex=this.selection.nextRangeIndex(this.selectionRangeIndex)),this.currentNavigationRange()}previousNavigationRange(){return this.singleCellSelection()||(this.selectionRangeIndex=this.selection.previousRangeIndex(this.selectionRangeIndex)),this.currentNavigationRange()}activeCell(ref){return ref&&(this.originalActiveCell=ref.first(),this._activeCell=this._sheet.unionWithMerged(ref.toRangeRef()),this._sheet.focus(ref),this._sheet.triggerChange({activeCell:!0,selection:!0})),this._activeCell}select(ref,expanded,changeActiveCell,view){if(ref){if(ref.eq(this.originalSelection))return;if(this._sheet.triggerSelect(new Range$1(ref,this._sheet)),this.originalSelection=ref,this.selection=expanded,!1!==changeActiveCell){if(ref.isCell())this._sheet.forEachMergedCell(ref,(function(merged){ref=merged.topLeft})),this.activeCell(ref);else{if(ref=this.selection.lastRange(),view&&view._sheet===this._sheet&&view.panes[0]){var i,pane,rows,cols,visible,newRef,panes=view.panes;for(i=0;i<panes.length&&(!(pane=panes[i])._currentView||(rows=pane._currentView.rows.values,cols=pane._currentView.columns.values,visible=new RangeRef(new CellRef(rows.start,cols.start),new CellRef(rows.end,cols.end)),(newRef=ref.intersect(visible))===NULLREF));i++);newRef&&newRef!==NULLREF&&(ref=newRef)}this.activeCell(ref.first())}this.selectionRangeIndex=this.selection.size()-1}else this._sheet.triggerChange({selection:!0})}return this.selection}singleCellSelection(){return this._activeCell.eq(this.selection)}}class Sheet extends Observable{constructor(){super(),this.events=["changing","commandRequest","afterInsertRow","afterDeleteRow","insertRow","insertColumn","deleteRow","deleteColumn","hideRow","hideColumn","unhideRow","unhideColumn","select","dataBinding","dataBound","progress"],this._reinit.apply(this,arguments)}activeCellCustomEditor(){}_reinit(rowCount,columnCount,rowHeight,columnWidth,headerHeight,headerWidth,defaultCellStyle){defaultCellStyle=defaultCellStyle||{},this._defaultCellStyle={background:defaultCellStyle.background,color:defaultCellStyle.color,fontFamily:defaultCellStyle.fontFamily,fontSize:defaultCellStyle.fontSize,italic:defaultCellStyle.italic,bold:defaultCellStyle.bold,underline:defaultCellStyle.underline,wrap:defaultCellStyle.wrap,verticalAlign:defaultCellStyle.verticalAlign,textAlign:defaultCellStyle.textAlign},this._rows=new Axis(rowCount,rowHeight),this._columns=new Axis(columnCount,columnWidth),this._filteredRows=new RangeList(0,rowCount-1,!1),this._mergedCells=[],this._frozenRows=0,this._frozenColumns=0,this._suspendChanges=!1,this._filter=null,this._showGridLines=!0,this._gridLinesColor=null,this._grid=new Grid(this._rows,this._columns,rowCount,columnCount,headerHeight,headerWidth),this._sheetRef=this._grid.normalize(SHEETREF),this._properties=new PropertyBag(rowCount,columnCount,this._defaultCellStyle),this._sorter=new Sorter(this._grid,this._properties.sortable()),this._viewSelection=new Selection(this),this._editSelection=new Selection(this),this._formulaSelections=[],this._drawings=[]}resize(newRows,newCols){newRows=Math.max(newRows,1),newCols=Math.max(newCols,1);var oldRows=this._rows._count,oldCols=this._columns._count;newRows<oldRows&&this.range(newRows,0,oldRows-newRows,oldCols).clear(),newCols<oldCols&&this.range(0,newCols,oldRows,oldCols-newCols).clear(),this._rows._resize(newRows),this._columns._resize(newCols),this._grid._resize(newRows,newCols),this._properties._resize(newRows,newCols),this._sheetRef=this._grid.normalize(SHEETREF),newRows>oldRows&&(this.range(oldRows,0,newRows-oldRows,newCols).clear(),this._filteredRows.value(oldRows,newRows-1,!1)),newCols>oldCols&&this.range(0,oldCols,newRows,newCols-oldCols).clear(),this.triggerChange({layout:!0})}_resizeAddRow(count){this.resize(this._rows._count+(count||1),this._columns._count)}_resizeAddColumn(count){this.resize(this._rows._count,this._columns._count+(count||1))}_resizeDeleteRow(count){this._resizeAddRow(-(count||1))}_resizeDeleteColumn(count){this._resizeAddColumn(-(count||1))}_resizeForJSON(rows){for(var rowCount=rows.length,colCount=0,ri=0;ri<rows.length;++ri){var row=rows[ri];if(null!=row.index&&(rowCount=Math.max(rowCount,row.index+1)),row.cells){colCount=Math.max(colCount,row.cells.length);for(var ci=0;ci<row.cells.length;++ci){var cell=row.cells[ci];null!=cell.index&&(colCount=Math.max(colCount,cell.index+1))}}}this.resize(Math.max(rowCount,this._rows._count),Math.max(colCount,this._columns._count))}_selectionState(){return this._inEdit?this._editSelection:this._viewSelection}navigator(){return this._navigator||(this._navigator=new SheetNavigator(this)),this._navigator}axisManager(){return this._axisManager||(this._axisManager=new AxisManager(this)),this._axisManager}_name(value){return value?(this._sheetName=value,this):this._sheetName}name(){return this._name()}_property(accessor,value,reason){return void 0===value?accessor():(accessor(value),this.triggerChange(reason))}_field(name,value,reason){return void 0===value?this[name]:(this[name]=value,this.triggerChange(reason))}suspendChanges(value){return void 0===value?this._suspendChanges:(this._suspendChanges=value,this)}triggerChange(reason){return this._suspendChanges?reason&&reason.isValue&&(this._valueChanged=!0):this.trigger("change",reason),this}triggerSelect(range){this.trigger("select",{range})}setDataSource(dataSource,columns){this.dataSourceBinder&&this.dataSourceBinder.destroy(),this.dataSourceBinder=new SheetDataSourceBinder({dataSource,sheet:this,columns}),this.dataSource=this.dataSourceBinder.dataSource}hideColumn(columnIndex){if(!this.trigger("hideColumn",{index:columnIndex}))return this._property(this._columns.hide.bind(this._columns),columnIndex,{layout:!0})}unhideColumn(columnIndex){if(!this.trigger("unhideColumn",{index:columnIndex}))return this._property(this._columns.unhide.bind(this._columns),columnIndex,{layout:!0})}isHiddenColumn(columnIndex){return this._grid._columns.hidden(columnIndex)}_copyRange(sourceRangeRef,targetRef){var grid=this._grid,rowCount=grid.rowCount,nextRefTopLeft=grid.normalize(sourceRangeRef.topLeft),nextRefBottomRight=grid.normalize(sourceRangeRef.bottomRight),nextIndex=nextRefTopLeft.col*rowCount+nextRefTopLeft.row,nextBottomIndex=nextRefBottomRight.col*rowCount+nextRefBottomRight.row,targetIndex=targetRef.col*rowCount+targetRef.row;this._properties.copy(nextIndex,nextBottomIndex,targetIndex)}_saveModifiedFormulas(array,callback){var save=MODIFIED_FORMULAS;MODIFIED_FORMULAS=array;var ret=callback();return MODIFIED_FORMULAS=save,ret}_restoreModifiedFormulas(array){var wb=this._workbook;array.forEach((function(f){var index,sheet=wb.sheetByName(f.sheet);f instanceof calc.runtime.Formula&&(index=sheet._grid.cellRefIndex(f),sheet._properties.set("formula",index,index,f)),f instanceof validationExport.Validation&&(index=sheet._grid.cellRefIndex(f),sheet._properties.set("validation",index,index,f))}))}_adjustReferences(operation,start,delta,mergedCells){if(this._mergedCells=mergedCells.reduce((function(a,ref){return(ref=ref.adjust(null,null,null,null,"row"===operation,start,delta))instanceof RangeRef&&a.push(ref),a}),[]),this._workbook){var affectedSheet=this._name();this._workbook._sheets.forEach((function(sheet){sheet._forFormulas((function(formula){var prev=formula.adjust(affectedSheet,operation,start,delta);prev&&MODIFIED_FORMULAS&&MODIFIED_FORMULAS.push(prev)})),sheet._forValidations((function(validation){var prev=validation.adjust(affectedSheet,operation,start,delta);prev&&MODIFIED_FORMULAS&&MODIFIED_FORMULAS.push(prev)}))})),this._workbook.adjustNames(affectedSheet,"row"===operation,start,delta)}var selection=this.select();(selection=selection.adjust(null,null,null,null,"row"===operation,start,delta))!==NULLREF&&this.select(selection),("col"===operation?this._columns:this._rows).adjust(start,delta),"row"===operation&&(delta<0?this._filteredRows.copy(start-delta,this._rows._count-1,start):(this._filteredRows.copy(start,this._rows._count,start+delta),this._filteredRows.value(start,start+delta-1,!1))),this._drawings.forEach((function(drawing){drawing.topLeftCell&&(drawing.topLeftCell=drawing.topLeftCell.adjust(null,null,null,null,"row"===operation,start,delta))}))}_forFormulas(callback){var formulas=this._properties.get("formula").values(),n=formulas.length;formulas.forEach((function(f,i){callback.call(this,f.value,i,n)}),this)}_forValidations(callback){this._properties.get("validation").values().forEach((function(v){callback.call(this,v.value)}),this)}insertRow(rowIndex,skipDataSourceInsert){if(!this.trigger("insertRow",{index:rowIndex}))return this.batch((function(){this._resizeAddRow();var grid=this._grid,columnCount=grid.columnCount,rowCount=grid.rowCount;if(rowIndex+1!==rowCount){var frozenRows=this.frozenRows();rowIndex<frozenRows&&this.frozenRows(frozenRows+1);for(var mergedCells=this._mergedCells.slice(),ci=0;ci<columnCount;ci++){var ref=new RangeRef(new CellRef(rowIndex,ci),new CellRef(rowIndex,ci)),topLeft=grid.normalize(ref.topLeft),bottomRight=grid.normalize(ref.bottomRight),nextRef=new RangeRef(new CellRef(topLeft.row,topLeft.col),new CellRef(rowCount-2,bottomRight.col));this._copyRange(nextRef,new CellRef(topLeft.row+1,topLeft.col)),new Range$1(ref,this).clear({clearAll:!0,keepBorders:!0})}this._adjustReferences("row",rowIndex,1,mergedCells)}}),{recalc:!0,layout:!0,insertRow:{index:rowIndex},ref:new RangeRef(new CellRef(rowIndex,0),new CellRef(1/0,1/0))}),skipDataSourceInsert||this.trigger("afterInsertRow",{index:rowIndex}),this}isEnabledRow(rowIndex){var ref=new RangeRef(new CellRef(rowIndex,0),new CellRef(rowIndex,this._grid.columnCount));return new Range$1(ref,this).enable()}deleteRow(rowIndex,skipDataSourceDelete){return this.isEnabledRow(rowIndex)?this.trigger("deleteRow",{index:rowIndex})?void 0:(this.batch((function(){var grid=this._grid,columnCount=grid.columnCount,frozenRows=this.frozenRows();rowIndex<frozenRows&&this.frozenRows(frozenRows-1);for(var mergedCells=this._mergedCells.slice(),ci=0;ci<columnCount;ci++){var ref=new RangeRef(new CellRef(rowIndex,ci),new CellRef(rowIndex,ci));new Range$1(ref,this).clear({clearAll:!0,keepBorders:!0});var topLeft=grid.normalize(ref.topLeft),bottomRight=grid.normalize(ref.bottomRight),nextRef=new RangeRef(new CellRef(topLeft.row+1,topLeft.col),new CellRef(1/0,bottomRight.col));this._copyRange(nextRef,topLeft);var nextRefBottomRight=grid.normalize(nextRef.bottomRight);new Range$1(new RangeRef(nextRefBottomRight,nextRefBottomRight),this).clear()}this._adjustReferences("row",rowIndex,-1,mergedCells),this._resizeDeleteRow()}),{recalc:!0,layout:!0,deleteRow:{index:rowIndex},ref:new RangeRef(new CellRef(rowIndex,0),new CellRef(1/0,1/0))}),skipDataSourceDelete||this.trigger("afterDeleteRow",{index:rowIndex}),this):this}insertColumn(columnIndex){if(!this.trigger("insertColumn",{index:columnIndex}))return this.batch((function(){this._resizeAddColumn();var grid=this._grid,columnCount=grid.columnCount;if(columnIndex+1!==columnCount){var frozenColumns=this.frozenColumns();columnIndex<frozenColumns&&this.frozenColumns(frozenColumns+1);for(var mergedCells=this._mergedCells.slice(),ci=columnCount;ci>=columnIndex;ci--){var ref=new RangeRef(new CellRef(0,ci),new CellRef(1/0,ci));if(new Range$1(ref,this).clear({clearAll:!0,keepBorders:!0}),ci===columnIndex)break;var topLeft=grid.normalize(ref.topLeft),bottomRight=grid.normalize(ref.bottomRight),nextRef=new RangeRef(new CellRef(topLeft.row,topLeft.col-1),new CellRef(bottomRight.row,bottomRight.col-1));this._copyRange(nextRef,topLeft)}this._adjustReferences("col",columnIndex,1,mergedCells)}}),{recalc:!0,layout:!0,insertColumn:{index:columnIndex},ref:new RangeRef(new CellRef(0,columnIndex),new CellRef(1/0,1/0))}),this}isEnabledColumn(columnIndex){var ref=new RangeRef(new CellRef(0,columnIndex),new CellRef(1/0,columnIndex));return new Range$1(ref,this).enable()}deleteColumn(columnIndex){return this.isEnabledColumn(columnIndex)?this.trigger("deleteColumn",{index:columnIndex})?void 0:(this.batch((function(){var grid=this._grid,columnCount=grid.columnCount,frozenColumns=this.frozenColumns();columnIndex<frozenColumns&&this.frozenColumns(frozenColumns-1);for(var mergedCells=this._mergedCells.slice(),ci=columnIndex;ci<columnCount;ci++){var ref=new RangeRef(new CellRef(0,ci),new CellRef(1/0,ci));if(new Range$1(ref,this).clear({clearAll:!0,keepBorders:!0}),ci===columnCount-1)break;var topLeft=grid.normalize(ref.topLeft),bottomRight=grid.normalize(ref.bottomRight),nextRef=new RangeRef(new CellRef(topLeft.row,topLeft.col+1),new CellRef(bottomRight.row,bottomRight.col+1));this._copyRange(nextRef,topLeft)}this._adjustReferences("col",columnIndex,-1,mergedCells),this._resizeDeleteColumn()}),{recalc:!0,layout:!0,deleteColumn:{index:columnIndex},ref:new RangeRef(new CellRef(0,columnIndex),new CellRef(1/0,1/0))}),this):this}_filterRow(rowIndex){this._rows.hide(rowIndex),this._filteredRows.value(rowIndex,rowIndex,!0),this.triggerChange({layout:!0})}hideRow(rowIndex){if(!this.trigger("hideRow",{index:rowIndex}))return this._property(this._rows.hide.bind(this._rows),rowIndex,{layout:!0})}unhideRow(rowIndex){if(!this.trigger("unhideRow",{index:rowIndex}))return this._property(this._rows.unhide.bind(this._rows),rowIndex,{layout:!0})}isHiddenRow(rowIndex){return this._grid._rows.hidden(rowIndex)}isFilteredRow(rowIndex){return this._filteredRows.value(rowIndex)}columnWidth(columnIndex,width){return this._property(this._columns.value.bind(this._columns,columnIndex,columnIndex),width,{layout:!0})}rowHeight(rowIndex,height){return this._property(this._rows.value.bind(this._rows,rowIndex,rowIndex),height,{layout:!0})}frozenRows(value){return this._field("_frozenRows",value,{layout:!0})}frozenColumns(value){return this._field("_frozenColumns",value,{layout:!0})}showGridLines(value){return this._field("_showGridLines",value,{layout:!0})}gridLinesColor(value){return this._field("_gridLinesColor",value,{layout:!0})}_ref(row,column,numRows,numColumns){var ref=null;return row instanceof Ref?row:row instanceof Range$1?row._ref.toRangeRef():("string"==typeof row?ref=calc.parseReference(row):(numRows||(numRows=1),numColumns||(numColumns=1),ref=new RangeRef(new CellRef(row,column),new CellRef(row+numRows-1,column+numColumns-1))),ref)}range(row,column,numRows,numColumns){return new Range$1(this._ref(row,column,numRows,numColumns),this)}_getMergedCells(range){var grid=this._grid,primary={},secondary={},hasMerged=!1;return this.forEachMergedCell(range,(function(ref){var topLeft=ref.topLeft;grid.forEach(ref,(function(cellRef){topLeft.eq(cellRef)?(primary[cellRef.print()]=ref,hasMerged=!0):range.contains(cellRef)&&(secondary[cellRef.print()]=topLeft,hasMerged=!0)}))})),{primary,secondary,hasMerged}}forEachMergedCell(ref,callback){var selectAll=!1;void 0===callback&&(callback=ref,selectAll=!0),this._mergedCells.forEach((function(merged){(selectAll||merged.intersects(ref))&&callback(merged)}))}forEachFilterHeader(ref,callback){var selectAll=!1;if(void 0===callback&&(callback=ref,selectAll=!0),this._filter){var refs=[];this._filter.ref.forEachColumn((function(columnRef){(selectAll||columnRef.intersects(ref))&&refs.push(columnRef.topLeft)})),this._mergedCells.forEach((function(merged){refs=refs.map((function(ref){return merged.intersects(ref)?merged:ref}))})),refs.reduce((function unique(result,element){return result.indexOf(element)<0&&result.push(element),result}),[]).forEach(callback)}}forEach(ref,callback){var self=this;function forEachRange(ref){ref instanceof RangeRef||(ref=ref.toRangeRef());var ci,ri,topLeft=self._grid.normalize(ref.topLeft),bottomRight=self._grid.normalize(ref.bottomRight);function doIt(value){callback(ri++,ci,value)}for(ci=topLeft.col;ci<=bottomRight.col;ci++){ri=topLeft.row;var startCellIndex=self._grid.index(ri,ci),endCellIndex=self._grid.index(bottomRight.row,ci);self._properties.forEach(startCellIndex,endCellIndex,doIt)}}ref instanceof RangeRef||(ref=self._ref(ref)),ref instanceof UnionRef?ref.forEach(forEachRange):forEachRange(ref)}startResizing(initialPosition){this._initialPosition=initialPosition,this._resizeInProgress=!0}startAutoFill(){this._autoFillInProgress=!0;var selection=this.select();this._autoFillOrigin=selection,this._autoFillDest=selection,this.triggerChange({selection:!0})}updateAutoFill(dest,punch,hint,direction){this._autoFillDest=dest,this._autoFillPunch=punch,this._autoFillHint=hint,this._autoFillDirection=direction,this.triggerChange({selection:!0})}autoFillRef(){return this._autoFillDest}autoFillPunch(){return this._autoFillPunch}autoFillInProgress(){return this._autoFillInProgress}resizingInProgress(){return this._resizeInProgress}draggingInProgress(){return this._draggingInProgress}completeResizing(){if(this._resizeInProgress){this._resizeInProgress=!1;var hintPosition=this.resizeHintPosition();if(this._initialPosition&&hintPosition){var handlePosition=this.resizeHandlePosition();handlePosition.col!==-1/0?this.trigger("commandRequest",{command:"ColumnWidthCommand",options:{target:handlePosition.col,value:this.columnWidth(handlePosition.col)-(this._initialPosition.x-hintPosition.x)}}):this.trigger("commandRequest",{command:"RowHeightCommand",options:{target:handlePosition.row,value:this.rowHeight(handlePosition.row)-(this._initialPosition.y-hintPosition.y)}})}else this.trigger("change",{resize:!0})}}_visualRange(ref){for(var merged=this._mergedCells,i=merged.length;--i>=0;)if(merged[i].intersects(ref))return this.range(merged[i]);return this.range(ref)}_renderComment(ref){var comment=null;if(ref){var range=this._visualRange(ref);comment=range.comment(),ref=range._ref.toRangeRef().topLeft}comment?this._commentRef&&ref.eq(this._commentRef)||(this._commentRef=ref,this.trigger("change",{comment:!0})):this._commentRef&&(this._commentRef=null,this.trigger("change",{comment:!0}))}resizeHandlePosition(){return this._resizeHandlePosition}resizeHintPosition(location){return void 0!==location&&(this._resizeHintPosition=location,this.trigger("change",{resize:!0})),this._resizeHintPosition}removeResizeHandle(){this._resizeHandlePosition&&(this._resizeHintPosition=void 0,this._resizeHandlePosition=void 0,this._initialPosition=void 0,this.trigger("change",{resize:!0}))}positionResizeHandle(ref){this._resizeHandlePosition=ref,this.trigger("change",{resize:!0})}startDragging(data){this._draggingInProgress=data}completeDragging(){var drag=this._draggingInProgress;if(drag){this._draggingInProgress=null;var drawing=drag.drawing;if(drawing.eq(drag.copy))return;if(drawing.topLeftCell){var box=this.drawingBoundingBox(drawing),row=this._rows.indexVisible(box.top),col=this._columns.indexVisible(box.left),ref=new CellRef(row,col),refBox=this.refBoundingBox(ref);drawing.offsetX=box.left-refBox.left,drawing.offsetY=box.top-refBox.top,drawing.topLeftCell=ref,this.triggerChange({dragging:!0})}this.trigger("commandRequest",{command:"DrawingUpdateCommand",options:{sheet:this,drawing,previous:drag.copy}})}}startSelection(view){this.frozenRows()||this.frozenColumns()?this._currentView=null:view&&view._sheet===this&&(this._currentView=view),this._selectionInProgress=!0}completeSelection(){if(this._selectionInProgress&&(this._selectionInProgress=!1,this._resizeHintPosition=void 0,this.trigger("change",{selection:!0})),this._autoFillInProgress){this._autoFillInProgress=!1;var dest=this._autoFillDest,origin=this._autoFillOrigin;this._autoFillPunch?this.trigger("commandRequest",{command:"ClearContentCommand",options:{operatingRange:this.range(this._autoFillPunch)}}):dest.eq(origin)?this.triggerChange({selection:!0}):this.trigger("commandRequest",{command:"AutoFillCommand",options:{operatingRange:this.range(dest),origin:this.range(origin)}}),this._autoFillDest=null,this._autoFillPunch=null,this._autoFillOrigin=null,this.select(dest)}}selectionInProgress(){return this._selectionInProgress}select(ref,changeActiveCell){var expandedRef,selectionState=this._selectionState();return ref&&(ref=this._ref(ref),ref=this._grid.normalize(ref),expandedRef=this._grid.isAxis(ref)?ref:this.unionWithMerged(ref)),selectionState.select(ref,expandedRef,changeActiveCell,this._currentView)}originalSelect(){return this._selectionState().originalSelection}currentSelectionRange(){return this._selectionState().currentSelectionRange()}currentOriginalSelectionRange(){return this._selectionState().currentOriginalNavigationRange()}currentNavigationRange(){return this._selectionState().currentNavigationRange()}nextNavigationRange(){return this._selectionState().nextNavigationRange()}previousNavigationRange(){return this._selectionState().previousNavigationRange()}selectionRangeIndex(){return this._selectionState().selectionRangeIndex}activeCell(ref){return this._selectionState().activeCell(ref)}originalActiveCell(){return this._selectionState().originalActiveCell}singleCellSelection(){return this._selectionState().singleCellSelection()}unionWithMerged(ref){var mergedCells=this._mergedCells;return ref.map((function(ref){return ref.toRangeRef().union(mergedCells)}))}trim(ref){var trims=[],grid=this._grid;return this._properties.forEachProperty((function(property){trims.push(grid.trim(ref,property.list))})),this.unionWithMerged(ref.topLeft.toRangeRef().union(trims))}focus(ref){if(!ref){var focus=this._focus;return this._focus=null,focus}this._focus=ref.toRangeRef()}activeCellSelection(){return new Range$1(this._grid.normalize(this.activeCell()),this)}selection(){return new Range$1(this._grid.normalize(this._selectionState().selection),this)}selectedHeaders(){var selection=this.select(),rows={},cols={},allCols=!1,allRows=!1,maxRow=this._grid.rowCount-1,maxCol=this._grid.columnCount-1;return selection.forEach((function(ref){var i,rowState="partial",colState="partial",bottomRight=(ref=ref.toRangeRef()).bottomRight,topLeft=ref.topLeft,rowSelection=topLeft.col<=0&&bottomRight.col>=maxCol,colSelection=topLeft.row<=0&&bottomRight.row>=maxRow;if(colSelection&&(allRows=!0,colState="full"),rowSelection&&(allCols=!0,rowState="full"),!colSelection)for(i=topLeft.row;i<=bottomRight.row;i++)"full"!==rows[i]&&(rows[i]=rowState);if(!rowSelection)for(i=topLeft.col;i<=bottomRight.col;i++)"full"!==cols[i]&&(cols[i]=colState)})),{rows,cols,allRows,allCols,all:allRows&&allCols}}isInEditMode(isInEdit){if(void 0===isInEdit)return this._inEdit;this._inEdit=isInEdit,isInEdit&&(this._editSelection.selection=this._viewSelection.selection.clone(),this._editSelection.originalSelection=this._viewSelection.originalSelection.clone(),this._editSelection._activeCell=this._viewSelection._activeCell.clone(),this._editSelection.originalActiveCell=this._viewSelection.originalActiveCell.clone())}_setFormulaSelections(selection){this._formulaSelections=(selection||[]).slice(),this.triggerChange({selection:!0})}_viewActiveCell(){return this._viewSelection._activeCell.toRangeRef()}toJSON(){var positions={},rows=this._rows.toJSON("height",positions),columns=this._columns.toJSON("width",{}),viewSelection=this._viewSelection,hyperlinks=[],defaultCellStyle=this._defaultCellStyle||{};this.forEach(SHEETREF,(function(row,col,cell){if(function clearDefaultStyle(cell){Object.keys(defaultCellStyle).forEach((function(key){cell[key]===defaultCellStyle[key]&&delete cell[key]}))}(cell),0!==Object.keys(cell).length){cell.link&&hyperlinks.push({ref:Ref.display(null,row,col),target:cell.link});var position=positions[row];void 0===position&&(position=rows.length,rows.push({index:row}),positions[row]=position),row=rows[position],cell.index=col,void 0===row.cells&&(row.cells=[]),cell.formula&&(cell.formula.arrayFormulaRange?cell.formula={src:cell.formula.toString(),ref:cell.formula.arrayFormulaRange.toString()}:cell.formula=cell.formula.toString()),cell.validation&&(cell.validation=cell.validation.toJSON()),cell.color&&(cell.color=(0,parse_color.Ay)(cell.color).toCss()),cell.background&&(cell.background=(0,parse_color.Ay)(cell.background).toCss()),cell.borderTop&&cell.borderTop.color&&(cell.borderTop.color=(0,parse_color.Ay)(cell.borderTop.color).toCss()),cell.borderBottom&&cell.borderBottom.color&&(cell.borderBottom.color=(0,parse_color.Ay)(cell.borderBottom.color).toCss()),cell.borderRight&&cell.borderRight.color&&(cell.borderRight.color=(0,parse_color.Ay)(cell.borderRight.color).toCss()),cell.borderLeft&&cell.borderLeft.color&&(cell.borderLeft.color=(0,parse_color.Ay)(cell.borderLeft.color).toCss()),row.cells.push(cell)}}));var json={name:this._name(),rows,columns,selection:viewSelection.selection.toString(),activeCell:viewSelection.activeCell().toString(),frozenRows:this.frozenRows(),frozenColumns:this.frozenColumns(),showGridLines:this.showGridLines(),gridLinesColor:this.gridLinesColor(),mergedCells:this._mergedCells.map((function(ref){return ref.toString()})),hyperlinks,defaultCellStyle,drawings:this._drawings.map((function(dr){return dr.toJSON()}))};return this._sort&&(json.sort={ref:this._sort.ref.toString(),columns:this._sort.columns.map((function(column){return{index:column.index,ascending:column.ascending}}))}),this._filter&&(json.filter={ref:this._filter.ref.toString(),columns:this._filter.columns.map((function(column){var filter=column.filter.toJSON();return filter.index=column.index,filter}))}),json}fromJSON(json){this.batch((function(){if(void 0!==json.name&&this._name(json.name),void 0!==json.frozenColumns&&this.frozenColumns(json.frozenColumns),void 0!==json.frozenRows&&this.frozenRows(json.frozenRows),void 0!==json.columns&&this._columns.fromJSON("width",json.columns),void 0!==json.rows){this._resizeForJSON(json.rows),this._rows.fromJSON("height",json.rows);for(var ri=0;ri<json.rows.length;ri++){var row=json.rows[ri],rowIndex=row.index;if(void 0===rowIndex&&(rowIndex=ri),row.cells)for(var ci=0;ci<row.cells.length;ci++){var cell=row.cells[ci],columnIndex=cell.index;if(void 0===columnIndex&&(columnIndex=ci),cell.formula){var isArray="string"!=typeof cell.formula,src=isArray?cell.formula.src:cell.formula,formula=this._compileFormula(rowIndex,columnIndex,src);isArray&&formula.setArrayFormulaRange(calc.parseReference(cell.formula.ref)),cell.formula=formula}cell.validation&&(cell.validation=this._compileValidation(rowIndex,columnIndex,cell.validation)),this._properties.fromJSON(this._grid.index(rowIndex,columnIndex),cell)}}}if(json.drawings&&(this._drawings=json.drawings.map(Drawing.fromJSON)),json.selection&&(this._viewSelection.selection=this._viewSelection.originalSelection=this._ref(json.selection)),json.activeCell){var activeCellRef=this._ref(json.activeCell);this._viewSelection._activeCell=activeCellRef.toRangeRef(),this._viewSelection.originalActiveCell=activeCellRef.first()}if(json.mergedCells&&json.mergedCells.forEach((function(ref){this.range(ref).merge()}),this),json.filter){var ref=json.filter.ref,columns=void 0===json.filter.columns?[]:json.filter.columns;ref&&(this._filter={ref:this._ref(ref),columns:columns.map((function(column){return{index:column.index,filter:Filter.create(column)}}))},this._refreshFilter())}void 0!==json.showGridLines&&(this._showGridLines=json.showGridLines),this._gridLinesColor=json.gridLinesColor,json.sort&&this._sortBy(this._ref(json.sort.ref),json.sort.columns.slice(0))})),this._rows._refresh(),this._columns._refresh()}formula(ref){return this._properties.get("formula",this._grid.cellRefIndex(ref))}validation(ref){return this._properties.get("validation",this._grid.cellRefIndex(ref))}resetFormulas(){this._forFormulas((function(formula){formula.reset()}))}resetValidations(){this._forValidations((function(validation){validation.reset()}))}recalc(context,callback){var formulas=this._properties.get("formula").values(),count=formulas.length,pending=0,i=0;if(!count&&callback)return callback();function next(){pending--,i!==count||pending||callback()}for(;i<count;)pending++,formulas[i++].value.exec(context,callback?next:null)}revalidate(context){var self=this;this._forValidations((function(validation){var cellRef=new CellRef(validation.row,validation.col),ref=new RangeRef(cellRef,cellRef);validation.exec(context,self._get(ref,"value"),self._get(ref,"format"))}))}_value(row,col,value){var index=this._grid.index(row,col);if(void 0===value)return this._properties.get("value",index);this._properties.set("value",index,index,value)}_validation(row,col){var index=this._grid.index(row,col);return this._properties.get("validation",index)}_compileValidation(row,col,curValidation){return curValidation instanceof validationExport.Validation?curValidation.clone(this._name(),row,col):(null!=curValidation.from&&(curValidation.from=(curValidation.from+"").replace(/^=/,"")),null!=curValidation.to&&(curValidation.to=(curValidation.to+"").replace(/^=/,"")),validationExport.compile(this._name(),row,col,curValidation))}_compileFormula(row,col,f){return f=f.replace(/^=/,""),f=calc.parseFormula(this._name(),row,col,f),calc.compile(f)}_copyValuesInRange(topLeft,bottomRight,value,property){var ci,start,end;for(ci=topLeft.col;ci<=bottomRight.col;ci++){start=this._grid.index(topLeft.row,ci),end=this._grid.index(bottomRight.row,ci);for(var index=start,row=topLeft.row;index<=end;++index,++row)value=value.clone(this._name(),row,ci),this._properties.set(property,index,index,value)}return value}_set(ref,name,value){var ci,start,end,topLeft=this._grid.normalize(ref.topLeft),bottomRight=this._grid.normalize(ref.bottomRight);if("number"==typeof value&&(value=calc.runtime.limitPrecision(value)),value&&"formula"===name)"string"==typeof value&&(value=this._compileFormula(topLeft.row,topLeft.col,value)),value=this._copyValuesInRange(topLeft,bottomRight,value,"formula");else if(value&&"validation"===name)value=this._compileValidation(topLeft.row,topLeft.col,value),value=this._copyValuesInRange(topLeft,bottomRight,value,"validation");else for(ci=topLeft.col;ci<=bottomRight.col;ci++)start=this._grid.index(topLeft.row,ci),end=this._grid.index(bottomRight.row,ci),this._properties.set(name,start,end,value),"formula"===name&&this._properties.set("value",start,end,null)}_get(ref,name){var topLeft=this._grid.normalize(ref.topLeft),index=this._grid.index(topLeft.row,topLeft.col);return this._properties.get(name,index)}batch(callback,reason){var suspended=this.suspendChanges();return this.suspendChanges(!0),this._valueChanged=!1,callback.call(this),reason||(reason={recalc:!0}),this._valueChanged&&(reason.isValue=!0),this.suspendChanges(suspended).triggerChange(reason)}_sortBy(ref,columns){var indices=null;columns.forEach((function(column){indices=this._sorter.sortBy(ref,column.index,this._properties.get("value"),column.ascending,indices)}),this),this._sort={ref,columns},this._refreshFilter(),this.forEach(ref,function(row,col,props){var formula=props.formula;if(formula){var diff=row-formula.row;if(0!==diff){var start=diff>0?formula.row:formula.row+diff;formula.adjust(this.name(),"row",start,diff)}}}.bind(this)),this.triggerChange({recalc:!0})}_refreshFilter(){this._filter&&this._filterBy(this._filter.ref,this._filter.columns)}_filterBy(ref,columns){this.batch((function(){for(var ri=ref.topLeft.row;ri<=ref.bottomRight.row;ri++)this.isFilteredRow(ri)&&(this._filteredRows.value(ri,ri,!1),this._rows.unhide(ri));columns.forEach((function(column){var columnRef=ref.resize({top:1}).toColumn(column.index),cells=[];if(columnRef!==NULLREF){this.forEach(columnRef,(function(row,col,cell){cell.row=row,cells.push(cell)})),column.filter.prepare(cells);for(var ci=0;ci<cells.length;ci++){var cell=cells[ci],value=column.filter.value(cell);!1===column.filter.matches(value)&&this._filterRow(cell.row)}}}),this),this._filter={ref,columns}}),{recalc:!0,layout:!0,filter:!0})}filterColumn(ref){var filterRef=this.filter().ref;return ref.toRangeRef().topLeft.col-filterRef.topLeft.col}filter(){return this._filter}clearFilter(spec){this._clearFilter(spec instanceof Array?spec:[spec])}_clearFilter(indices){this._filter&&this.batch((function(){this._filter.columns=this._filter.columns.filter((function(column){return indices.indexOf(column.index)<0})),this._refreshFilter()}),{recalc:!0,layout:!0,filter:!0})}getAxisState(){return{rows:this._rows.getState(),columns:this._columns.getState()}}setAxisState(state){this._rows.setState(state.rows),this._columns.setState(state.columns),this.triggerChange({layout:!0})}getState(){return{rows:this._rows.getState(),columns:this._columns.getState(),mergedCells:this._mergedCells.map((function(cell){return cell.clone()})),properties:this._properties.getState()}}setState(state){this._rows.setState(state.rows),this._columns.setState(state.columns),this._mergedCells=state.mergedCells,this._properties.setState(state.properties),this.triggerChange(ALL_REASONS)}_merge(ref){var mergedRef,mergedCells=this._mergedCells,sheet=this;return this.batch((function(){mergedRef=ref.map((function(ref){if(ref instanceof CellRef)return ref;var currentRef=ref.toRangeRef().union(mergedCells,(function(ref){mergedCells.splice(mergedCells.indexOf(ref),1)})),range=new Range$1(currentRef,sheet),formula=range._get("formula"),value=range.value(),format=range.format(),background=range.background();range.value(null),range.format(null),range.background(null);var topLeft=new Range$1(currentRef.collapse(),sheet);return formula?topLeft._set("formula",formula):topLeft.value(value),topLeft.format(format),topLeft.background(background),mergedCells.push(currentRef),currentRef}));var viewSelection=sheet._viewSelection;viewSelection.selection=sheet.unionWithMerged(viewSelection.originalSelection),viewSelection._activeCell=sheet.unionWithMerged(viewSelection.originalActiveCell)}),{activeCell:!0,selection:!0}),mergedRef}_useCultureDecimals(){return this._workbook&&this._workbook.options.useCultureDecimals}withCultureDecimals(f){var dot=".";return this._useCultureDecimals()&&(dot=culture().numbers.symbols.decimal),calc.withDecimalSeparator(dot,f)}drawingBoundingBox(drawing){var left=drawing.offsetX,top=drawing.offsetY;return drawing.topLeftCell&&(left+=this._columns.sum(0,drawing.topLeftCell.col-1),top+=this._rows.sum(0,drawing.topLeftCell.row-1)),new Rectangle(left,top,drawing.width,drawing.height)}refBoundingBox(ref){return this._grid.rectangle(ref.toRangeRef())}addDrawing(drw,activate){return drw instanceof Drawing||(drw=new Drawing(drw)),this._drawings.push(drw),activate&&(this._activeDrawing=drw),this.triggerChange({layout:!0}),drw}removeDrawing(drawing){var pos=this._drawings.indexOf(drawing);pos>=0&&(this._drawings.splice(pos,1),this.triggerChange({layout:!0}))}usesImage(img){for(var i=this._drawings.length;--i>=0;)if(this._drawings[i].image===img)return!0;return!1}isMerged(ref){for(var merged=this._mergedCells,i=merged.length;--i>=0;)if(merged[i].eq(ref))return!0;return!1}}class Drawing{constructor(args){this.reset(args)}toJSON(){return{topLeftCell:this.topLeftCell.toString(),offsetX:this.offsetX,offsetY:this.offsetY,width:this.width,height:this.height,image:this.image,opacity:this.opacity}}clone(){return new Drawing(this)}reset(dr){var anchor=dr.topLeftCell;"string"==typeof anchor&&(anchor=calc.parseReference(anchor)),this.topLeftCell=anchor,this.offsetX=dr.offsetX||0,this.offsetY=dr.offsetY||0,this.width=dr.width,this.height=dr.height,this.image=dr.image,this.opacity=null!=dr.opacity?dr.opacity:1}eq(dr){return(!this.topLeftCell&&!dr.topLeftCell||this.topLeftCell&&dr.topLeftCell&&this.topLeftCell.eq(dr.topLeftCell))&&this.offsetX===dr.offsetX&&this.offsetY===dr.offsetY&&this.width===dr.width&&this.height===dr.height&&this.image===dr.image&&this.opacity===dr.opacity}}Drawing.fromJSON=function(args){return new Drawing(args)};let PAPER_SIZE={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],executive:[521.86,756],folio:[612,936],legal:[612,1008],letter:[612,792],tabloid:[792,1224]};function mm2pt(mm){return mm*(72/25.4)}function cm2pt(cm){return mm2pt(10*cm)}function in2pt(inch){return 72*inch}function unitsToPoints(x,def){if("number"==typeof x)return x;if("string"==typeof x){let m;if(m=/^\s*([0-9.]+)\s*(mm|cm|in|pt)\s*$/.exec(x),m){let num=parseFloat(m[1]);if(!isNaN(num))return"pt"===m[2]?num:{mm:mm2pt,cm:cm2pt,in:in2pt}[m[2]](num)}}if(null!=def)return def;throw new Error("Can't parse unit: "+x)}let CONT;function distributeCoords(heights,pageHeight,maxEmpty,headerRows,headerCoords){let curr=0,out=[],bottom=pageHeight,header=0;return pageHeight&&maxEmpty&&(maxEmpty*=pageHeight),heights.forEach((function(h,i){null!=headerRows&&i<headerRows&&(header+=h),pageHeight&&curr+h>bottom&&(bottom-curr<maxEmpty&&(curr=pageHeight*Math.ceil(curr/pageHeight)+header,header>0&&headerCoords.push(curr-header)),bottom+=pageHeight*Math.ceil(h/pageHeight)),out.push(curr),curr+=h})),out.push(curr),out}function doLayout(sheet,range,options){let grid=sheet._grid;range=grid.normalize(range);let wholeRect=grid.rectangle(range),drawings=[];sheet._drawings.forEach((function(d){let box=sheet.drawingBoundingBox(d);box.intersects(wholeRect)&&drawings.push({drawing:d,box:box.offset(-wholeRect.left,-wholeRect.top)})}));let cells=[],rowHeights=[],colWidths=[],mergedCells=sheet._getMergedCells(range),maxRow=-1,maxCol=-1;sheet.forEach(range,(function(row,col,cell){let relrow=row-range.topLeft.row,relcol=col-range.topLeft.col,rh=sheet.rowHeight(row),cw=sheet.columnWidth(col);options.forScreen||(cell.drawings=drawings.filter((function(d){let tl=d.drawing.topLeftCell;if(tl&&tl.row==row&&tl.col==col)return maxRow=Math.max(maxRow,sheet._rows.index(d.box.bottom)),maxCol=Math.max(maxCol,sheet._columns.index(d.box.right)),!0}))),relcol||rowHeights.push(rh),relrow||colWidths.push(cw);let id=new CellRef(row,col).print();if(mergedCells.secondary[id])return;cell.row=relrow,cell.col=relcol;let m=mergedCells.primary[id];if(m?(delete mergedCells.primary[id],cell.merged=!0,cell.rowspan=m.height(),cell.colspan=m.width(),options.forScreen&&(cell.width=sheet._columns.sum(m.topLeft.col,m.bottomRight.col),cell.height=sheet._rows.sum(m.topLeft.row,m.bottomRight.row))):(cell.rowspan=1,cell.colspan=1),!sheet._grid._columns.sum(col,col+cell.colspan-1)||!sheet._grid._rows.sum(row,row+cell.rowspan-1))return;let nonEmpty=options.forScreen||function shouldDrawCell(cell){return null!=cell.value||cell.merged||null!=cell.background||null!=cell.borderRight||null!=cell.borderBottom||null!=cell.dBorders||null!=cell.validation&&!cell.validation.value||cell.drawings&&cell.drawings.length}(cell);(options.emptyCells||nonEmpty)&&(nonEmpty?(maxRow=Math.max(maxRow,relrow+cell.rowspan-1),maxCol=Math.max(maxCol,relcol+cell.colspan-1)):cell.empty=!0,cells.push(cell))})),options.forScreen||(rowHeights=rowHeights.slice(0,maxRow+1),colWidths=colWidths.slice(0,maxCol+1));let pageWidth=options.pageWidth,pageHeight=options.pageHeight,scaleFactor=options.scale||1;if(options.fitWidth){let width=colWidths.reduce(sum,0);width>pageWidth&&(scaleFactor=pageWidth/width)}pageWidth=Math.ceil(pageWidth/scaleFactor),pageHeight=Math.ceil(pageHeight/scaleFactor);let hyCoords=[],yCoords=distributeCoords(rowHeights,pageHeight||0,options.maxEmpty,options.headerRows,hyCoords),xCoords=distributeCoords(colWidths,pageWidth||0,options.maxEmpty),boxWidth=0,boxHeight=0,headerCells=[];return cells=cells.filter((function(cell){return(!cell.empty||!(cell.row>maxRow||cell.col>maxCol))&&(options.headerRows&&cell.row<options.headerRows&&headerCells.push(cell),cell.left=xCoords[cell.col],cell.top=yCoords[cell.row],cell.merged?options.forScreen?(cell.right=cell.left+cell.width,cell.bottom=cell.top+cell.height):(cell.right=orlast(xCoords,cell.col+cell.colspan),cell.bottom=orlast(yCoords,cell.row+cell.rowspan),cell.width=cell.right-cell.left,cell.height=cell.bottom-cell.top):(cell.width=colWidths[cell.col],cell.height=rowHeights[cell.row],cell.bottom=cell.top+cell.height,cell.right=cell.left+cell.width),options.forScreen||cell.drawings.forEach((function(d){let box=d.box;box.left=cell.left+d.drawing.offsetX,box.top=cell.top+d.drawing.offsetY,box.right=box.left+box.width,box.bottom=box.top+box.height})),boxWidth=Math.max(boxWidth,cell.right),boxHeight=Math.max(boxHeight,cell.bottom),!0)})),Object.keys(mergedCells.primary).forEach((function(id){let ref=mergedCells.primary[id];sheet.forEach(ref.topLeft.toRangeRef(),(function(row,col,cell){let relrow=row-range.topLeft.row,relcol=col-range.topLeft.col;cell.merged=!0,cell.colspan=ref.width(),cell.rowspan=ref.height(),cell.top=relrow<0?-sheet._rows.sum(row,row-relrow-1):yCoords[relrow],cell.left=relcol<0?-sheet._columns.sum(col,col-relcol-1):xCoords[relcol],cell.height=sheet._rows.sum(ref.topLeft.row,ref.bottomRight.row),cell.width=sheet._columns.sum(ref.topLeft.col,ref.bottomRight.col),cell.height>0&&cell.width>0&&(cell.right=cell.left+cell.width,cell.bottom=cell.top+cell.height,cell.row=relrow,cell.col=relcol,cells.push(cell))}))})),options.headerRows&&(hyCoords.forEach((function(y){headerCells.forEach((function(cell){(cell=function clone(hash,target){target||(target={});if(Object.assign)return Object.assign(target,hash);return Object.keys(hash).reduce((function(copy,key){return copy[key]=hash[key],copy}),target)}(cell)).top+=y,cell.bottom=cell.top+cell.height,cells.push(cell)})),yCoords.push(y)})),yCoords.sort(orderCoords)),{width:boxWidth,height:boxHeight,cells:cells.sort(orderCells),scale:scaleFactor,xCoords,yCoords,drawings}}function sameBorder(a,b){return a.size===b.size&&a.color===b.color}function sum(a,b){return a+b}function orlast(a,i){return i<a.length?a[i]:a[a.length-1]}function orderCells(a,b){return a.top<b.top?-1:a.top==b.top?a.left<b.left?-1:a.left==b.left?0:1:1}function orderCoords(a,b){return a<b?-1:a>b?1:0}function drawLayout(sheet,layout,group,options){let ncols=Math.ceil(layout.width/options.pageWidth),nrows=Math.ceil(layout.height/options.pageHeight),pageWidth=Math.ceil(options.pageWidth/layout.scale),pageHeight=Math.ceil(options.pageHeight/layout.scale);for(let j=0;j<nrows;++j)for(let i=0;i<ncols;++i)addPage(j,i);function addPage(row,col){let left=col*pageWidth,right=left+pageWidth,top=row*pageHeight,bottom=top+pageHeight,endbottom=0,endright=0;function isInside(box){return!(box.right<=left||box.left>=right||box.bottom<=top||box.top>=bottom)&&(endbottom=Math.max(box.bottom,endbottom),endright=Math.max(box.right,endright),!0)}let cells=layout.cells.filter(isInside),drawings=layout.drawings.filter((function(d){return isInside(d.box)}));if(endbottom=Math.min(endbottom,bottom),endright=Math.min(endright,right),cells.length||drawings.length){let page=new shapes_group.A;group.append(page);let content=new shapes_group.A;page.append(content),content.clip(path.w.fromRect(new geometry_rect.A([left-1,top-1],[endright+1,endbottom+1])));let matrix=geometry_matrix.A.scale(layout.scale,layout.scale).multiplyCopy(geometry_matrix.A.translate(-left,-top));if((options.hCenter||options.vCenter)&&(matrix=matrix.multiplyCopy(geometry_matrix.A.translate(options.hCenter?(right-endright)/2:0,options.vCenter?(bottom-endbottom)/2:0))),content.transform(matrix),options.guidelines){let prev=null;layout.xCoords.forEach((function(x){(x=Math.min(x,endright))!==prev&&x>=left&&x<=right&&(prev=x,content.append((new path.w).moveTo(x,top).lineTo(x,endbottom).close().stroke(options.guideColor,.8)))})),prev=null,layout.yCoords.forEach((function(y){(y=Math.min(y,endbottom))!==prev&&y>=top&&y<=bottom&&(prev=y,content.append((new path.w).moveTo(left,y).lineTo(endright,y).close().stroke(options.guideColor,.8)))}))}let borders=Borders();cells.forEach((function(cell){!function drawCell$1(cell,content,options){let g=new shapes_group.A;content.append(g);let rect=new geometry_rect.A([cell.left,cell.top],[cell.width,cell.height]);if(cell.background||cell.merged){let r2d2=rect;options.guidelines&&(r2d2=rect.clone(),r2d2.origin.x+=.5,r2d2.origin.y+=.5,r2d2.size.width-=1,r2d2.size.height-=1),g.append(new shapes_rect.A(r2d2).fill(cell.background||"#fff").stroke(null))}cell.dBorders&&(2&cell.dBorders.type&&g.append((new path.w).moveTo(cell.left,cell.bottom).lineTo(cell.right,cell.top).stroke(cell.dBorders.color,cell.dBorders.size)),1&cell.dBorders.type&&g.append((new path.w).moveTo(cell.left,cell.top).lineTo(cell.right,cell.bottom).stroke(cell.dBorders.color,cell.dBorders.size)));let val=cell.value;if(null!=val){let type="number"==typeof val?"number":null,clip=new shapes_group.A;clip.clip(path.w.fromRect(rect)),g.append(clip);let f,format=cell.format;if(format||"number"!=type||val==Math.floor(val)||(format="0.##############"),format?(f=formatting.textAndColor(val,format),val=f.text,f.type&&(type=f.type)):val+="",!cell.textAlign)switch(type){case"number":case"date":case"percent":case"currency":cell.textAlign="right";break;case"boolean":cell.textAlign="center"}!function drawText(text,color,cell,group){CONT||(CONT=document.createElement("div"),CONT.style.position="fixed",CONT.style.left="0px",CONT.style.top="0px",CONT.style.visibility="hidden",CONT.style.overflow="hidden",CONT.style.boxSizing="border-box",CONT.style.lineHeight="normal",document.body.appendChild(CONT));CONT.firstChild&&CONT.removeChild(CONT.firstChild);CONT.style.padding="2px 4px",CONT.style.color=color,CONT.style.font=function makeFontDef(cell){let font=[];cell.italic&&font.push("italic");cell.bold&&font.push("bold");return font.push((cell.fontSize||12)+"px"),font.push(cell.fontFamily||"Arial"),font.join(" ")}(cell),CONT.style.width=cell.width+"px",CONT.style.textAlign=cell.textAlign||"left",CONT.style.textDecoration=cell.underline?"underline":"none",applyIndent(cell,CONT.style),cell.wrap?(CONT.style.whiteSpace="pre-wrap",CONT.style.overflowWrap=CONT.style.wordWrap="break-word"):(CONT.style.whiteSpace="pre",CONT.style.overflowWrap=CONT.style.wordWrap="normal");CONT.appendChild(document.createTextNode(text));let vtrans=0;switch(cell.verticalAlign){case"center":vtrans=cell.height-CONT.offsetHeight>>1;break;case void 0:case null:case"bottom":vtrans=cell.height-CONT.offsetHeight}vtrans<0&&(vtrans=0);let textGroup=core.vr.drawText(CONT);textGroup.transform(geometry_matrix.A.translate(cell.left,cell.top+vtrans)),group.append(textGroup)}(val,f&&f.color||cell.color||"#000",cell,clip)}}(cell,content,options),borders.add(cell,sheet)}));let bordersGroup=new shapes_group.A;borders.vert.forEach((function(a){a.forEach((function(b){b.rendered||(b.rendered=!0,bordersGroup.append((new path.w).moveTo(b.x,b.top).lineTo(b.x,b.bottom).close().stroke(b.color,b.size)))}))})),borders.horiz.forEach((function(a){a.forEach((function(b){b.rendered||(b.rendered=!0,bordersGroup.append((new path.w).moveTo(b.left,b.y).lineTo(b.right,b.y).close().stroke(b.color,b.size)))}))})),content.append(bordersGroup),drawings.forEach((function(d){let drawing=d.drawing,image=drawing.image;if(null!=image){let box=d.box,url=sheet._workbook.imageUrl(image);content.append(new drawing.Image(url,new geometry_rect.A([box.left,box.top],[box.width,box.height])).opacity(drawing.opacity))}}))}}}function applyIndent(cell,style){if(cell.indent){let indent=1.4*cell.indent;switch(style.textAlign){case null:case"left":style.paddingLeft=indent+"ch";break;case"right":style.paddingRight=indent+"ch";break;case"center":style.paddingLeft=indent/2+"ch",style.paddingRight=indent/2+"ch"}}}function drawFn(sheet,range,options,callback){null==options&&null==callback&&(callback=range,options={},range=SHEETREF),null==callback&&(callback=options,range instanceof Range||range instanceof Ref||"string"==typeof range?options={}:(options=range,range=SHEETREF)),options=Object.assign({},{paperSize:"A4",landscape:!0,margin:"1cm",guidelines:!0,guideColor:"#aaa",emptyCells:!0,fitWidth:!1,center:!1,headerRows:null,maxEmpty:.2,scale:1},options);let group=new shapes_group.A,paper=function getPaperOptions(getOption){if("function"!=typeof getOption){let options=getOption;getOption=function(key,def){return key in options?options[key]:def}}let paperSize=getOption("paperSize",PAPER_SIZE.a4);if(!paperSize)return{};if("string"==typeof paperSize&&(paperSize=PAPER_SIZE[paperSize.toLowerCase()],null==paperSize))throw new Error("Unknown paper size");paperSize[0]=unitsToPoints(paperSize[0]),paperSize[1]=unitsToPoints(paperSize[1]),getOption("landscape",!1)&&(paperSize=[Math.max(paperSize[0],paperSize[1]),Math.min(paperSize[0],paperSize[1])]);let margin=getOption("margin");return margin&&("string"==typeof margin||"number"==typeof margin?(margin=unitsToPoints(margin,0),margin={left:margin,top:margin,right:margin,bottom:margin}):margin={left:unitsToPoints(margin.left,0),top:unitsToPoints(margin.top,0),right:unitsToPoints(margin.right,0),bottom:unitsToPoints(margin.bottom,0)},getOption("addMargin")&&(paperSize[0]+=margin.left+margin.right,paperSize[1]+=margin.top+margin.bottom)),{paperSize,margin}}(options);group.options.set("pdf",{author:options.author,creator:options.creator,date:options.date,keywords:options.keywords,margin:paper.margin,multiPage:!0,paperSize:paper.paperSize,subject:options.subject,title:options.title,autoPrint:options.autoPrint});let pageWidth=paper.paperSize[0],pageHeight=paper.paperSize[1];paper.margin&&(pageWidth-=paper.margin.left+paper.margin.right+1,pageHeight-=paper.margin.top+paper.margin.bottom+1),options.pageWidth=pageWidth,options.pageHeight=pageHeight;let layout=doLayout(sheet,sheet._ref(range),options);drawLayout(sheet,layout,group,options),callback(group)}function Container(){}function Borders(){let horiz=new Container,vert=new Container;function addVert(row,col,border,x,top,bottom){let a=vert[col]||(vert[col]=new Container),prev=row>0&&a[row-1];prev&&sameBorder(prev,border)?(a[row]=prev,prev.bottom=bottom):a[row]={size:border.size,color:border.color||"#000",x,top,bottom}}function addHoriz(row,col,border,y,left,right){let a=horiz[row]||(horiz[row]=new Container),prev=col>0&&a[col-1];prev&&sameBorder(prev,border)?(a[col]=prev,prev.right=right):a[col]={size:border.size,color:border.color||"#000",y,left,right}}return{add:function add(cell,sheet){if(sheet){let pb=sheet._properties,grid=sheet._grid;cell.borderLeft=pb.get("vBorders",grid.index(cell.row,cell.col)),cell.borderRight=pb.get("vBorders",grid.index(cell.row,cell.col+cell.colspan)),cell.borderTop=pb.get("hBorders",grid.index(cell.row,cell.col)),cell.borderBottom=pb.get("hBorders",grid.index(cell.row+cell.rowspan,cell.col))}cell.borderLeft&&addVert(cell.row,cell.col,cell.borderLeft,cell.left,cell.top,cell.bottom),cell.borderRight&&addVert(cell.row,cell.col+cell.colspan,cell.borderRight,cell.right,cell.top,cell.bottom),cell.borderTop&&addHoriz(cell.row,cell.col,cell.borderTop,cell.top,cell.left,cell.right),cell.borderBottom&&addHoriz(cell.row+cell.rowspan,cell.col,cell.borderBottom,cell.bottom,cell.left,cell.right)},horiz,vert}}Sheet.prototype.draw=function(range,options,callback){let sheet=this;sheet._workbook?sheet.recalc(sheet._workbook._context,(function(){drawFn(sheet,range,options,callback)})):drawFn(sheet,range,options,callback)},Container.prototype={forEach:function(f){Object.keys(this).forEach((function(key){f(this[key],key,this)}),this)}};const draw={Borders,doLayout,applyIndent},viewClassNames={view:"k-spreadsheet-view",fixedContainer:"k-spreadsheet-fixed-container",editContainer:"k-spreadsheet-edit-container",scroller:"k-spreadsheet-scroller",viewSize:"k-spreadsheet-view-size",clipboard:"k-spreadsheet-clipboard",cellEditor:"k-spreadsheet-cell-editor",barEditor:"k-spreadsheet-editor",topCorner:"k-spreadsheet-top-corner",filterHeadersWrapper:"k-filter-wrapper",filterRange:"k-filter-range",filterButton:"k-spreadsheet-filter",filterButtonSelected:"k-selected",horizontalResize:"k-horizontal-resize",verticalResize:"k-vertical-resize",icon:"k-icon",iconFilterDefault:"k-i-arrow-60-down",sheetsBar:"k-spreadsheet-sheets-bar",sheetsBarActive:"k-spreadsheet-sheets-bar-active",sheetsBarInactive:"k-spreadsheet-sheets-bar-inactive",cellContextMenu:"k-spreadsheet-cell-context-menu",rowHeaderContextMenu:"k-spreadsheet-row-header-context-menu",colHeaderContextMenu:"k-spreadsheet-col-header-context-menu",drawingContextMenu:"k-spreadsheet-drawing-context-menu"},paneClassNames={cell:"k-spreadsheet-cell",vaxis:"k-spreadsheet-vaxis",haxis:"k-spreadsheet-haxis",vborder:"k-spreadsheet-vborder",hborder:"k-spreadsheet-hborder",rowHeader:"k-spreadsheet-row-header",columnHeader:"k-spreadsheet-column-header",pane:"k-spreadsheet-pane",data:"k-spreadsheet-data",mergedCell:"k-spreadsheet-merged-cell",mergedCellsWrapper:"k-merged-cells-wrapper",activeCell:"k-spreadsheet-active-cell",selection:"k-spreadsheet-selection",selectionWrapper:"k-selection-wrapper",autoFillWrapper:"k-auto-fill-wrapper",single:"k-single",top:"k-top",right:"k-right",bottom:"k-bottom",left:"k-left",resizeHandle:"k-resize-handle",columnResizeHandle:"k-column-resize-handle",rowResizeHandle:"k-row-resize-handle",resizeHint:"k-resize-hint",resizeHintHandle:"k-resize-hint-handle",resizeHintMarker:"k-resize-hint-marker",resizeHintVertical:"k-resize-hint-vertical",selectionHighlight:"k-spreadsheet-selection-highlight",series:["k-series-a","k-series-b","k-series-c","k-series-d","k-series-e","k-series-f"]};function cellBorder(value){return(value.size||1)+"px solid "+(value.color||"#000")}function asURL(link){return/:\/\//.test(link)||(link="http://"+link),link}class Pane{constructor(sheet,grid){this._sheet=sheet,this._grid=grid}refresh(width,height){this._grid.refresh(width,height)}isVisible(scrollLeft,scrollTop,ref){return this._grid.view(scrollLeft,scrollTop).ref.intersects(ref)}render(args){let scroller=args.scroller,scrollLeft=scroller.scrollLeft,scrollTop=scroller.scrollTop;scrollTop<0&&(scrollTop=0),scrollLeft<0&&(scrollLeft=0);let classNames=Pane.classNames,sheet=this._sheet,grid=this._grid,view=grid.view(scrollLeft,scrollTop);this._currentView=view,this._currentRect=this._rectangle(view.ref),this._selectedHeaders=sheet.selectedHeaders();let children=[];if(children.push(this.renderData(args)),sheet._activeDrawing||children.push(this.renderSelection(scroller)),children.push(this.renderAutoFill()),children.push(this.renderEditorSelection()),children.push(this.renderFilterHeaders()),grid.hasRowHeader){let rowHeader=dom.element("div",{className:classNames.rowHeader,style:{width:grid.headerWidth+"px",top:view.rowOffset+"px"}});children.push(rowHeader),sheet.forEach(view.ref.leftColumn(),function(row){if(!sheet.isHiddenRow(row)){let text=row+1,height=sheet.rowHeight(row);rowHeader.children.push(dom.element("div",{className:this.headerClassName(row,"row"),style:{width:grid.headerWidth+"px",height:height+"px"}},[dom.element("div",{className:"k-vertical-align-center"},[dom.text(text+"")])]))}}.bind(this))}if(grid.hasColumnHeader){let columnHeader=dom.element("div",{className:classNames.columnHeader,style:{top:"0px",left:view.columnOffset+"px",width:this._currentRect.width+"px",height:grid.headerHeight+"px"}});children.push(columnHeader);let left=0;sheet.forEach(view.ref.topRow(),function(row,col){if(!sheet.isHiddenColumn(col)){let text=Ref.display(null,1/0,col),width=sheet.columnWidth(col);columnHeader.children.push(dom.element("div",{className:this.headerClassName(col,"col"),style:{position:"absolute",left:left+"px",width:width+"px",height:grid.headerHeight+"px"}},[dom.element("div",{className:"k-vertical-align-center"},[dom.text(text+"")])])),left+=width}}.bind(this))}sheet.resizeHandlePosition()&&(grid.hasColumnHeader||grid.hasRowHeader)&&(sheet.resizeHintPosition()||this.renderResizeHandle(children));let paneClasses=[classNames.pane];return grid.hasColumnHeader&&paneClasses.push(classNames.top),grid.hasRowHeader&&paneClasses.push(classNames.left),dom.element("div",{style:grid.style,className:paneClasses.join(" ")},children)}headerClassName(index,type){let itemSelection,allHeaders,selectedHeaders=this._selectedHeaders;"row"===type?(itemSelection=selectedHeaders.rows[index],allHeaders=selectedHeaders.allRows):(itemSelection=selectedHeaders.cols[index],allHeaders=selectedHeaders.allCols);let className=itemSelection||(selectedHeaders.all?"full":allHeaders?"partial":"none");return className&&(className="k-selection-"+className),className}renderData(args){let prev,sheet=this._sheet,view=this._currentView,cont=dom.element("div",{className:Pane.classNames.data,style:{position:"relative",left:view.columnOffset+"px",top:view.rowOffset+"px"}}),rect=this._currentRect,layout=draw.doLayout(sheet,view.ref,{forScreen:!0}),grid=this._grid,showGridLines=sheet._showGridLines;showGridLines&&(prev=null,layout.xCoords.forEach((function(x){x!==prev&&(prev=x,cont.children.push(dom.element("div",{className:paneClassNames.vaxis,style:{left:x+"px",height:rect.height+"px",borderColor:sheet.gridLinesColor()}})))})),prev=null,layout.yCoords.forEach((function(y){y!==prev&&(prev=y,cont.children.push(dom.element("div",{className:paneClassNames.haxis,style:{top:y+"px",width:rect.width+"px",borderColor:sheet.gridLinesColor()}})))})));let borders=draw.Borders(),activeCellRange=sheet.activeCell().toRangeRef(),activeCell=activeCellRange.topLeft;return layout.cells.forEach((function(cell){let cls=null,absRow=cell.row+view.ref.topLeft.row,absCol=cell.col+view.ref.topLeft.col;if(sheet._activeDrawing){let ref=sheet._activeDrawing.topLeftCell;ref&&ref.row===absRow&&ref.col===absCol&&(cls="k-spreadsheet-drawing-anchor-cell")}else absRow===activeCell.row&&absCol===activeCell.col&&(cls=[Pane.classNames.activeCell].concat(this._activeFormulaColor(),this._directionClasses(activeCellRange)),sheet.singleCellSelection()&&cls.push(Pane.classNames.single),cls=cls.join(" "));if(borders.add(cell),function drawCell(collection,cell,cls,showGrid){function maybeLink(el){let link=cell.link;if(link||"object"==typeof cell.value&&(link=cell.value.link),link){let style={textDecoration:"none"};return cell.color&&(style.color=cell.color),cell.underline&&(style.textDecoration="underline"),dom.element("a",{href:asURL(link),style,target:"_blank"},el?[el]:[])}return el}let shouldDraw=null!=cell.value||null!=cell.validation&&!cell.validation.value||cell.background||cell.merged||cell.comment||cell.dBorders;if(!cls&&!shouldDraw)return;let style={background:[]},background=cell.background;if(background){let defaultBorder=background;showGrid&&(defaultBorder=(0,parse_color.Ay)(defaultBorder).toHSV(),defaultBorder.v*=.9,defaultBorder=defaultBorder.toCssRgba()),defaultBorder=cellBorder({color:defaultBorder}),style.outline=defaultBorder}cell.dBorders&&(2&cell.dBorders.type&&style.background.push("linear-gradient(to top left, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) calc(50% - "+cell.dBorders.size+"px), "+cell.dBorders.color+" 50%, rgba(0, 0, 0, 0) calc(50% + "+cell.dBorders.size+"px), rgba(0, 0, 0, 0) 100%)"),1&cell.dBorders.type&&style.background.push("linear-gradient(to top right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) calc(50% - "+cell.dBorders.size+"px), "+cell.dBorders.color+" 50%, rgba(0, 0, 0, 0) calc(50% + "+cell.dBorders.size+"px), rgba(0, 0, 0, 0) 100%)")),background&&style.background.push(background),cell.color&&(style.color=cell.color),cell.fontFamily&&(style.fontFamily=cell.fontFamily),cell.underline&&(style.textDecoration="underline"),cell.italic&&(style.fontStyle="italic"),cell.textAlign&&(style.textAlign=cell.textAlign),cell.bold&&(style.fontWeight="bold"),cell.fontSize&&(style.fontSize=cell.fontSize+"px"),!0===cell.wrap?(style.whiteSpace="pre-wrap",style.overflowWrap="break-word",style.wordWrap="break-word"):(style.whiteSpace="pre",style.overflowWrap="normal",style.wordWrap="normal"),style.left=cell.left+1+"px",style.top=cell.top+1+"px",style.width=cell.width-1+"px",style.height=cell.height-1+"px";let data=cell.value,type=typeof data,format=cell.format;if(format||"number"!==type||data===Math.floor(data)||(format="0.##############"),format&&null!=data?(data=formatting.format(data,format),data.__dataType&&(type=data.__dataType)):null!=data&&(data=cell.html?dom.html(data):dom.text(data)),!style.textAlign)switch(type){case"number":case"date":case"percent":case"currency":style.textAlign="right";break;case"boolean":style.textAlign="center"}draw.applyIndent(cell,style);let classNames=[paneClassNames.cell];cls&&classNames.push(cls),!1===cell.enable&&classNames.push("k-disabled"),cell.merged&&classNames.push("k-spreadsheet-merged-cell"),cell.comment&&classNames.push("k-spreadsheet-has-comment");let verticalAlign=cell.verticalAlign||"bottom";data=verticalAlign&&data?dom.element("div",{className:"k-vertical-align-"+verticalAlign},[maybeLink(data)]):maybeLink(data),style.background.length?style.background=style.background.join(","):delete style.background;let children=data?[data]:[],properties={style},validation=cell.validation;validation&&!validation.value&&(children.push(dom.element("span",{className:"k-dirty"})),classNames.push("k-dirty-cell"),properties.title=validation.message),properties.className=classNames.join(" ");let div=dom.element("div",properties,children);return collection.push(div),div}(cont.children,cell,cls,showGridLines),cell.comment&&sheet._commentRef&&absRow===sheet._commentRef.row&&absCol===sheet._commentRef.col){let ttOffset=4,left=cell.right+grid.left+view.columnOffset+ttOffset,style={top:cell.top+grid.top+view.rowOffset+"px"};left+200>args.contentWidth?style.right=args.contentWidth-grid.left-cell.left-view.columnOffset+ttOffset+"px":style.left=left+"px";let div=dom.element("div",{className:"k-tooltip k-spreadsheet-cell-comment",style},[dom.text(cell.comment)]);args.toplevelElements.push(div)}}),this),borders.vert.forEach((function(a){a.forEach((function(b){if(!b.rendered){b.rendered=!0;let style={left:b.x+"px",top:b.top+"px",height:b.bottom-b.top+1+"px",borderWidth:b.size+"px",borderColor:b.color};1!==b.size&&(style.transform="translateX(-"+(b.size-1)/2+"px)"),cont.children.push(dom.element("div",{className:paneClassNames.vborder,style}))}}))})),borders.horiz.forEach((function(a){a.forEach((function(b){if(!b.rendered){b.rendered=!0;let style={top:b.y+"px",left:b.left+"px",width:b.right-b.left+"px",borderWidth:b.size+"px",borderColor:b.color};1!==b.size&&(style.transform="translateY(-"+(b.size-1)/2+"px)"),cont.children.push(dom.element("div",{className:paneClassNames.hborder,style}))}}))})),this.renderDrawings(layout,cont.children),cont}renderDrawings(layout,container){let sheet=this._sheet,workbook=sheet._workbook;layout.drawings.forEach((function(d){let drawing=d.drawing,div=d.box.toDiv("k-spreadsheet-drawing");drawing.image&&div.children.push(dom.element("div",{className:"k-spreadsheet-drawing-image",style:{backgroundImage:"url('"+workbook.imageUrl(drawing.image)+"')",opacity:drawing.opacity}})),drawing===sheet._activeDrawing&&(div.attr.className+=" k-spreadsheet-active-drawing",function drawingResizeHandles(container){["N","NE","E","SE","S","SW","W","NW"].forEach((function(direction){container.push(dom.element("div",{className:"k-spreadsheet-drawing-handle "+direction,"data-direction":direction}))}))}(div.children)),container.push(div)}))}renderResizeHandle(container){let style,ref=this._sheet.resizeHandlePosition(),rectangle=this._rectangle(ref),classNames=[Pane.classNames.resizeHandle];if(ref.col!==-1/0){if(this._grid.rows._start>0)return;style={height:this._grid.headerHeight+"px",width:"7px",left:rectangle.right-3.5+"px",top:"0px"},classNames.push(viewClassNames.horizontalResize)}else{if(this._grid.columns._start>0)return;style={height:"7px",width:this._grid.headerWidth+"px",top:rectangle.bottom-3.5+"px",left:"0px"},classNames.push(viewClassNames.verticalResize)}container.push(dom.element("div",{className:classNames.join(" "),style}))}filterIconRect(rect){return new Rectangle(rect.right-16-3,rect.top+3,16,16)}renderFilterHeaders(){let sheet=this._sheet,children=[],classNames=viewClassNames,filter=sheet.filter();function icon(className){return dom.element("span",{className:classNames.icon+" "+className})}return filter&&this._addDiv(children,filter.ref,classNames.filterRange),sheet.forEachFilterHeader(this._currentView.ref,function(ref){let rect=this._rectangle(ref),position=this.filterIconRect(rect),column=this._sheet.filterColumn(ref),button=function filterButton(classNames,position,index){let style={left:position.left+"px",top:position.top+"px"},filtered=filter&&filter.columns.some((function(c){return c.index===index})),classes=classNames.filterButton;return filtered&&(classes+=" "+classNames.filterButtonSelected),dom.element("span",{className:classes,style},[icon(classNames.iconFilterDefault)])}(classNames,position,column);children.push(button)}.bind(this)),dom.element("div",{className:classNames.filterHeadersWrapper},children)}renderEditorSelection(){let classNames=Pane.classNames,sheet=this._sheet,selections=[];return sheet._formulaSelections.forEach(function(range){let ref=range.ref;ref!==NULLREF&&this._addDiv(selections,ref,classNames.selectionHighlight+" "+range.colorClass)}.bind(this)),dom.element("div",{className:classNames.selectionWrapper},selections)}renderSelection(scroller){let classNames=Pane.classNames,selections=[],selectionClasses=[classNames.selection],sheet=this._sheet,activeCell=sheet.activeCell().toRangeRef(),selection=sheet.select();return selectionClasses=selectionClasses.concat(this._activeFormulaColor()),1===selection.size()&&selectionClasses.push("k-single-selection"),this._sheet.autoFillPunch()&&selectionClasses.push("k-dim-auto-fill-handle"),selection.forEach(function(ref){ref!==NULLREF&&this._addDiv(selections,ref,selectionClasses.join(" "))}.bind(this)),this._renderCustomEditorButton(selections,activeCell,scroller),dom.element("div",{className:classNames.selectionWrapper},selections)}renderAutoFill(){let autoFillRectangle=[];if(this._sheet.autoFillInProgress()){let autoFillRef=this._sheet.autoFillRef(),punch=this._sheet.autoFillPunch(),direction=this._sheet._autoFillDirection;if(this._addDiv(autoFillRectangle,autoFillRef,"k-auto-fill"),punch)this._addDiv(autoFillRectangle,punch,"k-auto-fill-punch");else if(void 0!==direction){let ref,cssClass;switch(direction){case 0:case 1:ref=autoFillRef.bottomRight,cssClass="k-auto-fill-br-hint";break;case 2:ref=new CellRef(autoFillRef.topLeft.row,autoFillRef.bottomRight.col),cssClass="k-auto-fill-tr-hint";break;case 3:ref=new CellRef(autoFillRef.bottomRight.row,autoFillRef.topLeft.col),cssClass="k-auto-fill-bl-hint"}let rectangle=this._addDiv(autoFillRectangle,ref,cssClass);if(rectangle){let hint=dom.element("span",{className:"k-tooltip"},[dom.text(this._sheet._autoFillHint)]);rectangle.children.push(hint)}}}return dom.element("div",{className:Pane.classNames.autoFillWrapper},autoFillRectangle)}_addDiv(collection,ref,className){let div;return this._currentView.ref.intersects(ref)&&(div=this._rectangle(ref).resize(1,1).toDiv(className),collection.push(div)),div}_renderCustomEditorButton(collection,ref,scroller){let self=this,sheet=self._sheet,view=self._currentView,columnCount=self._grid.columns._axis._count,ed=sheet.activeCellCustomEditor();if(ed&&view.ref.intersects(ref)){let rectangle=self._rectangle(ref);sheet.forEach(ref.collapse(),(function(row,col,cell){cell.left=rectangle.left,cell.top=rectangle.top,cell.width=rectangle.width,cell.height=rectangle.height;let btnClass="k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-spreadsheet-editor-button",isLastColumn=col===columnCount-1||self._buttonOutOfVisiblePane(row,col,scroller);isLastColumn&&(btnClass+=" k-spreadsheet-last-column"),self._editorInLastColumn=isLastColumn;let btn=dom.element("div",{className:btnClass,style:{left:cell.left+(isLastColumn?0:cell.width)+"px",top:cell.top+"px",height:cell.height+"px"}});ed.icon&&btn.children.push(dom.element("span",{className:"k-icon "+ed.icon})),collection.push(btn)}))}}_activeFormulaColor(){let activeFormulaSelection,colorClasses=[];return this._sheet.isInEditMode()&&(activeFormulaSelection=this._sheet._formulaSelections.filter((function(sel){return sel.active&&"ref"===sel.type}))[0],activeFormulaSelection&&colorClasses.push(activeFormulaSelection.colorClass)),colorClasses}_directionClasses(cell){let cellClasses=[],classNames=Pane.classNames,view=this._currentView.ref;return cell.move(0,-1).intersects(view)||cellClasses.push(classNames.left),cell.move(-1,0).intersects(view)||cellClasses.push(classNames.top),cell.move(0,1).intersects(view)||cellClasses.push(classNames.right),cell.move(1,0).intersects(view)||cellClasses.push(classNames.bottom),cellClasses}_rectangle(ref){return this._grid.boundingRectangle(ref.toRangeRef()).offset(-this._currentView.mergedCellLeft,-this._currentView.mergedCellTop)}_buttonOutOfVisiblePane(row,col,scroller){let theGrid=this._grid,sheet=this._sheet,ref=sheet.range(row,col)._ref,boundaries=theGrid.scrollBoundaries(ref),scrollLeft=theGrid.columns.frozen?0:scroller.scrollLeft;if(boundaries.right+20>scrollLeft||col+1===sheet.frozenColumns())return!0}}Pane.classNames=paneClassNames;let styles=["font-family","font-size","font-stretch","font-style","font-weight","letter-spacing","text-transform","line-height"],KEY_NAMES={27:"esc",37:"left",39:"right",35:"end",36:"home",32:"spacebar"},PRIVATE_FORMULA_CHECK=/(^_|[^a-z0-9]$)/i;class index_esm_FormulaInput extends Widget{constructor(element,opt){const options=Object.assign({},{name:"FormulaInput",autoScale:!1,filterOperator:"startswith",scalePadding:30,minLength:1,formulaBarWidth:null},opt);super(element,options),this.events=["keyup","focus"],this.input=opt.input,element&&(this.bind(this.events,this.options),element.classList.add(index_esm_FormulaInput.classNames.wrapper),options&&options.formulaBarWidth,this._highlightedRefs=[],this._formulaSource(),this._formulaList(),this._tooltip(),this._sync=this._sync.bind(this),this.scale=this.scale.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._blur=this._blur.bind(this),this._input=this._input.bind(this),this._focus=this._focus.bind(this),this._paste=this._paste.bind(this),this.options.autoScale&&element.addEventListener("input",this.scale),element.addEventListener("keydown",this._keydown),element.addEventListener("keyup",this._keyup),element.addEventListener("blur",this._blur),element.addEventListener("input",this._input),element.addEventListener("click",this._input),element.addEventListener("focus",this._focus),element.addEventListener("paste",this._paste))}enable(enable){if(void 0===enable)return"true"===this.element.getAttribute("contenteditable");enable?this.element.setAttribute("contenteditable",enable):this.element.removeAttribute("contenteditable"),this.element.classList.toggle("k-disabled",!enable)}getPos(){let div=this.element,sel=window.getSelection(),a=lookup(sel.focusNode,sel.focusOffset),b=lookup(sel.anchorNode,sel.anchorOffset);if(null!=a&&null!=b){if(a>b){let tmp=a;a=b,b=tmp}return{begin:a,end:b,collapsed:a===b}}function lookup(lookupNode,pos){try{!function loop(node){if(node===lookupNode)throw pos;if(1===node.nodeType)for(let i=node.firstChild;i;i=i.nextSibling)loop(i);else 3===node.nodeType&&(pos+=node.nodeValue.length)}(div)}catch(index){return index}}}setPos(begin,end){let eiv=this.element;if(begin=lookup(eiv,begin),end=null!=end?lookup(eiv,end):begin,begin&&end){let range=document.createRange();range.setStart(begin.node,begin.pos),range.setEnd(end.node,end.pos);let sel=window.getSelection();(function differ(a,b){return a.startOffset!==b.startOffset||a.endOffset!==b.endOffset||a.startContainer!==b.endContainer||a.endContainer!==b.endContainer})(range,sel.getRangeAt(0))&&(sel.removeAllRanges(),sel.addRange(range))}function lookup(node,pos){try{!function loop(node){if(3===node.nodeType){let len=node.nodeValue.length;if(len>=pos)throw node;pos-=len}else if(1===node.nodeType)for(let i=node.firstChild;i;i=i.nextSibling)loop(i)}(node)}catch(el){return{node:el,pos}}}}end(){this.setPos(this.length())}home(){this.setPos(0)}select(){this.setPos(0,this.length())}length(){return this.value().length}_formulaSource(){let value,result=[];for(let key in calc.runtime.FUNCS)PRIVATE_FORMULA_CHECK.test(key)||(value=key.toUpperCase(),result.push({value,text:value}));this.formulaSource=result}get list(){return this.input.current.list}get popup(){return this.input.current.popup}_formulaList(){this.list.data(this.formulaSource),this.list.itemClick((value=>{this._formulaListChange(value)}))}_formulaListChange(value){let tokenCtx=this._tokenContext();if(!tokenCtx||this._mute)return;let activeToken=tokenCtx.token,completion=value,ctx={replace:!0,token:activeToken,end:activeToken.end};tokenCtx.nextToken&&"("===tokenCtx.nextToken.value||(completion+="("),this._replaceAt(ctx,completion),this.popup.close()}_blur(){this.popup.close(),clearTimeout(this._focusId),this.trigger("blur")}_isFormula(){return/^=/.test(this.value())}_keydown(e){let key=e.keyCode,that=this;KEY_NAMES[key]?(that.popup.close(),that._navigated=!0):that._move(key)&&(that._navigated=!0,e.preventDefault()),that._keyDownTimeout=setTimeout(that._syntaxHighlight.bind(that))}_keyup(){let value,popup=this.popup;if(this._isFormula()&&!this._navigated){value=((this._tokenContext()||{}).token||{}).value;const data=this.filter(value);value&&data.length?(popup[popup.visible()?"position":"open"](),setTimeout((()=>{this.list.focusFirst()}),0)):popup.close()}this._navigated=!1,this._syntaxHighlight(),this.trigger("keyup")}_input(){this._syntaxHighlight()}_focus(){setTimeout(this._sync.bind(this)),this._focusTimeout=setTimeout(this._syntaxHighlight.bind(this)),this.trigger("focus")}_paste(ev){ev.preventDefault();let text,pos=this.getPos();text=ev.clipboardData.getData("text/plain");let val=this.value();val=val.substr(0,pos.begin)+text+val.substr(pos.end),this.value(val),this.setPos(pos.begin+text.length),this.scale()}_move(key){let list=this.list,popup=this.popup;if(popup.visible()){if(key===index_esm_keys.DOWN)return list.focusNext(),!0;if(key===index_esm_keys.UP)return list.focusPrev(),!0;if(key===index_esm_keys.ENTER||key===index_esm_keys.TAB)return list.data()[list.focus()]&&this._formulaListChange(list.data()[list.focus()].value),popup.close(),!0;if(key===index_esm_keys.PAGEUP)return list.focusFirst(),!0;if(key===index_esm_keys.PAGEDOWN)return list.focusLast(),!0}return!1}_tokenContext(){let point=this.getPos(),value=this.value();if(!value||!point||!point.collapsed)return null;let tok,tokens=calc.tokenize(value,this.row(),this.col());for(let i=0;i<tokens.length;++i)if(tok=tokens[i],touches(tok,point)&&/^(?:str|sym|func)$/.test(tok.type))return{token:tok,nextToken:tokens[i+1]};return null}_sync(){this._editorToSync&&this.isActive()&&this._editorToSync.value(this.value())}_textContainer(){let computedStyles=function(element,properties){let computedStyle,styles={};return document.defaultView&&document.defaultView.getComputedStyle?(computedStyle=document.defaultView.getComputedStyle(element,""),properties&&properties.forEach((function(value){styles[value]=computedStyle.getPropertyValue(value)}))):(computedStyle=element.currentStyle,properties&&properties.forEach((function(value){styles[value]=computedStyle[function toCamelCase(str){return str.replace(/\-(\w)/g,(function(strMatch,g1){return g1.toUpperCase()}))}(value)]}))),function size(obj){let key,result=0;for(key in obj)obj.hasOwnProperty(key)&&"toJSON"!==key&&result++;return result}(styles)||(styles=computedStyle),styles}(this.element,styles);computedStyles.position="absolute",computedStyles.visibility="hidden",computedStyles.whiteSpace="pre",computedStyles.top=-3333,computedStyles.left=-3333,this._span=document.createElement("span"),this._span.style.whiteSpace="pre";for(const style in computedStyles)Object.hasOwnProperty.call(computedStyles,style)&&(this._span.style[style]=computedStyles[style]);insertAfter(this._span,this.element)}_tooltip(){this._cellTooltip=document.createElement("div"),this._cellTooltip.className="k-widget k-tooltip",this._cellTooltip.style.position="absolute",this._cellTooltip.style.display="none",this._cellTooltip.appendChild(document.createTextNode("A1")),insertAfter(this._cellTooltip,this.element)}tooltip(value){for(;this._cellTooltip.firstChild;)this._cellTooltip.removeChild(this._cellTooltip.firstChild);this._cellTooltip.appendChild(document.createTextNode(value))}toggleTooltip(show){this._cellTooltip.style.display=show?"":"none"}isActive(){return this.element===function(){try{return document.activeElement}catch(e){return document.documentElement.activeElement}}()}filter(value){if(!value||value.length<this.options.minLength)return;const data=this.formulaSource.filter((item=>String(item.value).toLowerCase().startsWith(value.toLowerCase())));return this.list.data(data),data}hide(){this.enable(!1),this.element.style.display="none",this._cellTooltip.style.display="none"}show(){this.enable(!0),this.element.style.display="block"}row(){if(this.activeCell)return this.activeCell.row}col(){if(this.activeCell)return this.activeCell.col}position(rectangle){rectangle&&(this.show(),this.element.style.top=rectangle.top+1+"px",this.element.style.left=rectangle.left+1+"px",this._cellTooltip.style.top=rectangle.top-this._cellTooltip.offsetHeight-10+"px",this._cellTooltip.style.left=rectangle.left+"px")}resize(rectangle){rectangle&&(this.element.style.width=rectangle.width-1+"px",this.element.style.height=rectangle.height-1+"px")}canInsertRef(isKeyboardAction){return this._canInsertRef(isKeyboardAction)}_canInsertRef(isKeyboardAction){if(this.popup.visible())return null;let tokens,tok,i,strictMode=isKeyboardAction,point=this.getPos();if(point&&this._isFormula()){if(0===point.begin)return null;for(tokens=calc.tokenize(this.value(),this.row(),this.col()),i=0;i<tokens.length;++i){if(tok=tokens[i],touches(tok,point))return canReplace(tok);if(afterPoint(tok))return canInsertBetween(tokens[i-1],tok)}return canInsertBetween(tok,null)}return null;function afterPoint(tok){return tok.begin>point.begin}function canReplace(tok){if(tok){if(/^(?:num|str|bool|sym|ref)$/.test(tok.type))return{replace:!0,token:tok,end:tok.end};if(/^(?:op|punc|startexp)$/.test(tok.type))return tok.end===point.end?canInsertBetween(tok,tokens[i+1]):canInsertBetween(tokens[i-1],tok)}}function canInsertBetween(left,right){if(null==left)return null;if(null==right)return/^(?:op|startexp)$/.test(left.type)||isOpenParen(left.value)?{token:left,end:point.end}:null;if(strictMode){if("op"===left.type&&/^(?:punc|op)$/.test(right.type))return{token:left,end:point.end}}else{if("startexp"===left.type)return{token:left,end:point.end};if(/^(?:op|punc)$/.test(left.type)&&/^[,;({]$/.test(left.value))return{token:left,end:point.end};if(/^(?:ref|sym)/.test(left.type))return{token:left,replace:!0,end:left.end};if(/^(?:ref|sym)/.test(right.type))return{token:right,replace:!0,end:right.end}}return!1}}refAtPoint(sheet){let x=this._canInsertRef();if(x){let ref=sheet.selection()._ref.simplify().clone().relative(0,0,3);sheet.isMerged(ref)&&(ref=ref.topLeft),sheet!==this.activeSheet&&(ref=ref.setSheet(sheet.name(),!0)),this._replaceAt(x,ref.print(0,0))}}_replaceAt(ctx,newValue){let value=this.value(),tok=ctx.token,rest=value.substr(ctx.end);value=value.substr(0,ctx.replace?tok.begin:ctx.end)+newValue;let point=value.length;value+=rest,this._value(value),this.setPos(point),this.scale(),this._syntaxHighlight()}syncWith(formulaInput){this._editorToSync=formulaInput,this.element&&(this.element.removeEventListener("input",this._sync),this.element.addEventListener("input",this._sync))}scale(){let width,height,element=this.element;this._span||this._textContainer(),this._span.innerHTML=element.innerHTML,width=this._span.offsetWidth+this.options.scalePadding,height=this._span.offsetHeight,width>element.offsetWidth&&(element.style.width=width+"px");height-1>element.offsetHeight&&(element.style.height=height-1+"px"),this._sync()}_value(value){if((this.element.innerText||this.element.textContent).replace(/\n$/,"")!==value){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(document.createTextNode(value))}}value(value){let txt=(this.element.innerText||this.element.textContent).replace(/\n$/,"");if(void 0===value)return txt;txt!==value&&(this._value(value),this._syntaxHighlight())}highlightedRefs(){return this._highlightedRefs.slice()}_syntaxHighlight(){let pos=this.getPos(),value=this.value(),refClasses=Pane.classNames.series,highlightedRefs=[],refIndex=0,parens=[],tokens=[];pos&&!pos.collapsed||(/^=/.test(value)?(tokens=calc.tokenize(value,this.row(),this.col()),tokens.forEach((function(tok){if(tok.active=!1,tok.cls=["k-syntax-"+tok.type],"ref"===tok.type&&(tok.colorClass=refClasses[refIndex++%refClasses.length],tok.cls.push(tok.colorClass),highlightedRefs.push(tok)),pos&&"punc"===tok.type)if(isOpenParen(tok.value))parens.unshift(tok);else if(function isCloseParen(ch){return")"===ch||"]"===ch||"}"===ch}(tok.value)){let open=parens.shift();open?!function isMatchingParen(close,open){return"("===open?")"===close:"["===open?"]"===close:"{"===open&&"}"===close}(tok.value,open.value)?(tok.cls.push("k-syntax-error"),open.cls.push("k-syntax-error")):(touches(tok,pos)||touches(open,pos))&&(tok.cls.push("k-syntax-paren-match"),open.cls.push("k-syntax-paren-match")):tok.cls.push("k-syntax-error")}pos&&touches(tok,pos)&&(tok.cls.push("k-syntax-at-point"),tok.active=!0),"func"!==tok.type||function knownFunction(name){return calc.runtime.FUNCS[name.toLowerCase()]}(tok.value)||pos&&touches(tok,pos)||tok.cls.push("k-syntax-error")})),tokens.reverse().forEach((function(tok){let begin=tok.begin,end=tok.end,text=function(value){return String(value).replace(ampRegExp,"&amp;").replace(ltRegExp,"&lt;").replace(gtRegExp,"&gt;").replace(quoteRegExp,"&quot;").replace(aposRegExp,"&#39;")}(value.substring(begin,end));value=value.substr(0,begin)+"<span class='"+tok.cls.join(" ")+"'>"+text+"</span>"+value.substr(end)})),this.element.innerHTML=value,pos&&this.setPos(pos.begin,pos.end),this._highlightedRefs=highlightedRefs):this._highlightedRefs.length&&(this._highlightedRefs=[],this._value(value)))}destroy(){this._editorToSync=null,this.element.removeEventListener("input",this.scale),this.element.removeEventListener("keydown",this._keydown),this.element.removeEventListener("keyup",this._keyup),this.element.removeEventListener("blur",this._blur),this.element.removeEventListener("input",this._input),this.element.removeEventListener("click",this._input),this.element.removeEventListener("focus",this._focus),this.element.removeEventListener("paste",this._paste),clearTimeout(this._focusTimeout),clearTimeout(this._keyDownTimeout),this._cellTooltip=null,this._span=null,super.destroy()}insertNewline(){let val=this.value(),pos=this.getPos(),eof=pos.end===val.length;val=val.substr(0,pos.begin)+(eof?"\n\n":"\n"+val.substr(pos.end)),this.value(val),this.setPos(pos.begin+1)}}function isOpenParen(ch){return"("===ch||"["===ch||"{"===ch}function touches(pos,target){return pos.begin<=target.begin&&pos.end>=target.end}index_esm_FormulaInput.classNames={wrapper:"k-spreadsheet-formula-input",listWrapper:"k-spreadsheet-formula-list"};class FormulaBar extends Widget{constructor(element,options){super(element,options);const formulaInputDiv=element&&element.querySelector(".k-spreadsheet-formula-input:not(.k-spreadsheet-cell-editor)");this.formulaInput=new index_esm_FormulaInput(formulaInputDiv,this.options)}destroy(){this.formulaInput&&this.formulaInput.destroy(),this.formulaInput=null}}class NameEditor extends Widget{readData(){const data=[];return this._workbook.forEachName((function(def){!def.hidden&&def.value instanceof Ref&&data.push({name:def.name})})),data}value(val){if(this.options.combobox.current)return this.options.combobox.current.value(val)}}class index_esm_SheetsBar extends Widget{constructor(element,options){super(element,Object.assign({},{name:"SheetsBar"},options)),this.events=["select","reorder","rename"]}onSheetReorderEnd(e){this.trigger("reorder",{oldIndex:e.oldIndex,newIndex:e.newIndex})}onSheetRemove(removedSheetName){this.trigger("remove",{name:removedSheetName,confirmation:!0})}onSheetSelect(selectedSheetText){this.trigger("select",{name:selectedSheetText,isAddButton:!1})}onSheetRename(newSheetName,sheetIndex){this.trigger("rename",{name:newSheetName,sheetIndex})}onAddSelect(){this.trigger("select",{isAddButton:!0})}destroy(){super.destroy()}}class HtmlTable{constructor(){this.cols=[],this.trs=[],this._height=0,this._width=0}addColumn(width){this._width+=width;let col=dom.element("col",{style:{width:width+"px"}});col.visible=width>0,this.cols.push(col)}addRow(height){let attr=null;attr={style:{height:height+"px"}},this._height+=height;let tr=dom.element("tr",attr);tr.visible=height>0,this.trs.push(tr)}addCell(rowIndex,text,style,className,validation){null==text&&(text=""),text instanceof dom.Node||(text=dom.text(text));let children=[text],properties={style};validation&&!validation.value&&(children.push(dom.element("span",{className:"k-dirty"})),className=(className||"")+(className?" ":"")+"k-dirty-cell",properties.title=validation.message),className&&(properties.className=className);let td=dom.element("td",properties,children);return this.trs[rowIndex].children.push(td),td}toDomTree(x,y,className){this.trs=this.trs.filter((function(tr){return tr.visible}));let offset=0;return this.cols=this.cols.filter((function(col,ci){return col.visible||(this.trs.forEach((function(tr){tr.children.splice(ci-offset,1)})),offset++),col.visible}),this),dom.element("table",{style:{left:x+"px",top:y+"px",height:this._height+"px",width:this._width+"px"},className,role:"presentation"},[dom.element("colgroup",null,this.cols),dom.element("tbody",null,this.trs)])}}function within(value,min,max){return value>=min&&value<=max}class View extends Observable{constructor(element,options){super();let classNames=View.classNames;this.element=element,this.options=deepExtend({},{messages:index_esm_messages.view},this.options,options),this.events=["update","message"],this._chrome(),this._dialogs=[],this._formulaInput(),this.wrapper=element.querySelector("."+classNames.view),this.container=element.querySelector("."+classNames.fixedContainer),this.scroller=element.querySelector("."+classNames.scroller),this.clipboard=element.querySelector("."+classNames.clipboard),this.viewSize=this.scroller&&this.scroller.firstChild,this.tree=new dom.Tree(this.container),this.clipboardContents=new dom.Tree(this.clipboard),this.editor=new SheetEditor(this),this._sheetsbar()}enableClipboard(enable){this.isClipboardDeactivated=!enable,enable?this.clipboard.setAttribute("contenteditable",enable):this.clipboard.removeAttribute("contenteditable")}_resize(){}_chrome(){let nameEditor=this.element.querySelector(".k-spreadsheet-name-editor");this.nameEditor=new NameEditor(nameEditor,{combobox:this.options.nameBoxRef});let formulaBar=this.element.querySelector(".k-spreadsheet-formula-bar");this.formulaBar=new FormulaBar(formulaBar,{input:this.options.formulaBarInputRef})}_formulaInput(){let editor=this.element.querySelector("."+View.classNames.cellEditor);this.formulaInput=new index_esm_FormulaInput(editor,{autoScale:!0,input:this.options.formulaCellInputRef})}_sheetsbar(){this.options.sheetsbar&&(this.sheetsbar=new index_esm_SheetsBar(this.element.querySelector("."+View.classNames.sheetsBar),this.options.sheetsbar))}_tabstrip(){}_executeCommand(e){this._sheet.trigger("commandRequest",e)}workbook(workbook){this._workbook=workbook,workbook._view=this,this.nameEditor._workbook=workbook}sheet(sheet){this._sheet=sheet}activeCellRectangle(){return this.cellRectangle(this._sheet._viewActiveCell())}_rectangle(pane,ref){return pane._grid.boundingRectangle(ref.toRangeRef())}isColumnResizer(x,pane,col){return x-=this._sheet._grid._headerWidth,pane._grid.columns.frozen||(x+=this.scroller.scrollLeft),null===(col=this._sheet._grid._columns.locate(0,col,(function(w){return Math.abs(x-w)<=3.5})))||this._sheet.isHiddenColumn(col)?null:col}isRowResizer(y,pane,row){return y-=this._sheet._grid._headerHeight,pane._grid.rows.frozen||(y+=this.scroller.scrollTop),null===(row=this._sheet._grid._rows.locate(0,row,(function(h){return Math.abs(y-h)<=3.5})))||this._sheet.isHiddenRow(row)?null:row}isFilterIcon(x,y,pane,ref){let self=this,theGrid=pane._grid,scrollTop=theGrid.rows.frozen?0:self.scroller.scrollTop,scrollLeft=theGrid.columns.frozen?0:self.scroller.scrollLeft;return x-=self._sheet._grid._headerWidth-scrollLeft,y-=self._sheet._grid._headerHeight-scrollTop,withExit((function(exit){self._sheet.forEachFilterHeader(ref,(function(ref){let rect=self._rectangle(pane,ref);pane.filterIconRect(rect).intersects(x,y)&&exit(!0)}))}))}isAutoFill(x,y,pane){let selection=this._sheet.select();if(selection.size>1)return!1;x-=this._sheet._grid._headerWidth,y-=this._sheet._grid._headerHeight,pane._grid.columns.frozen||(x+=this.scroller.scrollLeft),pane._grid.rows.frozen||(y+=this.scroller.scrollTop);let rectangle=this._rectangle(pane,selection);return Math.abs(rectangle.right-x)<8&&Math.abs(rectangle.bottom-y)<8}isEditButton(x,y,pane){if(this._sheet.activeCellCustomEditor()){let r=this.activeCellRectangle();if(y>=r.top&&y<=r.bottom)return pane._editorInLastColumn?x<r.left&&x>=r.left-20:x>r.right&&x<=r.right+20}}drawingAt(x,y,pane){x-=this._sheet._grid._headerWidth,y-=this._sheet._grid._headerHeight,pane._grid.columns.frozen||(x+=this.scroller.scrollLeft),pane._grid.rows.frozen||(y+=this.scroller.scrollTop);let sheet=this._sheet,drawings=this._sheet._drawings;for(let i=drawings.length;--i>=0;){let d=drawings[i],box=sheet.drawingBoundingBox(d);if(box.intersects(x,y))return{drawing:d,drx:box.left-x,dry:box.top-y}}}objectAt(x,y,noDrawing){let object,pane,grid=this._sheet._grid;if(x<0||y<0||x>this.scroller.clientWidth||y>this.scroller.clientHeight)object={type:"outside"};else if(x<grid._headerWidth&&y<grid._headerHeight)object={type:"topcorner"};else if(pane=this.paneAt(x,y),pane){if(!noDrawing){let drawing=this.drawingAt(x,y,pane);if(drawing)return{type:"drawing",drawing:drawing.drawing,drx:drawing.drx,dry:drawing.dry,pane,startX:x,startY:y}}let row=pane._grid.rows.indexVisible(y,this.scroller.scrollTop),column=pane._grid.columns.indexVisible(x,this.scroller.scrollLeft),type="cell",ref=new CellRef(row,column),selecting=this._sheet.selectionInProgress();this.isAutoFill(x,y,pane)?type="autofill":this.isFilterIcon(x,y,pane,ref)?type="filtericon":!selecting&&x<grid._headerWidth?(type="rowheader",null!==(row=this.isRowResizer(y,pane,row))&&(ref=new CellRef(row,-1/0),type="rowresizehandle")):!selecting&&y<grid._headerHeight?(type="columnheader",null!==(column=this.isColumnResizer(x,pane,column))&&(ref=new CellRef(-1/0,column),type="columnresizehandle")):this.isEditButton(x,y,pane)&&(type="editor"),object={type,ref}}else object={type:"outside"};return object.pane=pane,object.x=x,object.y=y,object}paneAt(x,y){return this.panes.filter((function paneLocationWithin(pane){let grid=pane._grid;return within(y,grid.top,grid.bottom)&&within(x,grid.left,grid.right)}))[0]}containingPane(cell){return this.panes.filter((function(pane){return!!pane._grid.contains(cell)}))[0]}cellRectangle(cell){let theGrid=this.containingPane(cell)._grid;return this._sheet._grid.rectangle(cell).offset(theGrid.headerWidth-(theGrid.columns.frozen?0:this.scroller.scrollLeft),theGrid.headerHeight-(theGrid.rows.frozen?0:this.scroller.scrollTop))}refresh(reason){let sheet=this._sheet;if(this.trigger("update",{reason,range:sheet.range(sheet.activeCell())}),this._resize(),this.viewSize.style.height=sheet._grid.totalHeight()+"px",this.viewSize.style.width=sheet._grid.totalWidth()+"px",reason.layout){let frozenColumns=sheet.frozenColumns(),frozenRows=sheet.frozenRows();this.panes=[this._pane(frozenRows,frozenColumns)],frozenColumns>0&&this.panes.push(this._pane(frozenRows,0,null,frozenColumns)),frozenRows>0&&this.panes.push(this._pane(0,frozenColumns,frozenRows,null)),frozenRows>0&&frozenColumns>0&&this.panes.push(this._pane(0,0,frozenRows,frozenColumns))}reason.filter&&this._destroyFilterMenu(),reason.activeCell&&(this._focus=sheet.activeCell().toRangeRef())}createFilterMenu(){}selectClipboardContents(){this.isClipboardDeactivated||(this.clipboard.focus({preventScroll:!0}),function selectElementContents(el){let sel=window.getSelection();sel.removeAllRanges();let range=document.createRange();range.selectNodeContents(el),sel.addRange(range)}(this.clipboard))}scrollIntoView(cell){let willScroll=!1,theGrid=this.containingPane(cell)._grid,boundaries=theGrid.scrollBoundaries(cell),scroller=this.scroller,scrollTop=theGrid.rows.frozen?0:scroller.scrollTop,scrollLeft=theGrid.columns.frozen?0:scroller.scrollLeft;return boundaries.top<scrollTop&&(willScroll=!0,scroller.scrollTop=boundaries.scrollTop),boundaries.bottom>scrollTop&&(willScroll=!0,scroller.scrollTop=boundaries.scrollBottom),boundaries.left<scrollLeft&&(willScroll=!0,scroller.scrollLeft=boundaries.scrollLeft),boundaries.right>scrollLeft&&(willScroll=!0,scroller.scrollLeft=boundaries.scrollRight),willScroll}_destroyDialog(){this._dialogs.pop()}openCustomEditor(){let self=this,cell=self._sheet.activeCell().first(),editor=self._sheet.activeCellCustomEditor(),range=self._sheet.range(cell);editor.edit({range,rect:self.activeCellRectangle(),view:this,validation:this._sheet.validation(cell),callback:function(value,parse){self._executeCommand({command:"EditCommand",options:{operatingRange:range,editRange:range,property:parse?"input":"value",value}})}})}openDialog(name,options){let sheet=this._sheet;return sheet.withCultureDecimals(function(){let ref=sheet.activeCell(),range=new Range$1(ref,sheet);this.trigger("message",{...options,name,ref,range})}.bind(this))}showError(options,reopenEditor){let currentDialogs=this._dialogs,errorMessages=this.options.messages.errors;if(currentDialogs.length>0)return;let onClose=function(){currentDialogs.pop(),this.selectClipboardContents(),reopenEditor&&reopenEditor()}.bind(this);const dialogOptions={title:options.title||"Error",text:options.body?options.body:errorMessages[options.type],close:onClose};currentDialogs.push(dialogOptions),this.openDialog(options.type||"message",dialogOptions)}destroy(){this.unbind(),[this.tree,this.clipboardContents].forEach((el=>{for(;el&&el.root&&el.root.lastChild;)el.root.removeChild(el.root.lastChild)})),this.tree=this.clipboardContents=null}_destroyFilterMenu(){this._filterMenu&&(this._filterMenu.destroy(),this._filterMenu=void 0,this._filterMenuColumn=void 0)}render(reason){let sheet=this._sheet,focus=sheet.focus(),scrollbarSize=scrollbar(),contentWidth=this.wrapper.clientWidth-scrollbarSize,contentHeight=this.wrapper.clientHeight-scrollbarSize;if(focus&&this.scrollIntoView(focus))return;let resizeDirection=sheet.resizingInProgress()?sheet.resizeHandlePosition().col===-1/0?"column":"row":"none";this.wrapper.classList.toggle(viewClassNames.editContainer,this.editor.isActive()),this.wrapper.classList.toggle(viewClassNames.horizontalResize,"row"===resizeDirection),this.wrapper.classList.toggle(viewClassNames.verticalResize,"column"===resizeDirection);let grid=sheet._grid,content=[],args={scroller:this.scroller,toplevelElements:content,contentWidth,contentHeight};this.panes.forEach((function(pane){content.push(pane.render(args))}));let topCorner=dom.element("div",{style:{width:grid._headerWidth+"px",height:grid._headerHeight+"px"},className:View.classNames.topCorner});content.push(topCorner),sheet.resizeHandlePosition()&&sheet.resizeHintPosition()&&content.push(this.renderResizeHint()),this.tree.render(content),this.container.style.width=contentWidth+"px",this.container.style.height=contentHeight+"px",this.editor.isActive()?this.editor.toggleTooltip(this.activeCellRectangle()):reason.resize||reason.comment||sheet.selectionInProgress()||sheet.resizingInProgress()||sheet.draggingInProgress()||sheet.isInEditMode()||this.renderClipboardContents()}renderResizeHint(){let style,sheet=this._sheet,horizontal=sheet.resizeHandlePosition().col!==-1/0;style=horizontal?{height:this.scroller.clientHeight+"px",width:"7px",left:sheet.resizeHintPosition().x+"px",top:"0px"}:{height:"7px",width:this.scroller.clientWidth+"px",top:sheet.resizeHintPosition().y+"px",left:"0px"};let classNames=Pane.classNames;return dom.element("div",{className:classNames.resizeHint+(horizontal?"":" "+classNames.resizeHintVertical),style},[dom.element("div",{className:classNames.resizeHintHandle}),dom.element("div",{className:classNames.resizeHintMarker})])}renderClipboardContents(){let sheet=this._sheet,grid=sheet._grid,selection=grid.normalize(sheet.select().toRangeRef()),status=this._workbook.clipboard().canCopy();if(!1===status.canCopy&&status.multiSelection)return this.clipboardContents.render([]),void this.selectClipboardContents();selection=sheet.trim(selection);let table=new HtmlTable,selectionView=grid.rangeDimensions(selection);selectionView.rows.forEach((function(height){table.addRow(height)})),selectionView.columns.forEach((function(width){table.addColumn(width)}));let tmp=sheet._getMergedCells(selection),primaryMergedCells=tmp.primary,secondaryMergedCells=tmp.secondary;sheet.forEach(selection,(function(row,col,cell){let location=new CellRef(row,col).print();if(!secondaryMergedCells[location]){let td=function addCell(table,row,cell){let style={};cell.background&&(style.backgroundColor=cell.background),cell.color&&(style.color=cell.color),cell.fontFamily&&(style.fontFamily=cell.fontFamily),cell.underline&&(style.textDecoration="underline"),cell.italic&&(style.fontStyle="italic"),cell.textAlign&&(style.textAlign=cell.textAlign),cell.verticalAlign&&(style.verticalAlign="center"===cell.verticalAlign?"middle":cell.verticalAlign),cell.bold&&(style.fontWeight="bold"),cell.fontSize&&(style.fontSize=cell.fontSize+"px"),!0===cell.wrap&&(style.whiteSpace="pre-wrap"),cell.borderRight?style.borderRight=cellBorder(cell.borderRight):cell.background&&(style.borderRightColor=cell.background),cell.borderBottom?style.borderBottom=cellBorder(cell.borderBottom):cell.background&&(style.borderBottomColor=cell.background);let data=cell.value,type=typeof data,format=cell.format;if(format||"number"!==type||data===Math.floor(data)||(format="0.##############"),format&&null!=data&&(data=formatting.format(data,format),data.__dataType&&(type=data.__dataType)),!style.textAlign)switch(type){case"number":case"date":case"percent":case"currency":style.textAlign="right";break;case"boolean":style.textAlign="center"}let className=null;!1===cell.enable&&(className="k-disabled");let border,sibling,td=table.addCell(row,data,style,className,cell.validation);return cell.borderLeft?(sibling=function cellBefore(table,row){let cells=table.trs[row].children;return cells[cells.length-2]}(table,row),border=cellBorder(cell.borderLeft),sibling&&border&&(sibling.attr.style.borderRight=border)):cell.background&&(style.borderLeftColor=cell.background),cell.borderTop?(sibling=function cellAbove(table,row){let prevRow=table.trs[row-1],index=table.trs[row].children.length-1;if(prevRow&&index>=0)return prevRow.children[index]}(table,row),border=cellBorder(cell.borderTop),sibling&&border&&(sibling.attr.style.borderBottom=border)):cell.background&&(style.borderTopColor=cell.background),td}(table,row-selection.topLeft.row,cell),mergedCell=primaryMergedCells[location];mergedCell&&(td.attr.colspan=mergedCell.width(),td.attr.rowspan=mergedCell.height())}})),this.clipboardContents.render([table.toDomTree(0,0,"kendo-clipboard-"+this._workbook.clipboard()._uid)]),this.selectClipboardContents()}_pane(row,column,rowCount,columnCount){let pane=new Pane(this._sheet,this._sheet._grid.pane({row,column,rowCount,columnCount}));return pane.refresh(this.scroller.clientWidth,this.scroller.clientHeight),pane}}View.classNames=viewClassNames;class Clipboard{constructor(workbook){this._content={},this._externalContent={},this._internalContent={},this.workbook=workbook,this.origin=NULLREF,this.iframe=document.createElement("iframe"),this.iframe.className="k-spreadsheet-clipboard-paste",this.iframe.setAttribute("title","Spreadsheet clipboard iframe"),this.menuInvoked=!1,this._uid=function index_esm_guid(){let i,random,id="";for(id+="abcdef"[Math.floor(Math.random()*Math.floor(6))],i=1;i<32;i++)random=16*Math.random()|0,8!==i&&12!==i&&16!==i&&20!==i||(id+="-"),id+=(12===i?4:16===i?3&random|8:random).toString(16);return id}(),document.body.appendChild(this.iframe)}destroy(){this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe)}canCopy(){let status={canCopy:!0},selection=this.workbook.activeSheet().select();return selection===NULLREF&&(status.canCopy=!1),selection instanceof UnionRef&&(status.canCopy=!1,status.multiSelection=!0),this.menuInvoked&&(status.canCopy=!1,status.menuInvoked=!0),status}canPaste(){let sheet=this.workbook.activeSheet(),ref=this.pasteRef(),status={canPaste:!0,pasteOnMerged:!1,pasteOnDisabled:!1};return sheet.range(ref).enable()||(status.canPaste=!1,status.pasteOnDisabled=!0),ref.eq(sheet.unionWithMerged(ref))||(status.canPaste=!1,status.pasteOnMerged=!0),this.menuInvoked&&(status.canPaste=!1,status.menuInvoked=!0),status}intersectsMerged(){let sheet=this.workbook.activeSheet();this.parse(),this.origin=this._content.origRef;let ref=this.pasteRef();return!ref.eq(sheet.unionWithMerged(ref))}copy(){let sheet=this.workbook.activeSheet();this.origin=sheet.select(),this._internalContent=sheet.selection().getState(),delete this._externalContent.html,delete this._externalContent.plain}cut(){let sheet=this.workbook.activeSheet();this.copy(),sheet.range(sheet.select()).clear()}pasteRef(){let sheet=this.workbook.activeSheet();if(this.origin===NULLREF)return sheet.select();let destination=sheet.activeCell().first(),originActiveCell=this.origin.first(),rowDelta=originActiveCell.row-destination.row,colDelta=originActiveCell.col-destination.col;return this.origin.relative(rowDelta,colDelta,3)}paste(){let sheet=this.workbook.activeSheet(),pasteRef=this.pasteRef();(pasteRef.bottomRight.row>=sheet._rows._count||pasteRef.bottomRight.col>=sheet._columns._count)&&sheet.resize(Math.max(pasteRef.bottomRight.row+1,sheet._rows._count),Math.max(pasteRef.bottomRight.col+1,sheet._columns._count)),sheet.range(pasteRef).setState(this._content,this),sheet.triggerChange({recalc:!0,ref:pasteRef})}external(data){if(!data||!data.html&&!data.plain)return this._externalContent;this._externalContent=data}isExternal(){return!this._isInternal()}parse(){let state;if(this._isInternal())state=this._internalContent;else{let data=this._externalContent;if(state=data.plain?function parseTSV(data){let state=newState();if(-1===data.indexOf("\t")&&-1===data.indexOf("\n"))setStateData(state,0,0,{value:data});else{let rows=data.split("\n");for(let ri=0;ri<rows.length;ri++){let cols=rows[ri].split("\t");for(let ci=0;ci<cols.length;ci++)setStateData(state,ri,ci,{value:cols[ci]})}}return state}(data.plain):newState(),data.html){let doc=this.iframe.contentWindow.document;doc.open(),doc.write(data.html),doc.close();let table=doc.querySelector("table");if(table){let richState=function parseHTML(table){let state=newState(),done=[],row=0,col=0;for(let i=0;i<table.rows.length;++i)done.push([]);let hBorders=new calc.runtime.Matrix,vBorders=new calc.runtime.Matrix;for(let ri=0;ri<table.rows.length;++ri,++row){let tr=table.rows[ri];col=0;for(let ci=0;ci<tr.cells.length;++ci){let td=tr.cells[ci],rowSpan=td.rowSpan,colSpan=td.colSpan;for(;done[row][col];)col++;let style=td.getAttribute("style"),ignoreColspan=/mso-ignore:colspan/.test(style);setStateData(state,row,col,cellState(row,col,td,hBorders,vBorders)),(rowSpan>1||colSpan>1&&!ignoreColspan)&&state.mergedCells.push(new RangeRef(new CellRef(row,col),new CellRef(row+rowSpan-1,col+colSpan-1)).toString());for(let dr=row+rowSpan;--dr>=row;)for(let dc=col+colSpan;--dc>=col;)dr<done.length&&(done[dr][dc]=!0,dr===row&&dc===col||setStateData(state,dr,dc,{}))}}return state}(table);richState.data.forEach((function(rowData,rowIndex){rowData.forEach((function(colData,colIndex){/^\s*#+\s*$/.test(colData.value)&&(colData.value=state.data[rowIndex][colIndex].value)}))})),state=richState}}this.origin=state.origRef}this._content=state}_isInternal(){if(void 0===this._externalContent.html)return!0;let internalHTML=Boolean(createFragment(this._externalContent.html).querySelector("table.kendo-clipboard-"+this._uid)),internalPlain=Boolean(createFragment(this._externalContent.plain).querySelector("table.kendo-clipboard-"+this._uid));return internalHTML||internalPlain}}function newState(){let ref=new CellRef(0,0,0);return{ref,mergedCells:[],data:[],foreign:!0,origRef:ref.toRangeRef()}}function setStateData(state,row,col,value){let data=state.data||(state.data=[]);data[row]||(data[row]=[]),data[row][col]=value;let br=state.origRef.bottomRight;br.row=Math.max(br.row,row),br.col=Math.max(br.col,col)}function stripStyle(style){return style.replace(/^-(?:ms|moz|webkit)-/,"")}function cellState(row,col,element,hBorders,vBorders){let styles=window.getComputedStyle(element),text=(element.innerText||element.textContent).replace(/\t$/,""),borders=function borderObject(styles){let obj={};return["borderBottom","borderRight","borderLeft","borderTop"].forEach((function(key){obj[key]="none"===styles[key+"Style"]?null:{size:1,color:styles[key+"Color"]}})),obj}(styles),state={value:""===text?null:text,borderTop:borders.borderTop||hBorders.get(row,col)||null,borderBottom:borders.borderBottom||hBorders.get(row+1,col)||null,borderLeft:borders.borderLeft||vBorders.get(row,col)||null,borderRight:borders.borderRight||vBorders.get(row,col+1)||null,fontSize:parseInt(styles["font-size"],10)};return hBorders.set(row,col,state.borderTop),hBorders.set(row+1,col,state.borderBottom),vBorders.set(row,col,state.borderLeft),vBorders.set(row,col+1,state.borderRight),"rgb(0, 0, 0)"!==styles["background-color"]&&"rgba(0, 0, 0, 0)"!==styles["background-color"]&&(state.background=styles["background-color"]),"rgb(0, 0, 0)"!==styles.color&&"rgba(0, 0, 0, 0)"!==styles.color&&(state.color=styles.color),"underline"===styles["text-decoration"]&&(state.underline=!0),"italic"===styles["font-style"]&&(state.italic=!0),"bold"===styles["font-weight"]&&(state.bold=!0),"right"!==stripStyle(styles["text-align"])&&(state.textAlign=stripStyle(styles["text-align"])),"middle"!==styles["vertical-align"]&&(state.verticalAlign=styles["vertical-align"]),"normal"!==styles["word-wrap"]&&(state.wrap=!0),state}let COMMAND_TYPES_AUTO_FILL="autoFill",COMMAND_TYPES_CLEAR="clear",COMMAND_TYPES_CUT="cut",COMMAND_TYPES_EDIT="edit",COMMAND_TYPES_PASTE="paste",COMMAND_TYPES_VALIDATION="validation";const noop=()=>{};class Command{constructor(options){this.options=options,this._workbook=options.workbook,this._property=options&&options.property,this._state={}}range(range){return void 0!==range&&this._setRange(range),this._range}_setRange(range){this._range=range}redo(){this.range().select(),this.exec()}undo(){this.setState(this._state)}getState(){this._state=this.range().getState(this._property)}setState(state){this.range().setState(state)}rejectState(validationState){return this.undo(),{title:validationState.title,body:validationState.message,reason:"error",type:"validationError"}}_forEachCell(callback){let range=this.range();range._ref.forEach(function(ref){range.sheet().forEach(ref.toRangeRef(),callback.bind(this))}.bind(this))}usesImage(){return!1}}class DrawingCommand extends Command{constructor(options){super(options),this._drawing=options.drawing}usesImage(img){return this._drawing.image===img}}class ReorderDrawingsCommand extends DrawingCommand{exec(){let sheet=this.range().sheet();this._origIndex=sheet._drawings.indexOf(this._drawing),sheet._drawings.splice(this._origIndex,1),this._newIndex=this._reorder(),sheet._drawings.splice(this._newIndex,0,this._drawing),sheet.triggerChange({drawings:!0})}undo(){let sheet=this.range().sheet();sheet._drawings.splice(this._newIndex,1),sheet._drawings.splice(this._origIndex,0,this._drawing),sheet.triggerChange({drawings:!0})}}class TargetValueCommand extends Command{constructor(options){super(options),this._target=options.target,this._value=options.value}exec(){this.getState(),this.setState(this._value)}}class PropertyChangeCommand extends Command{_setRange(range){Command.prototype._setRange.call(this,range.skipHiddenCells())}constructor(options){super(options),this._value=options.value}exec(){let range=this.range();range.enable()&&(this.getState(),"format"===this.options.property&&this._workbook.trigger("changeFormat",{range}),range[this._property](this._value))}}class CutCommand extends Command{constructor(options){super(options),this._eventType="cut",this._clipboard=options.workbook.clipboard(),this._event=options.event}exec(){let rangeValues,currentRow,status=this._clipboard.canCopy(),data=[];if(!status.canCopy)return status.menuInvoked?{reason:"error",type:"useKeyboard"}:status.multiSelection?{reason:"error",type:"unsupportedSelection"}:void 0;let range=this._workbook.activeSheet().selection();if("cut"===this._eventType){if(!range.enable())return this._event.preventDefault(),{reason:"error",type:"cannotModifyDisabled"};this.getState()}if(this._workbook.trigger(this._eventType,{range}))this._event.preventDefault();else if("cut"===this._eventType){if(rangeValues=range.values(),rangeValues.forEach((function(row){currentRow=[],row.forEach((function(){currentRow.push({})})),data.push(currentRow)})),range.sheet().trigger("changing",{data,range,changeType:COMMAND_TYPES_CUT}))return;this._clipboard.cut()}else this._clipboard.copy()}undo(){let range=this.range();range.sheet().trigger("changing",{data:this._state.data,range,changeType:COMMAND_TYPES_CUT})||this.setState(this._state)}}class ApplyFilterCommand extends Command{column(){return this.options.column||0}undo(){this.range().sheet().clearFilter(this.column()),this._state.length&&this.range().filter(this._state)}getState(){let current=this.range().sheet().filter();current&&(this._state=current.columns.filter(function(c){return c.index===this.column()}.bind(this)))}exec(){let options,filterRule,range=this.range(),column=this.column(),current=range.sheet().filter(),exists=!1;this.options.valueFilter?filterRule={column,filter:new ValueFilter(this.options.valueFilter)}:this.options.customFilter&&(filterRule={column,filter:new CustomFilter(this.options.customFilter)}),this.getState(),current&&current.ref.eq(range._ref)&&current.columns.length?(current.columns.forEach((function(element){element.index===column&&(exists=!0)})),options=current.columns.map((function(element){return element.index===column?filterRule:{column:element.index,filter:element.filter}})),exists||options.push(filterRule)):options=filterRule,range.filter(options)}}class HideLineCommand extends Command{constructor(options){super(options),this.axis=options.axis}undo(){this.range().sheet().setAxisState(this._state)}exec(){let sheet=this.range().sheet();this._state=sheet.getAxisState(),"row"===this.axis?sheet.axisManager().hideSelectedRows():sheet.axisManager().hideSelectedColumns()}}class DeleteCommand extends Command{exec(){this._expandedRange=this._expand(this.range()),this._state=this._expandedRange.getState(),this._indexes=this._exec(this._expandedRange.sheet())}undo(){let self=this,range=self._expandedRange,sheet=range.sheet();sheet.batch((function(){self._indexes.forEach((function(x){self._undoOne(sheet,x),sheet._restoreModifiedFormulas(x.formulas)})),range.setState(self._state)}),{layout:!0,recalc:!0,ref:range._ref,isValue:!0})}}class AddCommand extends Command{constructor(options){super(options),this._value=options.value}undo(){let self=this,sheet=self.range().sheet();sheet.batch((function(){for(let i=self._pos.count;--i>=0;)self._undoOne(sheet,self._pos.base)}),{layout:!0,recalc:!0})}}class NameCommand extends Command{constructor(options){super(options),this._name=options.name,this._value=options.value}getState(){this._state=this._workbook.nameDefinition(this._name)}setState(){this._workbook.nameDefinition(this._name,this._state),this._workbook.trigger("change",{recalc:!0})}}var commands=Object.freeze({__proto__:null,AddColumnCommand:class AddColumnCommand extends AddCommand{exec(){let value=this._value,sheet=this.range().sheet();this._pos="left"===value?sheet.axisManager().addColumnLeft():sheet.axisManager().addColumnRight()}_undoOne(sheet,index){sheet.deleteColumn(index)}},AddCommand,AddRowCommand:class AddRowCommand extends AddCommand{exec(){let value=this._value,sheet=this.range().sheet();this._pos="above"===value?sheet.axisManager().addRowAbove():sheet.axisManager().addRowBelow()}_undoOne(sheet,index){sheet.deleteRow(index)}},AdjustDecimalsCommand:class AdjustDecimalsCommand extends Command{constructor(options){options.property="format",super(options),this._delta=options.value}exec(){let sheet=this.range().sheet(),delta=this._delta;this.getState(),sheet.batch(function(){this.range().forEachCell((function(row,col,cell){let format=cell.format;if(!format){let value=cell.value;"number"==typeof value&&/\./.test(value)&&(format="0."+String(value).split(".")[1].replace(/\d/g,"0"))}(format||delta>0)&&(format=formatting.adjustDecimals(format||"0",delta),sheet.range(row,col).format(format))}))}.bind(this))}},AdjustRowHeightCommand:class AdjustRowHeightCommand extends Command{exec(){let options=this.options,sheet=this._workbook.activeSheet();(options.range||sheet.range(options.rowIndex))._adjustRowHeight()}},ApplyFilterCommand,AutoFillCommand:class AutoFillCommand extends Command{constructor(options){super(options)}origin(origin){this._origin=origin}exec(){let autoFillData,range=this.range();if(!range.enable())return{reason:"error",type:"rangeDisabled"};if(range.intersectingArrayFormula())return{reason:"error",type:"intersectsArray"};this.getState();try{if(autoFillData=range._previewFillFrom(this._origin),range.sheet().trigger("changing",{data:autoFillData.props,range:autoFillData.dest,changeType:COMMAND_TYPES_AUTO_FILL}))return;autoFillData.dest._properties(autoFillData.props,!0)}catch(ex){if(ex instanceof Range$1.FillError)return{reason:"error",type:ex.code};throw ex}}undo(){let range=this.range(),state=this._state;range.sheet().trigger("changing",{data:state.data,range,changeType:COMMAND_TYPES_AUTO_FILL})||this.setState(this._state)}},BorderChangeCommand:class BorderChangeCommand extends Command{constructor(options){options.property="border",super(options),this._type=options.border,this._style=options.style}_batch(f){return this.range().sheet().batch(f,{})}exec(){let self=this;self.getState(),self._batch((function(){self[self._type](self._style)}))}noBorders(){this.range().insideBorders(null),this.outsideBorders(null)}allBorders(style){this.range().insideBorders(style),this.outsideBorders(style)}leftBorder(style){this.range().leftColumn().borderLeft(style)}rightBorder(style){this.range().rightColumn().borderRight(style)}topBorder(style){this.range().topRow().borderTop(style)}bottomBorder(style){this.range().bottomRow().borderBottom(style)}outsideBorders(style){let range=this.range();range.leftColumn().borderLeft(style),range.topRow().borderTop(style),range.rightColumn().borderRight(style),range.bottomRow().borderBottom(style)}insideBorders(style){this.range().insideBorders(style),this.outsideBorders(null)}insideHorizontalBorders(style){this.range().insideHorizontalBorders(style)}insideVerticalBorders(style){this.range().insideVerticalBorders(style)}},BringToFrontCommand:class BringToFrontCommand extends ReorderDrawingsCommand{_reorder(){return this.range().sheet()._drawings.length}},ClearContentCommand:class ClearContentCommand extends Command{exec(){let range,rowValues,nullValues,validationState,currentRange,values=[];return this.range().enable()?this.range().canEditArrayFormula()?(this.getState(),range=this.range().skipHiddenCells(),range._ref.refs&&range._ref.refs.length>1?range._ref.refs.forEach((function(ref){currentRange=range.sheet().range(ref),values=values.concat(currentRange.values())})):values=range.values(),nullValues=[],values.forEach((function(row){rowValues=[],row.forEach((function(){rowValues.push(null)})),nullValues.push(rowValues)})),range.sheet().trigger("changing",{data:nullValues,range,changeType:COMMAND_TYPES_CLEAR})?void 0:(range.clearContent(),validationState=range._getValidationState(),validationState?this.rejectState(validationState):void 0)):{reason:"error",type:"intersectsArray"}:{reason:"error",type:"cannotModifyDisabled"}}undo(){let rowValues,range=this.range().skipHiddenCells(),sheet=range.sheet(),data=this._state.data,values=[];data.forEach((function(row){rowValues=[],row.forEach((function(cell){rowValues.push(cell.value)})),values.push(rowValues)})),sheet.trigger("changing",{data:values,range,changeType:COMMAND_TYPES_CLEAR})||this.setState(this._state)}},ClearFilterCommand:class ClearFilterCommand extends ApplyFilterCommand{exec(){let range=this.range(),column=this.column();this.getState(),range.clearFilter(column)}},ColumnWidthCommand:class ColumnWidthCommand extends TargetValueCommand{getState(){this._state=this.range().sheet().columnWidth(this._target)}setState(state){this.range().sheet().columnWidth(this._target,state)}},Command,CopyCommand:class CopyCommand extends CutCommand{constructor(options){super(options),this._eventType="copy",this.undo=noop}},CutCommand,DefineNameCommand:class DefineNameCommand extends NameCommand{exec(){this.getState();try{this._workbook.defineName(this._name,this._value),this._workbook.trigger("change",{recalc:!0})}catch(ex){return{title:"Error",body:ex+"",reason:"error"}}}},DeleteColumnCommand:class DeleteColumnCommand extends DeleteCommand{_expand(range){return range.resize({top:-1/0,bottom:1/0})}_exec(sheet){return sheet.axisManager().deleteSelectedColumns()}_undoOne(sheet,x){sheet.insertColumn(x.index),sheet.columnWidth(x.index,x.width)}},DeleteCommand,DeleteDrawingCommand:class DeleteDrawingCommand extends DrawingCommand{exec(){let sheet=this.range().sheet();sheet._activeDrawing=null,sheet.removeDrawing(this._drawing)}undo(){let sheet=this.range().sheet();sheet._activeDrawing=this._drawing,sheet.addDrawing(this._drawing)}redo(){this.exec()}},DeleteNameCommand:class DeleteNameCommand extends NameCommand{exec(){this.getState(),this._workbook.undefineName(this._name),this._workbook.trigger("change",{recalc:!0})}},DeleteRowCommand:class DeleteRowCommand extends DeleteCommand{_expand(range){return range.resize({left:-1/0,right:1/0})}_exec(sheet){return sheet.axisManager().deleteSelectedRows()}_undoOne(sheet,x){sheet.insertRow(x.index),sheet.rowHeight(x.index,x.height)}},DrawingCommand,DrawingUpdateCommand:class DrawingUpdateCommand extends Command{constructor(options){super(options),this._sheet=options.sheet,this._drawing=options.drawing,this._orig=this._drawing.clone(),this._previous=options.previous}exec(){}undo(){this._drawing.reset(this._previous),this._sheet._activeDrawing=this._drawing,this._sheet.triggerChange({layout:!0})}redo(){this._drawing.reset(this._orig),this._sheet._activeDrawing=this._drawing,this._sheet.triggerChange({layout:!0})}usesImage(img){return this._drawing.image===img||this._orig.image===img||this._previous.image===img}},EditCommand:class EditCommand extends PropertyChangeCommand{constructor(options){options.property=options.property||"input",super(options)}_setRange(range){PropertyChangeCommand.prototype._setRange.apply(this,arguments),this._editRange=this.options.arrayFormula?range:range.sheet().activeCellSelection()}getState(){this._state=this.range().getState()}exec(){return this.range().sheet().withCultureDecimals(this._exec.bind(this))}undo(){let editRange=this._editRange,state=this._state;editRange.sheet().trigger("changing",{data:state.data[0][0].value,range:editRange,changeType:COMMAND_TYPES_EDIT})||this.setState(this._state)}_exec(){let arrayFormula=this.options.arrayFormula,editRange=this._editRange;if(!editRange.enable())return{reason:"error",type:"rangeDisabled"};if(!editRange.canEditArrayFormula())return{reason:"error",type:"intersectsArray"};let value=this._value;if(this.getState(),!this.range().sheet().trigger("changing",{data:value,range:this._editRange,changeType:COMMAND_TYPES_EDIT}))if("value"!==this._property)try{editRange.link(null),""===value?editRange.value(null):(editRange.input(value,{arrayFormula}),/\n/.test(editRange.value())&&editRange.wrap(!0)),editRange._adjustRowHeight();let validationState=editRange._getValidationState();if(validationState)return this.rejectState(validationState)}catch(ex){if(ex instanceof calc.ParseError)return{title:"Error in formula",body:ex+"",reason:"error"};throw ex}else editRange.value(value)}},EditValidationCommand:class EditValidationCommand extends Command{constructor(options){super(options),this._value=options.value}exec(){let self=this,sheet=self.range().sheet();if(this.getState(),!sheet.trigger("changing",{data:self._value,range:self.range(),changeType:COMMAND_TYPES_VALIDATION}))try{sheet.withCultureDecimals((function(){self.range().validation(self._value)}))}catch(ex){if(ex instanceof calc.ParseError)return{title:"Error in formula",body:ex+"",reason:"error"};throw ex}}undo(){let editRange=this.range(),state=this._state;editRange.sheet().trigger("changing",{data:state.data[0][0].validation,range:editRange,changeType:COMMAND_TYPES_VALIDATION})||this.setState(this._state)}},FilterCommand:class FilterCommand extends Command{undo(){this.range().filter(this._state)}exec(){let range=this.range();this._state=range.hasFilter(),range.filter(!this._state)}},FreezePanesCommand:class FreezePanesCommand extends Command{constructor(options){super(options),this._type=options.value}exec(){this.getState(),this._topLeft=this.range().topLeft(),this[this._type]()}getState(){this._state=this.range().sheet().getState()}undo(){this.range().sheet().setState(this._state)}panes(){let topLeft=this._topLeft;this.range().sheet().frozenColumns(topLeft.col).frozenRows(topLeft.row)}rows(){let topLeft=this._topLeft;this.range().sheet().frozenRows(topLeft.row)}columns(){let topLeft=this._topLeft;this.range().sheet().frozenColumns(topLeft.col)}unfreeze(){this.range().sheet().frozenRows(0).frozenColumns(0)}},GridLinesChangeCommand:class GridLinesChangeCommand extends TargetValueCommand{getState(){this._state=this._range.sheet().showGridLines()}setState(v){this._range.sheet().showGridLines(v)}},HideLineCommand,HyperlinkCommand:class HyperlinkCommand extends Command{constructor(options){super(options),this._link=options.link}exec(){let range=this.range();this._prevLink=range.link(),this._prevUnderline=range.underline(),range.link(this._link),range.underline(!0),null==range.value()&&(this._hasSetValue=!0,range.value(this._link))}undo(){let range=this.range();range.link(this._prevLink),range.underline(this._prevUnderline),this._hasSetValue&&range.value(null)}},InsertCommentCommand:class InsertCommentCommand extends PropertyChangeCommand{constructor(options){options.property="comment",super(options)}},InsertImageCommand:class InsertImageCommand extends DrawingCommand{constructor(options){super(options),this._blob=options.blob,this._width=options.width,this._height=options.height}exec(){let range=this.range(),sheet=range.sheet(),width=this._width,height=this._height,aspect=width/height;width>height?(width=Math.min(width,300),height=width/aspect):(height=Math.min(height,300),width=height*aspect),this._drawing=sheet.addDrawing({topLeftCell:range.topLeft(),offsetX:5,offsetY:5,width,height,opacity:1,image:this._workbook.addImage(this._blob)},!0),this._blob=null}undo(){let sheet=this.range().sheet();sheet._activeDrawing=null,sheet.removeDrawing(this._drawing)}redo(){let sheet=this.range().sheet();sheet._activeDrawing=this._drawing,sheet.addDrawing(this._drawing)}},MergeCellCommand:class MergeCellCommand extends Command{constructor(options){super(options),this._type=options.value}exec(){this.getState(),this[this._type](),this.range().sheet().triggerChange({recalc:!0})}activate(ref){this.range().sheet().activeCell(ref)}getState(){this._state=this.range().getState()}undo(){"unmerge"!==this._type&&(this.range().unmerge(),this.activate(this.range().topLeft())),this.range().setState(this._state)}cells(){let range=this.range(),ref=range._ref;range.merge(),this.activate(ref)}horizontally(){let ref=this.range().topRow()._ref;this.range().forEachRow((function(range){range.merge()})),this.activate(ref)}vertically(){let ref=this.range().leftColumn()._ref;this.range().forEachColumn((function(range){range.merge()})),this.activate(ref)}unmerge(){let range=this.range(),ref=range._ref.topLeft;range.unmerge(),this.activate(ref)}},NameCommand,OpenCommand:class OpenCommand extends Command{constructor(options){super(options),this.cannotUndo=!0}exec(){if(null===this.options.file.name.match(/.xlsx$/i))return{reason:"error",type:"openUnsupported"};let workbook=this.options.workbook;workbook.fromFile(this.options.file);let errors=workbook.excelImportErrors;errors&&errors.length&&workbook._view.openDialog("importError",{errors})}},PasteCommand:class PasteCommand extends Command{constructor(options){super(options),this._clipboard=options.workbook.clipboard(),this._clipboard.parse(),this._event=options.event,this._clipboardContent=this._clipboard._content,this._sheet=this._workbook.activeSheet(),this._range=this._sheet.selection?this._sheet.selection():this._sheet.range(this._clipboard.pasteRef()),this._state=this._range.getState(),this._targetRangeRefs=(this._range._ref instanceof UnionRef?this._range._ref.refs:[this._range._ref]).map((function(ref){return ref.toRangeRef()}))}exec(){return this.range().sheet().withCultureDecimals(this._exec.bind(this))}undo(){let sheet=this._sheet,range=this._range;sheet.trigger("changing",{data:this._state.data,range,changeType:COMMAND_TYPES_PASTE})||this.setState(this._state)}_exec(){let status=this._clipboard.canPaste();if(!status.canPaste)return status.menuInvoked?{reason:"error",type:"useKeyboard"}:status.pasteOnMerged?{reason:"error",type:"modifyMerged"}:status.pasteOnDisabled?(this._event.preventDefault(),{reason:"error",type:"cannotModifyDisabled"}):{reason:"error"};let sheet=this._sheet,range=this._range;this._workbook.trigger("paste",{range,clipboardContent:this._clipboardContent})||sheet.trigger("changing",{data:this._clipboardContent.data,range,changeType:COMMAND_TYPES_PASTE})?this._event.preventDefault():this._processPaste()}_adjustPasteTarget(multipliers,sourceRows,sourceCols){let refToSelect,rangeToSelect,ref,topLeft,multiplier,i,bottomRight,targetRangeRefs=this._targetRangeRefs,sheet=this._sheet,refs=[],compare=function(a,b){let result=0,topLeftA=a.topLeft,topLeftB=b.topLeft;return topLeftA.row>topLeftB.row?result=1:topLeftA.row<topLeftB.row?result=-1:topLeftA.col>topLeftB.col?result=1:topLeftA.col<topLeftB.col&&(result=-1),result};for(i=0;i<targetRangeRefs.length;i+=1)ref=targetRangeRefs[i],multiplier=multipliers[i],topLeft=ref.topLeft,bottomRight={row:multiplier.rows*sourceRows+topLeft.row-1,col:multiplier.cols*sourceCols+topLeft.col-1},refToSelect=new RangeRef(topLeft,bottomRight),refs.push(refToSelect);1===refs.length?rangeToSelect=sheet.range(refToSelect):(refs.sort(compare),rangeToSelect=sheet.range(new UnionRef(refs))),rangeToSelect.select(),this._range=rangeToSelect,this._state=this._range.getState()}_processPaste(){let i,that=this,sheet=that._sheet,clipboardContent=that._clipboardContent,range=that._range,sourceData=clipboardContent.data,sourceRows=sourceData.length,sourceCols=sourceData[0].length,targetRangeRefs=that._targetRangeRefs,multipliers=that._targetRanges(sourceRows,sourceCols),pasteRef=this._clipboard.pasteRef();(pasteRef.bottomRight.row>=sheet._rows._count||pasteRef.bottomRight.col>=sheet._columns._count)&&sheet.resize(Math.max(pasteRef.bottomRight.row+1,sheet._rows._count),Math.max(pasteRef.bottomRight.col+1,sheet._columns._count)),that._adjustPasteTarget(multipliers,sourceRows,sourceCols),sheet.batch((function(){for(i=0;i<targetRangeRefs.length;i++)that._populateTargetRange(targetRangeRefs[i],sourceRows,sourceCols,multipliers[i])}),{recalc:!0,ref:that._range._ref}),range._adjustRowHeight()}_populateTargetRange(ref,sourceRows,sourceCols,multipliers){let range,i,j,topLeft=ref.topLeft;for(i=0;i<multipliers.rows;i++)for(j=0;j<multipliers.cols;j++)range=this._sheet.range(topLeft.row+sourceRows*i,topLeft.col+sourceCols*j),range.setState(this._clipboardContent,this._clipboard)}_targetRangeDimensions(ref,sourceRows,sourceCols){let topLeft=ref.topLeft,bottomRight=ref.bottomRight,targetRangeRows=bottomRight.row-topLeft.row+1,targetRangeCols=bottomRight.col-topLeft.col+1,rowsMultiplier=1,colsMultiplier=1;return targetRangeRows%sourceRows===0&&targetRangeCols%sourceCols===0&&(rowsMultiplier=targetRangeRows/sourceRows,colsMultiplier=targetRangeCols/sourceCols),{rows:rowsMultiplier,cols:colsMultiplier}}_targetRanges(sourceRows,sourceCols){let i,targetRangeRefs=this._targetRangeRefs,multipliers=[];for(i=0;i<targetRangeRefs.length;i++)multipliers.push(this._targetRangeDimensions(targetRangeRefs[i],sourceRows,sourceCols));return multipliers}},PropertyChangeCommand,PropertyCleanCommand:class PropertyCleanCommand extends PropertyChangeCommand{exec(){let range=this.range();range.enable()&&(this.getState(),range.clearFormat())}},ReorderDrawingsCommand,RowHeightCommand:class RowHeightCommand extends TargetValueCommand{getState(){this._state=this.range().sheet().rowHeight(this._target)}setState(state){this.range().sheet().rowHeight(this._target,state)}},SaveAsCommand:class SaveAsCommand extends Command{constructor(options){super(options),this.cannotUndo=!0}exec(){let fileName=this.options.name+this.options.extension;".xlsx"===this.options.extension?this.options.workbook.saveAsExcel({fileName}):".pdf"===this.options.extension&&this.options.workbook.saveAsPDF(deepExtend(this.options.pdf,{workbook:this.options.workbook,fileName}))}},SendToBackCommand:class SendToBackCommand extends ReorderDrawingsCommand{_reorder(){return 0}},SortCommand:class SortCommand extends Command{undo(){this.range().sheet().setState(this._state)}exec(){let range=this.range(),sheet=range.sheet(),activeCell=sheet.activeCell(),col=this.options.sheet?activeCell.topLeft.col:this.options.column||0,ascending="asc"===this.options.value;this._state=sheet.getState(),this.options.sheet&&(range=this.expandRange());let reason=range.cantSort();if(reason)return{reason:"error",type:reason.code};range.sort({column:col,ascending})}expandRange(){let sheet=this.range().sheet();return new Range$1(sheet._sheetRef,sheet)}},TargetValueCommand,TextWrapCommand:class TextWrapCommand extends PropertyChangeCommand{constructor(options){options.property="wrap",super(options),this._value=options.value}getState(){let rowHeight={};this.range().forEachRow((function(range){let index=range.topLeft().row;rowHeight[index]=range.sheet().rowHeight(index)})),this._state=this.range().getState(this._property),this._rowHeight=rowHeight}undo(){let sheet=this.range().sheet(),rowHeight=this._rowHeight;this.range().setState(this._state);for(let row in rowHeight)sheet.rowHeight(row,rowHeight[row])}},ToolbarCopyCommand:class ToolbarCopyCommand extends Command{constructor(options){super(options),this._clipboard=options.workbook.clipboard(),this.undo=noop}exec(){return{reason:"error",type:"useKeyboard"}}},ToolbarCutCommand:class ToolbarCutCommand extends Command{constructor(options){super(options),this._clipboard=options.workbook.clipboard(),this.cannotUndo=!0}exec(){return{reason:"error",type:"useKeyboard"}}},ToolbarPasteCommand:class ToolbarPasteCommand extends Command{exec(){}},UnHideLineCommand:class UnHideLineCommand extends HideLineCommand{exec(){let sheet=this.range().sheet();this._state=sheet.getAxisState(),"row"===this.axis?sheet.axisManager().unhideSelectedRows():sheet.axisManager().unhideSelectedColumns()}}});class UndoRedoStack extends Observable{constructor(options){super(),this.options=options,this.events=["undo","redo"],this.clear()}push(command){this.stack=this.stack.slice(0,this.currentCommandIndex+1),this.currentCommandIndex=this.stack.push(command)-1}undo(){if(this.canUndo()){let command=this.stack[this.currentCommandIndex--];command.undo(),this.trigger("undo",{command})}}redo(){if(this.canRedo()){let command=this.stack[++this.currentCommandIndex];command.redo(),this.trigger("redo",{command})}}clear(){this.stack=[],this.currentCommandIndex=-1}canUndo(){return this.currentCommandIndex>=0}canRedo(){return this.currentCommandIndex!==this.stack.length-1}}let STRING=String.fromCharCode,ENTITIES={amp:38,lt:60,gt:62,quot:34,apos:39,nbsp:160};function CODE(str){let out=[];for(let i=0;i<str.length;++i)out.push(str.charCodeAt(i));return out}function UCS2(out,code){code>65535?(code-=65536,out.push(code>>>10&1023|55296,56320|1023&code)):out.push(code)}let START_CDATA=CODE("<![CDATA["),END_CDATA=CODE("]]>"),END_COMMENT=CODE("--\x3e"),START_COMMENT=CODE("!--"),END_SHORT_TAG=CODE("/>"),END_TAG=CODE("</"),END_DECLARATION=CODE("?>"),QUESTION_MARK=CODE("?"),LESS_THAN=CODE("<"),GREATER_THAN=CODE(">"),SEMICOLON=CODE(";"),EQUAL=CODE("="),AMPERSAND=CODE("&"),QUOTE=CODE('"'),APOSTROPHE=CODE("'"),SHARP=CODE("#"),LOWERCASE_X=CODE("x"),UPPERCASE_X=CODE("X"),EXIT={};function parse$1(data,callbacks){let index=0,stack=[],object={is:function(selector){let i=stack.length,j=selector.length;for(;--i>=0&&--j>=0;)if(stack[i].$tag!==selector[j]&&"*"!==selector[j])return!1;return j<0?stack[stack.length-1]:null},exit:function(){throw EXIT},stack};function readChar(body){let code=data[index++];240&code^240?224&code^224?192&code^192?body.push(code):UCS2(body,(31&code)<<6|63&data[index++]):UCS2(body,(15&code)<<12|(63&data[index++])<<6|63&data[index++]):UCS2(body,(3&code)<<18|(63&data[index++])<<12|(63&data[index++])<<6|63&data[index++])}function croak(msg){throw new Error(msg+", at "+index)}function readWhile(pred){let a=[];for(;index<data.length&&pred(data[index]);)a.push(data[index++]);return a}function readAsciiWhile(pred){return STRING.apply(0,readWhile(pred))}function skipWhitespace(){readWhile(isWhitespace)}function eat(a){let save=index;for(let i=0;i<a.length;++i)if(data[index++]!==a[i])return index=save,!1;return a}function skip(code){eat(code)||croak("Expecting "+code.join(", "))}function isWhitespace(code){return 9===code||10===code||13===code||32===code}function isDigit(code){return code>=48&&code<=57}function isHexDigit(code){return code>=48&&code<=57||(code|=32)>=97&&code<=102}function isNameStart(code){return 58===code||95===code||(code|=32)>=97&&code<=122}function isName(code){return 45===code||isDigit(code)||isNameStart(code)}function xmlTag(){let name,attrs;eat(QUESTION_MARK)?function xmlDecl(){call("decl",xmlName(),xmlAttrs()),skip(END_DECLARATION)}():eat(START_COMMENT)?function xmlComment(){let body=[];for(;index<data.length;){if(eat(END_COMMENT))return call("comment",STRING.apply(0,body));readChar(body)}}():(name=xmlName(),attrs=xmlAttrs(name),stack.push(attrs),eat(END_SHORT_TAG)?call("enter",name,attrs,!0):(skip(GREATER_THAN),call("enter",name,attrs),function xmlContent(name){let body=[];for(;index<data.length;){if(eat(END_TAG))return body.length&&call("text",STRING.apply(0,body));if(eat(START_CDATA))for(;index<data.length&&!eat(END_CDATA);)readChar(body);else eat(LESS_THAN)?(body.length&&call("text",STRING.apply(0,body)),xmlTag(),body=[]):eat(AMPERSAND)?xmlEntity(body):readChar(body)}croak("Unclosed tag "+name)}(name),name!==xmlName()&&croak("Bad closing tag"),call("leave",name,attrs),skipWhitespace(),skip(GREATER_THAN)),stack.pop())}function xmlName(){return isNameStart(data[index])||croak("Expecting XML name"),readAsciiWhile(isName)}function xmlString(){let quote=eat(QUOTE)||eat(APOSTROPHE);quote||croak("Expecting string");let body=[];for(;index<data.length;){if(eat(quote))return STRING.apply(0,body);eat(AMPERSAND)?xmlEntity(body):readChar(body)}croak("Unfinished string")}function xmlEntity(body){let code;if(eat(SHARP))code=eat(LOWERCASE_X)||eat(UPPERCASE_X)?parseInt(readAsciiWhile(isHexDigit),16):parseInt(readAsciiWhile(isDigit),10),isNaN(code)&&croak("Bad numeric entity");else{let name=xmlName();code=ENTITIES[name],void 0===code&&croak("Unknown entity "+name)}UCS2(body,code),skip(SEMICOLON)}function xmlAttrs(name){let map={$tag:name};for(;index<data.length;){skipWhitespace();let code=data[index];if(63===code||62===code||47===code)break;map[xmlName()]=(skip(EQUAL),xmlString())}return map}function call(what,thing,arg1,arg2){let f=callbacks&&callbacks[what];f&&f.call(object,thing,arg1,arg2)}let tmp=[];for(readChar(tmp),65279!==tmp[0]&&(index=0);index<data.length;)skipWhitespace(),skip(LESS_THAN),xmlTag(),skipWhitespace()}let MAP_EXCEL_OPERATOR={greaterThanOrEqual:"greaterThanOrEqualTo",lessThanOrEqual:"lessThanOrEqualTo"},ERROR_LOG=null;function readExcel(file,workbook){let reader=new FileReader;reader.onload=function(e){JSZip.loadAsync(e.target.result).then((zip=>{!async function readWorkbook(zip,workbook){ERROR_LOG=workbook.excelImportErrors=[];let strings=await async function readStrings(zip){let strings=[],current=null;return await parse(zip,"xl/sharedStrings.xml",{leave:function(){this.is(SEL_SHARED_STRING)&&(strings.push(current),current=null)},text:function(text){this.is(SEL_TEXT)&&(null==current&&(current=""),current+=text)}}),strings}(zip),relationships=await readRelationships(zip,"_rels/workbook.xml"),theme=await async function readTheme(zip,rel){let scheme=[],theme={colorScheme:scheme},file=xl(rel);zip.files[file]&&(await parse(zip,file,{enter:function(tag,attrs){this.is(SEL_SCHEME_SYSCLR)?scheme.push(toCSSColor("window"===attrs.val?"FFFFFFFF":"FF000000")):this.is(SEL_SCHEME_RGBCLR)&&scheme.push(toCSSColor("FF"+attrs.val))}}),scheme.length>3&&(swap(scheme,0,1),swap(scheme,2,3)));function swap(arr,a,b){let tmp=arr[a];arr[a]=arr[b],arr[b]=tmp}return theme}(zip,relationships.byType.theme[0]),styles=await async function readStyles(zip,theme){let styles={fonts:[],numFmts:{},fills:[],borders:[],namedStyles:[],inlineStyles:[]},font=null,fill=null,border=null,xf=null;function getXf(attrs){let xf={borderId:integer(attrs.borderId),fillId:integer(attrs.fillId),fontId:integer(attrs.fontId),numFmtId:integer(attrs.numFmtId),pivotButton:bool(attrs.pivotButton),quotePrefix:bool(attrs.quotePrefix),xfId:integer(attrs.xfId)};function addBool(name){null!=attrs[name]&&(xf[name]=bool(attrs[name]))}return addBool("applyAlignment"),addBool("applyBorder"),addBool("applyFill"),addBool("applyFont"),addBool("applyNumberFormat"),addBool("applyProtection"),xf}function getColor(attrs,defaultThemeColor){if(attrs.rgb)return toCSSColor(attrs.rgb);if(attrs.indexed)return INDEXED_COLORS[integer(attrs.indexed)];if(attrs.theme){let themeColor=theme.colorScheme[integer(attrs.theme)];if(!themeColor)return defaultThemeColor;let color=(0,parse_color.Ay)(themeColor);if(attrs.tint){color=color.toHSL();let tint=parseFloat(attrs.tint);color.l=tint<0?color.l*(1+tint):color.l*(1-tint)+(100-100*(1-tint))}return color.toCssRgba()}}return await parse(zip,"xl/styles.xml",{enter:function(tag,attrs,closed){if(this.is(SEL_NUM_FMT))styles.numFmts[attrs.numFmtId]=attrs;else if(this.is(SEL_FONT))styles.fonts.push(font={}),closed&&(font=null);else if(font)"sz"===tag?font.size=parseFloat(attrs.val):"name"===tag?font.name=attrs.val:"b"===tag?font.bold=bool(attrs.val,!0):"i"===tag?font.italic=bool(attrs.val,!0):"u"===tag?font.underline=null==attrs.val||"single"===attrs.val:"color"===tag&&(font.color=getColor(attrs,null));else if(this.is(SEL_FILL))styles.fills.push(fill={}),closed&&(fill=null);else if(fill)"patternFill"===tag?fill.type=attrs.patternType:("fgColor"===tag&&"solid"===fill.type||"bgColor"===tag&&"solid"!==fill.type)&&(fill.color=getColor(attrs,INDEXED_COLORS[0]));else if(this.is(SEL_BORDER))styles.borders.push(border={diagonalUp:+bool(attrs.diagonalUp,0),diagonalDown:+bool(attrs.diagonalDown,0)}),closed&&(border=null);else if(border){if(/^(?:left|top|right|bottom|diagonal)$/.test(tag)&&(border[tag]={style:attrs.style||"none"},"diagonal"===tag&&(border.diagonal.up=border.diagonalUp,border.diagonal.down=border.diagonalDown)),"color"===tag){let side=this.stack[this.stack.length-2].$tag;border[side].color=getColor(attrs,INDEXED_COLORS[0])}}else this.is(SEL_NAMED_STYLE)?(xf=getXf(attrs),styles.namedStyles.push(xf),closed&&(xf=null)):this.is(SEL_INLINE_STYLE)?(xf=getXf(attrs),styles.inlineStyles.push(xf),closed&&(xf=null)):xf&&"alignment"===tag&&(/^(?:left|center|right|justify)$/.test(attrs.horizontal)&&(xf.textAlign=attrs.horizontal),/^(?:top|center|bottom)$/.test(attrs.vertical)&&(xf.verticalAlign=attrs.vertical),null!=attrs.wrapText&&(xf.wrapText=bool(attrs.wrapText)),null!=attrs.indent&&(xf.indent=integer(attrs.indent)))},leave:function(tag){this.is(SEL_FONT)?font=null:this.is(SEL_FILL)?fill=null:this.is(SEL_BORDER)?border=null:"xf"===tag&&(xf=null)}}),styles}(zip,theme),items=[],activeSheet=0;await parse(zip,"xl/workbook.xml",{enter:function(tag,attrs){if(this.is(SEL_SHEET)){let relId=attrs["r:id"],file=relationships.byId[relId],name=attrs.name;items.push({workbook,zip,strings,styles,file,options:{name}})}else this.is(SEL_VIEW)&&attrs.activeTab&&(activeSheet=integer(attrs.activeTab))},text:function(text){let attrs=this.is(SEL_DEFINED_NAME);if(attrs&&!bool(attrs.function)&&!bool(attrs.vbProcedure)){let localSheetId=attrs.localSheetId,sheet=null;null!=localSheetId&&(sheet=items[localSheetId].options.name);let name=attrs.name;"_xlnm._FilterDatabase"!==name&&(sheet&&(name="'"+sheet.replace(/\'/g,"\\'")+"'!"+name),withErrorLog(sheet,null,(function(){workbook.defineName(name,text,bool(attrs.hidden))}),"reading user-defined name: "+name))}}});for(let i=0;i<items.length;i++){const item=items[i],dim=await sheetDimensions(item.zip,item.file),{workbook}=item;workbook.options.columnWidth=dim.columnWidth||workbook.options.columnWidth,workbook.options.rowHeight=dim.rowHeight||workbook.options.rowHeight,item.options={...item.options,rows:Math.max(workbook.options.rows||0,dim.rows),columns:Math.max(workbook.options.columns||0,dim.cols),columnWidth:dim.columnWidth,rowHeight:dim.rowHeight}}await async function loadSheets(items,workbook){for(let i=0;i<items.length;i++){const ctx=items[i];let sheet=workbook.insertSheet(ctx.options);sheet.suspendChanges(!0),await readSheet(ctx.zip,ctx.file,sheet,ctx.strings,ctx.styles)}}(items,workbook);let sheets=workbook.sheets();(function recalcSheets(sheets){for(let i=0;i<sheets.length;i++)sheets[i].suspendChanges(!1).triggerChange({recalc:!0})})(sheets),workbook.activeSheet(sheets[activeSheet])}(zip,workbook)}))},reader.readAsArrayBuffer(file)}let SEL_CELL=["sheetData","row","c"],SEL_COL=["cols","col"],SEL_DEFINED_NAME=["definedNames","definedName"],SEL_FORMULA=["sheetData","row","c","f"],SEL_MERGE=["mergeCells","mergeCell"],SEL_PANE=["sheetViews","sheetView","pane"],SEL_ROW=["sheetData","row"],SEL_SELECTION=["sheetViews","sheetView","selection"],SEL_SHEET=["sheets","sheet"],SEL_STRING=["sheetData","row","c","is"],SEL_TEXT=["t"],SEL_SHARED_STRING=["si"],SEL_VALUE=["sheetData","row","c","v"],SEL_VIEW=["bookViews","workbookView"],SEL_SHEET_VIEW=["sheetViews","sheetView"],SEL_HYPERLINK=["hyperlinks","hyperlink"],SEL_VALIDATION=["dataValidations","dataValidation"],SEL_VALIDATION_FORMULA1=["dataValidations","dataValidation","formula1"],SEL_VALIDATION_FORMULA2=["dataValidations","dataValidation","formula2"],SEL_VALIDATION_INSANE=["x14:dataValidations","x14:dataValidation"],SEL_VALIDATION_SQREF_INSANE=["x14:dataValidations","x14:dataValidation","xm:sqref"],SEL_VALIDATION_FORMULA1_INSANE=["x14:dataValidations","x14:dataValidation","x14:formula1","xm:f"],SEL_VALIDATION_FORMULA2_INSANE=["x14:dataValidations","x14:dataValidation","x14:formula2","xm:f"],SEL_COMMENT=["commentList","comment"],SEL_AUTHOR=["authors","author"],SEL_COMMENT_TEXT=["t"];function xl(file){return/^\//.test(file)?file=file.substr(1):/^xl\//.test(file)||(file="xl/"+file),file}async function sheetDimensions(zip,file){let ref,dim={rows:0,cols:0};return await parse(zip,xl(file),{enter:function(tag,attrs){"dimension"===tag?(ref=calc.parseReference(attrs.ref),ref.bottomRight&&(dim.cols=ref.bottomRight.col+1,dim.rows=ref.bottomRight.row+1)):"sheetFormatPr"===tag?(attrs.defaultColWidth&&(dim.columnWidth=toColWidth(parseFloat(attrs.defaultColWidth))),attrs.defaultRowHeight&&(dim.rowHeight=toRowHeight(parseFloat(attrs.defaultRowHeight)))):this.is(SEL_ROW)&&attrs.r?dim.rows=Math.max(dim.rows,+attrs.r):this.is(SEL_CELL)&&attrs.r&&(ref=calc.parseReference(attrs.r),dim.rows=Math.max(dim.rows,ref.row+1),dim.cols=Math.max(dim.cols,ref.col+1))}}),dim}function toColWidth(size){return 7*((256*size+Math.floor(128/7))/256)}function toRowHeight(pts){return pts*(4/3)}async function readSheet(zip,file,sheet,strings,styles){let ref,type,value,formula,formulaRange,isArrayFormula,formula1,formula2,filterRef,filterColumn,customFilterLogic,customFilterCriteria,valueFilterBlanks,valueFilterValues,sharedFormulas={},nCols=sheet._columns._count,prevCellRef=null,relsFile=file.replace(/worksheets\//,"worksheets/_rels/"),relationships=await readRelationships(zip,relsFile),filters=[];if(ERROR_LOG=sheet._workbook.excelImportErrors,file=xl(file),await parse(zip,file,{enter:function(tag,attrs,closed){let tmp;if(this.is(SEL_FORMULA))closed&&"shared"===attrs.t&&null!=attrs.si&&(formula=sheet.range(sharedFormulas[attrs.si])._get("formula"));else if(this.is(SEL_CELL)){value=null,formula=null,ref=attrs.r,formulaRange=null,null==ref&&(ref=calc.parseReference(prevCellRef),ref.col++,ref=ref.toString()),prevCellRef=ref,type=attrs.t;let styleIndex=attrs.s;null!=styleIndex&&applyStyle(sheet,ref,styles,styleIndex)}else if(this.is(SEL_MERGE))sheet.range(attrs.ref).merge();else if(this.is(SEL_COL)){let width,start=integer(attrs.min)-1,stop=Math.min(nCols,integer(attrs.max))-1;if(attrs.width&&(width=toColWidth(parseFloat(attrs.width)),0!==width&&sheet._columns.values.value(start,stop,width)),"1"===attrs.hidden||0===width)for(let ci=start;ci<=stop;ci++)sheet.hideColumn(ci);null!=attrs.style&&applyStyle(sheet,new RangeRef(new CellRef(-1/0,start),new CellRef(1/0,stop)),styles,attrs.style)}else if(this.is(SEL_ROW)){let height,row=integer(attrs.r)-1;attrs.ht&&(height=toRowHeight(parseFloat(attrs.ht)),0!==height&&sheet._rows.values.value(row,row,height)),"1"!==attrs.hidden&&0!==height||sheet.hideRow(row)}else if(this.is(SEL_SELECTION)){if(attrs.activeCell){let acRef=calc.parseReference(attrs.activeCell);sheet.select(acRef,!0)}}else if(this.is(SEL_PANE))attrs.state&&attrs.state.indexOf("frozen")>-1&&(attrs.xSplit&&sheet.frozenColumns(integer(attrs.xSplit)),attrs.ySplit&&sheet.frozenRows(integer(attrs.ySplit)));else if(this.is(SEL_SHEET_VIEW))sheet.showGridLines(bool(attrs.showGridLines,!0));else if(this.is(SEL_HYPERLINK)){let relId=attrs["r:id"],target=relationships.byId[relId];target&&sheet.range(attrs.ref).link(target)}else this.is(["autoFilter"])?(filterRef=attrs.ref,closed&&addAutoFilter()):filterRef&&(this.is(["filterColumn"])?filterColumn=parseInt(attrs.colId,10):this.is(["customFilters"])?(customFilterLogic=bool(attrs.and)?"and":"or",customFilterCriteria=[]):this.is(["customFilter"])?(tmp=function getCustomFilter(op,value){let ourOp={equal:"eq",notEqual:"ne",greaterThan:"gt",greaterThanOrEqual:"gte",lessThan:"lt",lessThanOrEqual:"lte"}[op];if(value=getFilterVal(value),ourOp&&"number"==typeof value)return{operator:ourOp,value};if(("notEqual"===op||!op)&&"string"==typeof value)return{operator:op?"doesnotmatch":"matches",value}}(attrs.operator,attrs.val),tmp&&customFilterCriteria.push({operator:tmp.operator,value:tmp.value})):this.is(["dynamicFilter"])?filters.push({column:filterColumn,filter:new DynamicFilter({type:dynamicFilterType(attrs.type)})}):this.is(["top10"])?filters.push({column:filterColumn,filter:new TopFilter({value:getFilterVal(attrs.val),type:(percent=bool(attrs.percent),top=bool(attrs.top),percent&&top?"topPercent":top?"topNumber":percent?"bottomPercent":"bottomNumber")})}):this.is(["filters"])?(valueFilterBlanks=bool(attrs.blank),valueFilterValues=[]):this.is(["filter"])&&valueFilterValues.push(getFilterVal(attrs.val)));var percent,top},leave:function(tag,attrs){if(this.is(SEL_FORMULA))formula||"shared"!==attrs.t||null==attrs.si||(formula=sheet.range(sharedFormulas[attrs.si])._get("formula"));else if(this.is(SEL_CELL)){if(null!=formula){withErrorLog(sheet,formulaRange||ref,(function(){sheet.range(formulaRange||ref).formula(formula,isArrayFormula)}),"parsing formula")&&sheet.range(formulaRange||ref).value(formula).background("#ffaaaa")}else if(null!=value){let range=sheet.range(ref);range._get("formula")||(type&&"n"!==type?"s"===type?value=strings[integer(value)]:"b"===type?value="1"===value:"d"===type&&(value=intl().parseDate(value)):value=parseFloat(value),null!=value&&range.value(value))}}else this.is(SEL_VALIDATION)||this.is(SEL_VALIDATION_INSANE)?function(){let refs=calc.parseSqref(attrs.sqref),type=attrs.type.toLowerCase(),operator=attrs.operator;/^(?:whole|decimal)$/.test(type)?type="number":"list"===type&&(operator="list"),!operator&&/^(?:number|date)$/.test(type)&&(operator="between"),refs.forEach((function(ref){withErrorLog(sheet,ref,(function(){sheet.range(ref).validation({type:bool(attrs.showErrorMessage,!0)?"reject":"warning",from:formula1,to:formula2,dataType:type,comparerType:MAP_EXCEL_OPERATOR[operator]||operator,allowNulls:bool(attrs.allowBlank),showButton:bool(attrs.showDropDown)||"date"===type||"list"===type,messageTemplate:attrs.error,titleTemplate:attrs.errorTitle})}),"parsing validation")}))}():"cols"===tag?sheet._columns._refresh():"sheetData"===tag?sheet._rows._refresh():"autoFilter"===tag?addAutoFilter():filterRef&&("customFilters"===tag?filters.push({column:filterColumn,filter:new CustomFilter({logic:customFilterLogic,criteria:customFilterCriteria})}):"filters"===tag&&filters.push({column:filterColumn,filter:new ValueFilter({values:valueFilterValues,blanks:valueFilterBlanks})}))},text:function(text){let attrs;this.is(SEL_VALUE)||this.is(SEL_STRING)?value=text:(attrs=this.is(SEL_FORMULA))?(formula=text,isArrayFormula="array"===attrs.t,isArrayFormula?formulaRange=attrs.ref:"shared"===attrs.t&&(sharedFormulas[attrs.si]=ref)):this.is(SEL_VALIDATION_FORMULA1)||this.is(SEL_VALIDATION_FORMULA1_INSANE)?formula1=text:this.is(SEL_VALIDATION_FORMULA2)||this.is(SEL_VALIDATION_FORMULA2_INSANE)?formula2=text:this.is(SEL_VALIDATION_SQREF_INSANE)&&(this.stack[this.stack.length-2].sqref=text)}}),relationships.byType.comments){let commentFile=relative_file(file,relationships.byType.comments[0]);await async function readComments(zip,file,sheet){let author,comment,authors=[];await parse(zip,file,{enter:function(tag,attrs){this.is(SEL_COMMENT)?comment={author:authors[attrs.authorId],ref:attrs.ref,text:""}:this.is(SEL_AUTHOR)&&(author="")},leave:function(){this.is(SEL_COMMENT)?sheet.range(comment.ref).comment(comment.text):this.is(SEL_AUTHOR)&&authors.push(author)},text:function(text){this.is(SEL_COMMENT_TEXT)?comment.text+=text:this.is(SEL_AUTHOR)&&(author+=text)}})}(zip,commentFile,sheet)}if(relationships.byType.drawing){let drawingFile=relative_file(file,relationships.byType.drawing[0]);await async function readDrawings(zip,file,sheet){let cdr,ref,width,height,sel_two_cell_anchor=["xdr:twoCellAnchor"],sel_ext=["xdr:ext"],sel_one_cell_anchor=["xdr:oneCellAnchor"],sel_from=["xdr:from"],sel_to=["xdr:to"],sel_row=["xdr:row"],sel_col=["xdr:col"],sel_row_offset=["xdr:rowOff"],sel_col_offset=["xdr:colOff"],sel_blip=["xdr:blipFill","a:blip"],relsFile=file.replace(/drawings\//,"drawings/_rels/"),relationships=await readRelationships(zip,relsFile);if(relationships.byType.image)for(const id of Object.keys(relationships.byId)){let img=relative_file(file,relationships.byId[id]),type=getContentType(img);if(type){let data=await zip.files[img].async("arrayBuffer"),name=getFileName(img),blob=name&&!main.T.edge?new window.File([data],name,{type}):new window.Blob([data],{type});relationships.byId[id]=sheet._workbook.addImage(blob)}}await parse(zip,file,{enter:function(tag,attrs){if(this.is(sel_two_cell_anchor)||this.is(sel_one_cell_anchor))cdr={};else if(this.is(sel_from)||this.is(sel_to))ref={};else if(this.is(sel_blip)){let id=attrs["r:embed"];cdr.image=relationships.byId[id]}else this.is(sel_ext)&&(width=excelToPixels(parseFloat(attrs.cx)),height=excelToPixels(parseFloat(attrs.cy)))},leave:function(){if(this.is(sel_from))cdr.topLeftCell=new CellRef(ref.row,ref.col),cdr.offsetX=excelToPixels(ref.colOffset),cdr.offsetY=excelToPixels(ref.rowOffset);else if(this.is(sel_to))cdr.brCell=new CellRef(ref.row,ref.col),cdr.brX=excelToPixels(ref.colOffset),cdr.brY=excelToPixels(ref.rowOffset);else if(this.is(sel_two_cell_anchor)&&cdr.image){let left=sheet._columns.sum(0,cdr.topLeftCell.col-1)+cdr.offsetX,top=sheet._rows.sum(0,cdr.topLeftCell.row-1)+cdr.offsetY,right=sheet._columns.sum(0,cdr.brCell.col-1)+cdr.brX,bottom=sheet._rows.sum(0,cdr.brCell.row-1)+cdr.brY;sheet.addDrawing({topLeftCell:cdr.topLeftCell,offsetX:cdr.offsetX,offsetY:cdr.offsetY,width:null!=width?width:right-left,height:null!=height?height:bottom-top,image:cdr.image,opacity:1})}else this.is(sel_one_cell_anchor)&&cdr.image&&sheet.addDrawing({topLeftCell:cdr.topLeftCell,offsetX:cdr.offsetX,offsetY:cdr.offsetY,width,height,image:cdr.image,opacity:1})},text:function(text){this.is(sel_row)?ref.row=parseFloat(text):this.is(sel_col)?ref.col=parseFloat(text):this.is(sel_row_offset)?ref.rowOffset=parseFloat(text):this.is(sel_col_offset)&&(ref.colOffset=parseFloat(text))}})}(zip,drawingFile,sheet)}function addAutoFilter(){sheet.range(filterRef).filter(filters),filterRef=null}}function getContentType(filename){let m=/\.([^.]+)$/.exec(filename);if(m&&m[1])return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",wmf:"image/wmf"}[m[1].toLowerCase()]}function getFileName(filename){let m=/[^/]+$/.exec(filename);return m&&m[0]}function dynamicFilterType(type){return{Q1:"quarter1",Q2:"quarter2",Q3:"quarter3",Q4:"quarter4",M1:"january",M2:"february",M3:"march",M4:"april",M5:"may",M6:"june",M7:"july",M8:"august",M9:"september",M10:"october",M11:"november",M12:"december"}[type.toUpperCase()]||type}function getFilterVal(val){let tmp=parseFloat(val);return isNaN(tmp)||tmp!==val?val:tmp}function withErrorLog(sheet,ref,func,context){try{return func(),!1}catch(ex){let err={context,error:String(ex)};return sheet&&sheet.name?err.sheet=sheet.name():sheet&&(err.sheet=sheet),ref&&(err.location=String(ref)),ERROR_LOG.push(err),!0}}let BORDER_WIDTHS={none:0,thin:1,medium:2,dashed:1,dotted:1,thick:3,double:3,hair:1,mediumDashed:2,dashDot:1,mediumDashDot:2,dashDotDot:1,mediumDashDotDot:2,slantDashDot:1},DEFAULT_FORMATS={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"mm-dd-yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@"};function applyStyle(sheet,ref,styles,styleIndex){let base,value,range=sheet.range(ref),xf=styles.inlineStyles[styleIndex];function shouldSet(applyName,propName){let t=xf[applyName];if(null!=t&&!t)return!1;if(value=xf[propName],base&&null==value){if(t=base[applyName],null!=t&&!t)return!1;value=base[propName]}return null!=value}xf.xfId&&(base=styles.namedStyles[xf.xfId]),shouldSet("applyBorder","borderId")&&function setBorder(b){function set(side,prop){let border=b[side];if(!border)return;let width=BORDER_WIDTHS[border.style];if(!width)return;let color=border.color;null==color&&(color="#000");let value={size:width,color};"diagonal"===side&&(value.type=border.up<<1|border.down),range._property(prop,value)}set("left","borderLeft"),set("top","borderTop"),set("right","borderRight"),set("bottom","borderBottom"),set("diagonal","dBorders")}(styles.borders[value]),shouldSet("applyFont","fontId")&&function setFont(f){range.fontFamily(f.name),f.size&&range._property("fontSize",4*f.size/3);f.bold&&range.bold(!0);f.italic&&range.italic(!0);f.underline&&range.underline(!0);f.color&&range.color(f.color)}(styles.fonts[value]),shouldSet("applyAlignment","textAlign")&&range.textAlign(value),shouldSet("applyAlignment","verticalAlign")&&range.verticalAlign(value),shouldSet("applyAlignment","indent")&&range.indent(value),shouldSet("applyAlignment","wrapText")&&range._property("wrap",value),shouldSet("applyFill","fillId")&&function setFill(f){"solid"===f.type&&range.background(f.color)}(styles.fills[value]),shouldSet("applyNumberFormat","numFmtId")&&function setFormat(f){let format="string"==typeof f?f:f.formatCode;null==format||/^general$/i.test(format)||(format=format.replace(/^\[\$-[0-9]+\]/,""),range.format(format))}(styles.numFmts[value]||DEFAULT_FORMATS[value])}async function parse(zip,file,callbacks){let part=zip.files[file];part&&await function parseXML(){try{return parse$1.apply(this,arguments)}catch(ex){if(ex!==EXIT)throw ex}}(await part.async("uint8array"),callbacks)}async function readRelationships(zip,file){let map={byId:{},byType:{theme:[]}};return await parse(zip,xl(file)+".rels",{enter:function(tag,attrs){if("Relationship"===tag){map.byId[attrs.Id]=attrs.Target;let type=attrs.Type.match(/\w+$/)[0],entries=map.byType[type]||[];entries.push(attrs.Target),map.byType[type]=entries}}}),map}let SEL_BORDER=["borders","border"],SEL_FILL=["fills","fill"],SEL_FONT=["fonts","font"],SEL_INLINE_STYLE=["cellXfs","xf"],SEL_NAMED_STYLE=["cellStyleXfs","xf"],SEL_NUM_FMT=["numFmts","numFmt"],INDEXED_COLORS=[toCSSColor("FF000000"),toCSSColor("FFFFFFFF"),toCSSColor("FFFF0000"),toCSSColor("FF00FF00"),toCSSColor("FF0000FF"),toCSSColor("FFFFFF00"),toCSSColor("FFFF00FF"),toCSSColor("FF00FFFF"),toCSSColor("FF000000"),toCSSColor("FFFFFFFF"),toCSSColor("FFFF0000"),toCSSColor("FF00FF00"),toCSSColor("FF0000FF"),toCSSColor("FFFFFF00"),toCSSColor("FFFF00FF"),toCSSColor("FF00FFFF"),toCSSColor("FF800000"),toCSSColor("FF008000"),toCSSColor("FF000080"),toCSSColor("FF808000"),toCSSColor("FF800080"),toCSSColor("FF008080"),toCSSColor("FFC0C0C0"),toCSSColor("FF808080"),toCSSColor("FF9999FF"),toCSSColor("FF993366"),toCSSColor("FFFFFFCC"),toCSSColor("FFCCFFFF"),toCSSColor("FF660066"),toCSSColor("FFFF8080"),toCSSColor("FF0066CC"),toCSSColor("FFCCCCFF"),toCSSColor("FF000080"),toCSSColor("FFFF00FF"),toCSSColor("FFFFFF00"),toCSSColor("FF00FFFF"),toCSSColor("FF800080"),toCSSColor("FF800000"),toCSSColor("FF008080"),toCSSColor("FF0000FF"),toCSSColor("FF00CCFF"),toCSSColor("FFCCFFFF"),toCSSColor("FFCCFFCC"),toCSSColor("FFFFFF99"),toCSSColor("FF99CCFF"),toCSSColor("FFFF99CC"),toCSSColor("FFCC99FF"),toCSSColor("FFFFCC99"),toCSSColor("FF3366FF"),toCSSColor("FF33CCCC"),toCSSColor("FF99CC00"),toCSSColor("FFFFCC00"),toCSSColor("FFFF9900"),toCSSColor("FFFF6600"),toCSSColor("FF666699"),toCSSColor("FF969696"),toCSSColor("FF003366"),toCSSColor("FF339966"),toCSSColor("FF003300"),toCSSColor("FF333300"),toCSSColor("FF993300"),toCSSColor("FF993366"),toCSSColor("FF333399"),toCSSColor("FF333333"),toCSSColor("FF000000"),toCSSColor("FFFFFFFF")];let SEL_SCHEME_RGBCLR=["a:clrScheme","*","a:srgbClr"],SEL_SCHEME_SYSCLR=["a:clrScheme","*","a:sysClr"];function integer(val){return null==val?null:parseInt(val,10)}function bool(val,def){return null==val?def:"true"===val||!0===val||1===val||"1"===val}function toCSSColor(rgb){let m=/^([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(rgb);return"rgba("+parseInt(m[2],16)+", "+parseInt(m[3],16)+", "+parseInt(m[4],16)+", "+parseInt(m[1],16)/255+")"}function relative_file(base,name){for(base=base.split(/\/+/),name=name.split(/\/+/),base.pop();name.length;){let part=name.shift();if(""===part)base=[];else{if("."===part)continue;".."===part?base.pop():base.push(part)}}return base.join("/")}function excelToPixels(val){return val/9525}const events$1=["cut","copy","paste","changing","change","excelImport","excelExport","insertSheet","removeSheet","selectSheet","renameSheet","insertRow","insertColumn","deleteRow","deleteColumn","hideRow","hideColumn","unhideRow","unhideColumn","select","changeFormat","dataBinding","dataBound","progress"];function loadBinary(url,callback){let xhr=new XMLHttpRequest;xhr.onload=function(){callback(xhr.response,xhr.getResponseHeader("Content-Type"))},xhr.onerror=function(){callback(null)},xhr.open("GET",url),xhr.responseType="arraybuffer",xhr.send()}class Workbook extends Observable{constructor(options,view){super(),this.events=events$1,this.options=options,this._view=view,this._sheets=[],this._images={},this._imgID=0,this._sheetsSearchCache={},this._sheet=this.insertSheet({rows:this.options.rows,columns:this.options.columns,rowHeight:this.options.rowHeight,columnWidth:this.options.columnWidth,headerHeight:this.options.headerHeight,headerWidth:this.options.headerWidth,dataSource:this.options.dataSource}),this.undoRedoStack=new UndoRedoStack,this.undoRedoStack.bind(["undo","redo"],this._onUndoRedo.bind(this)),this._context=new FormulaContext(this),this._validationContext=new ValidationFormulaContext(this),this._names=Object.create(null),this.fromJSON(this.options)}clipboard(){return this._clipboard||(this._clipboard=new Clipboard(this)),this._clipboard}destroy(){this.unbind(),this._clipboard&&this._clipboard.destroy()}_sheetChanging(e){this.trigger("changing",e)&&e.preventDefault()}_sheetChange(e){this.trigger("change",e)}_sheetInsertRow(e){this.trigger("insertRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetInsertColumn(e){this.trigger("insertColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetDeleteRow(e){this.trigger("deleteRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetDeleteColumn(e){this.trigger("deleteColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetHideRow(e){this.trigger("hideRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetHideColumn(e){this.trigger("hideColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetUnhideRow(e){this.trigger("unhideRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetUnhideColumn(e){this.trigger("unhideColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetSelect(e){this.trigger("select",e)}_sheetDataBinding(e){this.trigger("dataBinding",{sheet:e.sender})&&e.preventDefault()}_sheetDataBound(e){this.trigger("dataBound",{sheet:e.sender})}_sheetProgress(e){let that=this;setTimeout((function(){that.trigger("progress",{toggle:e.toggle})}))}_sheetCommandRequest(e){this.trigger("commandRequest",e)}_inputForRef(ref){let self=this;return self._sheet.withCultureDecimals((function(){return new Range$1(ref,self._sheet).input()}))}_onUndoRedo(e){e.command.range().select()}execute(options){let commandOptions=Object.assign({},{workbook:this},options.options),command=new commands[options.command](commandOptions),sheet=this.activeSheet();commandOptions.origin&&command.origin(commandOptions.origin),commandOptions.operatingRange?command.range(commandOptions.operatingRange):command.range(sheet.selection()),commandOptions.editRange&&(command._editRange=commandOptions.editRange);let result=command.exec();return result&&"error"===result.reason||command.cannotUndo||this.undoRedoStack.push(command),this.cleanupImages(),result}resetFormulas(){this._sheets.forEach((function(sheet){sheet.resetFormulas()}))}resetValidations(){this._sheets.forEach((function(sheet){sheet.resetValidations()}))}refresh(reason){reason.recalc&&(this.resetFormulas(),this.resetValidations(),this._sheet.recalc(this._context),this._sheet.revalidate(this._validationContext))}activeSheet(sheet){if(void 0===sheet)return this._sheet;this.sheetByName(sheet.name())&&(this._sheet=sheet,sheet.triggerChange(ALL_REASONS))}moveSheetToIndex(sheet,toIndex){let fromIndex=this.sheetIndex(sheet),sheets=this._sheets;-1!==fromIndex&&(this._sheetsSearchCache={},sheets.splice(toIndex,0,sheets.splice(fromIndex,1)[0]),this.trigger("change",{sheetSelection:!0}))}insertSheet(options){let sheetName,that=this,insertIndex="number"==typeof(options=options||{}).index?options.index:that._sheets.length,sheets=that._sheets;const messages=this.options.messages;let getUniqueSheetName=function(sheetNameSuffix){sheetNameSuffix=sheetNameSuffix||1;let name=messages.workbook.defaultSheetName+sheetNameSuffix;return that.sheetByName(name)?getUniqueSheetName(sheetNameSuffix+1):name};if(options.name&&that.sheetByName(options.name))return;this._sheetsSearchCache={},sheetName=options.name||getUniqueSheetName();let sheet=new Sheet(options.rows||this.options.rows,options.columns||this.options.columns,options.rowHeight||this.options.rowHeight,options.columnWidth||this.options.columnWidth,options.headerHeight||this.options.headerHeight,options.headerWidth||this.options.headerWidth,options.defaultCellStyle||this.options.defaultCellStyle);return sheet._workbook=this,sheet._name(sheetName),this._bindSheetEvents(sheet),sheets.splice(insertIndex,0,sheet),options.data&&sheet.fromJSON(options.data),options.dataSource&&sheet.setDataSource(options.dataSource),this.trigger("change",{sheetSelection:!0}),sheet}_bindSheetEvents(sheet){sheet.bind("changing",this._sheetChanging.bind(this)),sheet.bind("change",this._sheetChange.bind(this)),sheet.bind("insertRow",this._sheetInsertRow.bind(this)),sheet.bind("insertColumn",this._sheetInsertColumn.bind(this)),sheet.bind("deleteRow",this._sheetDeleteRow.bind(this)),sheet.bind("deleteColumn",this._sheetDeleteColumn.bind(this)),sheet.bind("hideRow",this._sheetHideRow.bind(this)),sheet.bind("hideColumn",this._sheetHideColumn.bind(this)),sheet.bind("unhideRow",this._sheetUnhideRow.bind(this)),sheet.bind("unhideColumn",this._sheetUnhideColumn.bind(this)),sheet.bind("select",this._sheetSelect.bind(this)),sheet.bind("commandRequest",this._sheetCommandRequest.bind(this)),sheet.bind("dataBinding",this._sheetDataBinding.bind(this)),sheet.bind("dataBound",this._sheetDataBound.bind(this)),sheet.bind("progress",this._sheetProgress.bind(this))}sheets(){return this._sheets.slice()}sheetByName(sheetName){return this._sheets[this.sheetIndex(sheetName)]}sheetByIndex(index){return this._sheets[index]}sheetIndex(sheet){let sheets=this._sheets,sheetName=("string"==typeof sheet?sheet:sheet.name()).toLowerCase(),idx=this._sheetsSearchCache[sheetName];if(idx>=0)return idx;for(idx=0;idx<sheets.length;idx++){let name=sheets[idx].name().toLowerCase();if(this._sheetsSearchCache[name]=idx,name===sheetName)return idx}return-1}renameSheet(sheet,newSheetName){let oldSheetName=sheet.name().toLowerCase();if(newSheetName&&oldSheetName!==newSheetName.toLowerCase()&&!this.sheetByName(newSheetName)&&(sheet=this.sheetByName(oldSheetName))&&(this._sheetsSearchCache={},!this.trigger("renameSheet",{sheet,newSheetName})))return this._sheets.forEach((function(sheet){sheet._forFormulas((function(formula){formula.renameSheet(oldSheetName,newSheetName)}))})),this.forEachName(function(def,name){def.nameref.renameSheet(oldSheetName,newSheetName)&&(this.undefineName(name),def.name=def.nameref.print(),this.nameDefinition(def.name,def)),(def.value instanceof Ref||def.value instanceof calc.runtime.Formula)&&def.value.renameSheet(oldSheetName,newSheetName)}.bind(this)),sheet._name(newSheetName),this.trigger("change",{sheetSelection:!0}),sheet}removeSheet(sheet){let that=this,sheets=that._sheets,name=sheet.name(),index=that.sheetIndex(sheet);if(1!==sheets.length&&!this.trigger("removeSheet",{sheet})&&(this._sheetsSearchCache={},index>-1))if(sheet.unbind(),sheets.splice(index,1),that.activeSheet().name()===name){let newSheet=sheets[index===sheets.length?index-1:index];that.activeSheet(newSheet)}else this.trigger("change",{recalc:!0,sheetSelection:!0})}_clearSheets(){for(let i=0;i<this._sheets.length;i++)this._sheets[i]._activeDrawing=[],this._sheets[i]._drawings=[],this._sheets[i].unbind();this._sheets=[],this._sheetsSearchCache={},this._names={},this._images={},this._imgID=0}_loadImages(){let self=this,ids=Object.keys(self._images),count=ids.length;function next(){--count<=0&&self.activeSheet().triggerChange({layout:!0})}count?ids.forEach((function(id){let img=self._images[id];img.blob||loadBinary(img.url,(function(data,type){null!=data&&(img.blob=new Blob([data],{type}),delete img.url),next()}))})):next()}fromJSON(json){if(json.sheets){this._clearSheets(),json.images&&(this._imgID=0,this._images={},Object.keys(json.images).forEach((function(id){if(!isNaN(id)){let num=parseFloat(id);isFinite(num)&&(this._imgID=Math.max(this._imgID,num))}this._images[id]={url:json.images[id]}}),this),this._loadImages());for(let idx=0;idx<json.sheets.length;idx++){let data=json.sheets[idx],args=sheetParamsFromJSON(data,this.options),sheet=this.insertSheet({rows:args.rowCount,columns:args.columnCount,rowHeight:args.rowHeight,columnWidth:args.columnWidth,headerHeight:args.headerHeight,headerWidth:args.headerWidth,data});data.dataSource&&sheet.setDataSource(data.dataSource)}}json.activeSheet?this.activeSheet(this.sheetByName(json.activeSheet)):this.activeSheet(this._sheets[0]),json.names&&json.names.forEach((function(def){this.defineName(def.name,def.value,def.hidden)}),this)}toJSON(){this.resetFormulas(),this.resetValidations();let names=Object.keys(this._names).map((function(name){let def=this._names[name],val=def.value;return val=val instanceof Ref||val instanceof calc.runtime.Formula?val.print(0,0,!0):val instanceof CalcError?String(val):JSON.stringify(val),{value:val,hidden:def.hidden,name:def.name,sheet:def.nameref.sheet,localName:def.nameref.name}}),this);return{activeSheet:this.activeSheet().name(),sheets:this._sheets.map((function(sheet){return sheet.recalc(this._context),sheet.revalidate(this._validationContext),sheet.toJSON()}),this),names,images:{},columnWidth:this.options.columnWidth,rowHeight:this.options.rowHeight}}saveJSON(){let self=this,data=self.toJSON(),ids=Object.keys(self._images).filter((function(id){return 1===self.usesImage(id)})),count=ids.length;const promises=[];return count&&ids.forEach((function(id){let img=self._images[id];if(img.blob){const promise=new Promise((resolve=>{let reader=new FileReader;reader.onload=function(){data.images[id]=reader.result,resolve()},reader.readAsDataURL(img.blob)}));promises.push(promise)}else data.images[id]=img.url})),Promise.all(promises).then((()=>data))}fromFile(file){file&&!this.trigger("excelImport",{file})&&(this._clearSheets(),readExcel(file,this))}saveAsExcel(options){let self=this;options=deepExtend({},self.options.excel,options);let data=self.toJSON();if(self.trigger("excelExport",{workbook:data}))return;let ids=Object.keys(self._images).filter((function(id){return 1===self.usesImage(id)})),count=ids.length,images=count?{}:null;function next(){if(--count<=0){data.images=images;let workbook=new options.Workbook(data);(options.forceProxy?workbook.toDataURL():workbook.toBlob()).then((blob=>{options.saveAs(blob,data.fileName||options.fileName,{proxyURL:options.proxyURL,forceProxy:options.forceProxy})}))}}count?ids.forEach((function(id){let img=self._images[id];if(img.blob){let reader=new FileReader;reader.onload=function(){images[id]={type:img.blob.type,name:img.blob.name,data:reader.result},next()},reader.readAsArrayBuffer(img.blob)}else loadBinary(img.url,(function(data,type){images[id]={type,data},next()}))})):next()}draw(options,callback){"function"!=typeof options||callback||(callback=options,options={});let parts=[],sheets=this._sheets;!function loop(i){if(i<sheets.length)sheets[i].draw(SHEETREF,options,(function(group){parts.push(group),loop(i+1)}));else{let group=parts[0];for(i=1;i<parts.length;++i)group.children=group.children.concat(parts[i].children);callback(group)}}(0)}nameForRef(ref,sheet){void 0===sheet&&(sheet=ref.sheet),sheet=sheet.toLowerCase();let str=String(ref);for(let name in this._names){let def=this._names[name],val=def.value;if(val instanceof Ref&&(!val.sheet||val.sheet&&sheet===val.sheet.toLowerCase())&&String(val)===str)return def}return{name:str}}defineName(name,value,hidden){let x=calc.parseNameDefinition(name,value);name=x.name.print(),this._names[name.toLowerCase()]={value:x.value,hidden,name,nameref:x.name}}undefineName(name){delete this._names[name.toLowerCase()]}nameValue(name){return(name=name.toLowerCase())in this._names?this._names[name].value:null}nameDefinition(name,def){return name=name.toLowerCase(),arguments.length>1&&(void 0===def?delete this._names[name]:this._names[name]=def),this._names[name]}forEachName(func){Object.keys(this._names).forEach((function(name){func(this._names[name],name)}),this)}adjustNames(affectedSheet,forRow,start,delta){affectedSheet=affectedSheet.toLowerCase(),Object.keys(this._names).forEach((function(name){let def=this._names[name],x=def.value;x instanceof Ref&&x.sheet.toLowerCase()===affectedSheet?def.value=x.adjust(null,null,null,null,forRow,start,delta):x instanceof calc.runtime.Formula&&x.adjust(affectedSheet,forRow?"row":"col",start,delta)}),this)}addImage(image){let id=String(++this._imgID);return this._images[id]="string"==typeof image?{url:image}:{blob:image},id}imageUrl(id){let img=this._images[id],url=img.url;return url||(url=img.url=window.URL.createObjectURL(img.blob)),url}cleanupImages(){Object.keys(this._images).forEach((function(id){if(!this.usesImage(id)){let url=this._images[id].url;url&&window.URL.revokeObjectURL(url),delete this._images[id]}}),this)}usesImage(img){let i,sheets=this._sheets;for(i=sheets.length;--i>=0;)if(sheets[i].usesImage(img))return 1;let stack=this.undoRedoStack.stack;for(i=stack.length;--i>=0;)if(stack[i].usesImage(img))return 2;return!1}}function sheetParamsFromJSON(data,options){function or(a,b,c){return void 0!==a?a:void 0!==b?b:c}let rowCount=or(data.rowCount,options.rows,200),columnCount=or(data.columnCount,options.columns,50),rowHeight=or(data.rowHeight,options.rowHeight,20),columnWidth=or(data.columnWidth,options.columnWidth,64),headerHeight=or(data.headerHeight,options.headerHeight,20),headerWidth=or(data.headerWidth,options.headerWidth,32);if(void 0!==data.rows)for(let i=0;i<data.rows.length;++i){let row=data.rows[i],ri=or(row.index,i);if(ri>=rowCount&&(rowCount=ri+1),row.cells)for(let j=0;j<row.cells.length;++j){let ci=or(row.cells[j].index,j);ci>=columnCount&&(columnCount=ci+1)}}return{rowCount,columnCount,rowHeight,columnWidth,headerHeight,headerWidth}}const events=["cut","copy","paste","pdfExport","excelExport","excelImport","changing","change","render","removeSheet","selectSheet","renameSheet","insertRow","insertColumn","deleteRow","insertSheet","deleteColumn","hideRow","hideColumn","unhideRow","unhideColumn","select","changeFormat","dataBinding","dataBound"];class SpreadsheetWidget extends Widget{constructor(element,options$1){super(element,deepExtend({},options,options$1)),this.events=events,this.bind(this.events,this.options),intl({locale:this.options.locale,...this.options.intl}),culture().calendar.months.format.wide.forEach((function(month,index){DynamicFilter.prototype[month.toLowerCase()]=function(value){return value instanceof Date&&value.getMonth()===index}})),this._view=new View(this.element,{messages:this.options.messages.view,toolbar:this.options.toolbar,sheetsbar:this.options.sheetsbar,formulaBarInputRef:this.options.formulaBarInputRef,formulaCellInputRef:this.options.formulaCellInputRef,nameBoxRef:this.options.nameBoxRef}),this._workbook=new Workbook(this.options,this._view),this._controller=new Controller(this._view,this._workbook),this._autoRefresh=!0,this._bindWorkbookEvents(),this._view.workbook(this._workbook),this._view.enableClipboard(!1),this.refresh(),this._view.enableClipboard(!0),this._resizeHandler=function(){this.resize()}.bind(this),window.addEventListener("resize",this._resizeHandler),this.element.addEventListener("keydown",this._keyDown.bind(this))}get view(){return this._view}get workbook(){return this._workbook}_keyDown(e){let key=e.keyCode;if(key===index_esm_keys.F11&&e.shiftKey)return this._view.sheetsbar._onAddSelect(),void e.preventDefault();if(e.altKey&&key===index_esm_keys.PAGEDOWN)this._view.sheetsbar.trigger("select",{name:this._view.sheetsbar._sheets[this._view.sheetsbar._selectedIndex+1].name(),isAddButton:!1});else if(e.altKey&&key===index_esm_keys.PAGEUP)this._view.sheetsbar.trigger("select",{name:this._view.sheetsbar._sheets[this._view.sheetsbar._selectedIndex-1].name(),isAddButton:!1});else{if(e.altKey&&key===index_esm_keys.DELETE){let closeCallback=function(e){e.sender.isConfirmed()&&this._view.sheetsbar.trigger("remove",{name:this.activeSheet()._name(),confirmation:!0})}.bind(this);return this._view.sheetsbar._openDialog("confirmation",{close:closeCallback}),void e.preventDefault()}if(e.altKey&&key===index_esm_keys.R)return this._view.sheetsbar._createEditor(),void e.preventDefault();if(e.ctrlKey&&key===index_esm_keys.B){const bold=this.element.querySelector("[data-tool=bold]");bold&&bold.click()}else if(e.ctrlKey&&key===index_esm_keys.I){const italic=this.element.querySelector("[data-tool=italic]");italic&&italic.click()}else if(e.ctrlKey&&key===index_esm_keys.U){const underline=this.element.querySelector("[data-tool=underline]");underline&&underline.click()}else{if(e.altKey&&key===index_esm_keys.H)return this._view.tabstrip.select(0),void e.preventDefault();if(e.altKey&&key===index_esm_keys.N)return this._view.tabstrip.select(1),void e.preventDefault();if(e.altKey&&key===index_esm_keys.A)return this._view.tabstrip.select(2),void e.preventDefault()}}}_resize(){this.refresh({layout:!0})}_workbookChanging(e){this.trigger("changing",e)&&e.preventDefault()}_workbookChange(e){if(this._autoRefresh&&this.refresh(e),e.recalc&&e.ref){let range=e.range||new Range$1(e.ref,this.activeSheet());this.trigger("change",{range})}}_workbookCut(e){this.trigger("cut",e)}_workbookCopy(e){this.trigger("copy",e)}_workbookPaste(e){this.trigger("paste",e)}activeSheet(sheet){return this._workbook.activeSheet(sheet)}moveSheetToIndex(sheet,index){return this._workbook.moveSheetToIndex(sheet,index)}insertSheet(options){return this._workbook.insertSheet(options)}sheets(){return this._workbook.sheets()}removeSheet(sheet){return this._workbook.removeSheet(sheet)}sheetByName(sheetName){return this._workbook.sheetByName(sheetName)}sheetIndex(sheet){return this._workbook.sheetIndex(sheet)}sheetByIndex(index){return this._workbook.sheetByIndex(index)}renameSheet(sheet,newSheetName){return this._workbook.renameSheet(sheet,newSheetName)}executeCommand(options){return this._controller.executeCommand(options)}refresh(reason){return reason||(reason=ALL_REASONS),reason.editorClose||(this._view.sheet(this._workbook.activeSheet()),this._controller.sheet(this._workbook.activeSheet()),this._workbook.refresh(reason)),reason.editorChange||(this._view.refresh(reason),this._controller.refresh(),this._view.render(reason),this.trigger("render")),this}openDialog(name,options){return this._view.openDialog(name,options)}autoRefresh(value){return void 0!==value?(this._autoRefresh=value,!0===value&&this.refresh(),this):this._autoRefresh}toJSON(){return this._workbook.toJSON()}fromJSON(json){json.sheets?(this._workbook.destroy(),this._workbook=new Workbook(deepExtend({},this.options,json)),this._bindWorkbookEvents(),this._view.workbook(this._workbook),this._controller.workbook(this._workbook),this.activeSheet(this.activeSheet())):this.refresh()}saveJSON(){return this._workbook.saveJSON()}fromFile(blob){return this._workbook.fromFile(blob)}saveAsPDF(options){this._workbook.saveAsPDF(deepExtend({},this.options.pdf,options,{workbook:this._workbook}))}saveAsExcel(options){this._workbook.saveAsExcel(options)}draw(options,callback){this._workbook.draw(options,callback)}_workbookExcelExport(e){this.trigger("excelExport",e)&&e.preventDefault()}_workbookExcelImport(e){this.trigger("excelImport",e)&&e.preventDefault()}_workbookPdfExport(e){this.trigger("pdfExport",e)&&e.preventDefault()}_workbookInsertSheet(e){this.trigger("insertSheet",e)&&e.preventDefault()}_workbookRemoveSheet(e){this.trigger("removeSheet",e)&&e.preventDefault()}_workbookSelectSheet(e){this.trigger("selectSheet",e)&&e.preventDefault()}_workbookRenameSheet(e){this.trigger("renameSheet",e)&&e.preventDefault()}_workbookInsertRow(e){this.trigger("insertRow",e)&&e.preventDefault()}_workbookInsertColumn(e){this.trigger("insertColumn",e)&&e.preventDefault()}_workbookDeleteRow(e){this.trigger("deleteRow",e)&&e.preventDefault()}_workbookDeleteColumn(e){this.trigger("deleteColumn",e)&&e.preventDefault()}_workbookHideRow(e){this.trigger("hideRow",e)&&e.preventDefault()}_workbookHideColumn(e){this.trigger("hideColumn",e)&&e.preventDefault()}_workbookUnhideRow(e){this.trigger("unhideRow",e)&&e.preventDefault()}_workbookUnhideColumn(e){this.trigger("unhideColumn",e)&&e.preventDefault()}_workbookSelect(e){this.trigger("select",e)}_workbookChangeFormat(e){this.trigger("changeFormat",e)}_workbookDataBinding(e){this.trigger("dataBinding",e)&&e.preventDefault()}_workbookDataBound(e){this.trigger("dataBound",e)}_workbookProgress(){}_bindWorkbookEvents(){this._workbook.bind("cut",this._workbookCut.bind(this)),this._workbook.bind("copy",this._workbookCopy.bind(this)),this._workbook.bind("paste",this._workbookPaste.bind(this)),this._workbook.bind("changing",this._workbookChanging.bind(this)),this._workbook.bind("change",this._workbookChange.bind(this)),this._workbook.bind("excelExport",this._workbookExcelExport.bind(this)),this._workbook.bind("excelImport",this._workbookExcelImport.bind(this)),this._workbook.bind("pdfExport",this._workbookPdfExport.bind(this)),this._workbook.bind("insertSheet",this._workbookInsertSheet.bind(this)),this._workbook.bind("removeSheet",this._workbookRemoveSheet.bind(this)),this._workbook.bind("selectSheet",this._workbookSelectSheet.bind(this)),this._workbook.bind("renameSheet",this._workbookRenameSheet.bind(this)),this._workbook.bind("insertRow",this._workbookInsertRow.bind(this)),this._workbook.bind("insertColumn",this._workbookInsertColumn.bind(this)),this._workbook.bind("deleteRow",this._workbookDeleteRow.bind(this)),this._workbook.bind("deleteColumn",this._workbookDeleteColumn.bind(this)),this._workbook.bind("hideRow",this._workbookHideRow.bind(this)),this._workbook.bind("hideColumn",this._workbookHideColumn.bind(this)),this._workbook.bind("unhideRow",this._workbookUnhideRow.bind(this)),this._workbook.bind("unhideColumn",this._workbookUnhideColumn.bind(this)),this._workbook.bind("select",this._workbookSelect.bind(this)),this._workbook.bind("changeFormat",this._workbookChangeFormat.bind(this)),this._workbook.bind("dataBinding",this._workbookDataBinding.bind(this)),this._workbook.bind("dataBound",this._workbookDataBound.bind(this)),this._workbook.bind("progress",this._workbookProgress.bind(this))}destroy(){this.unbind(),this._workbook.destroy(),this._controller.destroy(),this._view.destroy(),this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler)}defineName(name,value,hidden){return this._workbook.defineName(name,value,hidden)}undefineName(name){return this._workbook.undefineName(name)}nameValue(name){return this._workbook.nameValue(name)}forEachName(func){return this._workbook.forEachName(func)}cellContextMenu(){return this._view.cellContextMenu}rowHeaderContextMenu(){return this._view.rowHeaderContextMenu}colHeaderContextMenu(){return this._view.colHeaderContextMenu}addImage(image){return this._workbook.addImage(image)}cleanupImages(){return this._workbook.cleanupImages()}}var es_main=__webpack_require__("./node_modules/@progress/kendo-file-saver/dist/es/main.js");function map_map(array,func){return array.reduce(((result,el,i)=>{const val=func(el,i);return null!=val&&result.push(val),result}),[])}let current={toString:value=>value};const intl_service=class IntlService{static register(userImplementation){current=userImplementation}static toString(value,format){return current.toString(value,format)}};function time_dateToJulianDays(y,m,d){return(1461*(y+4800+((m-13)/12|0))/4|0)+(367*(m-1-12*((m-13)/12|0))/12|0)-(3*((y+4900+((m-13)/12|0))/100|0)/4|0)+d-32075}const time_BASE_DATE=time_dateToJulianDays(1900,0,-1);function time_dateToSerial(date){const time=function time_packTime(hh,mm,ss,ms){return(hh+(mm+(ss+ms/1e3)/60)/60)/24}(date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds()),serial=function time_packDate(year,month,date){return time_dateToJulianDays(year,month,date)-time_BASE_DATE}(date.getFullYear(),date.getMonth(),date.getDate());return serial<0?serial-1+time:serial+time}const MIME_TYPE="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",DATA_URL_PREFIX=`data:${MIME_TYPE};base64,`,DATA_URL_OPTIONS={compression:"DEFLATE",type:"base64"},BLOB_OPTIONS={compression:"DEFLATE",type:"blob"},ARRAYBUFFER_OPTIONS={compression:"DEFLATE",type:"arraybuffer"};function toDataURI(content){return DATA_URL_PREFIX+content}function indexOf(thing,array){return array.indexOf(thing)}const parseJSON=JSON.parse.bind(JSON);function ESC(val){return String(val).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;")}function ooxml_repeat(count,func){let str="";for(let i=0;i<count;++i)str+=func(i);return str}function foreach(arr,func){let str="";if(null!=arr)if(Array.isArray(arr))for(let i=0;i<arr.length;++i)str+=func(arr[i],i);else"object"==typeof arr&&Object.keys(arr).forEach(((key,i)=>{str+=func(arr[key],key,i)}));return str}const XMLHEAD='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r',RELS=`${XMLHEAD}\n            <Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n               <Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties" Target="docProps/app.xml"/>\n               <Relationship Id="rId2" Type="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties" Target="docProps/core.xml"/>\n               <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/>\n            </Relationships>`,WORKSHEET=({frozenColumns,frozenRows,columns,defaults,data,index,mergeCells,autoFilter,filter,showGridLines,hyperlinks,validations,defaultCellStyleId,rtl,legacyDrawing,drawing,lastRow,lastCol,hasDisabledCells})=>`${XMLHEAD}\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" mc:Ignorable="x14ac">\n   ${lastRow&&lastCol?`<dimension ref="A1:${ref(lastRow-1,lastCol-1)}" />`:""}\n\n   <sheetViews>\n     <sheetView ${rtl?'rightToLeft="1"':""} ${0===index?'tabSelected="1"':""} workbookViewId="0" ${!1===showGridLines?'showGridLines="0"':""}>\n     ${frozenRows||frozenColumns?`\n       <pane state="frozen"\n         ${frozenColumns?`xSplit="${frozenColumns}"`:""}\n         ${frozenRows?`ySplit="${frozenRows}"`:""}\n         topLeftCell="${String.fromCharCode(65+(frozenColumns||0))+((frozenRows||0)+1)}"\n       />`:""}\n     </sheetView>\n   </sheetViews>\n\n   <sheetFormatPr x14ac:dyDescent="0.25" ${defaults.skipCustomHeight?"":'customHeight="1"'} defaultRowHeight="${defaults.rowHeight?.75*defaults.rowHeight:15}"\n     ${defaults.columnWidth?`defaultColWidth="${toWidth(defaults.columnWidth)}"`:""} />\n\n   ${null!=defaultCellStyleId||columns&&columns.length>0?`\n     <cols>\n       ${columns&&columns.length?"":`\n         <col min="1" max="16384" style="${defaultCellStyleId}"\n              ${defaults.columnWidth?`width="${toWidth(defaults.columnWidth)}"`:""} /> `}\n       ${foreach(columns,((column,ci)=>{const columnIndex="number"==typeof column.index?column.index+1:ci+1;return 0===column.width?`<col ${null!=defaultCellStyleId?`style="${defaultCellStyleId}"`:""}\n                        min="${columnIndex}" max="${columnIndex}" hidden="1" customWidth="1" />`:`<col ${null!=defaultCellStyleId?`style="${defaultCellStyleId}"`:""}\n                      min="${columnIndex}" max="${columnIndex}" customWidth="1"\n                      ${column.autoWidth?`width="${(7*column.width+5)/7*256/256}" bestFit="1"`:`width="${toWidth(column.width)}"`} />`}))}\n     </cols>`:""}\n\n   <sheetData>\n     ${foreach(data,((row,ri)=>`\n         <row r="${"number"==typeof row.index?row.index+1:ri+1}" x14ac:dyDescent="0.25"\n              ${row.level?`outlineLevel="${row.level}"`:""}\n              ${0===row.height?'hidden="1"':row.height?`ht="${function toHeight(px){return.75*px}(row.height)}" customHeight="1"`:""}>\n           ${foreach(row.data,(cell=>`\n             <c r="${cell.ref}" ${cell.style?`s="${cell.style}"`:""} ${cell.type?`t="${cell.type}"`:""}>\n               ${null!=cell.formula?function writeFormula(formula){if("string"==typeof formula)return`<f>${ESC(formula)}</f>`;return`<f t="array" ref="${formula.ref}">${ESC(formula.src)}</f>`}(cell.formula):""}\n               ${null!=cell.value?`<v>${ESC(cell.value)}</v>`:""}\n             </c>`))}\n         </row>\n       `))}\n   </sheetData>\n\n   ${hasDisabledCells?'<sheetProtection sheet="1" objects="1" scenarios="1"/>':""}\n\n   ${autoFilter?`<autoFilter ref="${autoFilter.from}:${autoFilter.to}"/>`:filter?spreadsheetFilters(filter):""}\n\n   ${mergeCells.length?`\n     <mergeCells count="${mergeCells.length}">\n       ${foreach(mergeCells,(ref=>`<mergeCell ref="${ref}"/>`))}\n     </mergeCells>`:""}\n\n   ${validations.length?`\n     <dataValidations>\n       ${foreach(validations,(val=>`\n         <dataValidation sqref="${val.sqref.join(" ")}"\n                         showErrorMessage="${val.showErrorMessage}"\n                         type="${ESC(val.type)}"\n                         ${"list"!==val.type?`operator="${ESC(val.operator)}"`:""}\n                         allowBlank="${val.allowBlank}"\n                         showDropDown="${val.showDropDown}"\n                         ${val.error?`error="${ESC(val.error)}"`:""}\n                         ${val.errorTitle?`errorTitle="${ESC(val.errorTitle)}"`:""}>\n           ${val.formula1?`<formula1>${ESC(val.formula1)}</formula1>`:""}\n           ${val.formula2?`<formula2>${ESC(val.formula2)}</formula2>`:""}\n         </dataValidation>`))}\n     </dataValidations>`:""}\n\n   ${hyperlinks.length?`\n     <hyperlinks>\n       ${foreach(hyperlinks,(link=>`\n         <hyperlink ref="${link.ref}" r:id="${link.rId}"/>`))}\n     </hyperlinks>`:""}\n\n   <pageMargins left="0.7" right="0.7" top="0.75" bottom="0.75" header="0.3" footer="0.3" />\n   ${drawing?`<drawing r:id="${drawing}"/>`:""}\n   ${legacyDrawing?`<legacyDrawing r:id="${legacyDrawing}"/>`:""}\n</worksheet>`,DRAWINGS_RELS_XML=rels=>`${XMLHEAD}\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  ${foreach(rels,(rel=>`\n    <Relationship Id="${rel.rId}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/image" Target="${rel.target}"/>`))}\n</Relationships>`;function numChar(colIndex){const letter=Math.floor(colIndex/26)-1;return(letter>=0?numChar(letter):"")+String.fromCharCode(65+colIndex%26)}function ref(rowIndex,colIndex){return numChar(colIndex)+(rowIndex+1)}function $ref(rowIndex,colIndex){return"$"+numChar(colIndex)+"$"+(rowIndex+1)}function filterRowIndex(options){return(options.frozenRows||(options.freezePane||{}).rowSplit||1)-1}function toWidth(px){return px/7-Math.floor(128/7)/256}class Worksheet{constructor(options,sharedStrings,styles,borders){this.options=options,this._strings=sharedStrings,this._styles=styles,this._borders=borders,this._validations={},this._comments=[],this._drawings=options.drawings||[],this._hyperlinks=(this.options.hyperlinks||[]).map(((link,i)=>Object.assign({},link,{rId:`link${i}`})))}relsToXML(){const hyperlinks=this._hyperlinks,comments=this._comments,drawings=this._drawings;if(hyperlinks.length||comments.length||drawings.length)return(({hyperlinks,comments,sheetIndex,drawings})=>`${XMLHEAD}\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  ${foreach(hyperlinks,(link=>`\n    <Relationship Id="${link.rId}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink" Target="${ESC(link.target)}" TargetMode="External" />`))}\n  ${comments.length?`\n    <Relationship Id="comment${sheetIndex}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments" Target="../comments${sheetIndex}.xml"/>\n    <Relationship Id="vml${sheetIndex}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing" Target="../drawings/vmlDrawing${sheetIndex}.vml"/>`:""}\n  ${drawings.length?`\n    <Relationship Id="drw${sheetIndex}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing" Target="../drawings/drawing${sheetIndex}.xml"/>`:""}\n</Relationships>`)({hyperlinks,comments,sheetIndex:this.options.sheetIndex,drawings})}toXML(index){const mergeCells=this.options.mergedCells||[],data=function inflate(rows,mergedCells){const rowData=[],rowsByIndex=[];!function indexRows(rows,callback){for(let i=0;i<rows.length;i++){const row=rows[i];if(!row)continue;let index=row.index;"number"!=typeof index&&(index=i),callback(row,index)}}(rows,(function(row,index){const data={_source:row,index,height:row.height,level:row.level,cells:[]};rowData.push(data),rowsByIndex[index]=data}));const sorted=sortByIndex(rowData).slice(0),ctx={rowData,rowsByIndex,mergedCells};for(let i=0;i<sorted.length;i++)fillCells(sorted[i],ctx),delete sorted[i]._source;return sortByIndex(rowData)}(this.options.rows||[],mergeCells);this._readCells(data);let filter,autoFilter=this.options.filter;autoFilter&&"number"==typeof autoFilter.from&&"number"==typeof autoFilter.to?autoFilter={from:ref(filterRowIndex(this.options),autoFilter.from),to:ref(filterRowIndex(this.options),autoFilter.to)}:autoFilter&&autoFilter.ref&&autoFilter.columns&&(filter=autoFilter,autoFilter=null);const validations=[];for(let i in this._validations)Object.prototype.hasOwnProperty.call(this._validations,i)&&validations.push(this._validations[i]);let defaultCellStyleId=null,defaultCellStyle=this.options.defaultCellStyle;this._hasDisabledCells&&(defaultCellStyle=defaultCellStyle?Object.assign({disabled:!1},defaultCellStyle):{disabled:!1}),defaultCellStyle&&(defaultCellStyleId=this._lookupStyle(defaultCellStyle));const freezePane=this.options.freezePane||{},defaults=this.options.defaults||{},lastRow=this.options.rows?this._getLastRow():1,lastCol=this.options.rows?this._getLastCol():1;return WORKSHEET({frozenColumns:this.options.frozenColumns||freezePane.colSplit,frozenRows:this.options.frozenRows||freezePane.rowSplit,columns:this.options.columns,defaults,data,index,mergeCells,autoFilter,filter,showGridLines:this.options.showGridLines,hyperlinks:this._hyperlinks,validations,defaultCellStyleId,rtl:void 0!==this.options.rtl?this.options.rtl:defaults.rtl,legacyDrawing:this._comments.length?`vml${this.options.sheetIndex}`:null,drawing:this._drawings.length?`drw${this.options.sheetIndex}`:null,lastRow,lastCol,hasDisabledCells:this._hasDisabledCells})}commentsXML(){if(this._comments.length)return(({comments})=>`${XMLHEAD}\n<comments xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">\n  <authors>\n    <author></author>\n  </authors>\n  <commentList>\n    ${foreach(comments,(comment=>`\n      <comment ref="${comment.ref}" authorId="0">\n        <text>\n          <r>\n            <rPr>\n              <sz val="8"/>\n              <color indexed="81"/>\n              <rFont val="Tahoma"/>\n              <charset val="1"/>\n            </rPr>\n            <t>${ESC(comment.text)}</t>\n          </r>\n        </text>\n      </comment>`))}\n  </commentList>\n</comments>`)({comments:this._comments})}drawingsXML(images){if(this._drawings.length){let rels={},main=this._drawings.map((drw=>{let ref=parseRef(drw.topLeftCell),img=rels[drw.image];return img||(img=rels[drw.image]={rId:`img${drw.image}`,target:images[drw.image].target}),{col:ref.col,colOffset:pixelsToExcel(drw.offsetX),row:ref.row,rowOffset:pixelsToExcel(drw.offsetY),width:pixelsToExcel(drw.width),height:pixelsToExcel(drw.height),imageId:img.rId}}));return{main:(drawings=main,`${XMLHEAD}\n<xdr:wsDr xmlns:xdr="http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing"\n          xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main"\n          xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">\n  ${foreach(drawings,((drawing,index)=>`\n    <xdr:oneCellAnchor editAs="oneCell">\n      <xdr:from>\n        <xdr:col>${drawing.col}</xdr:col>\n        <xdr:colOff>${drawing.colOffset}</xdr:colOff>\n        <xdr:row>${drawing.row}</xdr:row>\n        <xdr:rowOff>${drawing.rowOffset}</xdr:rowOff>\n      </xdr:from>\n      <xdr:ext cx="${drawing.width}" cy="${drawing.height}" />\n      <xdr:pic>\n        <xdr:nvPicPr>\n          <xdr:cNvPr id="${index+1}" name="Picture ${index+1}"/>\n          <xdr:cNvPicPr/>\n        </xdr:nvPicPr>\n        <xdr:blipFill>\n          <a:blip r:embed="${drawing.imageId}"/>\n          <a:stretch>\n            <a:fillRect/>\n          </a:stretch>\n        </xdr:blipFill>\n        <xdr:spPr>\n          <a:prstGeom prst="rect">\n            <a:avLst/>\n          </a:prstGeom>\n        </xdr:spPr>\n      </xdr:pic>\n      <xdr:clientData/>\n    </xdr:oneCellAnchor>`))}\n</xdr:wsDr>`),rels:DRAWINGS_RELS_XML(rels)}}var drawings}legacyDrawing(){if(this._comments.length)return(({comments})=>`<xml xmlns:v="urn:schemas-microsoft-com:vml"\n     xmlns:o="urn:schemas-microsoft-com:office:office"\n     xmlns:x="urn:schemas-microsoft-com:office:excel">\n  <v:shapetype coordsize="21600,21600" id="_x0000_t202" path="m,l,21600r21600,l21600,xe">\n    <v:stroke joinstyle="miter"/>\n    <v:path gradientshapeok="t" o:connecttype="rect"/>\n  </v:shapetype>\n  ${foreach(comments,(comment=>`\n    <v:shape type="#_x0000_t202" style="visibility: hidden" fillcolor="#ffffe1" o:insetmode="auto">\n      <v:shadow on="t" color="black" obscured="t"/>\n      <x:ClientData ObjectType="Note">\n        <x:MoveWithCells/>\n        <x:SizeWithCells/>\n        <x:Anchor>${comment.anchor}</x:Anchor>\n        <x:AutoFill>False</x:AutoFill>\n        <x:Row>${comment.row}</x:Row>\n        <x:Column>${comment.col}</x:Column>\n      </x:ClientData>\n    </v:shape>`))}\n</xml>`)({comments:this._comments})}_lookupString(value){const key="$"+value,index=this._strings.indexes[key];let result;return void 0!==index?result=index:(result=this._strings.indexes[key]=this._strings.uniqueCount,this._strings.uniqueCount++),this._strings.count++,result}_lookupStyle(style){const json=JSON.stringify(style);if("{}"===json)return 0;let index=indexOf(json,this._styles);return index<0&&(index=this._styles.push(json)-1),index+1}_lookupBorder(border){const json=JSON.stringify(border);if("{}"===json)return;let index=indexOf(json,this._borders);return index<0&&(index=this._borders.push(json)-1),index+1}_readCells(rowData){for(let i=0;i<rowData.length;i++){const row=rowData[i],cells=row.cells;row.data=[];for(let j=0;j<cells.length;j++){const cellData=this._cell(cells[j],row.index,j);cellData&&row.data.push(cellData)}}}_cell(data,rowIndex,cellIndex){if(!data||data===EMPTY_CELL)return null;let value=data.value,border={};data.borderLeft&&(border.left=data.borderLeft),data.borderRight&&(border.right=data.borderRight),data.borderTop&&(border.top=data.borderTop),data.borderBottom&&(border.bottom=data.borderBottom),data.dBorders&&(border.diagonal=data.dBorders),border=this._lookupBorder(border);const defStyle=this.options.defaultCellStyle||{};let style={borderId:border};(add=>{add("color"),add("background"),add("bold"),add("italic"),add("underline"),add("fontFamily")||add("fontName","fontFamily"),add("fontSize"),add("format"),add("textAlign")||add("hAlign","textAlign"),add("verticalAlign")||add("vAlign","verticalAlign"),add("wrap"),add("indent"),add("disabled")||add("enable")&&(style.disabled=!style.enable,delete style.enable),style.disabled&&(this._hasDisabledCells=!0)})(((prop,target)=>{let val=data[prop];if(void 0===val&&(val=defStyle[prop]),void 0!==val)return style[target||prop]=val,!0}));const column=(this.options.columns||[])[cellIndex];let type=typeof value;if(column&&column.autoWidth&&(!data.colSpan||1===data.colSpan)){let displayValue=value;"number"===type&&(displayValue=intl_service.toString(value,data.format)),column.width=Math.max(column.width||0,String(displayValue).length)}"string"===type?(value=function stripFunnyChars(value){return String(value).replace(/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,"").replace(/\r?\n/g,"\r\n")}(value),value=this._lookupString(value),type="s"):"number"===type?type="n":"boolean"===type?(type="b",value=Number(value)):value&&value.getTime?(type=null,value=time_dateToSerial(value),style.format||(style.format="mm-dd-yy")):(type=null,value=null),style=this._lookupStyle(style);const cellName=ref(rowIndex,cellIndex);if(data.validation&&this._addValidation(data.validation,cellName),data.comment){let anchor=[cellIndex+1,15,rowIndex,10,cellIndex+3,15,rowIndex+3,4];this._comments.push({ref:cellName,text:data.comment,row:rowIndex,col:cellIndex,anchor:anchor.join(", ")})}return{value,formula:data.formula,type,style,ref:cellName}}_addValidation(v,ref){const tmp={showErrorMessage:"reject"===v.type?1:0,formula1:v.from,formula2:v.to,type:MAP_EXCEL_TYPE[v.dataType]||v.dataType,operator:ooxml_MAP_EXCEL_OPERATOR[v.comparerType]||v.comparerType,allowBlank:v.allowNulls?1:0,showDropDown:v.showButton?0:1,error:v.messageTemplate,errorTitle:v.titleTemplate},json=JSON.stringify(tmp);this._validations[json]||(this._validations[json]=tmp,tmp.sqref=[]),this._validations[json].sqref.push(ref)}_getLastRow(){return countData(this.options.rows)}_getLastCol(){let last=0;return this.options.rows.forEach((function(row){row.cells&&(last=Math.max(last,countData(row.cells)))})),last}}function countData(data){let last=data.length;return data.forEach((function(el){el.index&&el.index>=last&&(last=el.index+1)})),last}const ooxml_MAP_EXCEL_OPERATOR={greaterThanOrEqualTo:"greaterThanOrEqual",lessThanOrEqualTo:"lessThanOrEqual"},MAP_EXCEL_TYPE={number:"decimal"},defaultFormats={General:0,0:1,"0.00":2,"#,##0":3,"#,##0.00":4,"0%":9,"0.00%":10,"0.00E+00":11,"# ?/?":12,"# ??/??":13,"mm-dd-yy":14,"d-mmm-yy":15,"d-mmm":16,"mmm-yy":17,"h:mm AM/PM":18,"h:mm:ss AM/PM":19,"h:mm":20,"h:mm:ss":21,"m/d/yy h:mm":22,"#,##0 ;(#,##0)":37,"#,##0 ;[Red](#,##0)":38,"#,##0.00;(#,##0.00)":39,"#,##0.00;[Red](#,##0.00)":40,"mm:ss":45,"[h]:mm:ss":46,"mmss.0":47,"##0.0E+0":48,"@":49,"[$-404]e/m/d":27,"m/d/yy":30,t0:59,"t0.00":60,"t#,##0":61,"t#,##0.00":62,"t0%":67,"t0.00%":68,"t# ?/?":69,"t# ??/??":70};function convertColor(value){let color=function maybeRGB(value){function hex(val){let x=parseInt(val,10).toString(16);return x.length<2?"0"+x:x}let m=/^rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([0-9.]+)\s*)?\)/i.exec(value.trim());if(m)return"#"+hex(255*(m[4]?parseFloat(m[4]):1)|0)+hex(m[1])+hex(m[2])+hex(m[3]);return value}(value);return color.length<6&&(color=color.replace(/(\w)/g,(function($0,$1){return $1+$1}))),color=color.substring(1).toUpperCase(),color.length<8&&(color="FF"+color),color}class ooxml_Workbook{constructor(options){this.options=options||{},this._strings={indexes:{},count:0,uniqueCount:0},this._styles=[],this._borders=[],this._images=this.options.images,this._imgId=0,this._sheets=map_map(this.options.sheets||[],((options,i)=>(options.defaults=this.options,options.sheetIndex=i+1,new Worksheet(options,this._strings,this._styles,this._borders))))}imageFilename(mimeType){const id=++this._imgId;switch(mimeType){case"image/jpg":case"image/jpeg":return`image${id}.jpg`;case"image/png":return`image${id}.png`;case"image/gif":return`image${id}.gif`;default:return`image${id}.bin`}}toZIP(){const zip=function createZip(){return new JSZip}(),docProps=zip.folder("docProps");docProps.file("core.xml",(({creator,lastModifiedBy,created,modified})=>`${XMLHEAD}\n <cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties"\n   xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/"\n   xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n   <dc:creator>${ESC(creator)}</dc:creator>\n   <cp:lastModifiedBy>${ESC(lastModifiedBy)}</cp:lastModifiedBy>\n   <dcterms:created xsi:type="dcterms:W3CDTF">${ESC(created)}</dcterms:created>\n   <dcterms:modified xsi:type="dcterms:W3CDTF">${ESC(modified)}</dcterms:modified>\n</cp:coreProperties>`)({creator:this.options.creator||"Kendo UI",lastModifiedBy:this.options.creator||"Kendo UI",created:this.options.date||(new Date).toJSON(),modified:this.options.date||(new Date).toJSON()}));const sheetCount=this._sheets.length;docProps.file("app.xml",(({sheets})=>`${XMLHEAD}\n<Properties xmlns="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties" xmlns:vt="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes">\n  <Application>Microsoft Excel</Application>\n  <DocSecurity>0</DocSecurity>\n  <ScaleCrop>false</ScaleCrop>\n  <HeadingPairs>\n    <vt:vector size="2" baseType="variant">\n      <vt:variant>\n        <vt:lpstr>Worksheets</vt:lpstr>\n      </vt:variant>\n      <vt:variant>\n        <vt:i4>${sheets.length}</vt:i4>\n      </vt:variant>\n    </vt:vector>\n  </HeadingPairs>\n  <TitlesOfParts>\n    <vt:vector size="${sheets.length}" baseType="lpstr">${foreach(sheets,((sheet,i)=>sheet.options.title?`<vt:lpstr>${ESC(sheet.options.title)}</vt:lpstr>`:`<vt:lpstr>Sheet${i+1}</vt:lpstr>`))}</vt:vector>\n  </TitlesOfParts>\n  <LinksUpToDate>false</LinksUpToDate>\n  <SharedDoc>false</SharedDoc>\n  <HyperlinksChanged>false</HyperlinksChanged>\n  <AppVersion>14.0300</AppVersion>\n</Properties>`)({sheets:this._sheets}));zip.folder("_rels").file(".rels",RELS);const xl=zip.folder("xl");if(xl.folder("_rels").file("workbook.xml.rels",(({count})=>`${XMLHEAD}\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  ${ooxml_repeat(count,(idx=>`\n    <Relationship Id="rId${idx+1}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet${idx+1}.xml" />`))}\n  <Relationship Id="rId${count+1}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml" />\n  <Relationship Id="rId${count+2}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings" Target="sharedStrings.xml" />\n</Relationships>`)({count:sheetCount})),this._images){const media=xl.folder("media");Object.keys(this._images).forEach((id=>{const img=this._images[id],filename=this.imageFilename(img.type);media.file(filename,img.data),img.target=`../media/${filename}`}))}const sheetIds={};xl.file("workbook.xml",(({sheets,filterNames,userNames})=>`${XMLHEAD}\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">\n  <fileVersion appName="xl" lastEdited="5" lowestEdited="5" rupBuild="9303" />\n  <workbookPr defaultThemeVersion="124226" />\n  <bookViews>\n    <workbookView xWindow="240" yWindow="45" windowWidth="18195" windowHeight="7995" />\n  </bookViews>\n  <sheets>\n  ${foreach(sheets,(({options},i)=>{const name=options.name||options.title||`Sheet${i+1}`,state=options.state||"visible";return`<sheet name="${ESC(name)}" state="${state}" sheetId="${i+1}" r:id="rId${i+1}" />`}))}\n  </sheets>\n  ${filterNames.length||userNames.length?`\n    <definedNames>\n      ${foreach(filterNames,(f=>`\n         <definedName name="_xlnm._FilterDatabase" hidden="1" localSheetId="${f.localSheetId}">${ESC(function quoteSheet(name){return/^\'/.test(name)||/^[a-z_][a-z0-9_]*$/i.test(name)?name:"'"+name.replace(/\x27/g,"\\'")+"'"}(f.name))}!${ESC(f.from)}:${ESC(f.to)}</definedName>`))}\n      ${foreach(userNames,(f=>`\n         <definedName name="${f.name}" hidden="${f.hidden?1:0}" ${null!=f.localSheetId?`localSheetId="${f.localSheetId}"`:""}>${ESC(f.value)}</definedName>`))}\n    </definedNames>`:""}\n  <calcPr fullCalcOnLoad="1" calcId="145621" />\n</workbook>`)({sheets:this._sheets,filterNames:map_map(this._sheets,(function(sheet,index){const options=sheet.options,sheetName=options.name||options.title||"Sheet"+(index+1);sheetIds[sheetName.toLowerCase()]=index;const filter=options.filter;if(filter){if(filter.ref){let a=filter.ref.split(":"),from=parseRef(a[0]),to=parseRef(a[1]);return{localSheetId:index,name:sheetName,from:$ref(from.row,from.col),to:$ref(to.row,to.col)}}if(void 0!==filter.from&&void 0!==filter.to)return{localSheetId:index,name:sheetName,from:$ref(filterRowIndex(options),filter.from),to:$ref(filterRowIndex(options),filter.to)}}})),userNames:map_map(this.options.names||[],(function(def){return{name:def.localName,localSheetId:def.sheet?sheetIds[def.sheet.toLowerCase()]:null,value:def.value,hidden:def.hidden}}))}));const worksheets=xl.folder("worksheets"),drawings=xl.folder("drawings"),drawingsRels=drawings.folder("_rels"),sheetRels=worksheets.folder("_rels"),commentFiles=[],drawingFiles=[];let hasDisabledCells=!1;for(let idx=0;idx<sheetCount;idx++){const sheet=this._sheets[idx],sheetName=`sheet${idx+1}.xml`,sheetXML=sheet.toXML(idx),relsXML=sheet.relsToXML(),commentsXML=sheet.commentsXML(),legacyDrawing=sheet.legacyDrawing(),drawingsXML=sheet.drawingsXML(this._images);if(sheet._hasDisabledCells&&(hasDisabledCells=!0),relsXML&&sheetRels.file(sheetName+".rels",relsXML),commentsXML){let name=`comments${sheet.options.sheetIndex}.xml`;xl.file(name,commentsXML),commentFiles.push(name)}if(legacyDrawing&&drawings.file(`vmlDrawing${sheet.options.sheetIndex}.vml`,legacyDrawing),drawingsXML){let name=`drawing${sheet.options.sheetIndex}.xml`;drawings.file(name,drawingsXML.main),drawingsRels.file(`${name}.rels`,drawingsXML.rels),drawingFiles.push(name)}worksheets.file(sheetName,sheetXML)}const borders=map_map(this._borders,parseJSON),styles=map_map(this._styles,parseJSON),hasFont=function(style){return style.underline||style.bold||style.italic||style.color||style.fontFamily||style.fontSize},fonts=map_map(styles,(function(style){if(style.fontSize&&(style.fontSize=function(value){let fontInPt,fontInPx=Number(value);return fontInPx&&(fontInPt=3*fontInPx/4),fontInPt}(style.fontSize)),style.color&&(style.color=convertColor(style.color)),hasFont(style))return style})),formats=map_map(styles,(function(style){if(style.format&&void 0===defaultFormats[style.format])return style})),fills=map_map(styles,(function(style){if(style.background)return style.background=convertColor(style.background),style}));return xl.file("styles.xml",(({formats,fonts,fills,borders,styles})=>`${XMLHEAD}\n<styleSheet\n    xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"\n    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n    mc:Ignorable="x14ac"\n    xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac">\n  <numFmts count="${formats.length}">\n  ${foreach(formats,((format,fi)=>`\n    <numFmt formatCode="${ESC(format.format)}" numFmtId="${165+fi}" />`))}\n  </numFmts>\n  <fonts count="${fonts.length+1}" x14ac:knownFonts="1">\n    <font>\n       <sz val="11" />\n       <color theme="1" />\n       <name val="Calibri" />\n       <family val="2" />\n       <scheme val="minor" />\n    </font>\n    ${foreach(fonts,(font=>`\n    <font>\n      ${font.bold?"<b/>":""}\n      ${font.italic?"<i/>":""}\n      ${font.underline?"<u/>":""}\n      <sz val="${font.fontSize||11}" />\n      ${font.color?`<color rgb="${ESC(font.color)}" />`:'<color theme="1" />'}\n      ${font.fontFamily?`\n        <name val="${ESC(font.fontFamily)}" />\n        <family val="2" />\n      `:'\n        <name val="Calibri" />\n        <family val="2" />\n        <scheme val="minor" />\n      '}\n    </font>`))}\n  </fonts>\n  <fills count="${fills.length+2}">\n      <fill><patternFill patternType="none"/></fill>\n      <fill><patternFill patternType="gray125"/></fill>\n    ${foreach(fills,(fill=>"\n      "+(fill.background?`\n        <fill>\n          <patternFill patternType="solid">\n              <fgColor rgb="${ESC(fill.background)}"/>\n          </patternFill>\n        </fill>\n      `:"")))}\n  </fills>\n  <borders count="${borders.length+1}">\n    <border><left/><right/><top/><bottom/><diagonal/></border>\n    ${foreach(borders,borderTemplate)}\n  </borders>\n  <cellStyleXfs count="1">\n    <xf borderId="0" fillId="0" fontId="0" />\n  </cellStyleXfs>\n  <cellXfs count="${styles.length+1}">\n    <xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" />\n    ${foreach(styles,(style=>`\n      <xf xfId="0"\n          ${style.fontId?`fontId="${style.fontId}" applyFont="1"`:""}\n          ${style.fillId?`fillId="${style.fillId}" applyFill="1"`:""}\n          ${style.numFmtId?`numFmtId="${style.numFmtId}" applyNumberFormat="1"`:""}\n          ${style.textAlign||style.verticalAlign||style.wrap?'applyAlignment="1"':""}\n          ${style.borderId?`borderId="${style.borderId}" applyBorder="1"`:""}\n          ${null!=style.disabled?'applyProtection="1"':""}>\n        ${style.textAlign||style.verticalAlign||style.wrap?`\n        <alignment\n          ${style.textAlign?`horizontal="${ESC(style.textAlign)}"`:""}\n          ${style.verticalAlign?`vertical="${ESC(style.verticalAlign)}"`:""}\n          ${style.indent?`indent="${ESC(style.indent)}"`:""}\n          ${style.wrap?'wrapText="1"':""} />\n        `:""}\n        ${null!=style.disabled?`\n        <protection locked="${style.disabled?1:0}" />\n        `:""}\n      </xf>\n    `))}\n  </cellXfs>\n  <cellStyles count="1">\n    <cellStyle name="Normal" xfId="0" builtinId="0"/>\n  </cellStyles>\n  <dxfs count="0" />\n  <tableStyles count="0" defaultTableStyle="TableStyleMedium2" defaultPivotStyle="PivotStyleMedium9" />\n</styleSheet>`)({fonts,fills,formats,borders,styles:map_map(styles,(function(style){const result={};return hasFont(style)&&(result.fontId=indexOf(style,fonts)+1),style.background&&(result.fillId=indexOf(style,fills)+2),result.textAlign=style.textAlign,result.indent=style.indent,result.verticalAlign=style.verticalAlign,result.wrap=style.wrap,result.borderId=style.borderId,style.format&&(void 0!==defaultFormats[style.format]?result.numFmtId=defaultFormats[style.format]:result.numFmtId=165+indexOf(style,formats)),hasDisabledCells&&(result.disabled=!!style.disabled),result}))})),xl.file("sharedStrings.xml",(({count,uniqueCount,indexes})=>`${XMLHEAD}\n<sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" count="${count}" uniqueCount="${uniqueCount}">\n  ${foreach(Object.keys(indexes),(index=>`\n    <si><t xml:space="preserve">${ESC(index.substring(1))}</t></si>`))}\n</sst>`)(this._strings)),zip.file("[Content_Types].xml",(({sheetCount,commentFiles,drawingFiles})=>`${XMLHEAD}\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n  <Default Extension="png" ContentType="image/png"/>\n  <Default Extension="gif" ContentType="image/gif"/>\n  <Default Extension="jpg" ContentType="image/jpeg"/>\n  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />\n  <Default Extension="xml" ContentType="application/xml" />\n  <Default Extension="vml" ContentType="application/vnd.openxmlformats-officedocument.vmlDrawing"/>\n  <Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml" />\n  <Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"/>\n  <Override PartName="/xl/sharedStrings.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"/>\n  ${ooxml_repeat(sheetCount,(idx=>`<Override PartName="/xl/worksheets/sheet${idx+1}.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml" />`))}\n  ${foreach(commentFiles,(filename=>`<Override PartName="/xl/${filename}" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml"/>`))}\n  ${foreach(drawingFiles,(filename=>`<Override PartName="/xl/drawings/${filename}" ContentType="application/vnd.openxmlformats-officedocument.drawing+xml"/>`))}\n  <Override PartName="/docProps/core.xml" ContentType="application/vnd.openxmlformats-package.core-properties+xml" />\n  <Override PartName="/docProps/app.xml" ContentType="application/vnd.openxmlformats-officedocument.extended-properties+xml" />\n</Types>`)({sheetCount,commentFiles,drawingFiles})),zip}toDataURL(){const zip=this.toZIP();return zip.generateAsync?zip.generateAsync(DATA_URL_OPTIONS).then(toDataURI):toDataURI(zip.generate(DATA_URL_OPTIONS))}toBlob(){const zip=this.toZIP();return zip.generateAsync?zip.generateAsync(BLOB_OPTIONS):new Blob([zip.generate(ARRAYBUFFER_OPTIONS)],{type:MIME_TYPE})}}function borderSideTemplate(name,style){let result="";return style&&(result+="<"+name+' style="'+function borderStyle(width){let alias="thin";return 2===width?alias="medium":3===width&&(alias="thick"),alias}(style.size)+'">',style.color&&(result+='<color rgb="'+convertColor(style.color)+'"/>'),result+="</"+name+">"),result}function borderTemplate(border){let diag=border.diagonal?border.diagonal.type:0;return`<border ${2&diag?'diagonalUp="true"':""} ${1&diag?'diagonalDown="true"':""}>\n      ${borderSideTemplate("left",border.left)}\n      ${borderSideTemplate("right",border.right)}\n      ${borderSideTemplate("top",border.top)}\n      ${borderSideTemplate("bottom",border.bottom)}\n      ${borderSideTemplate("diagonal",border.diagonal)}\n    </border>`}const EMPTY_CELL={};function sortByIndex(items){return items.sort((function(a,b){return a.index-b.index}))}function getSpan(mergedCells,ref){for(let i=0;i<mergedCells.length;++i){const a=mergedCells[i].split(":");let topLeft=a[0];if(topLeft===ref){let bottomRight=a[1];return topLeft=parseRef(topLeft),bottomRight=parseRef(bottomRight),{rowSpan:bottomRight.row-topLeft.row+1,colSpan:bottomRight.col-topLeft.col+1}}}}function parseRef(ref){const m=/^([a-z]+)(\d+)$/i.exec(ref);return{row:function getrow(str){return parseInt(str,10)-1}(m[2]),col:function getcol(str){let upperStr=str.toUpperCase(),col=0;for(let i=0;i<upperStr.length;++i)col=26*col+upperStr.charCodeAt(i)-64;return col-1}(m[1])}}function pixelsToExcel(px){return Math.round(9525*px)}function fillCells(data,ctx){const row=data._source,rowIndex=data.index,cells=row.cells,cellData=data.cells;var array,el;if(cells)for(let i=0;i<cells.length;i++){const cell=cells[i]||EMPTY_CELL;let rowSpan=cell.rowSpan||1,colSpan=cell.colSpan||1;const cellIndex=insertCell(cellData,cell),topLeftRef=ref(rowIndex,cellIndex);if(1===rowSpan&&1===colSpan){const tmp=getSpan(ctx.mergedCells,topLeftRef);tmp&&(colSpan=tmp.colSpan,rowSpan=tmp.rowSpan)}if(spanCell(cell,cellData,cellIndex,colSpan),(rowSpan>1||colSpan>1)&&(array=ctx.mergedCells,el=topLeftRef+":"+ref(rowIndex+rowSpan-1,cellIndex+colSpan-1),array.indexOf(el)<0&&array.push(el)),rowSpan>1)for(let ri=rowIndex+1;ri<rowIndex+rowSpan;ri++){let nextRow=ctx.rowsByIndex[ri];nextRow||(nextRow=ctx.rowsByIndex[ri]={index:ri,cells:[]},ctx.rowData.push(nextRow)),spanCell(cell,nextRow.cells,cellIndex-1,colSpan+1)}}}function insertCell(data,cell){let index;return"number"==typeof cell.index?(index=cell.index,insertCellAt(data,cell,cell.index)):index=function appendCell(data,cell){let index=data.length;for(let i=0;i<data.length+1;i++)if(!data[i]){data[i]=cell,index=i;break}return index}(data,cell),index}function insertCellAt(data,cell,index){data[index]=cell}function spanCell(cell,row,startIndex,colSpan){for(let i=1;i<colSpan;i++){insertCellAt(row,{borderTop:cell.borderTop,borderRight:cell.borderRight,borderBottom:cell.borderBottom,borderLeft:cell.borderLeft},startIndex+i)}}const SPREADSHEET_FILTERS=({ref,columns,generators})=>`\n<autoFilter ref="${ref}">\n  ${foreach(columns,(col=>`\n    <filterColumn colId="${col.index}">\n      ${generators[col.filter](col)}\n    </filterColumn>\n  `))}\n</autoFilter>`,SPREADSHEET_CUSTOM_FILTER=({logic,criteria})=>`\n<customFilters ${"and"===logic?'and="1"':""}>\n${foreach(criteria,(f=>{let op=spreadsheetFilters.customOperator(f);return`<customFilter ${op?`operator="${op}"`:""} val="${spreadsheetFilters.customValue(f)}"/>`}))}\n</customFilters>`,SPREADSHEET_DYNAMIC_FILTER=({type})=>`<dynamicFilter type="${spreadsheetFilters.dynamicFilterType(type)}" />`,SPREADSHEET_TOP_FILTER=({type,value})=>`<top10 percent="${/percent$/i.test(type)?1:0}"\n       top="${/^top/i.test(type)?1:0}"\n       val="${value}" />`,SPREADSHEET_VALUE_FILTER=({blanks,values})=>`<filters ${blanks?'blank="1"':""}>\n    ${foreach(values,(value=>`\n      <filter val="${value}" />`))}\n  </filters>`;function spreadsheetFilters(filter){return SPREADSHEET_FILTERS({ref:filter.ref,columns:filter.columns,generators:{custom:SPREADSHEET_CUSTOM_FILTER,dynamic:SPREADSHEET_DYNAMIC_FILTER,top:SPREADSHEET_TOP_FILTER,value:SPREADSHEET_VALUE_FILTER}})}spreadsheetFilters.customOperator=function(f){return{eq:"equal",gt:"greaterThan",gte:"greaterThanOrEqual",lt:"lessThan",lte:"lessThanOrEqual",ne:"notEqual",doesnotstartwith:"notEqual",doesnotendwith:"notEqual",doesnotcontain:"notEqual",doesnotmatch:"notEqual"}[f.operator.toLowerCase()]},spreadsheetFilters.customValue=function(f){function esc(str){return str.replace(/([*?])/g,"~$1")}switch(f.operator.toLowerCase()){case"startswith":case"doesnotstartwith":return esc(f.value)+"*";case"endswith":case"doesnotendwith":return"*"+esc(f.value);case"contains":case"doesnotcontain":return"*"+esc(f.value)+"*";default:return f.value}},spreadsheetFilters.dynamicFilterType=function(type){return{quarter1:"Q1",quarter2:"Q2",quarter3:"Q3",quarter4:"Q4",january:"M1",february:"M2",march:"M3",april:"M4",may:"M5",june:"M6",july:"M7",august:"M8",september:"M9",october:"M10",november:"M11",december:"M12"}[type.toLowerCase()]||type};const ExcelExport=props=>{const{spreadsheetRef}=props,onDownload=react.useCallback((()=>{spreadsheetRef.current&&spreadsheetRef.current.saveAsExcel(Object.assign(Object.assign({},spreadsheetRef.current.options.excel),{saveAs:es_main.U,Workbook:ooxml_Workbook}))}),[]);return react.createElement(Button.$,{className:"k-toolbar-button",title:"Export...",icon:"download",fillMode:"flat",svgIcon:index_es.downloadIcon,onClick:onDownload})};ExcelExport.displayName="ExcelExport";var Upload=__webpack_require__("./node_modules/@progress/kendo-react-upload/dist/es/Upload.js");const Open=props=>{const{spreadsheetRef}=props,onFileOpen=react.useCallback((event=>{const targetEl=event.target;if(targetEl instanceof Element&&targetEl.parentNode){const toolbarEl=targetEl.closest(".k-toolbar"),input=toolbarEl&&toolbarEl.querySelector(".k-upload input");input&&input.click()}}),[]),onAdd=react.useCallback((event=>{const fileInfo=event.newState;if(fileInfo[0]&&fileInfo[0].getRawFile){const file=fileInfo[0].getRawFile();spreadsheetRef.current&&spreadsheetRef.current.executeCommand({command:"OpenCommand",options:{file}})}}),[]);return react.createElement(react.Fragment,null,react.createElement(Button.$,{className:"k-toolbar-button",title:(0,useLocalization.B)().toLanguageString(keys.open,messages[keys.open]),icon:"folder-open",svgIcon:index_es.folderOpenIcon,fillMode:"flat",onClick:onFileOpen}),react.createElement("div",{style:{display:"none"}},react.createElement(Upload._,{restrictions:{allowedExtensions:[".xlsx"]},onAdd,autoUpload:!1,defaultFiles:[],multiple:!1,accept:".xlsx,.XLSX",withCredentials:!1})))};Open.displayName="Open";var ColorPicker=__webpack_require__("./node_modules/@progress/kendo-react-inputs/dist/es/colors/ColorPicker.js"),utils_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const FONT_FAMILIES=["Arial","Courier New","Georgia","Times New Roman","Trebuchet MS","Verdana"],FONT_SIZES=[8,9,10,11,12,13,14,16,18,20,22,24,26,28,36,48,72],FORMATS=[{text:"Automatic",value:null},{text:"Text",value:"@"},{text:"Number",value:"#,0.00"},{text:"Percent",value:"0.00%"},{text:"Financial",value:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)'},{text:"Currency",value:"$#,##0.00;[Red]$#,##0.00"},{text:"Date",value:"m/d/yyyy"},{text:"Time",value:"h:mm:ss AM/PM"},{text:"Date time",value:"m/d/yyyy h:mm"},{text:"Duration",value:"[h]:mm:ss"}],PropertyChangeTool=settings=>props=>{const{property,icon,svgIcon,titleKey}=settings,{spreadsheetRef,value:selected}=props,onClick=react.useCallback((()=>{if(spreadsheetRef.current){const options={command:"PropertyChangeCommand",options:{property,value:!selected}};spreadsheetRef.current.executeCommand(options)}}),[selected]);return react.createElement(Button.$,{type:"button",icon,svgIcon,fillMode:"flat",togglable:!0,onClick,selected,title:(0,useLocalization.B)().toLanguageString(titleKey,messages[titleKey])})},ColorTool=settings=>props=>{const{property,titleKey}=settings,colorPickerProps=utils_rest(settings,["property","titleKey"]),{spreadsheetRef,value}=props,onChange=react.useCallback((event=>{if(spreadsheetRef.current){const options={command:"PropertyChangeCommand",options:{property,value:event.value||null}};spreadsheetRef.current.executeCommand(options)}}),[property]);return react.createElement(ColorPicker.s,Object.assign({onChange,onActiveColorClick:onChange,fillMode:"flat"},colorPickerProps,{title:(0,useLocalization.B)().toLanguageString(titleKey,messages[titleKey]),value}))},UndoRedo=settings=>props=>{const{spreadsheetRef}=props,onClick=react.useCallback((()=>{if(spreadsheetRef.current){spreadsheetRef.current.workbook.undoRedoStack[settings.action]()}}),[]);return react.createElement(Button.$,{type:"button",icon:settings.icon,svgIcon:settings.svgIcon,fillMode:"flat",title:(0,useLocalization.B)().toLanguageString(settings.titleKey,messages[settings.titleKey]),onClick})},Bold=PropertyChangeTool({property:"bold",icon:"bold",svgIcon:index_es.boldIcon,titleKey:keys.bold});Bold.displayName="Bold";const Italic=PropertyChangeTool({property:"italic",icon:"italic",svgIcon:index_es.italicIcon,titleKey:keys.italic});Italic.displayName="Italic";const Underline=PropertyChangeTool({property:"underline",icon:"underline",svgIcon:index_es.underlineIcon,titleKey:keys.underline});Underline.displayName="Underline";var DropDownList=__webpack_require__("./node_modules/@progress/kendo-react-dropdowns/dist/es/DropDownList/DropDownList.js");const FontFamily=props=>{const{spreadsheetRef,value}=props,onChange=react.useCallback((event=>{if(spreadsheetRef.current){const options={command:"PropertyChangeCommand",options:{property:"fontFamily",value:event.value||null}};spreadsheetRef.current.executeCommand(options)}}),[]);return react.createElement(DropDownList.O8,{onChange,value,data:FONT_FAMILIES,defaultValue:"Arial",fillMode:"flat",title:(0,useLocalization.B)().toLanguageString(keys.fontName,messages[keys.fontName]),leftRightKeysNavigation:!1})};FontFamily.displayName="FontFamily";const toNumber=value=>"string"==typeof value?parseFloat(value):value,FontSize=props=>{const{spreadsheetRef}=props,value=toNumber(props.value),onChange=react.useCallback((event=>{var _a;let nextValue=event.value?toNumber(event.value):value;nextValue=isNaN(nextValue)?value:nextValue,nextValue=Math.min(409,Math.max(1,nextValue));const options={command:"PropertyChangeCommand",options:{property:"fontSize",value:nextValue}};"keydown"===event.nativeEvent.type||"focusout"===event.nativeEvent.type?null===(_a=spreadsheetRef.current)||void 0===_a||_a.executeCommand(options):setTimeout((()=>{var _a;null===(_a=spreadsheetRef.current)||void 0===_a||_a.executeCommand(options)}),0)}),[value]);return react.createElement(ComboBox.a3,{onChange,value,data:FONT_SIZES,defaultValue:12,allowCustom:!0,fillMode:"flat",title:(0,useLocalization.B)().toLanguageString(keys.fontSize,messages[keys.fontSize]),tabIndex:-1,clearButton:!1})};FontSize.displayName="FontSize";const fontSizeChangeTool=settings=>{const tool=props=>{const{property,icon,svgIcon,titleKey,step}=settings,{spreadsheetRef}=props,value=toNumber(props.value),onClick=react.useCallback((()=>{var _a;const options={command:"PropertyChangeCommand",options:{property,value:Math.min(409,Math.max(1,value+step))}};null===(_a=spreadsheetRef.current)||void 0===_a||_a.executeCommand(options)}),[value]);return react.createElement(Button.$,{type:"button",icon,svgIcon,fillMode:"flat",onClick,disabled:value+step<1||value+step>409,title:(0,useLocalization.B)().toLanguageString(titleKey,messages[titleKey])})};return tool.displayName=settings.displayName,tool},IncreaseFontSize=fontSizeChangeTool({property:"fontSize",icon:"font-grow",svgIcon:index_es.fontGrowIcon,titleKey:keys.fontSizeIncrease,displayName:"IncreaseFontSize",step:1}),DecreaseFontSize=fontSizeChangeTool({property:"fontSize",icon:"font-shrink",svgIcon:index_es.fontShrinkIcon,titleKey:keys.fontSizeDecrease,displayName:"DecreaseFontSize",step:-1}),TextColor=ColorTool({icon:"foreground-color",svgIcon:index_es.foregroundColorIcon,view:"palette",property:"color",titleKey:keys.textColor,ariaLabel:"Text Color"});TextColor.displayName="TextColor";const BackgroundColor=ColorTool({icon:"droplet",svgIcon:index_es.dropletIcon,view:"palette",property:"background",titleKey:keys.background,ariaLabel:"Background"});BackgroundColor.displayName="BackgroundColor";var DropDownButton=__webpack_require__("./node_modules/@progress/kendo-react-buttons/dist/es/ListButton/DropDownButton.js");const alignItems=[{icon:"align-left",svgIcon:index_es.alignLeftIcon,textKey:keys.alignLeft,commandName:"textAlign",value:"left",selected:!1},{icon:"align-center",svgIcon:index_es.alignCenterIcon,textKey:keys.alignCenter,commandName:"textAlign",value:"center",selected:!1},{icon:"align-right",svgIcon:index_es.alignRightIcon,textKey:keys.alignRight,commandName:"textAlign",value:"right",selected:!1},{icon:"align-justify",svgIcon:index_es.alignJustifyIcon,textKey:keys.alignJustify,commandName:"textAlign",value:"justify",selected:!1},{icon:"align-top",svgIcon:index_es.alignTopIcon,textKey:keys.alignTop,commandName:"verticalAlign",value:"top",selected:!1},{icon:"align-middle",svgIcon:index_es.alignMiddleIcon,textKey:keys.alignMiddle,commandName:"verticalAlign",value:"center",selected:!1},{icon:"align-bottom",svgIcon:index_es.alignBottomIcon,textKey:keys.alignBottom,commandName:"verticalAlign",value:"bottom",selected:!1}],alignHorizontalItems=[alignItems[0],Object.assign(Object.assign({},alignItems[1]),{textKey:keys.center}),alignItems[2],Object.assign(Object.assign({},alignItems[3]),{textKey:keys.justify})],alignVerticalItems=alignItems.filter((i=>"verticalAlign"===i.commandName)),alignHorizontal={items:alignHorizontalItems,icon:{icon:"align-left",svgIcon:index_es.alignLeftIcon},displayName:"AlignHorizontally",titleKey:keys.alignHorizontally},alignVertical={items:alignVerticalItems,icon:{icon:"align-bottom",svgIcon:index_es.alignBottomIcon},displayName:"AlignVertically",titleKey:keys.alignVertically},createAlignTool=settings=>{const Tool=props=>{const{value,spreadsheetRef}=props,loc=(0,useLocalization.B)(),onItemClick=react.useCallback((event=>{if(spreadsheetRef.current){const item=event.item,options={command:"PropertyChangeCommand",options:{property:item.commandName,value:item.value||null}};spreadsheetRef.current.executeCommand(options)}}),[]);let items=settings.items.slice();items=items.map((i=>Object.assign(Object.assign({},i),{text:loc.toLanguageString(i.textKey,messages[i.textKey])}))),items=items.map((i=>Object.assign(Object.assign({},i),{selected:i.value===value})));const icons=Object.assign({},settings.icon),selected=items.find((i=>i.selected));return selected&&(icons.icon=selected.icon,icons.svgIcon=selected.svgIcon),react.createElement(DropDownButton.Q,Object.assign({},icons,{items,fillMode:"flat",onItemClick,title:loc.toLanguageString(settings.titleKey,messages[settings.titleKey]),text:react.createElement(IconWrap.Q,{name:"caret-alt-down",icon:index_es.caretAltDownIcon})}))};return Tool.displayName=settings.displayName,Tool},AlignHorizontally=createAlignTool(alignHorizontal),AlignVertically=createAlignTool(alignVertical),TextWrap=props=>{const{value:selected,spreadsheetRef}=props,onClick=react.useCallback((()=>{if(spreadsheetRef.current){const sheet=spreadsheetRef.current.activeSheet();if(sheet){const options={command:"TextWrapCommand",options:{property:"wrap",value:!sheet.range(sheet.activeCell()).wrap()}};spreadsheetRef.current.executeCommand(options)}}}),[]);return react.createElement(Button.$,{type:"button",togglable:!0,icon:"text-wrap",svgIcon:index_es.textWrapIcon,fillMode:"flat",title:(0,useLocalization.B)().toLanguageString(keys.textWrap,messages[keys.textWrap]),onClick,selected})};TextWrap.displayName="TextWrap";const GridLines=props=>{const{value:selected,spreadsheetRef}=props,onClick=react.useCallback((()=>{if(spreadsheetRef.current){const sheet=spreadsheetRef.current.activeSheet();if(sheet){const options={command:"GridLinesChangeCommand",options:{property:"gridLines",value:!sheet.showGridLines()}};spreadsheetRef.current.executeCommand(options)}}}),[]);return react.createElement(Button.$,{type:"button",togglable:!0,icon:"borders-none",svgIcon:index_es.bordersNoneIcon,fillMode:"flat",title:(0,useLocalization.B)().toLanguageString(keys.gridLines,messages[keys.gridLines]),onClick,selected})};GridLines.displayName="GridLines";const Format=props=>{const{spreadsheetRef}=props,onChange=react.useCallback((event=>{const value=event.item.value||null;setTimeout((()=>{if(spreadsheetRef.current){const options={command:"PropertyChangeCommand",options:{property:"format",value}};spreadsheetRef.current.executeCommand(options)}}),0)}),[]);return react.createElement(DropDownButton.Q,{icon:"custom-format",svgIcon:index_es.customFormatIcon,fillMode:"flat",onItemClick:onChange,items:FORMATS,title:(0,useLocalization.B)().toLanguageString(keys.format,messages[keys.format]),text:react.createElement(IconWrap.Q,{name:"caret-alt-down"})})};Format.displayName="Format";const TableDataTool=settings=>props=>{const{spreadsheetRef,value}=props,onClick=react.useCallback((()=>{if(spreadsheetRef.current){const options={command:settings.command,options:{value:settings.value}};spreadsheetRef.current.executeCommand(options)}}),[]);return react.createElement(Button.$,{type:"button",icon:settings.icon,svgIcon:settings.svgIcon,fillMode:"flat",title:(0,useLocalization.B)().toLanguageString(settings.titleKey,messages[settings.titleKey]),onClick,disabled:value&&settings.disabled(value)})},tableTools_addColumnLeft={command:"AddColumnCommand",value:"left",icon:"table-column-insert-left",svgIcon:index_es.tableColumnInsertLeftIcon,titleKey:keys.addColumnLeft,disabled:headers=>headers.allCols,displayName:"AddColumnLeft"},tableTools_addColumnRight={command:"AddColumnCommand",value:"right",icon:"table-column-insert-right",svgIcon:index_es.tableColumnInsertRightIcon,titleKey:keys.addColumnRight,disabled:headers=>headers.allCols,displayName:"AddColumnRight"},tableTools_addRowBelow={command:"AddRowCommand",value:"below",icon:"table-row-insert-below",svgIcon:index_es.tableRowInsertBelowIcon,titleKey:keys.addRowBelow,disabled:headers=>headers.allRows,displayName:"AddRowBelow"},tableTools_addRowAbove={command:"AddRowCommand",value:"above",icon:"table-row-insert-above",svgIcon:index_es.tableRowInsertAboveIcon,titleKey:keys.addRowAbove,disabled:headers=>headers.allRows,displayName:"AddRowAbove"},tableTools_deleteColumn={command:"DeleteColumnCommand",icon:"table-column-delete",svgIcon:index_es.tableColumnDeleteIcon,titleKey:keys.deleteColumn,disabled:headers=>headers.allCols,displayName:"DeleteColumn"},tableTools_deleteRow={command:"DeleteRowCommand",icon:"table-row-delete",svgIcon:index_es.tableRowDeleteIcon,titleKey:keys.deleteRow,disabled:headers=>headers.allRows,displayName:"DeleteRow"},AddColumnLeft=TableDataTool(tableTools_addColumnLeft),AddColumnRight=TableDataTool(tableTools_addColumnRight),AddRowBelow=TableDataTool(tableTools_addRowBelow),AddRowAbove=TableDataTool(tableTools_addRowAbove),DeleteColumn=TableDataTool(tableTools_deleteColumn),DeleteRow=TableDataTool(tableTools_deleteRow);AddColumnLeft.displayName="AddColumnLeft",AddColumnRight.displayName="AddColumnRight",AddRowBelow.displayName="AddRowBelow",AddRowAbove.displayName="AddRowAbove",DeleteColumn.displayName="DeleteColumn",DeleteRow.displayName="DeleteRow";const Undo=UndoRedo({action:"undo",icon:"reset",svgIcon:index_es.arrowRotateCcwIcon,titleKey:keys.undo});Undo.displayName="Undo";const Redo=UndoRedo({action:"redo",icon:"reload",svgIcon:index_es.arrowRotateCwIcon,titleKey:keys.redo});Redo.displayName="Redo";const adjustDecimalsTool=settings=>props=>{const{icon,svgIcon,titleKey,value}=settings,{spreadsheetRef}=props,onClick=react.useCallback((()=>{if(spreadsheetRef.current){const options={command:"AdjustDecimalsCommand",options:{value}};spreadsheetRef.current.executeCommand(options)}}),[]);return react.createElement(Button.$,{type:"button",icon,svgIcon,fillMode:"flat",onClick,title:(0,useLocalization.B)().toLanguageString(titleKey,messages[titleKey])})},IncreaseDecimal=adjustDecimalsTool({icon:index_es.decimalIncreaseIcon.name,svgIcon:index_es.decimalIncreaseIcon,value:1,titleKey:keys.increaseDecimal}),DecreaseDecimal=adjustDecimalsTool({icon:index_es.decimalDecreaseIcon.name,svgIcon:index_es.decimalDecreaseIcon,value:-1,titleKey:keys.decreaseDecimal}),defaultTabs=[{textKey:keys.file,tools:[Open,ExcelExport]},{textKey:keys.home,selected:!0,tools:[[Undo,Redo],ToolbarSeparator.l,FontFamily,FontSize,IncreaseFontSize,DecreaseFontSize,ToolbarSeparator.l,[Bold,Italic,Underline],TextColor,ToolbarSeparator.l,BackgroundColor,ToolbarSeparator.l,AlignHorizontally,AlignVertically,TextWrap,ToolbarSeparator.l,GridLines]},{textKey:keys.insert,tools:[[AddColumnLeft,AddColumnRight,AddRowBelow,AddRowAbove],ToolbarSeparator.l,[DeleteColumn,DeleteRow]]},{textKey:keys.formatTab,tools:[Format,[DecreaseDecimal,IncreaseDecimal]]}];var WatermarkOverlay=__webpack_require__("./node_modules/@progress/kendo-react-common/dist/es/watermark/WatermarkOverlay.js");const package_metadata_packageMetadata={name:"@progress/kendo-react-spreadsheet",productName:"KendoReact",productCodes:["KENDOUIREACT","KENDOUICOMPLETE"],publishDate:1695803267,version:"",licensingDocsUrl:"https://www.telerik.com/kendo-react-ui/my-license/?utm_medium=product&utm_source=kendoreact&utm_campaign=kendo-ui-react-purchase-license-keys-warning"};var useInternationalization=__webpack_require__("./node_modules/@progress/kendo-react-intl/dist/es/hooks/useInternationalization.js");const toolsFunctions=["bold","italic","underline","fontFamily","fontSize","color","background","textAlign","verticalAlign","wrap","gridLines"],toolsValueMap={Bold:state=>state.bold,Italic:state=>state.italic,Underline:state=>state.underline,FontFamily:state=>state.fontFamily,FontSize:state=>state.fontSize,IncreaseFontSize:state=>state.fontSize,DecreaseFontSize:state=>state.fontSize,TextColor:state=>state.color,BackgroundColor:state=>state.background,Alignment:state=>({textAlign:state.textAlign,verticalAlign:state.verticalAlign}),AlignHorizontally:state=>state.textAlign,AlignVertically:state=>state.verticalAlign,TextWrap:state=>state.wrap,GridLines:state=>state.gridLines,AddColumnLeft:state=>state.selectedHeaders,AddColumnRight:state=>state.selectedHeaders,AddRowBelow:state=>state.selectedHeaders,AddRowAbove:state=>state.selectedHeaders,DeleteColumn:state=>state.selectedHeaders,DeleteRow:state=>state.selectedHeaders},noInnerButton=":not(.k-dropdownlist button):not(.k-combobox button):not(.k-upload-button):not(.k-colorpicker button):not(.k-split-button .k-split-button-arrow)",toolbarButtons=["button"+noInnerButton,".k-button-group > button"+noInnerButton,".k-dropdownlist",".k-combobox",".k-colorpicker"],Spreadsheet=react.forwardRef(((props,ref)=>{(0,validate_package.$)(package_metadata_packageMetadata);const showLicenseWatermark=(0,validate_package.E)(package_metadata_packageMetadata),{toolbar=defaultTabs}=props,toolbarTools=[];"boolean"==typeof toolbar?toolbarTools.push(...toolbar?defaultTabs:[]):toolbarTools.push(...toolbar);const[dialog,setDialog]=react.useState(null),[tab,setTab]=react.useState(toolbarTools.findIndex((t=>t.selected))||0),[_init,setInit]=react.useState(!1),elementRef=react.useRef(null),formulaBarInputRef=react.useRef(null),formulaCellInputRef=react.useRef(null),nameBoxRef=react.useRef(null),spreadsheetRef=react.useRef(null),[toolsState,setToolsState]=react.useState({}),prevState=react.useRef({});prevState.current=toolsState;const propsRef=react.useRef({});propsRef.current=props;const loc=(0,useLocalization.B)(),onSelect=react.useCallback((event=>{propsRef.current.onSelect&&propsRef.current.onSelect.call(void 0,event)}),[]),onChange=react.useCallback((event=>{propsRef.current.onChange&&propsRef.current.onChange.call(void 0,event)}),[]),onChangeFormat=react.useCallback((event=>{propsRef.current.onChangeFormat&&propsRef.current.onChangeFormat.call(void 0,event)}),[]),onExcelImport=react.useCallback((event=>{propsRef.current.onExcelImport&&propsRef.current.onExcelImport.call(void 0,event)}),[]),onExcelExport=react.useCallback((event=>{propsRef.current.onExcelExport&&propsRef.current.onExcelExport.call(void 0,event)}),[]),target=react.useRef(null);react.useImperativeHandle(target,(()=>({element:elementRef.current,get instance(){return spreadsheetRef.current},props,get view(){return spreadsheetRef.current.view},get workbook(){return spreadsheetRef.current.workbook},executeCommand(options){var _a;null===(_a=spreadsheetRef.current)||void 0===_a||_a.executeCommand(options)},fromJSON(json){var _a;return null===(_a=spreadsheetRef.current)||void 0===_a?void 0:_a.fromJSON(json)},toJSON:()=>spreadsheetRef.current.toJSON(),saveJSON:()=>spreadsheetRef.current.saveJSON(),fromFile:file=>spreadsheetRef.current.fromFile(file),saveAsExcel(options){var _a;null===(_a=spreadsheetRef.current)||void 0===_a||_a.saveAsExcel(Object.assign(Object.assign(Object.assign({},spreadsheetRef.current.options.excel),{saveAs:es_main.U,Workbook:ooxml_Workbook}),options))},activeSheet(sheet){var _a;return null===(_a=spreadsheetRef.current)||void 0===_a?void 0:_a.activeSheet(sheet)},sheets:()=>spreadsheetRef.current.sheets(),refresh(){var _a;return null===(_a=spreadsheetRef.current)||void 0===_a?void 0:_a.refresh()}})),[props]),react.useImperativeHandle(ref,(()=>target.current));const nameEditor=react.useCallback((()=>spreadsheetRef.current&&spreadsheetRef.current.view.nameEditor),[]),onUpdateTools=react.useCallback((e=>{const state={};toolsFunctions.forEach((tool=>{"function"==typeof e.range[tool]?state[tool]=e.range[tool]():"gridLines"===tool&&(state[tool]=e.range.sheet().showGridLines())})),state.selectedHeaders=e.range.sheet().selectedHeaders(),(toolsFunctions.some((k=>state[k]!==prevState.current[k]))||state.selectedHeaders.allCols!==prevState.current.selectedHeaders.allCols||state.selectedHeaders.allRows!==prevState.current.selectedHeaders.allRows)&&setToolsState(state)}),[]),onMessage=react.useCallback((e=>{const name=e.name,key=keys[name];setDialog({title:"Error"===e.title?loc.toLanguageString(keys.error,messages[keys.error]||e.title):e.title,message:key?loc.toLanguageString(key,messages[key]||e.text):e.text,close:e.close})}),[]),onDialogClose=react.useCallback((()=>{setDialog(null),null==dialog||dialog.close()}),[dialog]),intl=(0,useInternationalization.a)(),localization=(0,useLocalization.B)();react.useEffect((()=>{var _a;const options=Object.assign(Object.assign({},props.defaultProps),{sheets:structuredClone(null===(_a=props.defaultProps)||void 0===_a?void 0:_a.sheets),messages:{workbook:{defaultSheetName:localization.toLanguageString(keys.defaultSheetName,messages[keys.defaultSheetName])}},intl:{localeInfo:()=>intl.localeInfo(),parseDate:(value,fmt)=>intl.parseDate(value,fmt),toString:(value,fmt)=>intl.toString(value,fmt),format:(fmt,...values)=>intl.format(fmt,...values)},formulaBarInputRef,formulaCellInputRef,nameBoxRef}),spreadsheet=new SpreadsheetWidget(elementRef.current,options);spreadsheetRef.current=spreadsheet,spreadsheet.bind("select",onSelect),spreadsheet.bind("change",onChange),spreadsheet.bind("changeFormat",onChangeFormat),spreadsheet.bind("excelImport",onExcelImport),spreadsheet.bind("excelExport",onExcelExport),spreadsheet.view.bind("update",onUpdateTools),spreadsheet.view.bind("message",onMessage);const sheet=spreadsheet.activeSheet();return sheet&&onUpdateTools({range:sheet.range(sheet.activeCell())}),setInit(!0),()=>{spreadsheet.destroy()}}),[]);const renderTool=react.useCallback(((Tool,index)=>{const tool=react.createElement(Tool,{spreadsheetRef,value:toolsValueMap[Tool.displayName]?toolsValueMap[Tool.displayName](toolsState):void 0,key:index});return tool.type===ToolbarSeparator.l?react.createElement(Tool,{key:index}):tool}),[toolsState]);let tabstrip=null;return toolbarTools.length&&(tabstrip=react.createElement(TabStrip.q,{selected:tab,animation:!1,className:"k-floatwrap k-spreadsheet-tabstrip",style:{minHeight:"auto"},onSelect:e=>setTab(e.selected)},toolbarTools.map((tabData=>{const title=tabData.textKey?localization.toLanguageString(tabData.textKey,messages[tabData.textKey]):tabData.text;return react.createElement(TabStripTab.T,{key:tabData.textKey||tabData.text,title},react.createElement(Toolbar.M,{buttons:toolbarButtons,className:"k-spreadsheet-toolbar"},tabData.tools.map(((tool,index)=>Array.isArray(tool)?react.createElement(ButtonGroup.e,{key:index},tool.map(((t,i)=>renderTool(t,i)))):renderTool(tool,index)))))})))),react.createElement("div",{ref:elementRef,style:props.style,className:(0,classNames.x)("k-widget k-spreadsheet",props.className),role:"application"},tabstrip,react.createElement("div",{className:"k-spreadsheet-action-bar"},react.createElement(NameBox,{ref:nameBoxRef,nameEditor}),react.createElement("div",{className:"k-spreadsheet-formula-bar"},react.createElement(IconWrap.Q,{name:"formula-fx",icon:index_es.formulaFxIcon}),react.createElement(FormulaInput,{ref:formulaBarInputRef}))),react.createElement("div",{className:"k-spreadsheet-view"},react.createElement("div",{className:"k-spreadsheet-fixed-container"}),react.createElement("div",{className:"k-spreadsheet-scroller"},react.createElement("div",{className:"k-spreadsheet-view-size"})),react.createElement("div",{tabIndex:0,className:"k-spreadsheet-clipboard",contentEditable:"true"}),react.createElement(FormulaInput,{ref:formulaCellInputRef,className:"k-spreadsheet-cell-editor"})),react.createElement(SheetsBar,{spreadsheetRef}),dialog&&react.createElement(Dialog.l,{title:dialog.title,onClose:onDialogClose},react.createElement("div",null,dialog.message),react.createElement(DialogActionsBar.f,{layout:"start"},react.createElement(Button.$,{themeColor:"primary",onClick:onDialogClose,autoFocus:!0},loc.toLanguageString(keys.ok,messages[keys.ok])))),showLicenseWatermark&&react.createElement(WatermarkOverlay.R,null))}));Spreadsheet.displayName="KendoReactSpreadsheet",Spreadsheet.propTypes={className:prop_types.string,defaultProps:prop_types.any,toolbar:prop_types.oneOfType([prop_types.bool,prop_types.arrayOf(prop_types.any)]),style:prop_types.object,onSelect:prop_types.func,onChange:prop_types.func,onChangeFormat:prop_types.func,onExcelImport:prop_types.func,onExcelExport:prop_types.func}}}]);